import{_ as s,c as n,o as a,a3 as l}from"./chunks/framework.zGi9i9Bf.js";const p="/ProgramLearnNotes/assets/640-1714148323181-31.DjK1xR8c.webp",o="/ProgramLearnNotes/assets/640-1714148021231-28.D_D7v7f8.webp",e="/ProgramLearnNotes/assets/640-4984949.B8gyXfRS.webp",r="/ProgramLearnNotes/assets/640-1714914507252-739.B9PbVu6P.webp",c="/ProgramLearnNotes/assets/640-1714914507252-740.DzIiYSEb.webp",t="/ProgramLearnNotes/assets/640-1714914507252-741.kRrCkDGS.webp",B="/ProgramLearnNotes/assets/640-1714914507252-742._RxZ7UF8.webp",y="/ProgramLearnNotes/assets/640-1714914507252-743.B-Z_0nnJ.webp",i="/ProgramLearnNotes/assets/640-1714914507252-744.BofPRy5P.webp",F="/ProgramLearnNotes/assets/640-1714914507252-745.6z6V3NNR.webp",A="/ProgramLearnNotes/assets/640-1715068197611-193.CU9E9797.webp",b="/ProgramLearnNotes/assets/image-20240511170544803.DW5W9uH1.png",u="/ProgramLearnNotes/assets/image-20240428021246470.BPgsfZ8q.png",m="/ProgramLearnNotes/assets/640-1715065766658-149.Dl-ol-jx.webp",C="/ProgramLearnNotes/assets/640-1715065809363-152.H_voUQy5.webp",d="/ProgramLearnNotes/assets/640-1715065809363-153.DTL-PJHQ.webp",D="/ProgramLearnNotes/assets/640-1715065861345-158.BH83Wu33.webp",E="/ProgramLearnNotes/assets/640-1715065881212-161.DQfEKHTh.webp",f="/ProgramLearnNotes/assets/640-1715065924848-164.tSv8LTCc.webp",_="/ProgramLearnNotes/assets/640-1715065981143-167.D8chce4b.webp",q="/ProgramLearnNotes/assets/640-1715065981143-168.Dh_mLdPY.webp",h="/ProgramLearnNotes/assets/640-1715066020051-173.DMgCzdxE.webp",g="/ProgramLearnNotes/assets/640-1715066058661-176.CuABF-IV.webp",x="/ProgramLearnNotes/assets/640-1715066058661-177.BPkv5Pb9.webp",v="/ProgramLearnNotes/assets/640-1715066085164-182.BWTQyKIj.webp",k="/ProgramLearnNotes/assets/640-1715066085164-183.Bl24ruLA.webp",w="/ProgramLearnNotes/assets/image-20240511163904249.CLM0lYvO.png",P="/ProgramLearnNotes/assets/image-20240511163922849.Bja4wW3s.png",S="/ProgramLearnNotes/assets/image-20240511163942229.2S7_d-Xw.png",T="/ProgramLearnNotes/assets/image-20240511164342838.C-9dWmLR.png",I="/ProgramLearnNotes/assets/image-20240511164423298.DPiLbdvd.png",N="/ProgramLearnNotes/assets/image-20240511164510019.CiIshtl7.png",L="/ProgramLearnNotes/assets/image-20240511164549862.Bl82llzD.png",j="/ProgramLearnNotes/assets/image-20240511164610981._Vw6aGfK.png",M="/ProgramLearnNotes/assets/image-20240517185959561.k07n0VLw.png",O="/ProgramLearnNotes/assets/image-20240517190011652.Ccn-qdo5.png",R="/ProgramLearnNotes/assets/image-20240605143351987.DB2FHn_t.png",H="/ProgramLearnNotes/assets/image-20240605143409737.B-jsyWQK.png",W="/ProgramLearnNotes/assets/image-20240605143420141.BKoZo70G.png",G="/ProgramLearnNotes/assets/image-20240605143518275.DjPsvzmS.png",U="/ProgramLearnNotes/assets/image-20240605143530012.T2Io6CzI.png",K="/ProgramLearnNotes/assets/image-20240511164848486.BfHz-IdD.png",z="/ProgramLearnNotes/assets/image-20240511164917121.CqX8puLu.png",Y="/ProgramLearnNotes/assets/image-20240511164928150.C57N3I7J.png",X="/ProgramLearnNotes/assets/image-20240526153035637.VZBbn957.png",V="/ProgramLearnNotes/assets/image-20240526153111986.DUR9KPp7.png",J="/ProgramLearnNotes/assets/image-20240526153218638.BbLZCkc2.png",Q="/ProgramLearnNotes/assets/image-20240511165016030.5rR5eB87.png",Z="/ProgramLearnNotes/assets/image-20240511165107665.CgdJ-P9i.png",$="/ProgramLearnNotes/assets/image-20240511165233544.BEEiGWbQ.png",ss="/ProgramLearnNotes/assets/640-48948.CCKLk5KD.webp",ns="/ProgramLearnNotes/assets/640-1716128146064-1.D3cTwrVd.webp",as="/ProgramLearnNotes/assets/image-20240514153728881.Je-JAEeG.png",ls="/ProgramLearnNotes/assets/640-1714914807650-762.BJPyGIAr.webp",ps="/ProgramLearnNotes/assets/640-1714914807650-763.BMiL-iON.webp",os="/ProgramLearnNotes/assets/640-1714914807650-764.DvMobFoS.webp",es="/ProgramLearnNotes/assets/image-20240511165332063.rESafK-g.png",rs="/ProgramLearnNotes/assets/image-20240526152206096.RjpCcB3V.png",cs="/ProgramLearnNotes/assets/image-20240526152222785.Cs0mi5aS.png",ts="/ProgramLearnNotes/assets/image-20240526152255927.BIFhUILe.png",Bs="/ProgramLearnNotes/assets/image-20240526152335719.-qRjK4BE.png",ys="/ProgramLearnNotes/assets/image-20240526152410443.DuIVPLpi.png",is="/ProgramLearnNotes/assets/image-20240526152429428.GqgeEJw1.png",Fs="/ProgramLearnNotes/assets/image-20240526152446491.CbhgrUlf.png",As="/ProgramLearnNotes/assets/640-1716128303391-6.C8h5HBGc.webp",bs="/ProgramLearnNotes/assets/640-1716128303391-7.BhDZL-KF.webp",us="/ProgramLearnNotes/assets/640-1716128303391-8.BrhR3eVt.webp",ms="/ProgramLearnNotes/assets/image-20240511165849202.CPH3HFTj.png",Cs="/ProgramLearnNotes/assets/image-20240511165902883.CpASc4Rz.png",ds="/ProgramLearnNotes/assets/image-20240511165944023.CyUNibuX.png",Ds="/ProgramLearnNotes/assets/image-20240511165955042.CZAOf1Ox.png",Es="/ProgramLearnNotes/assets/image-20240511170011096.B83jtFLf.png",fs="/ProgramLearnNotes/assets/image-20240511170146116.BukgeEF-.png",_s="/ProgramLearnNotes/assets/image-20240511170220150.DR5LXmve.png",qs="/ProgramLearnNotes/assets/image-20240511170230697.BriyZ9xJ.png",hs="/ProgramLearnNotes/assets/image-20240511170302941.Cuu02gpO.png",gs="/ProgramLearnNotes/assets/489496489.BzzoyD5p.webp",xs="/ProgramLearnNotes/assets/640-1715865487406-78.CW2QtJoL.webp",vs="/ProgramLearnNotes/assets/640-9992222.DE3Q4ndC.webp",ks="/ProgramLearnNotes/assets/640-1716211454870-156.CelLN94D.webp",ws="/ProgramLearnNotes/assets/640-1716211454870-157.BR3axaSv.webp",Ps="/ProgramLearnNotes/assets/640-1716211454870-158.DU9VZ8jw.webp",Ss="/ProgramLearnNotes/assets/640-1716211454870-159.CbKkajdx.webp",Ts="/ProgramLearnNotes/assets/image-20240511170638118.BkIshhON.png",Is="/ProgramLearnNotes/assets/image-20240511170653295.CQ66ZhKO.png",Ns="/ProgramLearnNotes/assets/image-20240511170709321.CIH1PaEL.png",Ls="/ProgramLearnNotes/assets/image-20240511170723940.COcmkNF1.png",js="/ProgramLearnNotes/assets/image-20240511170735156.BPhM6raW.png",Ms="/ProgramLearnNotes/assets/image-20240511170747321.D6gNOaGK.png",Os="/ProgramLearnNotes/assets/image-20240511170801963.Bo1RSQDW.png",Rs="/ProgramLearnNotes/assets/image-20240511170851523.DM6Vs2dZ.png",Hs="/ProgramLearnNotes/assets/image-20240511170909563.BcgY1Vfb.png",Ws="/ProgramLearnNotes/assets/image-20240511171006983.CPDJudln.png",Gs="/ProgramLearnNotes/assets/image-20240511171027590.BsnOGuge.png",Us="/ProgramLearnNotes/assets/image-20240511171058971.6__fQTWD.png",Ks="/ProgramLearnNotes/assets/image-20240513165835111.C91oHjlE.png",zs="/ProgramLearnNotes/assets/image-20240513165911570.CwiHwpBD.png",Ys="/ProgramLearnNotes/assets/image-20240513165937452.u00aKSSR.png",Xs="/ProgramLearnNotes/assets/image-20240513165947756.CFnovzVl.png",Vs="/ProgramLearnNotes/assets/image-20240513170027955.BkvG2vy7.png",Js="/ProgramLearnNotes/assets/image-20240513170050286.B8E36ha9.png",Qs="/ProgramLearnNotes/assets/image-20240513170059555.Tvp16Dvk.png",Zs="/ProgramLearnNotes/assets/image-20240511171206902.DOFfwJIy.png",$s="/ProgramLearnNotes/assets/image-20240511171216652.72U5w0iG.png",sn="/ProgramLearnNotes/assets/image-20240511171352762.BCEmnitg.png",nn="/ProgramLearnNotes/assets/image-20240511171410934.BMd8dS0_.png",an="/ProgramLearnNotes/assets/image-20240511171425260.BRPP2Ijl.png",ln="/ProgramLearnNotes/assets/image-20240511171609709.DctRVu-T.png",pn="/ProgramLearnNotes/assets/image-20240511171620516.CiDdX2PB.png",on="/ProgramLearnNotes/assets/image-20240511171634401.snzY1-Yj.png",en="/ProgramLearnNotes/assets/image-20240511171659774.DG4ctwGc.png",rn="/ProgramLearnNotes/assets/image-20240511171712733.JgJVMaJw.png",cn="/ProgramLearnNotes/assets/image-20240511171730682.cn_ho2Sh.png",tn="/ProgramLearnNotes/assets/image-20240511171746907.CFl-Js5t.png",Bn="/ProgramLearnNotes/assets/640-1715765080431-74.hExGIKnx.webp",yn="/ProgramLearnNotes/assets/640-1715765080432-75.DrEEUt-9.webp",Fn="/ProgramLearnNotes/assets/image-20240516212224824.CCdwcKIy.png",An="/ProgramLearnNotes/assets/image-20240516212431669.Dh9YJ1Uk.png",bn="/ProgramLearnNotes/assets/image-20240516212538600.CSM0yR6k.png",xn=JSON.parse('{"title":"Python 脚本开发","description":"","frontmatter":{},"headers":[],"relativePath":"Document/Python/Python脚本开发.md","filePath":"Document/Python/Python脚本开发.md","lastUpdated":1717757371000}'),un={name:"Document/Python/Python脚本开发.md"},mn=l(`<h1 id="python-脚本开发" tabindex="-1">Python 脚本开发 <a class="header-anchor" href="#python-脚本开发" aria-label="Permalink to &quot;Python 脚本开发&quot;">​</a></h1><h2 id="玩转-python30-个实用脚本解锁自动化大法" tabindex="-1">玩转 Python30 个实用脚本解锁自动化大法 <a class="header-anchor" href="#玩转-python30-个实用脚本解锁自动化大法" aria-label="Permalink to &quot;玩转 Python30 个实用脚本解锁自动化大法&quot;">​</a></h2><p>让我们从基础到进阶，一步步来学习这些神奇的代码片段吧。</p><p><strong>1.</strong> <code>hello_world.py</code>: 这是 Python 入门的第一课，打印出&quot;Hello, World!&quot;，让你知道你已经上路了。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> print_hello</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Hello, World!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">print_hello</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>2.</strong> <code>countdown.py</code>: 让我们来个倒计时，输入一个数字，然后从大到小数数。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> countdown</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">n</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(n)</span></span>
<span class="line"><span style="color:#ABB2BF;">        n </span><span style="color:#56B6C2;">-=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">countdown</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>3.</strong> <code>file_reader.py</code>: 打开文件，读取内容，轻松查看文本。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> read_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_name, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        content </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> content</span></span>
<span class="line"><span style="color:#ABB2BF;">content </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> read_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.txt&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>4.</strong> <code>email_sender.py</code>: 发送一封简单的邮件通知，用起来就像发短信一样简单。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">to</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">subject</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">message</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 实例化SMTP服务器...</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(from_addr, to, message)</span></span>
<span class="line"><span style="color:#61AFEF;">send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;you@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;自动邮件&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;这是你的提醒邮件！&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>5.</strong> <code>web_scraper.py</code>: 爬虫初体验，抓取网页数据，比如新闻标题。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_news_titles</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    titles </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.html.</span><span style="color:#61AFEF;">find_all</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;h2&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> [title.text </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> title </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> titles]</span></span>
<span class="line"><span style="color:#ABB2BF;">titles </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_news_titles</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://news.example.com&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>6.</strong> <code>csv_sorter.py</code>: 读取 CSV 文件，按特定列排序，保持数据整洁。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> sort_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">column</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(input_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    sorted_df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df.</span><span style="color:#61AFEF;">sort_values</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">column)</span></span>
<span class="line"><span style="color:#ABB2BF;">    sorted_df.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sorted_&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> input_file, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">sort_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;date&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>7.</strong> <code>image_resizer.py</code>: 图片处理小能手，调整图片大小。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> resize_image</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">image_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">new_size</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(image_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">    resized_img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> img.</span><span style="color:#61AFEF;">resize</span><span style="color:#ABB2BF;">(new_size)</span></span>
<span class="line"><span style="color:#ABB2BF;">    resized_img.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;resized_&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> image_path)</span></span>
<span class="line"><span style="color:#61AFEF;">resize_image</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;pic.jpg&#39;</span><span style="color:#ABB2BF;">, (</span><span style="color:#D19A66;">800</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">600</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>8.</strong> <code>password_generator.py</code>: 自动创建随机密码，安全又多样。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> string</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> generate_password</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">length</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    chars </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> string.ascii_letters </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> string.digits </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> string.punctuation</span></span>
<span class="line"><span style="color:#ABB2BF;">    password </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">choice</span><span style="color:#ABB2BF;">(chars) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> _ </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(length))</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> password</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">generate_password</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>9.</strong> <code>daily_weather.py</code>: 获取并显示当地天气，每天都不一样。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_weather</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">city</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # API请求...</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> weather_data[</span><span style="color:#98C379;">&#39;description&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">city_weather </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_weather</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;New York&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>10.</strong> <code>task_scheduler.py</code>: 设定定时任务，自动完成每日例行公事。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> schedule, time</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> job_function</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 你的任务...</span></span>
<span class="line"><span style="color:#ABB2BF;">schedule.</span><span style="color:#61AFEF;">every</span><span style="color:#ABB2BF;">().day.</span><span style="color:#61AFEF;">at</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;10:00&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">do</span><span style="color:#ABB2BF;">(job_function)</span></span>
<span class="line"><span style="color:#C678DD;">while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    schedule.</span><span style="color:#61AFEF;">run_pending</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>11.</strong> <code>excel_data_analyzer.py</code>: 分析 Excel 数据，找出趋势和异常值。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> analyze_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 数据分析...</span></span>
<span class="line"><span style="color:#ABB2BF;">    summary </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> summary</span></span>
<span class="line"><span style="color:#ABB2BF;">report </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> analyze_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sales_data.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>12.</strong> <code>csv_to_json.py</code>: 将 CSV 转换为 JSON，方便数据交换。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> csv</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> csv_to_json</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">csv_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">json_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(csv_file, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> csv_data, </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(json_file, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> json_data:</span></span>
<span class="line"><span style="color:#ABB2BF;">        reader </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">DictReader</span><span style="color:#ABB2BF;">(csv_data)</span></span>
<span class="line"><span style="color:#ABB2BF;">        json_data.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;[</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> reader:</span></span>
<span class="line"><span style="color:#ABB2BF;">            json_data.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">{{</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">()[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;: &quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row[row.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">()[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">}}\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        json_data.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;]</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">csv_to_json</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;input.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;output.json&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>13.</strong> <code>email_attachment_sender.py</code>: 发送带附件的电子邮件，文件管理变得更简单。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> send_email_with_attachment</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">to</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">subject</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">msg</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">attachment_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 添加附件...</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(from_addr, to, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;Subject: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">subject</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\n\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">msg</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 发送...</span></span>
<span class="line"><span style="color:#61AFEF;">send_email_with_attachment</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;recipient@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;附件邮件&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;邮件正文&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;document.pdf&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>14.</strong> <code>text_summary_generator.py</code>: 自动生成文本摘要，节省阅读时间。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> gensim.summarization </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> summarize</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> create_summary</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">text</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#61AFEF;"> summarize</span><span style="color:#ABB2BF;">(text)</span></span>
<span class="line"><span style="color:#ABB2BF;">summary </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> create_summary</span><span style="color:#ABB2BF;">(long_text)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>15.</strong> <code>git_tracker.py</code>: 自动跟踪并记录 Git 提交信息，整理项目历史。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> subprocess</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> git_log</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">repo_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    log </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subprocess.</span><span style="color:#61AFEF;">check_output</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;git&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;log&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;--oneline&#39;</span><span style="color:#ABB2BF;">, repo_path])</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> log.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">commit_history </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> git_log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>16.</strong> <code>pdf_watermarker.py</code>: 在 PDF 上添加水印，保护版权或个性化。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> PyPDF2 </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PdfWriter, PdfReader</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> add_watermark</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_pdf</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_pdf</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">watermark</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    pdf_writer </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PdfWriter</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    pdf_reader </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PdfReader</span><span style="color:#ABB2BF;">(input_pdf)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> page_num </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(pdf_reader.numPages):</span></span>
<span class="line"><span style="color:#ABB2BF;">        page </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pdf_reader.</span><span style="color:#61AFEF;">getPage</span><span style="color:#ABB2BF;">(page_num)</span></span>
<span class="line"><span style="color:#ABB2BF;">        page.</span><span style="color:#61AFEF;">mergePage</span><span style="color:#ABB2BF;">(watermark)</span></span>
<span class="line"><span style="color:#ABB2BF;">        pdf_writer.</span><span style="color:#61AFEF;">addPage</span><span style="color:#ABB2BF;">(page)</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(output_pdf, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> out:</span></span>
<span class="line"><span style="color:#ABB2BF;">        pdf_writer.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(out)</span></span>
<span class="line"><span style="color:#ABB2BF;">watermark_pdf </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> add_watermark</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;original.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;watermarked.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;COPYRIGHT&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>17.</strong> <code>webhook_handler.py</code>: 监听 API webhook，自动化处理外部事件。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> handle_webhook</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 解析数据...</span></span>
<span class="line"><span style="color:#61AFEF;">    process_data</span><span style="color:#ABB2BF;">(data)</span></span>
<span class="line"><span style="color:#61AFEF;">handle_webhook</span><span style="color:#ABB2BF;">(requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;http://your-webhook-url.com&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>18.</strong> <code>database_connector.py</code>: 连接数据库，执行 SQL 查询或操作。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sqlite3</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> query_database</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">query</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    conn </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sqlite3.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;database.db&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    cursor </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> conn.</span><span style="color:#61AFEF;">cursor</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(query)</span></span>
<span class="line"><span style="color:#ABB2BF;">    results </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cursor.</span><span style="color:#61AFEF;">fetchall</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    conn.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> results</span></span>
<span class="line"><span style="color:#ABB2BF;">query_results </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> query_database</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;SELECT * FROM users&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>19.</strong> <code>csv_splitter.py</code>: 将大文件切分成多个小文件，方便管理和处理。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> csv</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> split_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">chunk_size</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(input_file, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> csv_in, \\</span></span>
<span class="line"><span style="color:#56B6C2;">         open</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;split_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">input_file</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> csv_out:</span></span>
<span class="line"><span style="color:#ABB2BF;">        reader </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">reader</span><span style="color:#ABB2BF;">(csv_in)</span></span>
<span class="line"><span style="color:#ABB2BF;">        writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">writer</span><span style="color:#ABB2BF;">(csv_out)</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> i, chunk </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(reader, </span><span style="color:#E06C75;font-style:italic;">start</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> i </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> chunk_size </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                csv_out.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                csv_in.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                new_file </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;split_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">i</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.csv&#39;</span></span>
<span class="line"><span style="color:#C678DD;">                with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(new_file, </span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> new_csv_out:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">writer</span><span style="color:#ABB2BF;">(new_csv_out)</span></span>
<span class="line"><span style="color:#ABB2BF;">            writer.</span><span style="color:#61AFEF;">writerow</span><span style="color:#ABB2BF;">(chunk)</span></span>
<span class="line"><span style="color:#61AFEF;">split_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;large_data.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>20.</strong> <code>csv_combiner.py</code>: 合并多个 CSV 文件为一个，简化数据集成过程。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> glob</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> combine_csvs</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    dfs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> glob.</span><span style="color:#61AFEF;">glob</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">directory</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/*.csv&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        dfs.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    combined_df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(dfs, </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    combined_df.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;combined_data.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">combine_csvs</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;split_data/&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>21.</strong> <code>csv_cleaner.py</code>: 自动清理 CSV 中的重复项和缺失值。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> clean_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(input_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df.</span><span style="color:#61AFEF;">drop_duplicates</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df.</span><span style="color:#61AFEF;">dropna</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    df.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;cleaned_&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> input_file, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">clean_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;dirty_data.csv&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>22.</strong> <code>file_uploader.py</code>: 上传文件到云存储服务，如 Google Drive 或 Dropbox。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> google.oauth2.credentials </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Credentials</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> googleapiclient.discovery </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> build</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> upload_to_drive</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">credentials_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    service </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> build</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;drive&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;v3&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">credentials</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">Credentials.</span><span style="color:#61AFEF;">from_authorized_user_file</span><span style="color:#ABB2BF;">(credentials_path))</span></span>
<span class="line"><span style="color:#ABB2BF;">    file_metadata </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">: file_path}</span></span>
<span class="line"><span style="color:#ABB2BF;">    media </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MediaFileUpload</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#E06C75;font-style:italic;">resumable</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">    file</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> service.</span><span style="color:#61AFEF;">files</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">body</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">file_metadata, </span><span style="color:#E06C75;font-style:italic;">media_body</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">media, </span><span style="color:#E06C75;font-style:italic;">fields</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">upload_to_drive</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;uploaded_file.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;credentials.json&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>23.</strong> <code>time_tracker.py</code>: 记录和分析工作时间，提升生产力。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> start_stop_timer</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">task_name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    start_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # ...开始计时...</span></span>
<span class="line"><span style="color:#ABB2BF;">    end_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    total_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> end_time </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> start_time</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">task_name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> completed in </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">total_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">start_stop_timer</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Writing code&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>24.</strong> <code>data_visualizer.py</code>: 生成图表，让复杂数据可视化。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> matplotlib.pyplot </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> plt</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> plot_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">x</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">y</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">plot</span><span style="color:#ABB2BF;">(x, y)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">xlabel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;X-axis&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">ylabel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Y-axis&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Data Visualization&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">show</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">x </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">y </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">40</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#61AFEF;">plot_data</span><span style="color:#ABB2BF;">(x, y)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>25.</strong> <code>webpage_screenshot.py</code>: 自动抓取网页截图，用于报告或存档。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pyautogui</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> take_screenshot</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # ...使用Selenium或类似工具...</span></span>
<span class="line"><span style="color:#ABB2BF;">    pyautogui.</span><span style="color:#61AFEF;">screenshot</span><span style="color:#ABB2BF;">(output_path)</span></span>
<span class="line"><span style="color:#61AFEF;">take_screenshot</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;screenshot.png&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>26.</strong> <code>csv_split_by_date.py</code>: 根据日期范围分割 CSV 文件。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> split_by_date</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">start_date</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">end_date</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(input_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    sliced_df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[(df[</span><span style="color:#98C379;">&#39;date&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> start_date) </span><span style="color:#56B6C2;">&amp;</span><span style="color:#ABB2BF;"> (df[</span><span style="color:#98C379;">&#39;date&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#ABB2BF;"> end_date)]</span></span>
<span class="line"><span style="color:#ABB2BF;">    sliced_df.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;split_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">start_date</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">end_date</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">split_by_date</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sales_data.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;2022-01-01&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;2022-03-31&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>27.</strong> <code>email_report_generator.py</code>: 自动生成并发送定期销售报告。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib, xlsxwriter</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> generate_sales_report</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">report_data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> xlsxwriter.</span><span style="color:#61AFEF;">Workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sales_report.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # ...生成报告...</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">    send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;team@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Sales Report&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Please find attached the latest sales report.&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sales_report.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        attach </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;sales_report.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">...</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">attach</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">attach)</span></span>
<span class="line"><span style="color:#61AFEF;">generate_sales_report</span><span style="color:#ABB2BF;">(sales_data)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>28.</strong> <code>file_encryptor.py</code>: 加密文件，保护敏感信息。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> cryptography.fernet </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Fernet</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> encrypt_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">key</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    cipher_suite </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Fernet</span><span style="color:#ABB2BF;">(key)</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(input_file, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        original_data </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    encrypted_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cipher_suite.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(original_data)</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;encrypted_&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> input_file, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> encrypted_file:</span></span>
<span class="line"><span style="color:#ABB2BF;">        encrypted_file.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(encrypted_data)</span></span>
<span class="line"><span style="color:#61AFEF;">encrypt_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;confidential.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;your_secret_key&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>29.</strong> <code>csv_data_validation.py</code>: 检查 CSV 数据一致性，避免错误。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> validate_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">validation_rules</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(input_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    errors </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df.</span><span style="color:#61AFEF;">apply</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">lambda</span><span style="color:#D19A66;font-style:italic;"> row</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">all</span><span style="color:#ABB2BF;">(row[col]符合验证规则 </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> col </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> validation_rules), </span><span style="color:#E06C75;font-style:italic;">axis</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> errors.</span><span style="color:#61AFEF;">value_counts</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">validation_results </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> validate_data</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data.csv&#39;</span><span style="color:#ABB2BF;">, {</span><span style="color:#98C379;">&#39;email&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;^</span><span style="color:#D19A66;">[</span><span style="color:#E06C75;">\\w</span><span style="color:#56B6C2;">\\.</span><span style="color:#D19A66;">-]+</span><span style="color:#E06C75;">@</span><span style="color:#D19A66;">[</span><span style="color:#E06C75;">\\w</span><span style="color:#56B6C2;">\\.</span><span style="color:#D19A66;">-]+</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">\\w</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">$&#39;</span><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>30.</strong> <code>web_crawler_and_scraper.py</code>: 爬取网站信息并存储到 CSV 或数据库中。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> scrapy</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> MySpider</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">scrapy</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Spider</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    name </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;myspider&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    start_urls </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;http://example.com&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> parse</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">response</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # ...解析HTML...</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;title&#39;</span><span style="color:#ABB2BF;">: response.</span><span style="color:#61AFEF;">css</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;h1::text&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;description&#39;</span><span style="color:#ABB2BF;">: response.</span><span style="color:#61AFEF;">css</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;p::text&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;">        yield</span><span style="color:#ABB2BF;"> {k: v </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> k, v </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">()}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> store_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">item</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # ...存储到CSV或数据库...</span></span>
<span class="line"><span style="color:#ABB2BF;">spider </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MySpider</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">spider.</span><span style="color:#61AFEF;">crawl</span><span style="color:#ABB2BF;">(spider)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这些脚本涵盖了从基本操作到更复杂的任务，现在你已经掌握了 30 个 Python 自动化脚本，可以开始在实际项目中大展身手了！记得不断实践，你的 Python 技能会越来越棒！</p><h1 id="京东自动预约和抢购某台脚本" tabindex="-1">京东自动预约和抢购某台脚本 <a class="header-anchor" href="#京东自动预约和抢购某台脚本" aria-label="Permalink to &quot;京东自动预约和抢购某台脚本&quot;">​</a></h1><p>代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> functools</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pickle</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> lxml </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> etree</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> jd_logger </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> logger</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> timer </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Timer</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> config </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> global_config</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> concurrent.futures </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ProcessPoolExecutor</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> exception </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> SKException</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> util </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    parse_json,</span></span>
<span class="line"><span style="color:#ABB2BF;">    send_wechat,</span></span>
<span class="line"><span style="color:#ABB2BF;">    wait_some_time,</span></span>
<span class="line"><span style="color:#ABB2BF;">    response_status,</span></span>
<span class="line"><span style="color:#ABB2BF;">    save_image,</span></span>
<span class="line"><span style="color:#ABB2BF;">    open_image</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> SpiderSession</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    Session相关操作</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.cookies_dir_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;./cookies/&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.user_agent </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;config&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;DEFAULT_USER_AGENT&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_init_session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _init_session</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        session </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        session.headers </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_headers</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> session</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_headers</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;User-Agent&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;Accept&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;text/html,application/xhtml+xml,application/xml;&quot;</span></span>
<span class="line"><span style="color:#98C379;">                          &quot;q=0.9,image/webp,image/apng,*/*;&quot;</span></span>
<span class="line"><span style="color:#98C379;">                          &quot;q=0.8,application/signed-exchange;&quot;</span></span>
<span class="line"><span style="color:#98C379;">                          &quot;v=b3&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;Connection&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;keep-alive&quot;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_user_agent</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_session</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取当前Session</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_cookies</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取当前Cookies</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_session</span><span style="color:#ABB2BF;">().cookies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> set_cookies</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">cookies</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session.cookies.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(cookies)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> load_cookies_from_local</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        从本地加载Cookie</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        cookies_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.cookies_dir_path):</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.cookies_dir_path):</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> name.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.cookies&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                cookies_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;</span><span style="color:#D19A66;">{}{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.cookies_dir_path, name)</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> cookies_file </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(cookies_file, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">            local_cookies </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pickle.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">(f)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">set_cookies</span><span style="color:#ABB2BF;">(local_cookies)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> save_cookies_to_local</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">cookie_file_name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        保存Cookie到本地</span></span>
<span class="line"><span style="color:#98C379;">        :param cookie_file_name: 存放Cookie的文件名称</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        cookies_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;</span><span style="color:#D19A66;">{}{}</span><span style="color:#98C379;">.cookies&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.cookies_dir_path, cookie_file_name)</span></span>
<span class="line"><span style="color:#ABB2BF;">        directory </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">dirname</span><span style="color:#ABB2BF;">(cookies_file)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(directory):</span></span>
<span class="line"><span style="color:#ABB2BF;">            os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(directory)</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(cookies_file, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">            pickle.</span><span style="color:#61AFEF;">dump</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_cookies</span><span style="color:#ABB2BF;">(), f)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> QrLogin</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    扫码登录</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">spider_session</span><span style="color:#ABB2BF;">: SpiderSession):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        初始化扫码登录</span></span>
<span class="line"><span style="color:#98C379;">        大致流程：</span></span>
<span class="line"><span style="color:#98C379;">            1、访问登录二维码页面，获取Token</span></span>
<span class="line"><span style="color:#98C379;">            2、使用Token获取票据</span></span>
<span class="line"><span style="color:#98C379;">            3、校验票据</span></span>
<span class="line"><span style="color:#98C379;">        :param spider_session:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.qrcode_img_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;qr_code.png&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.spider_session </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> spider_session</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.is_login </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_login_status</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> refresh_login_status</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        刷新是否登录状态</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.is_login </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_validate_cookies</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _validate_cookies</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        验证cookies是否有效（是否登陆）</span></span>
<span class="line"><span style="color:#98C379;">        通过访问用户订单列表页进行判断：若未登录，将会重定向到登陆页面。</span></span>
<span class="line"><span style="color:#98C379;">        :return: cookies是否有效 True/False</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://order.jd.com/center/list.action&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;rid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload, </span><span style="color:#E06C75;font-style:italic;">allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> resp.status_code </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> requests.codes.</span><span style="color:#D19A66;">OK</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;验证cookies是否有效发生异常&quot;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _get_login_page</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取PC端登录页面</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;https://passport.jd.com/new/login.aspx&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        page </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_headers</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> page</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _get_qrcode</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        缓存并展示登录二维码</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://qr.m.jd.com/show&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;appid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">133</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;size&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">147</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;t&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_user_agent</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://passport.jd.com/new/login.aspx&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#61AFEF;"> response_status</span><span style="color:#ABB2BF;">(resp):</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;获取二维码失败&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">        save_image</span><span style="color:#ABB2BF;">(resp, </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.qrcode_img_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;二维码获取成功，请打开京东APP扫描&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        open_image</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.qrcode_img_file)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _get_qrcode_ticket</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        通过 token 获取票据</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://qr.m.jd.com/check&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;appid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;133&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;callback&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;jQuery</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000000</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">9999999</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;token&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.cookies.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;wlfstk_smdl&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;_&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_user_agent</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://passport.jd.com/new/login.aspx&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#61AFEF;"> response_status</span><span style="color:#ABB2BF;">(resp):</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;获取二维码扫描结果异常&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> parse_json</span><span style="color:#ABB2BF;">(resp.text)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> resp_json[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Code: </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">, Message: </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, resp_json[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">], resp_json[</span><span style="color:#98C379;">&#39;msg&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;已完成手机客户端确认&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> resp_json[</span><span style="color:#98C379;">&#39;ticket&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _validate_qrcode_ticket</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">ticket</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        通过已获取的票据进行校验</span></span>
<span class="line"><span style="color:#98C379;">        :param ticket: 已获取的票据</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://passport.jd.com/uc/qrCodeTicketValidation&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_user_agent</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://passport.jd.com/uc/login?ltype=logout&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;t&#39;</span><span style="color:#ABB2BF;">: ticket})</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#61AFEF;"> response_status</span><span style="color:#ABB2BF;">(resp):</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(resp.text)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> resp_json[</span><span style="color:#98C379;">&#39;returnCode&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(resp_json)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login_by_qrcode</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        二维码登陆</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get_login_page</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # download QR code</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get_qrcode</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#61AFEF;"> SKException</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;二维码下载失败&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # get QR code ticket</span></span>
<span class="line"><span style="color:#ABB2BF;">        ticket </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        retry_times </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 85</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> _ </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(retry_times):</span></span>
<span class="line"><span style="color:#ABB2BF;">            ticket </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get_qrcode_ticket</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> ticket:</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#61AFEF;"> SKException</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;二维码过期，请重新获取扫描&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # validate QR code ticket</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_validate_qrcode_ticket</span><span style="color:#ABB2BF;">(ticket):</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#61AFEF;"> SKException</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;二维码信息校验失败&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_login_status</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;二维码登录成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> JdSeckill</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.spider_session </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> SpiderSession</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">load_cookies_from_local</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.qrlogin </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> QrLogin</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.spider_session)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 初始化信息</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.sku_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;config&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;sku_id&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_num </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_init_info </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_url </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_order_data </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.timers </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Timer</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.user_agent </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.spider_session.user_agent</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.nick_name </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login_by_qrcode</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        二维码登陆</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.qrlogin.is_login:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;登录成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.qrlogin.</span><span style="color:#61AFEF;">login_by_qrcode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.qrlogin.is_login:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.nick_name </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_username</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">save_cookies_to_local</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.nick_name)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#61AFEF;"> SKException</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;二维码登录失败！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> check_login</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">func</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        用户登陆态校验装饰器。若用户未登陆，则调用扫码登陆</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">        @functools</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wraps</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">func</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        def</span><span style="color:#61AFEF;"> new_func</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, *</span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.qrlogin.is_login:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{0}</span><span style="color:#98C379;"> 需登陆后调用，开始扫码登陆&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(func.</span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login_by_qrcode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#61AFEF;"> func</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, *args, **kwargs)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> new_func</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @check_login</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> reserve</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        预约</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_reserve</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @check_login</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> seckill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        抢购</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_seckill</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @check_login</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> seckill_by_proc_pool</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">work_count</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        多进程进行抢购</span></span>
<span class="line"><span style="color:#98C379;">        work_count：进程数量</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#61AFEF;"> ProcessPoolExecutor</span><span style="color:#ABB2BF;">(work_count) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pool:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(work_count):</span></span>
<span class="line"><span style="color:#ABB2BF;">                pool.</span><span style="color:#61AFEF;">submit</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _reserve</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        预约</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">make_reserve</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;预约发生异常!&#39;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"><span style="color:#61AFEF;">            wait_some_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _seckill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        抢购</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">request_seckill_url</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">request_seckill_checkout_page</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">submit_seckill_order</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购发生异常，稍后继续执行！&#39;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"><span style="color:#61AFEF;">            wait_some_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> make_reserve</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;商品预约&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;商品名称:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_sku_title</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://yushou.jd.com/youshouinfo.action?&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;callback&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;fetchJSON&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;sku&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;_&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://item.jd.com/</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">.html&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> parse_json</span><span style="color:#ABB2BF;">(resp.text)</span></span>
<span class="line"><span style="color:#ABB2BF;">        reserve_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.timers.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;https:&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> reserve_url)</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;预约成功，已获得抢购资格 / 您已成功预约过了，无需重复预约&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;messenger&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;enable&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;true&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    success_message </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;预约成功，已获得抢购资格 / 您已成功预约过了，无需重复预约&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">                    send_wechat</span><span style="color:#ABB2BF;">(success_message)</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;预约失败正在重试...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_username</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;获取用户信息&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://passport.jd.com/user/petName/getUserInfoForMiniJd.action&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;callback&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;jQuery</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000000</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">9999999</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;_&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://order.jd.com/center/list.action&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        try_count </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 5</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> resp.text.</span><span style="color:#61AFEF;">startswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;jQuery&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            try_count </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> try_count </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> try_count </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#61AFEF;">            wait_some_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 响应中包含了许多用户信息，现在在其中返回昵称</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # jQuery2381773({&quot;imgUrl&quot;:&quot;//storage.360buyimg.com/i.imageUpload/xxx.jpg&quot;,&quot;lastLoginTime&quot;:&quot;&quot;,&quot;nickName&quot;:&quot;xxx&quot;,&quot;plusStatus&quot;:&quot;0&quot;,&quot;realName&quot;:&quot;xxx&quot;,&quot;userLevel&quot;:x,&quot;userScoreVO&quot;:{&quot;accountScore&quot;:xx,&quot;activityScore&quot;:xx,&quot;consumptionScore&quot;:xxxxx,&quot;default&quot;:false,&quot;financeScore&quot;:xxx,&quot;pin&quot;:&quot;xxx&quot;,&quot;riskScore&quot;:x,&quot;totalScore&quot;:xxxxx}})</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#61AFEF;"> parse_json</span><span style="color:#ABB2BF;">(resp.text).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;nickName&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_sku_title</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;获取商品名称&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://item.jd.com/</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">.html&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;config&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;sku_id&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url).content</span></span>
<span class="line"><span style="color:#ABB2BF;">        x_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> etree.</span><span style="color:#61AFEF;">HTML</span><span style="color:#ABB2BF;">(resp)</span></span>
<span class="line"><span style="color:#ABB2BF;">        sku_title </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> x_data.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/head/title/text()&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> sku_title[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_seckill_url</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;获取商品的抢购链接</span></span>
<span class="line"><span style="color:#98C379;">        点击&quot;抢购&quot;按钮后，会有两次302跳转，最后到达订单结算页面</span></span>
<span class="line"><span style="color:#98C379;">        这里返回第一次跳转后的页面url，作为商品的抢购链接</span></span>
<span class="line"><span style="color:#98C379;">        :return: 商品的抢购链接</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://itemko.jd.com/itemShowBtn&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;callback&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;jQuery</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000000</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">9999999</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;skuId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;from&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;pc&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;_&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Host&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;itemko.jd.com&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://item.jd.com/</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">.html&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#ABB2BF;">            resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> parse_json</span><span style="color:#ABB2BF;">(resp.text)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # https://divide.jd.com/user_routing?skuId=8654289&amp;sn=c3f4ececd8461f0e4d7267e96a91e0e0&amp;from=pc</span></span>
<span class="line"><span style="color:#ABB2BF;">                router_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https:&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # https://marathon.jd.com/captcha.html?skuId=8654289&amp;sn=c3f4ececd8461f0e4d7267e96a91e0e0&amp;from=pc</span></span>
<span class="line"><span style="color:#ABB2BF;">                seckill_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> router_url.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;divide&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;marathon&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;user_routing&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;captcha.html&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢购链接获取成功: </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">, seckill_url)</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#ABB2BF;"> seckill_url</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢购链接获取失败，稍后自动重试&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                wait_some_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> request_seckill_url</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;访问商品的抢购链接（用于设置cookie等&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;用户:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_username</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;商品名称:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_sku_title</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.timers.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_url[</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id] </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_seckill_url</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;访问商品的抢购连接...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Host&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;marathon.jd.com&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://item.jd.com/</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">.html&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            url</span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_url.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.sku_id),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> request_seckill_checkout_page</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;访问抢购订单结算页面&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;访问抢购订单结算页面...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://marathon.jd.com/seckill/seckill.action&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;skuId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;num&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_num,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;rid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Host&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;marathon.jd.com&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://item.jd.com/</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">.html&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _get_seckill_init_info</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;获取秒杀初始化信息（包括：地址，发票，token）</span></span>
<span class="line"><span style="color:#98C379;">        :return: 初始化信息组成的dict</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;获取秒杀初始化信息...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://marathon.jd.com/seckillnew/orderService/pc/init.action&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;sku&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;num&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_num,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;isModifyAddress&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;false&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Host&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;marathon.jd.com&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> parse_json</span><span style="color:#ABB2BF;">(resp.text)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#61AFEF;"> SKException</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购失败，返回信息:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(resp.text[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">128</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> resp_json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _get_seckill_order_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;生成提交抢购订单所需的请求体参数</span></span>
<span class="line"><span style="color:#98C379;">        :return: 请求体参数组成的dict</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;生成提交抢购订单所需参数...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 获取用户秒杀初始化信息</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_init_info[</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id] </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get_seckill_init_info</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        init_info </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.seckill_init_info.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id)</span></span>
<span class="line"><span style="color:#ABB2BF;">        default_address </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> init_info[</span><span style="color:#98C379;">&#39;addressList&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]  </span><span style="color:#7F848E;font-style:italic;"># 默认地址dict</span></span>
<span class="line"><span style="color:#ABB2BF;">        invoice_info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> init_info.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;invoiceInfo&#39;</span><span style="color:#ABB2BF;">, {})  </span><span style="color:#7F848E;font-style:italic;"># 默认发票信息dict, 有可能不返回</span></span>
<span class="line"><span style="color:#ABB2BF;">        token </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> init_info[</span><span style="color:#98C379;">&#39;token&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;skuId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;num&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_num,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;addressId&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;yuShou&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;true&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;isModifyAddress&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;false&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;name&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;provinceId&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;provinceId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;cityId&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;cityId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;countyId&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;countyId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;townId&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;townId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;addressDetail&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;addressDetail&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;mobile&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;mobile&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;mobileKey&#39;</span><span style="color:#ABB2BF;">: default_address[</span><span style="color:#98C379;">&#39;mobileKey&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;email&#39;</span><span style="color:#ABB2BF;">: default_address.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;email&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;postCode&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceTitle&#39;</span><span style="color:#ABB2BF;">: invoice_info.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;invoiceTitle&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceCompanyName&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceContent&#39;</span><span style="color:#ABB2BF;">: invoice_info.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;invoiceContentType&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceTaxpayerNO&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceEmail&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoicePhone&#39;</span><span style="color:#ABB2BF;">: invoice_info.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;invoicePhone&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoicePhoneKey&#39;</span><span style="color:#ABB2BF;">: invoice_info.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;invoicePhoneKey&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoice&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;true&#39;</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> invoice_info </span><span style="color:#C678DD;">else</span><span style="color:#98C379;"> &#39;false&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;password&#39;</span><span style="color:#ABB2BF;">: global_config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;account&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;payment_pwd&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;codTimeType&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;paymentType&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;areaCode&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;overseas&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;phone&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;eid&#39;</span><span style="color:#ABB2BF;">: global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;config&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;eid&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;fp&#39;</span><span style="color:#ABB2BF;">: global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;config&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;fp&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">            &#39;token&#39;</span><span style="color:#ABB2BF;">: token,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;pru&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> submit_seckill_order</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;提交抢购（秒杀）订单</span></span>
<span class="line"><span style="color:#98C379;">        :return: 抢购结果 True/False</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://marathon.jd.com/seckillnew/orderService/pc/submitOrder.action&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;skuId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.seckill_order_data[</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sku_id] </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get_seckill_order_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购失败，无法获取生成订单的基本信息，接口返回:【</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">】&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e)))</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;提交抢购订单...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Host&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;marathon.jd.com&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://marathon.jd.com/seckill/seckill.action?skuId=</span><span style="color:#D19A66;">{0}</span><span style="color:#98C379;">&amp;num=</span><span style="color:#D19A66;">{1}</span><span style="color:#98C379;">&amp;rid=</span><span style="color:#D19A66;">{2}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.sku_id, </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_num, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">())),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            data</span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_order_data.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.sku_id),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">            headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">        resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            resp_json </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> parse_json</span><span style="color:#ABB2BF;">(resp.text)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购失败，返回信息:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(resp.text[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">128</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 返回信息</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 抢购失败：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # {&#39;errorMessage&#39;: &#39;很遗憾没有抢到，再接再厉哦。&#39;, &#39;orderId&#39;: 0, &#39;resultCode&#39;: 60074, &#39;skuId&#39;: 0, &#39;success&#39;: False}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # {&#39;errorMessage&#39;: &#39;抱歉，您提交过快，请稍后再提交订单！&#39;, &#39;orderId&#39;: 0, &#39;resultCode&#39;: 60017, &#39;skuId&#39;: 0, &#39;success&#39;: False}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # {&#39;errorMessage&#39;: &#39;系统正在开小差，请重试~~&#39;, &#39;orderId&#39;: 0, &#39;resultCode&#39;: 90013, &#39;skuId&#39;: 0, &#39;success&#39;: False}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 抢购成功：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # {&quot;appUrl&quot;:&quot;xxxxx&quot;,&quot;orderId&quot;:820227xxxxx,&quot;pcUrl&quot;:&quot;xxxxx&quot;,&quot;resultCode&quot;:0,&quot;skuId&quot;:0,&quot;success&quot;:true,&quot;totalMoney&quot;:&quot;xxxxx&quot;}</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;success&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            order_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;orderId&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            total_money </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;totalMoney&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            pay_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https:&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> resp_json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;pcUrl&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购成功，订单号:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">, 总价:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">, 电脑端付款链接:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(order_id, total_money, pay_url))</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;messenger&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;enable&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;true&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                success_message </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;抢购成功，订单号:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">, 总价:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">, 电脑端付款链接:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(order_id, total_money, pay_url)</span></span>
<span class="line"><span style="color:#61AFEF;">                send_wechat</span><span style="color:#ABB2BF;">(success_message)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购失败，返回信息:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(resp_json))</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;messenger&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;enable&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;true&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                error_message </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;抢购失败，返回信息:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(resp_json)</span></span>
<span class="line"><span style="color:#61AFEF;">                send_wechat</span><span style="color:#ABB2BF;">(error_message)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br></div></div><p>这段代码是一个用于处理京东购物的 Python 脚本，主要包括登录、预约和抢购功能。</p><p><strong>注意事项</strong></p><ol><li>引入必要的库：代码开始处引入了操作网络请求、时间、文件和图片等的库。</li><li>定义类和函数：</li></ol><p>- SpiderSession 类：管理与服务器会话的类，包括初始化会话、获取和设置用户代理和 cookies 等。</p><p>- QrLogin 类：处理扫码登录逻辑的类，包括获取登录页面、下载二维码、验证二维码和登录状态等。</p><p>- JdSeckill 类：主要处理预约和抢购的逻辑，以及通过多进程支持并发抢购。</p><ol start="3"><li>主要功能和流程：</li></ol><p>- 登录：用户通过扫描二维码登录。</p><p>- 预约：在抢购前，用户需要预约商品。</p><p>- 抢购：在预约后，用户可以参与商品的抢购。</p><p>- 多进程抢购：使用<code>ProcessPoolExecutor</code>来启动多个进程进行抢购，以增加成功率。</p><ol start="4"><li>异常和状态处理：</li></ol><p>- 程序通过记录日志和发送微信消息的方式来反馈程序的运行状态和异常信息。</p><p>- 使用了装饰器@check_login 来确保执行某些操作前用户已经登录。</p><ol start="5"><li>辅助功能：</li></ol><p>- 保存和加载 cookies：允许程序在多次运行间保持登录状态。</p><p>- 获取用户信息和商品信息：通过解析网页内容或 API 响应来获取所需信息。</p><p><strong>特别提醒</strong></p><p>主要面向有一定 Python 基础和理解 HTTP 请求处理的用户。它展示了如何在 Python 中使用网络请求、处理会话、解析 HTML/XML、以及如何使用多线程/多进程来提高任务执行效率的基本方法。</p><p><strong>解析如下</strong></p><p>这个 Python 脚本是为了自动完成茅台预约，具体功能包括从环境变量中获取用户信息，向指定的 API 发送预约请求，并处理响应。以下是脚本执行的主要步骤：</p><ol><li>环境变量和配置：通过青龙面板（一个自动化运行脚本的工具）添加环境变量，包括用户的 token、设备 ID 等信息，以及 app 版本号<code>Mt_Version</code>。</li><li>函数定义：</li></ol><p>- <code>mt_add</code>：向服务器发送预约请求。</p><p>- <code>tongzhi</code>：发送通知到指定用户。</p><p>- <code>get_session_id</code>：获取会话 ID。</p><p>- <code>get_shop_item</code>：获取商店和商品信息。</p><p>- <code>get_user_id</code>：获取用户 ID。</p><p>- <code>getUserEnergyAward</code>：领取耐力（可能是某种游戏机制或活动的奖励）。</p><p>- <code>get_map</code>：获取省份和城市的映射信息。</p><p>- <code>login</code>：登录并获取 token 和 cookie。</p><ol start="3"><li>预约流程实现：脚本主体通过读取环境变量中的用户 token 等信息，逐个执行预约流程，包括登录、获取用户信息、选择商品和商店、发送预约请求等。</li><li>结果通知：预约结果通过<code>send</code>函数发送通知。</li><li>主函数：脚本的入口点，读取环境变量中的用户 token 列表，遍历每个 token 执行预约流程。</li></ol><p>脚本使用了第三方库<code>requests</code>来发送 HTTP 请求，<code>base64</code>和<code>json</code>进行数据编码和解码。通过环境变量<code>MTTokenD</code>读取用户的预约参数，<code>Mt_Version</code>读取 app 版本号。脚本支持多账号操作，对于每个账号，解析其预约参数（包括省份、城市、经纬度、设备 ID、token 等），并根据这些参数向茅台预约 API 发送请求。</p><p>此脚本适用于自动化茅台酒预约流程，减少手动操作，提高预约成功率。同时，脚本还包含了一些附加功能，如领取耐力奖励等。</p><h2 id="重置版" tabindex="-1">重置版 <a class="header-anchor" href="#重置版" aria-label="Permalink to &quot;重置版&quot;">​</a></h2><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> urllib </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> parse</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> JniSign</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> getUrlParams</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    res </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">(parse.</span><span style="color:#61AFEF;">parse_qsl</span><span style="color:#ABB2BF;">(url))</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> res</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_cookie_string</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">cookie</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    cookie_string </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> cookie_key </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> cookie.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">        cookie_string </span><span style="color:#56B6C2;">+=</span><span style="color:#98C379;"> &#39;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">=</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">;&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> (cookie_key, cookie[cookie_key])</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> cookie_string</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_jd_time</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;https://api.m.jd.com/client.action?functionId=queryMaterialProducts&amp;client=wh5&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_sk</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [val </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> val </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">values</span><span style="color:#ABB2BF;">()]</span></span>
<span class="line"><span style="color:#ABB2BF;">    n, o, p, q, r, s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_val[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">], data_val[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">], data_val[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">], data_val[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">], data_val[</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">], data_val[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;cca&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> p[</span><span style="color:#D19A66;">14</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">19</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> o[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;ab&#39;</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># check ok</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> r[</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">18</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> s[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;ch&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> q.</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> r[</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;cbc&#39;</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># check ok</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> q[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> p[</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">19</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;by&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> o[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">8</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">sub</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;c&#39;</span><span style="color:#ABB2BF;">, p, </span><span style="color:#E06C75;font-style:italic;">flags</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">re.</span><span style="color:#D19A66;">IGNORECASE</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;xa&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> o[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> s[</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;cza&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> q[</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">19</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> s[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">11</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;cb&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> s[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">14</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> p[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> sk_val</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> JDSecKillAPI</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">login_cookie</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.skuId </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;100012043978&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.token_cookie </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> login_cookie</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.token_cookie_string </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_cookie_string</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">cookie</span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token_cookie)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.aid </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.eid </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.uuid </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.uts </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.wifiBssid </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.user_agent </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> reserve_maotai</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;okhttp/3.12.&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;content-type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/x-www-form-urlencoded&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;content-length&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3081&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;cookie&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token_cookie_string,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;jdc-backup&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token_cookie_string,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        query_params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;functionId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;appoint&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;clientVersion&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;9.3.4&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;build&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;85134&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;client&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;android&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;d_brand&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;maotai&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;d_model&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;LIO-AN00&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;osVersion&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;7.1.2&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;screen&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1920*1080&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;partner&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;hhqj02&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;aid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.aid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;eid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.eid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;sdkVersion&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;25&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;lang&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;zh_CN&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;uuid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.uuid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;area&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;15_1213_3411_59341&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;networkType&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;wifi&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;wifiBssid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.wifiBssid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;uts&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.uts</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        reserve_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://api.m.jd.com/client.action?&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> parse.</span><span style="color:#61AFEF;">urlencode</span><span style="color:#ABB2BF;">(query_params) </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;&amp;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        body_string </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;{&quot;autoAddCart&quot;:&quot;0&quot;,&quot;bsid&quot;:&quot;&quot;,&quot;check&quot;:&quot;0&quot;,&quot;ctext&quot;:&quot;&quot;,&quot;isShowCode&quot;:&quot;0&quot;,&quot;mad&quot;:&quot;0&quot;,&quot;skuId&quot;:&quot;100012043978&quot;,&quot;type&quot;:&quot;1&quot;}&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;body&#39;</span><span style="color:#ABB2BF;">: body_string}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        plainTextDic </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;functionId&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;functionId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;clientVersion&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;clientVersion&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;client&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;client&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;uuid&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;uuid&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;body&#39;</span><span style="color:#ABB2BF;">: body_string,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;st&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        sign </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JniSign.</span><span style="color:#61AFEF;">JDencrypt_version0</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">plainTextDic</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">plainTextDic, </span><span style="color:#E06C75;font-style:italic;">ran1</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">reserve_url </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> sign, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">timeout</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_token_key</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;okhttp/3.12.&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;content-type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/x-www-form-urlencoded&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;content-length&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3081&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;cookie&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token_cookie_string,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;jdc-backup&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token_cookie_string,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        body_string </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;{&quot;action&quot;:&quot;to&quot;,&quot;to&quot;:&quot;https%3A</span><span style="color:#D19A66;">%2F%2F</span><span style="color:#98C379;">divide.jd.com</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">user_routing</span><span style="color:#D19A66;">%3F</span><span style="color:#98C379;">skuId%3D100012043978&quot;}&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        query_params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;functionId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;genToken&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;clientVersion&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;9.2.0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;build&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;85134&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;client&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;android&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;d_brand&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;maotai&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;d_model&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;LIO-AN00&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;osVersion&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;7.1.2&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;screen&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1920*1080&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;partner&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;hhqj02&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;aid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.aid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;eid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.eid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;sdkVersion&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;25&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;lang&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;zh_CN&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;uuid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.uuid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;area&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;15_1213_3411_59341&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;networkType&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;wifi&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;wifiBssid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.wifiBssid,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;uts&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.uts</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        token_key_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://api.m.jd.com/client.action?&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> parse.</span><span style="color:#61AFEF;">urlencode</span><span style="color:#ABB2BF;">(query_params) </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;&amp;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;body&#39;</span><span style="color:#ABB2BF;">: body_string}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        plainTextDic </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;functionId&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;functionId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;clientVersion&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;clientVersion&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;client&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;client&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;uuid&#39;</span><span style="color:#ABB2BF;">: query_params[</span><span style="color:#98C379;">&#39;uuid&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;body&#39;</span><span style="color:#ABB2BF;">: data[</span><span style="color:#98C379;">&#39;body&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;st&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        sign </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JniSign.</span><span style="color:#61AFEF;">JDencrypt_version0</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">plainTextDic</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">plainTextDic, </span><span style="color:#E06C75;font-style:italic;">ran1</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">token_key_url </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> sign, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">timeout</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # token_key = response.json()[&#39;tokenKey&#39;]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # print(&#39;Token Key: ----------&gt; %s&#39; % response.json())</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # print(response.status_code)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_appjmp</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">token_params</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        appjmp_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> token_params[</span><span style="color:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;to&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://divide.jd.com/user_routing?skuId=</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.skuId,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;tokenKey&#39;</span><span style="color:#ABB2BF;">: token_params[</span><span style="color:#98C379;">&#39;tokenKey&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;lbs&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;{&quot;lat&quot;:&quot;39.904585&quot;,&quot;lng&quot;:&quot;116.407018&quot;,&quot;provinceId&quot;:&quot;1&quot;,&quot;cityId&quot;:&quot;2802&quot;,&quot;districtId&quot;:&quot;54741&quot;,&quot;provinceName&quot;:&quot;北京&quot;,&quot;cityName&quot;:&quot;东城区&quot;,&quot;districtName&quot;:&quot;东华门街道&quot;}&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">appjmp_url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params, </span><span style="color:#E06C75;font-style:italic;">allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # print(&#39;Get Appjmp跳转链接--------------&gt;%s&#39; % response.headers[&#39;Location&#39;])</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.headers[</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_divide</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">divide_url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">divide_url, </span><span style="color:#E06C75;font-style:italic;">allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Get Divide跳转链接--------------&gt;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> response.headers[</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.headers[</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_captcha</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">captcha_url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">captcha_url, </span><span style="color:#E06C75;font-style:italic;">allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Get Captcha跳转链接--------------&gt;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> response.headers[</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.headers[</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_seckill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">seckill_url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">seckill_url, </span><span style="color:#E06C75;font-style:italic;">allow_redirects</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> init_action</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">num</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        init_action_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://marathon.jd.com/seckillnew/orderService/init.action&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;sku&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.skuId,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;num&#39;</span><span style="color:#ABB2BF;">: num,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;isModifyAddress&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">init_action_url, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;init action返回数据：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> response.text)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_tak</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        tak_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://tak.jd.com/t/41CD2?_t=</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">tak_url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">        sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_sk</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> sk_val</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> submit_order</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">order_data</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">sk</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        submit_order_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://marathon.jd.com/seckillnew/orderService/submitOrder.action?skuId=</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.skuId</span></span>
<span class="line"><span style="color:#ABB2BF;">        address_info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> order_data[</span><span style="color:#98C379;">&#39;addressList&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        invoice_info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> order_data[</span><span style="color:#98C379;">&#39;invoiceInfo&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;num&#39;</span><span style="color:#ABB2BF;">: order_data[</span><span style="color:#98C379;">&#39;seckillSkuVO&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;num&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;addressId&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;yuShou&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;isModifyAddress&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;name&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;provinceId&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;provinceId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;provinceName&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;provinceName&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;cityId&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;cityId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;cityName&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;cityName&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;countyId&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;countyId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;countyName&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;countyName&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;townId&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;townId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;townName&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;townName&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;addressDetail&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;addressDetail&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;mobile&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;mobile&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;mobileKey&#39;</span><span style="color:#ABB2BF;">: address_info[</span><span style="color:#98C379;">&#39;mobileKey&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;email&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceTitle&#39;</span><span style="color:#ABB2BF;">: invoice_info[</span><span style="color:#98C379;">&#39;invoiceTitle&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoiceContent&#39;</span><span style="color:#ABB2BF;">: invoice_info[</span><span style="color:#98C379;">&#39;invoiceContentType&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoicePhone&#39;</span><span style="color:#ABB2BF;">: invoice_info[</span><span style="color:#98C379;">&#39;invoicePhone&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoicePhoneKey&#39;</span><span style="color:#ABB2BF;">: invoice_info[</span><span style="color:#98C379;">&#39;invoicePhoneKey&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;invoice&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;codTimeType&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;paymentType&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;4&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;overseas&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;token&#39;</span><span style="color:#ABB2BF;">: order_data[</span><span style="color:#98C379;">&#39;token&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">            &#39;sk&#39;</span><span style="color:#ABB2BF;">: sk,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # print(&#39;submit提交数据： %s&#39; % data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.s.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">submit_order_url, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            submit_result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;"> submit order返回数据：状态：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">，信息：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">()),</span></span>
<span class="line"><span style="color:#ABB2BF;">                                                       submit_result[</span><span style="color:#98C379;">&#39;success&#39;</span><span style="color:#ABB2BF;">], submit_result))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;"> submit order返回数据-非json格式：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">()), response.content))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # return response</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    login_cookie_186 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">        &#39;pin&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;wskey&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;whwswswws&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;unionwsws&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    JDska </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> JDSecKillAPI</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">login_cookie</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">login_cookie_186)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(JDska.</span><span style="color:#61AFEF;">reserve_maotai</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    token_params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JDska.</span><span style="color:#61AFEF;">get_token_key</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    divide_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JDska.</span><span style="color:#61AFEF;">get_appjmp</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">token_params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">token_params)</span></span>
<span class="line"><span style="color:#ABB2BF;">    captcha_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JDska.</span><span style="color:#61AFEF;">get_divide</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">divide_url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">divide_url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    seckill_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JDska.</span><span style="color:#61AFEF;">get_captcha</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">captcha_url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">captcha_url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    JDska.</span><span style="color:#61AFEF;">get_seckill</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">seckill_url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">seckill_url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    order_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JDska.</span><span style="color:#61AFEF;">init_action</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    sk_val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> JDska.</span><span style="color:#61AFEF;">get_tak</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;python计算sk参数：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> sk_val)</span></span>
<span class="line"><span style="color:#ABB2BF;">    JDska.</span><span style="color:#61AFEF;">submit_order</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">order_data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">order_data, </span><span style="color:#E06C75;font-style:italic;">sk</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">sk_val)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(JDska.s.cookies)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # get_jd_time()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br></div></div><p><strong>说明</strong></p><p>这段脚本是为了自动化京东的秒杀活动而编写的。它涵盖了预约、获取令牌、跳转、以及最终的提交订单等多个步骤。以下是脚本各部分的详细解析：</p><p><strong>函数和类解释</strong></p><ol><li>getUrlParams(url):</li></ol><p>- 解析 URL 中的查询参数并返回字典格式。</p><ol start="2"><li>get_cookie_string(cookie):</li></ol><p>- 将 cookie 字典转换为字符串格式，以便在 HTTP 请求中使用。</p><ol start="3"><li>get_jd_time():</li></ol><p>- 请求京东服务器时间，主要用于同步操作时间。</p><ol start="4"><li>get_sk(data):</li></ol><p>- 通过特定的加密和处理逻辑生成<code>sk</code>值，此值可能用于提交订单时验证。</p><ol start="5"><li>JDSecKillAPI:</li></ol><p>- 主要类，封装了预约、获取令牌、提交订单等功能。</p><p><strong>类方法解释</strong></p><p>- reserve_maotai():</p><p>- 发起预约请求，设置必要的 HTTP 头和请求参数。</p><p>- get_token_key():</p><p>- 获取用于后续操作的令牌。</p><p>- get_appjmp(token_params):</p><p>- 使用获取到的令牌生成跳转链接。</p><p>- get_divide(divide_url):</p><p>- 访问跳转链接并获取可能的下一跳转链接。</p><p>- get_captcha(captcha_url):</p><p>- 处理验证码跳转链接，这可能是秒杀活动的一部分。</p><p>- get_seckill(seckill_url):</p><p>- 访问最终的秒杀链接。</p><p>- init_action():</p><p>- 初始化订单操作，可能是获取必要的订单数据。</p><p>- get_tak():</p><p>- 获取<code>tak</code>值，可能是用于订单提交的另一种验证。</p><p>- submit_order(order_data, sk):</p><p>- 提交订单，使用获取到的所有必要数据。</p><p><strong>脚本流程</strong></p><ol><li>实例化<code>JDSecKillAPI</code>类。</li><li>调用<code>reserve_maotai()</code>函数进行预约。</li><li>获取令牌。</li><li>通过令牌获取跳转链接。</li><li>处理跳转，获取和处理验证码。</li><li>初始化订单操作。</li><li>获取<code>sk</code>值。</li><li>提交订单。</li></ol><p><strong>额外的注意点</strong></p><p>- 使用了外部模块<code>JniSign</code>进行签名，这是一种保护措施以符合京东的 API 安全要求。</p><p>- 脚本涉及多次跳转和请求，反映了京东防刷措施的复杂性。</p><p>- 脚本运行依赖于正确的 cookie 和其他验证信息，这些信息需要事先获取。</p><p>这个脚本用于自动化京东的秒杀过程，特别是对于高需求商品如茅台。它展示了通过自动化工具模拟用户行为的能力，但同时也涉及到了使用自动化脚本可能违反网站使用条款的问题。使用此类脚本前应确保合规，了解可能的风险。</p><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h2 id="代码文件概览" tabindex="-1">代码文件概览 <a class="header-anchor" href="#代码文件概览" aria-label="Permalink to &quot;代码文件概览&quot;">​</a></h2><p>在本次补充中，我们详细介绍以下四个关键代码文件，每个文件都在自动化过程中发挥着重要作用：</p><ol><li>jd_logger.py - 负责日志记录，帮助追踪脚本执行情况。</li><li>timer.py - 包含计时器功能，确保在正确的时间点触发操作。</li><li>config.py - 存储脚本运行所需的配置信息，如登录凭证。</li><li>util.py - 提供支持日志、时间处理的实用工具函数。</li></ol><p><strong>爬虫技巧与用户代理的补充</strong></p><p>补充代码中特别展示了爬虫通用技巧和大量的用户代理字符串。正确应用用户代理不仅可以提高请求的成功率，也是应对网站安全策略的有效策略。这有助于模拟多样化的用户环境，减少被检测的概率。</p><p><strong>发布原因与使用警告</strong></p><p>虽然有顾虑，但我们意识到提供这些信息对于促进技术交流和支持学术研究具有重要价值。因此，我们决定分享这些补充内容，但<strong>严格限定用于测试和学术研究目的</strong>，绝对<strong>禁止用于任何商业用途</strong>。使用这些脚本可能违反服务条款，因此使用时需要自行承担相关风险。</p><p>有粉丝反馈导包报错，现重发 config.ini 和 config.py 脚本，请查收。</p><h3 id="config-ini-文件" tabindex="-1">config.ini 文件 <a class="header-anchor" href="#config-ini-文件" aria-label="Permalink to &quot;config.ini 文件&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[config]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># eid, fp参数必须填写，具体请参考 wiki-常见问题</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 随意填写可能导致订单无法提交等问题</span></span>
<span class="line"><span style="color:#61AFEF;">eid</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">fp</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># cookie现在不需要填写了</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># cookies_String = &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 商品id</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 已经是茅台的sku_id了</span></span>
<span class="line"><span style="color:#61AFEF;">sku_id</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 100012043978</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设定时间 # 2024-04-19 10:00:00.100000</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 修改成每天的几点几分几秒几毫秒</span></span>
<span class="line"><span style="color:#61AFEF;">buy_time</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> 09:59:59.500</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 默认UA</span></span>
<span class="line"><span style="color:#61AFEF;">DEFAULT_USER_AGENT</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否使用随机 useragent，默认为 false</span></span>
<span class="line"><span style="color:#61AFEF;">random_useragent</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[account]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 支付密码</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果你的账户中有可用的京券（注意不是东券）或 在上次购买订单中使用了京豆，</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 那么京东可能会在下单时自动选择京券支付 或 自动勾选京豆支付。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 此时下单会要求输入六位数字的支付密码。请在下方配置你的支付密码，如 123456 。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果没有上述情况，下方请留空。</span></span>
<span class="line"><span style="color:#61AFEF;">payment_pwd</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[messenger]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用了Server酱的推送服务</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果想开启下单成功后消息推送，则将 enable 设置为 true，默认为 false 不开启推送</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 开启消息推送必须填入 sckey，如何获取请搜索百度</span></span>
<span class="line"><span style="color:#61AFEF;">enable</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> false</span></span>
<span class="line"><span style="color:#61AFEF;">sckey</span><span style="color:#98C379;"> =</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>config.py</strong>文件</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> configparser</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> Config</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">config_file</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;config.ini&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">._path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(os.</span><span style="color:#61AFEF;">getcwd</span><span style="color:#ABB2BF;">(), config_file)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">._path):</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> FileNotFoundError(</span><span style="color:#98C379;">&quot;No such file: config.ini&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">._config </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> configparser.</span><span style="color:#61AFEF;">ConfigParser</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">._config.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">._path, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8-sig&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">._configRaw </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> configparser.</span><span style="color:#61AFEF;">RawConfigParser</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">._configRaw.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">._path, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8-sig&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">section</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">._config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(section, name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">section</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">._configRaw.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(section, name)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">global_config </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Config</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="成功率高版本推荐" tabindex="-1">成功率高版本推荐 <a class="header-anchor" href="#成功率高版本推荐" aria-label="Permalink to &quot;成功率高版本推荐&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> math</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> config</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> encrypt </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Encrypt</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> hashlib</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> logging</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pytz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66;">AES_KEY</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;xxxxxxxxxxxxxxxxxx&#39;</span></span>
<span class="line"><span style="color:#D19A66;">AES_IV</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;xxxxxxxxxx&#39;</span></span>
<span class="line"><span style="color:#D19A66;">SALT</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;xxxxxxxxxxxxxxxxxxxx&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># AMAP_KEY = &#39;9449339b6c4aee04d69481e6e6c84a84&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">current_time </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;">mt_version </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(re.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;latest__version&quot;&gt;(.*?)&lt;/p&gt;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://apps.apple.com/cn/app/i</span><span style="color:#D19A66;">%E</span><span style="color:#98C379;">8%8C</span><span style="color:#D19A66;">%85%</span><span style="color:#98C379;">E5</span><span style="color:#D19A66;">%8F</span><span style="color:#98C379;">%B0/id1600482450&#39;</span><span style="color:#ABB2BF;">).text,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                re.S)).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">header_context </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">MT-Lat: 28.499562</span></span>
<span class="line"><span style="color:#98C379;">MT-K: 1675213490331</span></span>
<span class="line"><span style="color:#98C379;">MT-Lng: 102.182324</span></span>
<span class="line"><span style="color:#98C379;">Host: app.moutai519.com.cn</span></span>
<span class="line"><span style="color:#98C379;">MT-User-Tag: 0</span></span>
<span class="line"><span style="color:#98C379;">Accept: */*</span></span>
<span class="line"><span style="color:#98C379;">MT-Network-Type: WIFI</span></span>
<span class="line"><span style="color:#98C379;">MT-Token: 1</span></span>
<span class="line"><span style="color:#98C379;">MT-Team-ID:</span></span>
<span class="line"><span style="color:#98C379;">MT-Info: 028e7f96f6369cafe1d105579c5b9377</span></span>
<span class="line"><span style="color:#98C379;">MT-Device-ID: 2F2075D0-B66C-4287-A903-DBFF6358342A</span></span>
<span class="line"><span style="color:#98C379;">MT-Bundle-ID: com.moutai.mall</span></span>
<span class="line"><span style="color:#98C379;">Accept-Language: en-CN;q=1, zh-Hans-CN;q=0.9</span></span>
<span class="line"><span style="color:#98C379;">MT-Request-ID: 167560018873318465</span></span>
<span class="line"><span style="color:#98C379;">MT-APP-Version: 1.3.7</span></span>
<span class="line"><span style="color:#98C379;">User-Agent: iOS;16.3;Apple;?unrecognized?</span></span>
<span class="line"><span style="color:#98C379;">MT-R: clips_OlU6TmFRag5rCXwbNAQ/Tz1SKlN8THcecBp/HGhHdw==</span></span>
<span class="line"><span style="color:#98C379;">Content-Length: 93</span></span>
<span class="line"><span style="color:#98C379;">Accept-Encoding: gzip, deflate, br</span></span>
<span class="line"><span style="color:#98C379;">Connection: keep-alive</span></span>
<span class="line"><span style="color:#98C379;">Content-Type: application/json</span></span>
<span class="line"><span style="color:#98C379;">userId: 2</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> init_headers</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">user_id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;1&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">token</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;2&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">lat</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;28.499562&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">lng</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;102.182324&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> k </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> header_context.</span><span style="color:#61AFEF;">rstrip</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">lstrip</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        temp_l </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> k.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;: &#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">        dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {temp_l[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]: temp_l[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]})</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&quot;userId&quot;</span><span style="color:#ABB2BF;">: user_id})</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&quot;MT-Token&quot;</span><span style="color:#ABB2BF;">: token})</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&quot;MT-Lat&quot;</span><span style="color:#ABB2BF;">: lat})</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&quot;MT-Lng&quot;</span><span style="color:#ABB2BF;">: lng})</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&quot;MT-APP-Version&quot;</span><span style="color:#ABB2BF;">: mt_version})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> signature</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    keys </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> sorted</span><span style="color:#ABB2BF;">(data.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    temp_v </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> keys:</span></span>
<span class="line"><span style="color:#ABB2BF;">        temp_v </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> data[item]</span></span>
<span class="line"><span style="color:#ABB2BF;">    text </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> SALT</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> temp_v </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> current_time</span></span>
<span class="line"><span style="color:#ABB2BF;">    hl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> hashlib.</span><span style="color:#61AFEF;">md5</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    hl.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(text.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf8&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    md5 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> hl.</span><span style="color:#61AFEF;">hexdigest</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> md5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_vcode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">mobile</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;mobile&#39;</span><span style="color:#ABB2BF;">: mobile}</span></span>
<span class="line"><span style="color:#ABB2BF;">    md5 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> signature</span><span style="color:#ABB2BF;">(params)</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(params, {</span><span style="color:#98C379;">&#39;md5&#39;</span><span style="color:#ABB2BF;">: md5, </span><span style="color:#98C379;">&quot;timestamp&quot;</span><span style="color:#ABB2BF;">: current_time, </span><span style="color:#98C379;">&#39;MT-APP-Version&#39;</span><span style="color:#ABB2BF;">: mt_version})</span></span>
<span class="line"><span style="color:#ABB2BF;">    responses </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://app.moutai519.com.cn/xhr/front/user/register/vcode&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                              headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    logging.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">        f</span><span style="color:#98C379;">&#39;get v_code : params : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">params</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response code : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response body : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">mobile</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">v_code</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;mobile&#39;</span><span style="color:#ABB2BF;">: mobile, </span><span style="color:#98C379;">&#39;vCode&#39;</span><span style="color:#ABB2BF;">: v_code, </span><span style="color:#98C379;">&#39;ydToken&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;ydLogId&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    md5 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> signature</span><span style="color:#ABB2BF;">(params)</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(params, {</span><span style="color:#98C379;">&#39;md5&#39;</span><span style="color:#ABB2BF;">: md5, </span><span style="color:#98C379;">&quot;timestamp&quot;</span><span style="color:#ABB2BF;">: current_time, </span><span style="color:#98C379;">&#39;MT-APP-Version&#39;</span><span style="color:#ABB2BF;">: mt_version})</span></span>
<span class="line"><span style="color:#ABB2BF;">    responses </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://app.moutai519.com.cn/xhr/front/user/register/login&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                              headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> responses.status_code </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">            f</span><span style="color:#98C379;">&#39;login : params : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">params</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response code : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response body : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&#39;MT-Token&#39;</span><span style="color:#ABB2BF;">: responses.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;token&#39;</span><span style="color:#ABB2BF;">]})</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&#39;userId&#39;</span><span style="color:#ABB2BF;">: responses.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;userId&#39;</span><span style="color:#ABB2BF;">]})</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> responses.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;token&#39;</span><span style="color:#ABB2BF;">], responses.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;userId&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_current_session_id</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    day_time </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_day_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    responses </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;https://static.moutai519.com.cn/mt-backend/xhr/front/mall/index/session/get/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">day_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> responses.status_code </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">            f</span><span style="color:#98C379;">&#39;get_current_session_id : params : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">day_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response code : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response body : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    current_session_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> responses.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;sessionId&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#56B6C2;">    dict</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(headers, {</span><span style="color:#98C379;">&#39;current_session_id&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(current_session_id)})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_day_time</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 创建一个东八区（北京时间）的时区对象</span></span>
<span class="line"><span style="color:#ABB2BF;">    beijing_tz </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pytz.</span><span style="color:#61AFEF;">timezone</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Asia/Shanghai&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 获取当前北京时间的日期和时间对象</span></span>
<span class="line"><span style="color:#ABB2BF;">    beijing_dt </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">(beijing_tz)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 设置时间为0点</span></span>
<span class="line"><span style="color:#ABB2BF;">    beijing_dt </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> beijing_dt.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">hour</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">minute</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">second</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">microsecond</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 获取时间戳（以秒为单位）</span></span>
<span class="line"><span style="color:#ABB2BF;">    timestamp </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(beijing_dt.</span><span style="color:#61AFEF;">timestamp</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> timestamp</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_location_count</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">province</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                       city</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                       item_code</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                       p_c_map</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                       source_data</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                       lat</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;28.499562&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                       lng</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;102.182324&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    day_time </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_day_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    session_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> headers[</span><span style="color:#98C379;">&#39;current_session_id&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    responses </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">        f</span><span style="color:#98C379;">&quot;https://static.moutai519.com.cn/mt-backend/xhr/front/mall/shop/list/slim/v3/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">session_id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">province</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">item_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">day_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> responses.status_code </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">            f</span><span style="color:#98C379;">&#39;get_location_count : params : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">day_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response code : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response body : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    shops </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> responses.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;shops&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> config.</span><span style="color:#D19A66;">MAX_ENABLED</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#61AFEF;"> max_shop</span><span style="color:#ABB2BF;">(city, item_code, p_c_map, province, shops)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> config.</span><span style="color:#D19A66;">DISTANCE_ENABLED</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#61AFEF;"> distance_shop</span><span style="color:#ABB2BF;">(city, item_code, p_c_map, province, shops, source_data, lat, lng)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> distance_shop</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">city</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  item_code</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  p_c_map</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  province</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  shops</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  source_data</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  lat</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;28.499562&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                  lng</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;102.182324&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # shop_ids = p_c_map[province][city]</span></span>
<span class="line"><span style="color:#ABB2BF;">    temp_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> shop </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> shops:</span></span>
<span class="line"><span style="color:#ABB2BF;">        shopId </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> shop[</span><span style="color:#98C379;">&#39;shopId&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        items </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> shop[</span><span style="color:#98C379;">&#39;items&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        item_ids </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [i[</span><span style="color:#98C379;">&#39;itemId&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> items]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # if shopId not in shop_ids:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     continue</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(item_code) </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> item_ids:</span></span>
<span class="line"><span style="color:#C678DD;">            continue</span></span>
<span class="line"><span style="color:#ABB2BF;">        shop_info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> source_data.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(shopId)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # d = geodesic((lat, lng), (shop_info[&#39;lat&#39;], shop_info[&#39;lng&#39;])).km</span></span>
<span class="line"><span style="color:#ABB2BF;">        d </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> math.</span><span style="color:#61AFEF;">sqrt</span><span style="color:#ABB2BF;">((</span><span style="color:#56B6C2;">float</span><span style="color:#ABB2BF;">(lat) </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> shop_info[</span><span style="color:#98C379;">&#39;lat&#39;</span><span style="color:#ABB2BF;">]) </span><span style="color:#56B6C2;">**</span><span style="color:#D19A66;"> 2</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">float</span><span style="color:#ABB2BF;">(lng) </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> shop_info[</span><span style="color:#98C379;">&#39;lng&#39;</span><span style="color:#ABB2BF;">]) </span><span style="color:#56B6C2;">**</span><span style="color:#D19A66;"> 2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # print(f&quot;距离：{d}&quot;)</span></span>
<span class="line"><span style="color:#ABB2BF;">        temp_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">((d, shopId))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # sorted(a,key=lambda x:x[0])</span></span>
<span class="line"><span style="color:#ABB2BF;">    temp_list </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> sorted</span><span style="color:#ABB2BF;">(temp_list, </span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">lambda</span><span style="color:#D19A66;font-style:italic;"> x</span><span style="color:#ABB2BF;">: x[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # logging.info(f&quot;所有门店距离:{temp_list}&quot;)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(temp_list) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> temp_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#98C379;"> &#39;0&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> max_shop</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">city</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">item_code</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">p_c_map</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">province</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">shops</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    max_count </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">    max_shop_id </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;0&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    shop_ids </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> p_c_map[province][city]</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> shop </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> shops:</span></span>
<span class="line"><span style="color:#ABB2BF;">        shopId </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> shop[</span><span style="color:#98C379;">&#39;shopId&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        items </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> shop[</span><span style="color:#98C379;">&#39;items&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> shopId </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> shop_ids:</span></span>
<span class="line"><span style="color:#C678DD;">            continue</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> items:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> item[</span><span style="color:#98C379;">&#39;itemId&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(item_code):</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> item[</span><span style="color:#98C379;">&#39;inventory&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> max_count:</span></span>
<span class="line"><span style="color:#ABB2BF;">                max_count </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> item[</span><span style="color:#98C379;">&#39;inventory&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                max_shop_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> shopId</span></span>
<span class="line"><span style="color:#ABB2BF;">    logging.</span><span style="color:#61AFEF;">debug</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;item code </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">item_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, max shop id : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_shop_id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, max count : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_count</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> max_shop_id</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">encrypt </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Encrypt</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">AES_KEY</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">iv</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">AES_IV</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> act_params</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">shop_id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">item_id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #     &quot;actParam&quot;: &quot;a/v0XjWK/a/a+ZyaSlKKZViJHuh8tLw==&quot;,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #     &quot;itemInfoList&quot;: [</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #         {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #             &quot;count&quot;: 1,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #             &quot;itemId&quot;: &quot;2478&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #         }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #     ],</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #     &quot;shopId&quot;: &quot;151510100019&quot;,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #     &quot;sessionId&quot;: 508</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # }</span></span>
<span class="line"><span style="color:#ABB2BF;">    session_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> headers[</span><span style="color:#98C379;">&#39;current_session_id&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    userId </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> headers[</span><span style="color:#98C379;">&#39;userId&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;itemInfoList&quot;</span><span style="color:#ABB2BF;">: [{</span><span style="color:#98C379;">&quot;count&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;itemId&quot;</span><span style="color:#ABB2BF;">: item_id}],</span></span>
<span class="line"><span style="color:#98C379;">              &quot;sessionId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(session_id),</span></span>
<span class="line"><span style="color:#98C379;">              &quot;userId&quot;</span><span style="color:#ABB2BF;">: userId,</span></span>
<span class="line"><span style="color:#98C379;">              &quot;shopId&quot;</span><span style="color:#ABB2BF;">: shop_id</span></span>
<span class="line"><span style="color:#ABB2BF;">              }</span></span>
<span class="line"><span style="color:#ABB2BF;">    s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(params)</span></span>
<span class="line"><span style="color:#ABB2BF;">    act </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> encrypt.</span><span style="color:#61AFEF;">aes_encrypt</span><span style="color:#ABB2BF;">(s)</span></span>
<span class="line"><span style="color:#ABB2BF;">    params.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&quot;actParam&quot;</span><span style="color:#ABB2BF;">: act})</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> params</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">msg</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> config.</span><span style="color:#D19A66;">PUSH_TOKEN</span><span style="color:#C678DD;"> is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span></span>
<span class="line"><span style="color:#ABB2BF;">    title </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;imoutai预约失败&#39;</span><span style="color:#7F848E;font-style:italic;">  # 改成你要的标题内容</span></span>
<span class="line"><span style="color:#ABB2BF;">    content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> msg  </span><span style="color:#7F848E;font-style:italic;"># 改成你要的正文内容</span></span>
<span class="line"><span style="color:#ABB2BF;">    url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;http://www.pushplus.plus/send&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    r </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;token&#39;</span><span style="color:#ABB2BF;">: config.</span><span style="color:#D19A66;">PUSH_TOKEN</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                                  &#39;title&#39;</span><span style="color:#ABB2BF;">: title,</span></span>
<span class="line"><span style="color:#98C379;">                                  &#39;content&#39;</span><span style="color:#ABB2BF;">: content})</span></span>
<span class="line"><span style="color:#ABB2BF;">    logging.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;通知推送结果：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">r.status_code, r.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> reservation</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">params</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">mobile</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    params.</span><span style="color:#61AFEF;">pop</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;userId&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    responses </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://app.moutai519.com.cn/xhr/front/mall/reservation/add&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                              headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> responses.status_code </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 401</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">        send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;[</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">mobile</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">],登录token失效，需要重新登录&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        raise</span><span style="color:#ABB2BF;"> RuntimeError</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#98C379;"> &#39;您的实名信息未完善或未通过认证&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> responses.text:</span></span>
<span class="line"><span style="color:#61AFEF;">        send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;[</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">mobile</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">],</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        raise</span><span style="color:#ABB2BF;"> RuntimeError</span></span>
<span class="line"><span style="color:#ABB2BF;">    logging.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">        f</span><span style="color:#98C379;">&#39;预约 : mobile:</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">mobile</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> :  response code : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response body : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">responses.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> select_geo</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">i</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # https://www.piliang.tech/geocoding-amap</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;https://www.piliang.tech/api/amap/geocode?address=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">i</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    geocodes: </span><span style="color:#56B6C2;">list</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> resp.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;geocodes&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> geocodes</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_map</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">lat</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;28.499562&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">lng</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;102.182324&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    p_c_map </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;">    url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://static.moutai519.com.cn/mt-backend/xhr/front/mall/resource/get&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">        &#39;X-Requested-With&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;XMLHttpRequest&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Mozilla/5.0 (iPhone; CPU iPhone OS 15_0_1 like Mac OS X)&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;Referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://h5.moutai519.com.cn/gux/game/main?appConfig=2_1_2&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;Client-User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;iOS;16.0.1;Apple;iPhone 14 ProMax&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;MT-R&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;clips_OlU6TmFRag5rCXwbNAQ/Tz1SKlN8THcecBp/HGhHdw==&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;Origin&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://h5.moutai519.com.cn&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;MT-APP-Version&#39;</span><span style="color:#ABB2BF;">: mt_version,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;MT-Request-ID&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}{</span><span style="color:#ABB2BF;">random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1111111</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">999999999</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;Accept-Language&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;zh-CN,zh-Hans;q=1&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;MT-Device-ID&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}{</span><span style="color:#ABB2BF;">random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1111111</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">999999999</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;Accept&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/json, text/javascript, */*; q=0.01&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;mt-lng&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">lng</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;mt-lat&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">lat</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, )</span></span>
<span class="line"><span style="color:#ABB2BF;">    mtshops </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> res.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">, {}).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;mtshops_pc&#39;</span><span style="color:#ABB2BF;">, {})</span></span>
<span class="line"><span style="color:#ABB2BF;">    urls </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mtshops.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;url&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    r </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(urls)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> k, v </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">(r.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()).</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">        provinceName </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> v.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;provinceName&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        cityName </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> v.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;cityName&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> p_c_map.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(provinceName):</span></span>
<span class="line"><span style="color:#ABB2BF;">            p_c_map[provinceName] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> p_c_map[provinceName].</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(cityName, </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            p_c_map[provinceName][cityName] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [k]</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            p_c_map[provinceName][cityName].</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(k)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> p_c_map, </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">(r.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> getUserEnergyAward</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">mobile</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    cookies </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">        &#39;MT-Device-ID-Wap&#39;</span><span style="color:#ABB2BF;">: headers[</span><span style="color:#98C379;">&#39;MT-Device-ID&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">        &#39;MT-Token-Wap&#39;</span><span style="color:#ABB2BF;">: headers[</span><span style="color:#98C379;">&#39;MT-Token&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">        &#39;YX_SUPPORT_WEBP&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://h5.moutai519.com.cn/game/isolationPage/getUserEnergyAward&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">cookies</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">cookies,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                             headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{})</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # response.json().get(&#39;message&#39;) if &#39;无法领取奖励&#39; in response.text else &quot;领取奖励成功&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    logging.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">        f</span><span style="color:#98C379;">&#39; : mobile:</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">mobile</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> :  response code : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">response.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, response body : </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">response.text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br></div></div><p><strong>说明</strong></p><p>这段代码主要关联了许多网络请求和对应的业务逻辑处理，用于处理与一个名为“茅台商城”的应用相关的网络操作。主要功能和关键组件的详细说明如下：</p><p><strong>1. 全局变量和配置</strong>：</p><p>- 使用 AES 加密密钥(<code>AES_KEY</code>)、初始向量(<code>AES_IV</code>)和一个盐值(<code>SALT</code>)用于加密相关操作。</p><p>- 定义了当前时间戳<code>current_time</code>和一组请求头<code>headers</code>。</p><p>- 从苹果应用商店拉取并解析应用的当前版本号。</p><p><strong>2. 初始化请求头</strong>：</p><p>- <code>init_headers</code>函数通过解析一个多行的字符串<code>header_context</code>来初始化请求头。</p><p><strong>3. 签名生成：</strong></p><p>- <code>signature</code>函数使用 MD5 算法生成请求的签名，签名用于后续的网络请求验证。</p><p><strong>4. 用户交互函数：</strong></p><p>- <code>get_vcode</code>用于获取短信验证码。</p><p>- <code>login</code>用于用户登录，使用手机号和验证码。</p><p>- <code>get_current_session_id</code>和<code>get_day_time</code>用于获取当前的会话 ID 和准确的时间戳。</p><p><strong>5. 地理位置和商店处理：</strong></p><p>- <code>get_location_count</code>查询特定省市下的商店库存。</p><p>- <code>distance_shop</code>和<code>max_shop</code>用于基于不同标准（如距离和库存最大化）选择商店。</p><p>- <code>select_geo</code>用于地理编码，将地址转换成地理坐标。</p><p><strong>6. 加密和动作参数构建：</strong></p><p>- 使用<code>Encrypt</code>类（从<code>encrypt</code>模块导入）对参数进行 AES 加密。</p><p>- <code>act_params</code>用于构建活动参数，这些参数包括了用户、商品和店铺的 ID 等。</p><p><strong>7. 通知和预约功能：</strong></p><p>- <code>send_email</code>函数通过 Pushplus 服务发送通知。</p><p>- <code>reservation</code>用于提交商品预约请求。</p><p><strong>8. 实用功能：</strong></p><p>- <code>get_map</code>用于获取商店的地理位置数据。</p><p>- <code>getUserEnergyAward</code>用于领取用户能量奖励，这可能是应用内的某种积分或奖励系统。</p><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h1 id="茅台葫芦娃自动预约脚本" tabindex="-1">茅台葫芦娃自动预约脚本 <a class="header-anchor" href="#茅台葫芦娃自动预约脚本" aria-label="Permalink to &quot;茅台葫芦娃自动预约脚本&quot;">​</a></h1><p>全代码如下</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#56B6C2;">/**</span></span>
<span class="line"><span style="color:#ABB2BF;"> 葫芦娃预约 v1.06</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"> cron: </span><span style="color:#D19A66;">30</span><span style="color:#D19A66;"> 8</span><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> *</span></span>
<span class="line"><span style="color:#ABB2BF;"> const </span><span style="color:#FFFFFF;">$</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> new </span><span style="color:#61AFEF;">Env</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;葫芦娃预约&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;"> 自行抓包把token</span><span style="color:#ABB2BF;">(一般在请求头里)填到变量中, 多账号用换行隔开（可自定义）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">XLTH_COOKIE</span><span style="color:#ABB2BF;"> 新联惠购</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">GLYP_COOKIE</span><span style="color:#ABB2BF;"> 贵旅优品</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">KGLG_COOKIE</span><span style="color:#ABB2BF;"> 空港乐购</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">HLQG_COOKIE</span><span style="color:#ABB2BF;"> 航旅黔购</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">ZHCS_COOKIE</span><span style="color:#ABB2BF;"> 遵行出山</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">GYQP_COOKIE</span><span style="color:#ABB2BF;"> 贵盐黔品</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">LLSC_COOKIE</span><span style="color:#ABB2BF;"> 乐旅商城</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">YLQX_COOKIE</span><span style="color:#ABB2BF;"> 驿路黔寻</span></span>
<span class="line"><span style="color:#56B6C2;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">SPLIT</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 分割符（可自定义）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const axios </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;axios&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const crypto </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;crypto&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const moment </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;moment&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const notify </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./sendNotify&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">XLTH_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wxded2e7e6d60ac09d&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 新联惠购</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">GLYP_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx61549642d715f361&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵旅优品</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">KGLG_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx613ba8ea6a002aa8&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 空港乐购</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">HLQG_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx936aa5357931e226&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 航旅黔购</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">ZHCS_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx624149b74233c99a&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 遵航出山</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">GYQP_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx5508e31ffe9366b8&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵盐黔品</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">LLSC_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx821fb4d8604ed4d6&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 乐旅商城</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">YLQX_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wxee0ce83ab4b26f9c&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 驿路黔寻</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;https://gw.huiqunchina.com&#39;</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">AK</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;00670fb03584fbf44dd6b136e534f495&#39;</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">SK</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;0d65f24dbe2bc1ede3c3ceeb96ef71bb&#39;</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">let sendMessage </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">delay</span><span style="color:#ABB2BF;">(time) {</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> new </span><span style="color:#61AFEF;">Promise</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">resolve</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#61AFEF;"> setTimeout</span><span style="color:#ABB2BF;">(resolve, time));</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">calculateDigest</span><span style="color:#ABB2BF;">(body, sk) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const hmac = crypto.</span><span style="color:#61AFEF;">createHmac</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sha256&#39;</span><span style="color:#ABB2BF;">, sk);</span></span>
<span class="line"><span style="color:#ABB2BF;">    hmac.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(body);</span></span>
<span class="line"><span style="color:#ABB2BF;">    const signature = hmac.</span><span style="color:#61AFEF;">digest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;base64&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> signature;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">calculateSignature</span><span style="color:#ABB2BF;">(method, url, ak, sk, date) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const strToSign = </span><span style="color:#FFFFFF;">\`\${method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toUpperCase</span><span style="color:#ABB2BF;">()</span><span style="color:#FFFFFF;">}\\n\${url}\\n\\n\${ak}\\n\${date}\\n\`;</span></span>
<span class="line"><span style="color:#FFFFFF;">    const hmac = crypto</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createHmac</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sha256&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#FFFFFF;"> sk</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    hmac.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(strToSign);</span></span>
<span class="line"><span style="color:#ABB2BF;">    const signature = hmac.</span><span style="color:#61AFEF;">digest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;base64&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> signature;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, body) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const date = </span><span style="color:#61AFEF;">moment</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">utc</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ddd, DD MMM YYYY HH:mm:ss [GMT]&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    const signature = </span><span style="color:#61AFEF;">calculateSignature</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">AK</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">SK</span><span style="color:#ABB2BF;">, date);</span></span>
<span class="line"><span style="color:#ABB2BF;">    const digest = </span><span style="color:#61AFEF;">calculateDigest</span><span style="color:#ABB2BF;">(body, </span><span style="color:#D19A66;">SK</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    const headers = {</span></span>
<span class="line"><span style="color:#98C379;">        &#39;Content-Type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/json&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;X-HMAC-SIGNATURE&#39;</span><span style="color:#ABB2BF;">: signature,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;X-HMAC-ACCESS-KEY&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">AK</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;X-HMAC-ALGORITHM&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;hmac-sha256&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;X-HMAC-DIGEST&#39;</span><span style="color:#ABB2BF;">: digest,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;X-HMAC-Date&#39;</span><span style="color:#ABB2BF;">: date,</span></span>
<span class="line"><span style="color:#98C379;">        &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 MicroMessenger/7.0.20.1781(0x6700143B) NetType/WIFI MiniProgramEnv/Windows WindowsWechat/WMPF XWEB/6945&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    };</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> headers;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">getUserInfo</span><span style="color:#ABB2BF;">(appId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/queryById/token&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const data = {appId};</span></span>
<span class="line"><span style="color:#ABB2BF;">    const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">    headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    let resData;</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, {method: method, data: data, headers: headers})</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        });</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">getChannelActivity</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;">, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/promotion/channelActivity&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const data = {</span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#ABB2BF;">    const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">    headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    let resData;</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, {method: method, data: data, headers: headers})</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        });</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">getChannelInfoId</span><span style="color:#ABB2BF;">(appId) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const url = </span><span style="color:#98C379;">&#39;/front-manager/api/get/getChannelInfoId&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const data = {appId};</span></span>
<span class="line"><span style="color:#ABB2BF;">    const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">    headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    let resData;</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, {method: method, data: data, headers: headers})</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        });</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">appoint</span><span style="color:#ABB2BF;">(activityId, channelId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/promotion/appoint&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const data = {activityId, channelId};</span></span>
<span class="line"><span style="color:#ABB2BF;">    const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">    headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    let resData;</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, {method: method, data: data, headers: headers})</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        });</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">checkCustomerInQianggou</span><span style="color:#ABB2BF;">(activityId, channelId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/promotion/checkCustomerInQianggou&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const data = {activityId, channelId};</span></span>
<span class="line"><span style="color:#ABB2BF;">    const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">    headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    let resData;</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, {method: method, data: data, headers: headers})</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">        });</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">autoSubmit</span><span style="color:#ABB2BF;">(appId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    let channelId = </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    let channelName = </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">XLTH_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;8&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;新联惠购&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">GLYP_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;7&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;贵旅优品&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">KGLG_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;2&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;空港乐购&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">HLQG_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;6&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;航旅黔购&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">ZHCS_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;5&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;遵行出山&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">GYQP_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;3&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;贵盐黔品&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">LLSC_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;乐旅商城&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">YLQX_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelId = </span><span style="color:#98C379;">&#39;9&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        channelName = </span><span style="color:#98C379;">&#39;驿路黔寻&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        const res1 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> getUserInfo</span><span style="color:#ABB2BF;">(appId, token);</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (res1.code </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;10000&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(res1.message);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(res1.message);</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        const realName = res1.data.realName;</span></span>
<span class="line"><span style="color:#ABB2BF;">        const phone = res1.data.phone;</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`当前用户</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${phone}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`当前用户</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${phone}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        const res2 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> getChannelActivity</span><span style="color:#ABB2BF;">(channelId, token);</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (res2.code </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;10000&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(res2.message);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(res2.message);</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        const activityId = res2.data.id;</span></span>
<span class="line"><span style="color:#ABB2BF;">        const activityName = res2.data.name;</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`活动名称</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${activityName}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`活动名称</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${activityName}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        const res3 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> checkCustomerInQianggou</span><span style="color:#ABB2BF;">(activityId, channelId, token);</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (res3.code </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;10000&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(res3.message);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(res3.message);</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        const data = res3.data;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        let message = </span><span style="color:#98C379;">&#39;用户已经预约成功&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (data </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> false) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            const res4 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> appoint</span><span style="color:#ABB2BF;">(activityId, channelId, token);</span></span>
<span class="line"><span style="color:#ABB2BF;">            this.sendMessage = res4.message;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`预约结果</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${message}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`预约结果</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${message}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;"> (err) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`运行异常</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${err</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">message}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`运行异常</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${err</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">message}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">XLTH_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">XLTH_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 新联惠购</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">GLYP_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">GLYP_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵旅优品</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">KGLG_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">KGLG_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 空港乐购</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">HLQG_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">HLQG_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 航旅黔购</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">ZHCS_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">ZHCS_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 遵行出山</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">GYQP_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">GYQP_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵盐黔品</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">LLSC_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">LLSC_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 乐旅商城</span></span>
<span class="line"><span style="color:#ABB2BF;">    const </span><span style="color:#D19A66;">YLQX_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">YLQX_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 驿路黔寻</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">XLTH_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">XLTH_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">XLTH_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">GLYP_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">GLYP_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">GLYP_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">KGLG_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;空港乐购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">KGLG_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">KGLG_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;空港乐购预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;空港乐购预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">HLQG_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;航旅黔购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">HLQG_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HLQG_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;航旅黔购预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;航旅黔购预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">ZHCS_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;遵行出山预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">ZHCS_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">ZHCS_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;遵行出山预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;遵行出山预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">GYQP_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">GYQP_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">GYQP_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">LLSC_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">LLSC_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">LLSC_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">YLQX_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻预约开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">YLQX_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">YLQX_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻预约结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> notify.</span><span style="color:#61AFEF;">sendNotify</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`葫芦娃预约\`</span><span style="color:#ABB2BF;">, sendMessage.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">), {}, </span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n\\n</span><span style="color:#98C379;">本通知 By：一泽&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br></div></div><p>解析：</p><p>这段 JavaScript 代码是一个自动化预约脚本，版本为 1.06，设计用于在多个平台上根据用户提供的 token 自动完成预约活动。它主要针对几个特定的购物平台，通过调用这些平台的 API 接口实现自动预约。以下是脚本的主要功能和步骤：</p><ol><li>环境变量设置：脚本通过环境变量获取用户的 token，支持多账号操作。针对不同的购物平台，如新联惠购、贵旅优品、空港乐购等，设置了不同的环境变量（如<code>XLTH_COOKIE</code>、<code>GLYP_COOKIE</code>等）来存储 token。</li><li>请求和加密处理：使用<code>axios</code>库发起网络请求，<code>crypto</code>库进行签名加密，以满足 API 调用时的安全要求。<code>moment</code>库用于处理日期和时间格式，以符合 API 请求的标准。</li><li>构建请求头：<code>buildHeader</code>函数用于构建 API 请求所需的头部信息，包括内容类型、签名、访问密钥等信息。</li><li>用户信息和活动查询：通过<code>getUserInfo</code>和<code>getChannelActivity</code>函数查询用户信息和渠道活动详情。</li><li>预约活动：<code>appoint</code>函数用于执行预约操作，调用特定的 API 接口进行活动预约。</li><li>检查和提交预约：<code>checkCustomerInQianggou</code>函数用于检查用户是否已在抢购活动中，<code>autoSubmit</code>函数负责自动提交预约请求。</li><li>主函数：<code>main</code>函数是脚本的入口，处理环境变量中的 token，遍历每个账号，并对每个购物平台进行预约尝试。</li><li>通知：通过<code>notify.sendNotify</code>函数发送预约结果的通知。</li></ol><p>整个脚本利用了环境变量中的 token 来为不同的用户在多个购物平台上自动完成预约，减少了手动操作的需要，并通过定时任务（如<code>cron</code>设置）自动执行，以提高抢购活动的成功率。</p><h1 id="定时轮询预约申购-mao-台脚本" tabindex="-1">定时轮询预约申购 mao 台脚本 <a class="header-anchor" href="#定时轮询预约申购-mao-台脚本" aria-label="Permalink to &quot;定时轮询预约申购 mao 台脚本&quot;">​</a></h1><p><strong>代码如下</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> appium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.common.exceptions </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> NoSuchElementException</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> appium.webdriver.common.touch_action </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TouchAction</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> appium.webdriver.connectiontype </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ConnectionType</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">daily_subscribe </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">daily_tour </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">luck_day </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">daily_check </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps[</span><span style="color:#98C379;">&#39;platformName&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;Android&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps[</span><span style="color:#98C379;">&#39;platformversion&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;7.1.1&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps[</span><span style="color:#98C379;">&#39;deviceName&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;192.168.0.105:5555&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># desired_caps[&#39;udid&#39;] = &#39;192.168.0.101:5556&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#desired_caps[&#39;appPackage&#39;] = &#39;com.moutai.mall&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#desired_caps[&#39;appActivity&#39;] = &#39;.MainActivity&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps[</span><span style="color:#98C379;">&#39;noReset&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;True&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps[</span><span style="color:#98C379;">&#39;unicodeKeyboard&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#ABB2BF;">desired_caps[</span><span style="color:#98C379;">&#39;resetKeyboard&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># print(driver.current_package)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># print(driver.current_activity)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> handleException</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;登录&#39;]&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/etPhone&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">clear</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/etPhone&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;15895919875&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        flag </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_class_name</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;android.widget.CheckBox&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;checked&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> flag </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;false&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            driver.</span><span style="color:#61AFEF;">find_element_by_class_name</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;android.widget.CheckBox&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;获取验证码&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">start_activity</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;com.tencent.mobileqq&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.activity.SplashActivity&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[contains(@content-desc, &#39;phil&#39;)]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_class_name</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;android.widget.EditText&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;i茅台登录过期，请输入验证码&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;发送&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        string </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        eles </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_class_name</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;android.widget.TextView&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(eles)</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> eles[i].text.</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;yzm&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                string </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> eles[i].text[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">:]</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(string)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># back</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># back</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/etVerifyCode&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">clear</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/etVerifyCode&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(string)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;登录&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> NoSuchElementException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> daily_subcribe</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #driver.start_activity(&#39;com.moutai.mall&#39;, &#39;.MainActivity&#39;)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;i茅台&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/ivLeft&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;预约申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;确定申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;继续申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">swipe</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">530</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1700</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">530</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">300</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">swipe</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">530</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1700</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">530</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">300</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;预约申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;确定申购&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #check</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;查看详情&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/date_time&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        status </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/draw_status&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        string </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">min</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(date))):</span></span>
<span class="line"><span style="color:#ABB2BF;">            string </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> date[i].text </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> status[i].text</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(string)</span></span>
<span class="line"><span style="color:#ABB2BF;">        current_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">, time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#56B6C2;">        str</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> current_date </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;静候申购结果&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> current_date </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;静候申购结果&quot;</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># return</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> string </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> NoSuchElementException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#61AFEF;">        handleException</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> check_daily_subcribe</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;i茅台&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;我的&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;我的申购单&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/date_time&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    status </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.moutai.mall:id/draw_status&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    string </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(date)):</span></span>
<span class="line"><span style="color:#ABB2BF;">        string </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> date[i].text </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;:&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> status[i].text </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(string)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">start_activity</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;com.tencent.mobileqq&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.activity.SplashActivity&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[contains(@content-desc, &#39;phil&#39;)]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_class_name</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;android.widget.EditText&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(string)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;发送&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># back</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># back</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> xiao_mao_yun</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;i茅台&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;小茅运&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;旅行&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[contains(@text, &#39;100耐力去旅行&#39;)]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;1650539651c20999&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># exit</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> NoSuchElementException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;小茅运&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;旅行&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;领取奖励&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;我知道了&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # driver.find_element_by_xpath(&quot;//*[@text=&#39;我知道啦&#39;]&quot;).click()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        TouchAction</span><span style="color:#ABB2BF;">(driver).</span><span style="color:#61AFEF;">tap</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">315</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1704</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">perform</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;1650539651c20999&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># exit</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> NoSuchElementException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # driver.find_element_by_xpath(&quot;//*[@text=&#39;60耐力 加速完成&#39;]&quot;).click()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # driver.find_element_by_xpath(&quot;//*[@text=&#39;40耐力 加速完成&#39;]&quot;).click()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # driver.find_element_by_xpath(&quot;//*[@text=&#39;20耐力 加速完成&#39;]&quot;).click()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # driver.find_element_by_xpath(&quot;//*[@text=&#39;小茅累了，明日继续&#39;]&quot;).click()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # TouchAction(driver).tap(x=544, y=1620).perform()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> catch_jong_dong</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;京东&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;我的&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;商品收藏&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@resource-id=&#39;com.jd.lib.favourites.feature:id/b7&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> catch_tian_mao</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;手机天猫&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@text=&#39;购物车&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;天猫超市店铺勾选按钮未选中&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;结算,按钮&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;//*[@content-desc=&#39;提交订单&#39;]&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> unlock</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> driver</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Remote</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;http://localhost:4723/wd/hub&#39;</span><span style="color:#ABB2BF;">, desired_caps)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">implicitly_wait</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">swipe</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">530</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1700</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">530</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">300</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        TouchAction</span><span style="color:#ABB2BF;">(driver).</span><span style="color:#61AFEF;">press</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">536</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">993</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">move_to</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">247</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1283</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">move_to</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">536</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1283</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">move_to</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">828</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1283</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">release</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">perform</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># home</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> lock</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># back</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># back</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># home</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">close_app</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">press_keycode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">26</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># power</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        current_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> current_time.tm_hour </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 8</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(current_time)</span></span>
<span class="line"><span style="color:#ABB2BF;">            daily_subscribe </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">            daily_tour </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">            luck_day </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">            daily_check </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#ABB2BF;"> current_time.tm_hour </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 9</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> daily_subscribe </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(current_time)</span></span>
<span class="line"><span style="color:#61AFEF;">            unlock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#61AFEF;"> daily_subcribe</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                daily_subscribe </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">            lock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#ABB2BF;"> current_time.tm_hour </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 10</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> daily_tour </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(current_time)</span></span>
<span class="line"><span style="color:#61AFEF;">            unlock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#61AFEF;"> xiao_mao_yun</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                daily_tour </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">            lock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#D19A66;"> 0</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;"> current_time.tm_min </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;"> 50</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(current_time)</span></span>
<span class="line"><span style="color:#61AFEF;">            unlock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">            lock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # elif current_time.tm_hour == 18 and 20 &lt; current_time.tm_min &lt; 50 and daily_check is 0:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     print(current_time)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     unlock()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     check_daily_subcribe()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     lock()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     daily_check = 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">600</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br></div></div><p><strong>说明</strong></p><p>这段代码使用 Appium 框架来自动化控制安卓设备，主要执行一系列操作，如登录、预约申购、自动旅行等。下面是代码的详细解析：</p><p><strong>导入模块和初始化变量</strong></p><p>- 使用 <code>appium.webdriver</code> 来驱动安卓设备。</p><p>- <code>selenium.common.exceptions.NoSuchElementException</code> 用于处理元素未找到的异常。</p><p>- 定义了几个全局变量（<code>daily_subscribe</code>, <code>daily_tour</code>, <code>luck_day</code>, <code>daily_check</code>）来跟踪每日任务的完成状态。</p><p><strong>Appium 配置</strong></p><p>- 设置 <code>desired_caps</code> 字典来配置 Appium，包括设备名称、平台、版本等信息。</p><p><strong>Appium 驱动实例</strong></p><p>- <code>driver</code> 是用于控制设备的 webdriver 实例。</p><p><strong>功能函数</strong></p><p>- <code>handleException()</code>：异常处理，尝试登录并获取验证码，然后返回到登录界面。</p><p>- <code>daily_subcribe()</code>：尝试进行每日预约申购操作。</p><p>- <code>check_daily_subcribe()</code>：检查预约申购的状态。</p><p>- <code>xiao_mao_yun()</code>：自动完成旅行任务。</p><p>- <code>catch_jong_dong()</code> 和 <code>catch_tian_mao()</code>：模拟在京东和天猫的购物行为。</p><p>- <code>unlock()</code> 和 <code>lock()</code>：解锁和锁定设备，执行操作前后的准备和收尾工作。</p><p><strong>主逻辑</strong></p><p>- 在主函数中，程序进入一个无限循环，每 10 分钟检查一次时间，根据当前的小时数来决定执行哪些任务。例如，在 9 点时尝试执行 <code>daily_subcribe()</code> 函数进行申购操作，而在 10 点时执行 <code>xiao_mao_yun()</code> 进行旅行任务。</p><p><strong>特点和用途</strong></p><p>- 此脚本适用于需要定时自动化执行一系列手机操作的场景，如自动登录、预约、购物等。</p><p>- 通过修改时间条件和对应的任务函数，可以灵活配置其自动执行的任务。</p><p>- 此脚本依赖于具体的应用元素和布局（如元素 ID 和 XPath），可能需要针对不同的应用和安卓版本进行适当调整。</p><p>- 需要有适当的设备和 Appium 服务器配置才能运行此脚本。</p><p>这个脚本的使用场景主要是自动化测试或自动执行日常任务，减少重复性工作的人工操作需求。如果有具体的使用场景或者遇到问题，可以进一步探讨如何调整和优化代码。</p><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h1 id="葫芦娃茅台中签脚本" tabindex="-1">葫芦娃茅台中签脚本 <a class="header-anchor" href="#葫芦娃茅台中签脚本" aria-label="Permalink to &quot;葫芦娃茅台中签脚本&quot;">​</a></h1><p><strong>代码如下</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#56B6C2;">/**</span></span>
<span class="line"><span style="color:#ABB2BF;"> 葫芦娃中签查询 v4.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"> cron: </span><span style="color:#D19A66;">30</span><span style="color:#D19A66;"> 8</span><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> *</span></span>
<span class="line"><span style="color:#ABB2BF;"> const </span><span style="color:#FFFFFF;">$</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> new </span><span style="color:#61AFEF;">Env</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;葫芦娃中签查询&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;"> 自行抓包把token</span><span style="color:#ABB2BF;">(一般在请求头里)填到变量中, 多账号用换行隔开（可自定义）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">XLTH_COOKIE</span><span style="color:#ABB2BF;"> 新联惠购</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">GLYP_COOKIE</span><span style="color:#ABB2BF;"> 贵旅优品</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">KGLG_COOKIE</span><span style="color:#ABB2BF;"> 空港乐购</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">HLQG_COOKIE</span><span style="color:#ABB2BF;"> 航旅黔购</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">ZHCS_COOKIE</span><span style="color:#ABB2BF;"> 遵行出山</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">GYQP_COOKIE</span><span style="color:#ABB2BF;"> 贵盐黔品</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">LLSC_COOKIE</span><span style="color:#ABB2BF;"> 乐旅商城</span></span>
<span class="line"><span style="color:#ABB2BF;"> 环境变量 </span><span style="color:#D19A66;">YLQX_COOKIE</span><span style="color:#ABB2BF;"> 驿路黔寻</span></span>
<span class="line"><span style="color:#56B6C2;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">SPLIT</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 分割符（可自定义）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const axios </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;axios&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const crypto </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;crypto&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const moment </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;moment&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const notify </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./sendNotify&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">XLTH_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wxded2e7e6d60ac09d&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 新联惠购</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">GLYP_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx61549642d715f361&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵旅优品</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">KGLG_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx613ba8ea6a002aa8&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 空港乐购</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">HLQG_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx936aa5357931e226&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 航旅黔购</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">ZHCS_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx624149b74233c99a&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 遵航出山</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">GYQP_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx5508e31ffe9366b8&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵盐黔品</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">LLSC_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wx821fb4d8604ed4d6&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 乐旅商城</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">YLQX_APPID</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;wxee0ce83ab4b26f9c&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 驿路黔寻</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;https://gw.huiqunchina.com&#39;</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">AK</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;00670fb03584fbf44dd6b136e534f495&#39;</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">const </span><span style="color:#D19A66;">SK</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;0d65f24dbe2bc1ede3c3ceeb96ef71bb&#39;</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">let sendMessage </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">delay</span><span style="color:#ABB2BF;"> (time) {</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> new </span><span style="color:#61AFEF;">Promise</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">resolve</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#61AFEF;"> setTimeout</span><span style="color:#ABB2BF;">(resolve, time));</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">calculateDigest</span><span style="color:#ABB2BF;"> (body, sk) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const hmac = crypto.</span><span style="color:#61AFEF;">createHmac</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sha256&#39;</span><span style="color:#ABB2BF;">, sk);</span></span>
<span class="line"><span style="color:#ABB2BF;">  hmac.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(body);</span></span>
<span class="line"><span style="color:#ABB2BF;">  const signature = hmac.</span><span style="color:#61AFEF;">digest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;base64&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> signature;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">calculateSignature</span><span style="color:#ABB2BF;"> (method, url, ak, sk, date) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const strToSign = </span><span style="color:#FFFFFF;">\`\${method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toUpperCase</span><span style="color:#ABB2BF;">()</span><span style="color:#FFFFFF;">}\\n\${url}\\n\\n\${ak}\\n\${date}\\n\`;</span></span>
<span class="line"><span style="color:#FFFFFF;">  const hmac = crypto</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createHmac</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sha256&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#FFFFFF;"> sk</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  hmac.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(strToSign);</span></span>
<span class="line"><span style="color:#ABB2BF;">  const signature = hmac.</span><span style="color:#61AFEF;">digest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;base64&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> signature;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;"> (method, url, body) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const date = </span><span style="color:#61AFEF;">moment</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">utc</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ddd, DD MMM YYYY HH:mm:ss [GMT]&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  const signature = </span><span style="color:#61AFEF;">calculateSignature</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">AK</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">SK</span><span style="color:#ABB2BF;">, date);</span></span>
<span class="line"><span style="color:#ABB2BF;">  const digest = </span><span style="color:#61AFEF;">calculateDigest</span><span style="color:#ABB2BF;">(body, </span><span style="color:#D19A66;">SK</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  const headers = {</span></span>
<span class="line"><span style="color:#98C379;">    &#39;Content-Type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/json&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">    &#39;X-HMAC-SIGNATURE&#39;</span><span style="color:#ABB2BF;">: signature,</span></span>
<span class="line"><span style="color:#98C379;">    &#39;X-HMAC-ACCESS-KEY&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">AK</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">    &#39;X-HMAC-ALGORITHM&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;hmac-sha256&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">    &#39;X-HMAC-DIGEST&#39;</span><span style="color:#ABB2BF;">: digest,</span></span>
<span class="line"><span style="color:#98C379;">    &#39;X-HMAC-Date&#39;</span><span style="color:#ABB2BF;">: date,</span></span>
<span class="line"><span style="color:#98C379;">    &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 MicroMessenger/7.0.20.1781(0x6700143B) NetType/WIFI MiniProgramEnv/Windows WindowsWechat/WMPF XWEB/6945&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> headers;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">getUserInfo</span><span style="color:#ABB2BF;"> (appId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/queryById/token&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  const data = { appId };</span></span>
<span class="line"><span style="color:#ABB2BF;">  const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">  headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  let resData;</span></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, { method: method, data: data, headers: headers })</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">    })</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">getChannelActivity</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;">, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/promotion/channelActivity&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  const data = { </span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;"> };</span></span>
<span class="line"><span style="color:#ABB2BF;">  const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">  headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  let resData;</span></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, { method: method, data: data, headers: headers })</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">    })</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">/**</span><span style="color:#ABB2BF;"> 查询 </span><span style="color:#56B6C2;">*/</span></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">getWinningCustomers</span><span style="color:#ABB2BF;"> (activityId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const url = </span><span style="color:#98C379;">&#39;/front-manager/api/customer/promotion/getWinningCustomers&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  const method = </span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  const data = { activityId };</span></span>
<span class="line"><span style="color:#ABB2BF;">  const headers = </span><span style="color:#61AFEF;">buildHeader</span><span style="color:#ABB2BF;">(method, url, </span><span style="color:#D19A66;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stringify</span><span style="color:#ABB2BF;">(data));</span></span>
<span class="line"><span style="color:#ABB2BF;">  headers[</span><span style="color:#98C379;">&#39;X-access-token&#39;</span><span style="color:#ABB2BF;">] = token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  let resData;</span></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#61AFEF;"> axios</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HOST</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> url, { method: method, data: data, headers: headers })</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      resData = res.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">    })</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#56B6C2;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      resData = err.response.data;</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> resData;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">autoSubmit</span><span style="color:#ABB2BF;"> (appId, token) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  let channelId = </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  let channelName = </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">XLTH_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;8&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;新联惠购&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">GLYP_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;7&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;贵旅优品&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">KGLG_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;2&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;空港乐购&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">HLQG_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;6&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;航旅黔购&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">ZHCS_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;5&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;遵行出山&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">GYQP_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;3&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;贵盐黔品&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">LLSC_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;乐旅商城&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (appId </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">= </span><span style="color:#D19A66;">YLQX_APPID</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelId = </span><span style="color:#98C379;">&#39;9&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    channelName = </span><span style="color:#98C379;">&#39;驿路黔寻&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    const res1 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> getUserInfo</span><span style="color:#ABB2BF;">(appId, token);</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (res1.code </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;10000&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(res1.message);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(res1.message);</span></span>
<span class="line"><span style="color:#C678DD;">      return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    const realName = res1.data.realName;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const phone = res1.data.phone;</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`当前用户</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${phone}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`当前用户</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${phone}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    const res2 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> getChannelActivity</span><span style="color:#ABB2BF;">(channelId, token);</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (res2.code </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;10000&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(res2.message);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(res2.message);</span></span>
<span class="line"><span style="color:#C678DD;">      return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    const activityId = res2.data.id;</span></span>
<span class="line"><span style="color:#ABB2BF;">    const activityName = res2.data.name;</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`活动名称</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${activityName}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`活动名称</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${activityName}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    const res5 = </span><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> getWinningCustomers</span><span style="color:#ABB2BF;">(activityId, token)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (res5.code </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;10000&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(res5.message);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(res5.message);</span></span>
<span class="line"><span style="color:#C678DD;">      return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`小程序：\${channelName}，活动名称「\${activityName}」，中签结果：\${res5</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">message ?? </span><span style="color:#98C379;">&#39;--&#39;</span><span style="color:#FFFFFF;">}\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`小程序：\${channelName}，活动名称「\${activityName}」，中签结果：\${res5</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">message ?? </span><span style="color:#98C379;">&#39;--&#39;</span><span style="color:#FFFFFF;">}\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;"> 发送飞书机器人</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;"> (err) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`运行异常</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${err</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">message}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`运行异常</span><span style="color:#ABB2BF;">[</span><span style="color:#FFFFFF;">\${err</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">message}</span><span style="color:#ABB2BF;">]</span><span style="color:#FFFFFF;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> function </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">XLTH_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">XLTH_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 新联惠购</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">GLYP_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">GLYP_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵旅优品</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">KGLG_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">KGLG_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 空港乐购</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">HLQG_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">HLQG_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 航旅黔购</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">ZHCS_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">ZHCS_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 遵行出山</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">GYQP_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">GYQP_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 贵盐黔品</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">LLSC_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">LLSC_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 乐旅商城</span></span>
<span class="line"><span style="color:#ABB2BF;">  const </span><span style="color:#D19A66;">YLQX_COOKIE_ARR</span><span style="color:#ABB2BF;"> = process.env.</span><span style="color:#D19A66;">YLQX_COOKIE</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;"> 驿路黔寻</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">XLTH_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">XLTH_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">XLTH_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">GLYP_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">GLYP_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">GLYP_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵旅优品查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">KGLG_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;空港乐购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">KGLG_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">KGLG_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;空港乐购查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;空港乐购查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">HLQG_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;航旅黔购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">HLQG_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">HLQG_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;航旅黔购查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;航旅黔购查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">ZHCS_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;遵行出山查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;新联惠购查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">ZHCS_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">ZHCS_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;遵行出山查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;遵行出山查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">GYQP_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">GYQP_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">GYQP_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;贵盐黔品查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">LLSC_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">LLSC_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">LLSC_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;乐旅商城查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">YLQX_COOKIE_ARR</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻查询开始&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (let [index, item] of </span><span style="color:#D19A66;">YLQX_COOKIE_ARR</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">SPLIT</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">entries</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`----第\${index </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#FFFFFF;">}个号----\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> autoSubmit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">YLQX_APPID</span><span style="color:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#C678DD;">      await</span><span style="color:#61AFEF;"> delay</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendMessage.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;驿路黔寻查询结束</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#ABB2BF;"> notify.</span><span style="color:#61AFEF;">sendNotify</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">\`葫芦娃中签查询\`</span><span style="color:#ABB2BF;">, sendMessage.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">), {},);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br></div></div><p><strong>说明</strong></p><p>这段代码是一个用于查询中签结果的自动化脚本，专门针对多个不同的平台（如新联惠购、贵旅优品等）。它是为了运行在 Node.js 环境中设计的，主要通过环境变量配置用户的登录信息，然后自动查询中签结果。</p><p><strong>主要组件和功能</strong></p><ol><li>环境变量: 利用环境变量来存储各个平台的 Cookie 信息，这些信息用于用户身份验证。</li><li>Axios: 使用 axios 库来发送 HTTP 请求，与各平台的 API 进行交互。</li><li>Crypto: 使用 crypto 库来进行加密操作，主要用于生成请求签名，确保请求的安全性。</li><li>Moment: 使用 moment 库来处理日期和时间，这在生成签名和设置请求头中尤为重要。</li><li>Notify: 假设有一个 notify 模块用于发送通知，可能是通过邮件或其他方式。</li></ol><p><strong>主要逻辑</strong></p><ol><li>配置信息: 定义了多个平台的 AppID、API 密钥等信息。</li><li>HTTP 请求头生成: <code>buildHeader</code>函数负责根据提供的参数构建每个请求所需的特定头信息，包括内容类型、日期、签名等。</li><li>用户信息和活动信息查询: <code>getUserInfo</code>和<code>getChannelActivity</code>函数用于获取用户信息和活动详情。</li><li>中签查询: <code>getWinningCustomers</code>函数查询特定活动的中签情况。</li></ol><p><strong>执行流程</strong></p><ol><li>Cookie 解析: 脚本首先从环境变量中读取不同平台的 Cookie。</li><li>按平台执行查询: 对于每个平台，脚本通过<code>autoSubmit</code>函数执行查询操作。此函数将调用前述的获取用户信息、获取活动信息和查询中签结果的函数。</li><li>结果处理: 查询结果会被整理并通过通知模块发送出去。</li></ol><p><strong>自动化和异步处理</strong></p><p>- 脚本大量使用了<code>async</code>和<code>await</code>来处理异步操作，确保在发送请求或等待响应时不会阻塞其他操作。</p><p>- 通过设置延时（<code>delay</code>函数）来避免过于频繁的请求。</p><p><strong>定期执行</strong></p><p>- 脚本顶部的注释提到了 Cron 表达式，这意味着脚本是设计为定时执行的。具体来说，它被设置为每天的 8 点 30 分执行。</p><p><strong>安全性</strong></p><p>- 使用 HMAC SHA256 算法来为每个请求生成签名，增加了 API 调用的安全性。</p><p>这个脚本适合用在需要自动化查询中签结果的场景，尤其是在涉及多个账号和平台时。它通过环境变量灵活配置，利用现代 JavaScript 异步特性来高效处理网络请求。</p><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h1 id="chrome-插件-天猫活动自动抢购茅台脚本" tabindex="-1">Chrome 插件：天猫活动自动抢购茅台脚本 <a class="header-anchor" href="#chrome-插件-天猫活动自动抢购茅台脚本" aria-label="Permalink to &quot;Chrome 插件：天猫活动自动抢购茅台脚本&quot;">​</a></h1><h2 id="步骤-1-准备文件" tabindex="-1">步骤 1: 准备文件 <a class="header-anchor" href="#步骤-1-准备文件" aria-label="Permalink to &quot;步骤 1: 准备文件&quot;">​</a></h2><p>首先，确保您的项目目录包含以下文件：</p><p>- manifest.json</p><p>- maotai.js</p><p>- icon.png（需要创建或下载一个图标文件作为扩展的图标）</p><h2 id="步骤-2-修改和确认这三个文件" tabindex="-1">步骤 2: 修改和确认这三个文件 <a class="header-anchor" href="#步骤-2-修改和确认这三个文件" aria-label="Permalink to &quot;步骤 2: 修改和确认这三个文件&quot;">​</a></h2><h3 id="manifest-json" tabindex="-1">manifest.json <a class="header-anchor" href="#manifest-json" aria-label="Permalink to &quot;manifest.json&quot;">​</a></h3><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;manifest_version&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Tmall-tickets&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;version&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;description&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天猫超市抢购茅台&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;icons&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;48&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;icon.png&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;browser_action&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;default_icon&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;icon.png&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;permissions&quot;</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&quot;tabs&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&lt;all_urls&gt;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;storage&quot;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;content_scripts&quot;</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">		{</span></span>
<span class="line"><span style="color:#E06C75;">			&quot;matches&quot;</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#98C379;">				&quot;https://chaoshi.detail.tmall.com/*&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">				&quot;https://cart.tmall.com/*&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">				&quot;https://buy.tmall.com/*&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">			],</span></span>
<span class="line"><span style="color:#E06C75;">			&quot;js&quot;</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&quot;maotai.js&quot;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;">			&quot;run_at&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;document_idle&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	]</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="maotai-js" tabindex="-1">maotai.js <a class="header-anchor" href="#maotai-js" aria-label="Permalink to &quot;maotai.js&quot;">​</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//定时器</span></span>
<span class="line"><span style="color:#C678DD;">var</span><span style="color:#E06C75;"> timer</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> null</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//检测状态</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> checkElementState</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">callback</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> ele</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">ele</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">		callback</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#61AFEF;"> callback</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;异步加载元素中....&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#E06C75;"> path</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		setTimeout</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#61AFEF;">			checkElementState</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">callback</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//点击购买按钮</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> clickBuy</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;买！&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	//票的数量  如果还不可以购买，这个地方获取会失败</span></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> amount</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getElementsByClassName</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;mui-amount-increase&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#E06C75;">	amount</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#E5C07B;"> amount</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">//+1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> btnBuy</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.buy-button-selector&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//结算</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> checkOut</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;结算开始....&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> btn</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getElementById</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;J_Go&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">btn</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">		btn</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;结算按钮没找到&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> checkOutAsync</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#61AFEF;">	checkElementState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;#J_Go&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">checkOut</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//提交订单</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> submitOrder</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;提交订单开始....&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">	checkElementState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.go-btn&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#C678DD;">		var</span><span style="color:#E06C75;"> btn</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.go-btn&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">		if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">btn</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">			btn</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">		} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">			console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;提交订单按钮没找到&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//目标时间</span></span>
<span class="line"><span style="color:#C678DD;">var</span><span style="color:#E06C75;"> dDate</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Date</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">//10点和20点开抢</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">dDate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getHours</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;"> 10</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">	dDate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setHours</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">9</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">59</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">59.2</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	dDate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setHours</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">19</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">59</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">59.2</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//dDate.setSeconds( dDate.getSeconds() + 10 );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//进入时间判断循环</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> enterTimeCheckLoop</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">callback</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> date</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Date</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> diff</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Date</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">dDate</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">-</span><span style="color:#E5C07B;"> Date</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">date</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">diff</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">diff</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">900</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;时间过了！&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">diff</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#D19A66;"> 500</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">		callback</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#61AFEF;"> callback</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;时间到了！！！&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">		setTimeout</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#61AFEF;">			enterTimeCheckLoop</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">callback</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}, </span><span style="color:#D19A66;">400</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		//console.log(&#39;--&#39;);</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//主要函数</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">		&quot;############################开始抢购茅台############################&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	//debugger;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">	var</span><span style="color:#E06C75;"> href</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> window</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">location</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">href</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">href</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">indexOf</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;cart.tmall.com&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		//结算页面</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		//进入时间判断</span></span>
<span class="line"><span style="color:#61AFEF;">		enterTimeCheckLoop</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">checkOutAsync</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">href</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">indexOf</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;buy.tmall.com&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		//提交订单页面</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">		submitOrder</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br></div></div><p><strong>icon.png</strong></p><p>注意: 购买按钮和其他按钮的实际选择器需要您通过浏览天猫超市的相应页面，使用开发者工具（F12）来确定正确的 CSS 选择器。</p><h2 id="步骤-3-加载扩展到-chrome-浏览器" tabindex="-1">步骤 3: 加载扩展到 Chrome 浏览器 <a class="header-anchor" href="#步骤-3-加载扩展到-chrome-浏览器" aria-label="Permalink to &quot;步骤 3: 加载扩展到 Chrome 浏览器&quot;">​</a></h2><ol><li>打开 Chrome。</li><li>输入 <code>chrome://extensions/</code> 在地址栏并回车。</li><li>开启右上角的 &quot;开发者模式&quot;。</li><li>点击 &quot;加载已解压的扩展程序&quot;，选择包含您的 <code>manifest.json</code> 和其他文件的文件夹。</li></ol><h2 id="步骤-4-测试扩展" tabindex="-1">步骤 4: 测试扩展 <a class="header-anchor" href="#步骤-4-测试扩展" aria-label="Permalink to &quot;步骤 4: 测试扩展&quot;">​</a></h2><ul><li><p>打开天猫超市的相关页面（如茅台酒页面）以检查扩展是否按预期触发。</p></li><li><p>观察控制台（Console tab）中的输出，以确认脚本是否在正确的时间执行了预期的操作。</p></li></ul><p>通过以上步骤，您应该能够成功部署并测试您的 Chrome 扩展。这个扩展会在指定的时间尝试自动完成购买过程，帮助您提高在天猫超市上成功购买茅台酒的机会。</p><h1 id="手机上用油猴实现自动抢购茅台" tabindex="-1">手机上用油猴实现自动抢购茅台 <a class="header-anchor" href="#手机上用油猴实现自动抢购茅台" aria-label="Permalink to &quot;手机上用油猴实现自动抢购茅台&quot;">​</a></h1><h2 id="油猴获取和部署全讲解" tabindex="-1">油猴获取和部署全讲解 <a class="header-anchor" href="#油猴获取和部署全讲解" aria-label="Permalink to &quot;油猴获取和部署全讲解&quot;">​</a></h2><p>创建和部署一个简单的油猴脚本需要遵循几个基本步骤，本示例脚本的功能是自动更改 Google 主页的背景色。</p><h3 id="步骤-1-安装油猴扩展" tabindex="-1">步骤 1: 安装油猴扩展 <a class="header-anchor" href="#步骤-1-安装油猴扩展" aria-label="Permalink to &quot;步骤 1: 安装油猴扩展&quot;">​</a></h3><p>请根据你使用的浏览器，参照上一个回答中的指引安装油猴扩展（Tampermonkey 或 Greasemonkey）。</p><p>Google Chrome：在 Chrome Web Store 搜索“Tampermonkey”，找到扩展程序并点击“添加到 Chrome”。</p><p>Mozilla Firefox：在 Firefox Add-ons 搜索“Greasemonkey”或“Tampermonkey”，选择相应的扩展点击“添加到 Firefox”。</p><p>Microsoft Edge：在 Microsoft Edge Add-ons 搜索“Tampermonkey”，然后安装。</p><p>Safari：在 Safari Extensions 中搜索“Tampermonkey”，然后下载并安装。</p><h4 id="查找脚本" tabindex="-1"><em>查找脚本</em> <a class="header-anchor" href="#查找脚本" aria-label="Permalink to &quot;_查找脚本_&quot;">​</a></h4><p>一旦安装了油猴扩展，你就可以开始寻找需要的脚本了。有几个著名的网站可以找到用户共享的油猴脚本，如：</p><p>Greasy Fork (<a href="https://greasyfork.org/" target="_blank" rel="noreferrer">https://greasyfork.org/</a>)</p><p>OpenUserJS (<a href="https://openuserjs.org/" target="_blank" rel="noreferrer">https://openuserjs.org/</a>)</p><p>在这些网站上，你可以根据需要搜索或浏览不同的脚本。</p><h3 id="步骤-2-创建新脚本" tabindex="-1">步骤 2: 创建新脚本 <a class="header-anchor" href="#步骤-2-创建新脚本" aria-label="Permalink to &quot;步骤 2: 创建新脚本&quot;">​</a></h3><ol><li>点击浏览器右上角的油猴扩展图标。</li><li>在弹出的菜单中选择“添加新脚本”（或“Create a new script”）。</li><li>这将打开一个新的脚本编辑器标签页，你可以在这里编写或粘贴你的脚本代码。</li></ol><h3 id="步骤-3-编写脚本" tabindex="-1">步骤 3: 编写脚本 <a class="header-anchor" href="#步骤-3-编写脚本" aria-label="Permalink to &quot;步骤 3: 编写脚本&quot;">​</a></h3><p>在脚本编辑器中，粘贴下面的脚本代码：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         Change Google Background Color</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    http://tampermonkey.net/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      0.1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  try to take over the world!</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       You</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        https://www.google.com/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// Your code here...</span></span>
<span class="line"><span style="color:#E5C07B;">	document</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">style</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">backgroundColor</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;lightblue&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">//更改背景色为浅蓝色</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这段脚本的功能是更改 Google 主页的背景颜色为浅蓝色。<code>@match</code> 指令告诉油猴这个脚本应当在哪些页面上运行，在这个例子中，它将在所有 Google 主页的 URL 上运行。</p><h3 id="步骤-4-保存并运行脚本" tabindex="-1">步骤 4: 保存并运行脚本 <a class="header-anchor" href="#步骤-4-保存并运行脚本" aria-label="Permalink to &quot;步骤 4: 保存并运行脚本&quot;">​</a></h3><ol><li>在脚本编辑器的界面上找到保存按钮（通常在界面上方），点击保存你的脚本。</li><li>关闭编辑器标签页。</li><li>转到：<a href="https://www.google.com" target="_blank" rel="noreferrer">https://www.google.com</a>，你会看到背景色已经更改。</li></ol><h3 id="步骤-5-管理脚本" tabindex="-1">步骤 5: 管理脚本 <a class="header-anchor" href="#步骤-5-管理脚本" aria-label="Permalink to &quot;步骤 5: 管理脚本&quot;">​</a></h3><p>你可以随时点击油猴扩展图标，查看和管理你的脚本。在这里，你可以启用或禁用已安装的脚本，编辑它们，或者查看每个脚本的详情。</p><h3 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><ul><li><p>当你访问目标网页时，确保油猴扩展已启用，且你的脚本也处于启用状态。</p></li><li><p>如果脚本没有按预期运行，检查它的<code>@match</code>指令是否正确覆盖了目标页面的 URL。</p></li><li><p>为了防止可能的安全风险，只应从信任的来源安装或运行油猴脚本。</p></li></ul><p>示例二：在访问百度搜索时，自动将页面背景颜色更改为淡绿色，以提供更舒适的阅读体验。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         百度背景颜色更改</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    http://tampermonkey.net/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      1.0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  让你的百度搜索体验更加舒适</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       you</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        *://*baidu.com/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// 更改背景色为淡绿色</span></span>
<span class="line"><span style="color:#E5C07B;">	document</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">style</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">backgroundColor</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;#ccffcc&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这段代码的作用是将匹配<code>*://*baidu.com/*</code>模式的网页（即所有百度的网页）的背景色更改为淡绿色（<code>#ccffcc</code>）。</p><p>点击编辑器界面的保存按钮（通常是一个磁盘图标或者直接写着“保存”）。保存后，关闭脚本编辑器标签页。前往：<a href="https://www.baidu.com" target="_blank" rel="noreferrer">https://www.baidu.com</a> 测试脚本效果。你会看到背景色已经改变。</p><h2 id="手机上用油猴实现自动抢购茅台-1" tabindex="-1">手机上用油猴实现自动抢购茅台 <a class="header-anchor" href="#手机上用油猴实现自动抢购茅台-1" aria-label="Permalink to &quot;手机上用油猴实现自动抢购茅台&quot;">​</a></h2><p>要在移动端使用油猴脚本实现自动化操作（比如抢购茅台）是有一定限制的，因为主流的移动浏览器（如 Chrome 和 Safari）通常不支持油猴脚本。不过，有一个方法可以绕过这一限制，那就是使用支持用户脚本的移动浏览器。对于 Android 用户，可以考虑使用如 <strong>Kiwi Browser</strong> 或 <strong>Yandex Browser</strong>，这些浏览器基于 Chromium，支持 Chrome 扩展，包括油猴（Tampermonkey）。</p><h3 id="步骤-1-在-android-设备上安装支持扩展的浏览器" tabindex="-1">步骤 1: 在 Android 设备上安装支持扩展的浏览器 <a class="header-anchor" href="#步骤-1-在-android-设备上安装支持扩展的浏览器" aria-label="Permalink to &quot;步骤 1: 在 Android 设备上安装支持扩展的浏览器&quot;">​</a></h3><ol><li>下载并安装 Kiwi Browser 或 Yandex Browser:</li></ol><p>- 打开 Google Play Store。</p><p>- 搜索 “Kiwi Browser” 或 “Yandex Browser”。</p><p>- 选择浏览器并安装。</p><h3 id="步骤-2-安装-tampermonkey-扩展" tabindex="-1">步骤 2: 安装 Tampermonkey 扩展 <a class="header-anchor" href="#步骤-2-安装-tampermonkey-扩展" aria-label="Permalink to &quot;步骤 2: 安装 Tampermonkey 扩展&quot;">​</a></h3><ol><li>在安装好的浏览器中，打开扩展页面（通常在菜单中有“扩展”选项）。</li><li>搜索 Tampermonkey 官网或在 Google 上搜索 Tampermonkey 的 Chrome Web Store 页面，下载并安装 Tampermonkey 扩展。</li></ol><h3 id="步骤-3-创建并编辑油猴脚本" tabindex="-1">步骤 3: 创建并编辑油猴脚本 <a class="header-anchor" href="#步骤-3-创建并编辑油猴脚本" aria-label="Permalink to &quot;步骤 3: 创建并编辑油猴脚本&quot;">​</a></h3><ol><li>点击浏览器中 Tampermonkey 图标，选择“添加新脚本”。</li><li>在脚本编辑器中，删除默认模板，粘贴以下示例脚本：</li></ol><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         自动购买茅台移动版</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    http://tampermonkey.net/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      0.1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  自动化在移动端天猫购买茅台酒</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       You</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        *://*/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @run-at       document-end</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// 每次页面加载后检查是否为茅台的购买页面</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">window</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">location</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">href</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;chaoshi.detail.tmall.com&quot;</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#61AFEF;">		setTimeout</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">			// 尝试找到购买按钮并点击</span></span>
<span class="line"><span style="color:#C678DD;">			const</span><span style="color:#E5C07B;"> buyButton</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;button.buy&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 根据实际页面调整选择器</span></span>
<span class="line"><span style="color:#C678DD;">			if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">buyButton</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">				buyButton</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">			} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">				console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;购买按钮未找到&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">			}</span></span>
<span class="line"><span style="color:#ABB2BF;">		}, </span><span style="color:#D19A66;">3000</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 延迟3秒钟执行，等待页面加载完成</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="3"><li>修改脚本中的 <code>@match</code> 以适应实际的 URL，修改选择器以适应实际的按钮。</li></ol><h3 id="步骤-4-测试和调整脚本" tabindex="-1">步骤 4: 测试和调整脚本 <a class="header-anchor" href="#步骤-4-测试和调整脚本" aria-label="Permalink to &quot;步骤 4: 测试和调整脚本&quot;">​</a></h3><p>- 打开目标购买页面，观察脚本是否能正确执行。</p><p>- 根据需要调整延迟时间或按钮选择器。</p><h3 id="注意事项-1" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项-1" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><ul><li><p>自动化购买脚本可能违反天猫或其他平台的服务条款，使用时需谨慎。</p></li><li><p>确保脚本不会无意中触发不需要的购买。</p></li><li><p>该方法可能不适用于 iOS 设备，因为 iOS 的浏览器架构限制了此类扩展。</p></li></ul><p>通过这种方法，您可以在支持扩展的移动浏览器上实现类似 PC 浏览器油猴脚本的功能，从而在移动设备上自动化一些操作。这为移动端网页自动化提供了一种可行的解决方案。</p><h3 id="做些优化" tabindex="-1">做些优化 <a class="header-anchor" href="#做些优化" aria-label="Permalink to &quot;做些优化&quot;">​</a></h3><p>对于在移动端使用油猴脚本进行自动化的场景，以下优化帮助您更安全、更有效地实施自动化策略：</p><h4 id="_1-监测和调试" tabindex="-1">1.监测和调试 <a class="header-anchor" href="#_1-监测和调试" aria-label="Permalink to &quot;1.监测和调试&quot;">​</a></h4><ul><li><p>调试脚本：使用浏览器的开发者工具进行调试，检查是否有 JavaScript 错误或者查看网络请求等。虽然在移动设备上进行调试比较复杂，但使用基于 Chromium 的浏览器如 Kiwi 或 Yandex 可以让这个过程更接近桌面体验。</p></li><li><p>日志记录：在你的脚本中增加适当的日志记录，这可以帮助你理解脚本在实际环境中的行为，尤其是在处理异步事件和响应时。</p></li></ul><h4 id="_2-用户界面友好性" tabindex="-1">2.用户界面友好性 <a class="header-anchor" href="#_2-用户界面友好性" aria-label="Permalink to &quot;2.用户界面友好性&quot;">​</a></h4><ul><li><p>反馈机制：确保脚本在执行操作时有清晰的用户反馈。例如，当点击按钮或完成购买时，可以显示一些提示信息，让用户知道脚本已经执行。</p></li><li><p>错误处理：增强脚本的错误处理能力，确保在遇到意外情况（如元素未找到、网络请求失败等）时，脚本能给出错误提示并优雅地终止或重试。</p></li></ul><h4 id="_3-性能考虑" tabindex="-1">3.性能考虑 <a class="header-anchor" href="#_3-性能考虑" aria-label="Permalink to &quot;3.性能考虑&quot;">​</a></h4><ul><li><p>避免过度轮询：使用<code>setTimeout</code>或<code>setInterval</code>进行元素检查或操作时，设置合理的间隔时间，避免对设备性能造成影响或增加不必要的服务器请求。</p></li><li><p>资源清理：确保脚本在完成任务后能正确清理已占用的资源，如关闭不再需要的定时器，删除不必要的全局变量等。</p></li></ul><h1 id="auto-js-售票平台自动刷新抢票脚本" tabindex="-1">Auto.js：售票平台自动刷新抢票脚本 <a class="header-anchor" href="#auto-js-售票平台自动刷新抢票脚本" aria-label="Permalink to &quot;Auto.js：售票平台自动刷新抢票脚本&quot;">​</a></h1><p><strong>说明</strong>：</p><p>在手机上运行 JavaScript 抢票脚本相对比较复杂，因为大多数手机浏览器不支持直接加载和执行自定义 JavaScript 代码。有几个常用选择可以尝试：</p><h3 id="_1-使用-kiwi-browser-tampermonkey-扩展-android" tabindex="-1">1. 使用 Kiwi Browser + Tampermonkey 扩展（Android） <a class="header-anchor" href="#_1-使用-kiwi-browser-tampermonkey-扩展-android" aria-label="Permalink to &quot;1. 使用 Kiwi Browser + Tampermonkey 扩展（Android）&quot;">​</a></h3><p>Kiwi Browser 是一款基于 Chromium 的 Android 浏览器，它支持 Chrome 扩展。通过在 Kiwi Browser 中安装 Tampermonkey 扩展，你可以运行自定义的 JavaScript 脚本。</p><p>操作步骤如下：</p><ul><li>在 Google Play 商店下载并安装 Kiwi Browser。</li><li>打开 Kiwi Browser，访问 Chrome 网上应用店，搜索并安装 Tampermonkey 扩展。</li><li>安装完毕后，点击 Tampermonkey 扩展图标，选择“添加新脚本”。</li><li>在编辑器中粘贴你的抢票 JavaScript 代码，保存脚本。</li><li>访问目标网站时，Tampermonkey 将自动执行你的脚本。</li></ul><h3 id="_2-使用-via-浏览器的自定义脚本功能-android" tabindex="-1">2. 使用 Via 浏览器的自定义脚本功能（Android） <a class="header-anchor" href="#_2-使用-via-浏览器的自定义脚本功能-android" aria-label="Permalink to &quot;2. 使用 Via 浏览器的自定义脚本功能（Android）&quot;">​</a></h3><p>Via 浏览器是一款轻量级的 Android 浏览器，支持用户自定义 JavaScript 脚本。</p><p>操作步骤如下：</p><ul><li>从 Google Play 商店下载并安装 Via 浏览器。</li><li>打开 Via 浏览器，进入设置 &gt; 通用设置 &gt; 脚本，开启用户脚本功能。</li><li>点击“新建脚本”，在编辑界面粘贴你的抢票脚本，设置好匹配的网址，保存。</li></ul><h3 id="_3-使用油猴脚本管理器-app-ios-和-android" tabindex="-1">3. 使用油猴脚本管理器 App（iOS 和 Android） <a class="header-anchor" href="#_3-使用油猴脚本管理器-app-ios-和-android" aria-label="Permalink to &quot;3. 使用油猴脚本管理器 App（iOS 和 Android）&quot;">​</a></h3><p>对于 iOS 用户，由于系统限制，选项更少。不过，有一些第三方 App 声称支持油猴脚本，如 Alook 浏览器（iOS 和 Android）等。这些浏览器 App 可能内置了脚本管理器，允许用户添加和执行自定义 JavaScript 脚本。</p><ul><li>下载并安装支持的浏览器 App。</li><li>根据 App 提供的指引添加和管理 JavaScript 脚本。</li></ul><p>全代码如下：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#56B6C2;"> //</span><span style="color:#ABB2BF;"> 检查无障碍服务是否已经启用，如果没有启用则跳转到无障碍服务启用界面，并等待无障碍服务启动；当无障碍服务启动后脚本会继续运行。</span></span>
<span class="line"><span style="color:#ABB2BF;"> auto.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">()</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#56B6C2;"> //</span><span style="color:#ABB2BF;">打开某知名售票平台app</span></span>
<span class="line"><span style="color:#ABB2BF;"> app.</span><span style="color:#61AFEF;">launchApp</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;某知名售票平台&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#61AFEF;"> openConsole</span><span style="color:#ABB2BF;">()</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;"> console.</span><span style="color:#61AFEF;">setTitle</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;某知名售票平台 go!&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;#ff11ee00&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">)</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">()</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;">获取输入的场次信息</span></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">getPlayEtc</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#ABB2BF;">    var playEtc = </span><span style="color:#61AFEF;">rawInput</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入场次关键字(按照默认格式)&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;周五&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (playEtc </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> null </span><span style="color:#FFFFFF;">||</span><span style="color:#ABB2BF;"> playEtc.</span><span style="color:#61AFEF;">trim</span><span style="color:#ABB2BF;">()</span><span style="color:#56B6C2;">==</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">        alert</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入场次信息!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#61AFEF;"> getPlayEtc</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;手动输入的场次信息：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">playEtc);</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> playEtc;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;">获取输入票价信息</span></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">getTicketPrice</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#ABB2BF;">    var ticketPrice = </span><span style="color:#61AFEF;">rawInput</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入票价关键字(按照默认格式)&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1180&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (ticketPrice </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> null </span><span style="color:#FFFFFF;">||</span><span style="color:#ABB2BF;"> ticketPrice.</span><span style="color:#61AFEF;">trim</span><span style="color:#ABB2BF;">()</span><span style="color:#56B6C2;">==</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">        alert</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入票价信息!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#61AFEF;"> getTicketPrice</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">     }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;手动输入的票价信息：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">ticketPrice);</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> ticketPrice;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;">获取输入的抢票时间</span></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">getSellTime</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#ABB2BF;">    var sellTime = </span><span style="color:#61AFEF;">rawInput</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入抢票时间(按照默认格式)&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;03-18 11:00&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (sellTime </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> null </span><span style="color:#FFFFFF;">||</span><span style="color:#ABB2BF;"> sellTime.</span><span style="color:#61AFEF;">trim</span><span style="color:#ABB2BF;">()</span><span style="color:#56B6C2;">==</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">        alert</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入抢票时间!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#61AFEF;"> getSellTime</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">     }</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> sellTime;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开始某知名售票平台抢票!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var preBook= </span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已预约&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    var preBook2 = </span><span style="color:#61AFEF;">textContains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已设置&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    var isPreBook = preBook2</span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;">null</span><span style="color:#FFFFFF;">||</span><span style="color:#ABB2BF;">preBook</span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;">null;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var playEtc;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var ticketPrice;</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;界面是否已预约：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">isPreBook);</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">!</span><span style="color:#ABB2BF;">isPreBook){</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;无预约信息，请输入抢票信息!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        playEtc = </span><span style="color:#61AFEF;">getPlayEtc</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        ticketPrice = </span><span style="color:#61AFEF;">getTicketPrice</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    var month;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var day;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var hour;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var minute;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    var inputTime = </span><span style="color:#61AFEF;">getSellTime</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">在这里使用输入的时间进行后续操作</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;输入的抢票时间：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> inputTime);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var times = inputTime.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var time1 = times[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    var time2 = times[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    var monthDay= time1.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    month = monthDay[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    day = monthDay[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">    var hourMinute= time2.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;:&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    hour = hourMinute[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">    minute=  hourMinute[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;"> 设置开抢时间</span></span>
<span class="line"><span style="color:#ABB2BF;">    var year = new </span><span style="color:#61AFEF;">Date</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getFullYear</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    var second = </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var msecond = </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var startTimestamp = new </span><span style="color:#61AFEF;">Date</span><span style="color:#ABB2BF;">(year, month, day, hour, minute, second, msecond).</span><span style="color:#61AFEF;">getTime</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">     //</span><span style="color:#ABB2BF;"> 减去 </span><span style="color:#FFFFFF;">45ms</span><span style="color:#ABB2BF;"> 的网络延迟</span></span>
<span class="line"><span style="color:#ABB2BF;">    startTimestamp = startTimestamp </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 45</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var 某知名售票平台Timestamp;</span></span>
<span class="line"><span style="color:#ABB2BF;">    var startTime = </span><span style="color:#61AFEF;">convertToTime</span><span style="color:#ABB2BF;">(startTimestamp);</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开抢时间：&quot;</span><span style="color:#ABB2BF;">, startTime);</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;等待开抢...&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;"> 循环等待</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#ABB2BF;"> (true) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        某知名售票平台Timestamp = </span><span style="color:#61AFEF;">get某知名售票平台Timestamp</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (某知名售票平台Timestamp </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> startTimestamp) {</span></span>
<span class="line"><span style="color:#C678DD;">            break</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    var realStartTime = </span><span style="color:#61AFEF;">get某知名售票平台Timestamp</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;冲啊！！！&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var goRes = </span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;trade_project_detail_purchase_status_bar_container_fl&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;点击了立即购票相关按钮：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">goRes)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;">(</span><span style="color:#FFFFFF;">!</span><span style="color:#ABB2BF;">isPreBook){</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;进入了，准备选择场次：&#39;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">playEtc);</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#ABB2BF;"> 选择场次</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#61AFEF;">textContains</span><span style="color:#ABB2BF;">(playEtc).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#61AFEF;"> textContains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">playEtc</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#61AFEF;"> textContains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">playEtc</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#ABB2BF;"> console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;选择场次&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#ABB2BF;"> ticketPrice = </span><span style="color:#98C379;">&quot;¥&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">ticketPrice</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#ABB2BF;"> app.</span><span style="color:#61AFEF;">sendBroadcast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;inspect_layout_bounds&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#61AFEF;"> sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#61AFEF;"> back</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">        //</span><span style="color:#61AFEF;"> sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">        textContains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;看台&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">        textContains</span><span style="color:#ABB2BF;">(ticketPrice).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;选择票档&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.TextView&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;确认&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#61AFEF;"> classNameStartsWith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;android.widget.&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;确认&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    textContains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;数量&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">    click</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">878</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">2263</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;点击确认&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#C678DD;"> while</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.TextView&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;确认&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()){</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">     console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;确认按钮还在，继续点击&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">等待立即支付按钮出现</span></span>
<span class="line"><span style="color:#61AFEF;">    className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.Button&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    var c = </span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.Button&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;点击立即支付 &quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">c);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var t = </span><span style="color:#61AFEF;">get某知名售票平台Timestamp</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> realStartTime</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;花费时间：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">t)</span></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;休息2秒,如果立即支付按钮还在再点击一次&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">休息2秒</span></span>
<span class="line"><span style="color:#61AFEF;">    sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.Button&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()){</span></span>
<span class="line"><span style="color:#ABB2BF;">        var c = </span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.Button&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;继续点击立即支付 &quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">c);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">立即支付按钮一直在一直支付</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#C678DD;"> while</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.Button&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()){</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">     var c = </span><span style="color:#61AFEF;">className</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.widget.Button&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#61AFEF;">     sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;">     console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;继续点击立即支付 &quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">c);</span></span>
<span class="line"><span style="color:#56B6C2;">    //</span><span style="color:#ABB2BF;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;结束时间：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#61AFEF;">convertToTime</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">get某知名售票平台Timestamp</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">/**</span></span>
<span class="line"><span style="color:#56B6C2;"> *</span></span>
<span class="line"><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> @</span><span style="color:#ABB2BF;">returns 某知名售票平台服务器时间戳</span></span>
<span class="line"><span style="color:#56B6C2;"> */</span></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">get某知名售票平台Timestamp</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#D19A66;"> JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(http.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://mtop.某知名售票平台.cn/gw/mtop.common.getTimestamp/&quot;</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers: {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Host&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;mtop.某知名售票平台.cn&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Content-Type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/json;charset=utf-8&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Accept&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;*/*&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;floattime/1.1.1 (iPhone; iOS 15.6; Scale/3.00)&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Accept-Language&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;zh-Hans-CN;q=1, en-CN;q=0.9&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Accept-Encoding&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;gzip, deflate, br&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Connection&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;keep-alive&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }).body.</span><span style="color:#61AFEF;">string</span><span style="color:#ABB2BF;">()).data.t;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">/**</span></span>
<span class="line"><span style="color:#56B6C2;"> *</span></span>
<span class="line"><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> @</span><span style="color:#ABB2BF;">param {时间戳} timestamp</span></span>
<span class="line"><span style="color:#56B6C2;"> *</span><span style="color:#56B6C2;"> @</span><span style="color:#ABB2BF;">returns </span><span style="color:#D19A66;">ISO</span><span style="color:#D19A66;"> 8601</span><span style="color:#ABB2BF;"> 格式的北京时间</span></span>
<span class="line"><span style="color:#56B6C2;"> */</span></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">convertToTime</span><span style="color:#ABB2BF;">(timestamp) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    var date = new </span><span style="color:#61AFEF;">Date</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Number</span><span style="color:#ABB2BF;">(timestamp));</span></span>
<span class="line"><span style="color:#ABB2BF;">    var year = date.</span><span style="color:#61AFEF;">getUTCFullYear</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    var month = (date.</span><span style="color:#61AFEF;">getUTCMonth</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">padStart</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var day = date.</span><span style="color:#61AFEF;">getUTCDate</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">padStart</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var hours = (date.</span><span style="color:#61AFEF;">getUTCHours</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 8</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">padStart</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var minutes = date.</span><span style="color:#61AFEF;">getUTCMinutes</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">padStart</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var seconds = date.</span><span style="color:#61AFEF;">getUTCSeconds</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">padStart</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var milliseconds = date.</span><span style="color:#61AFEF;">getUTCMilliseconds</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">padStart</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    var iso8601 = </span><span style="color:#FFFFFF;">\`\${year}</span><span style="color:#56B6C2;">-</span><span style="color:#FFFFFF;">\${month}</span><span style="color:#56B6C2;">-</span><span style="color:#FFFFFF;">\${day} \${hours}:\${minutes}:\${seconds}</span><span style="color:#ABB2BF;">.</span><span style="color:#FFFFFF;">\${milliseconds}\`</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> iso8601;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;"> //</span><span style="color:#ABB2BF;">点击控件所在坐标</span></span>
<span class="line"><span style="color:#ABB2BF;">function </span><span style="color:#61AFEF;">btn_position_click</span><span style="color:#ABB2BF;">(x) {</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (x) {</span></span>
<span class="line"><span style="color:#ABB2BF;">       var b = x.</span><span style="color:#61AFEF;">bounds</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#56B6C2;">       print</span><span style="color:#ABB2BF;">(b.</span><span style="color:#61AFEF;">centerX</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#56B6C2;">       print</span><span style="color:#ABB2BF;">(b.</span><span style="color:#61AFEF;">centerY</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">       var c = </span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">(b.</span><span style="color:#61AFEF;">centerX</span><span style="color:#ABB2BF;">(), b.</span><span style="color:#61AFEF;">centerY</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">       console.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;点击是否成功：&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">c);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br></div></div><p><strong>代码说明</strong>：</p><p>这段代码是为了在 Android 设备上自动化执行抢购某知名售票平台网（某知名售票平台.cn）上的票务流程。它利用了 Auto.js 这样的脚本引擎来模拟用户操作。以下是代码的详细解析：</p><ol><li><p>初始化和打开某知名售票平台 App：</p></li><li><ul><li><code>auto.waitFor();</code> 等待用户开启无障碍服务。如果未开启，则引导用户去设置开启。</li><li><code>app.launchApp(&quot;某知名售票平台&quot;);</code> 启动某知名售票平台 App。</li><li><code>openConsole();</code> 开启控制台，用于输出日志。</li><li><code>console.setTitle(&quot;某知名售票平台 go!&quot;,&quot;#ff11ee00&quot;,30);</code> 设置控制台的标题、颜色和字体大小。</li></ul></li><li><p>输入信息获取：</p></li><li><ul><li><code>getPlayEtc()</code>、<code>getTicketPrice()</code> 和 <code>getSellTime()</code> 分别用于从用户处获取演出场次、票价和抢票时间的信息。这些信息通过弹窗输入获取，如果用户未输入则会提示并重新请求输入。</li></ul></li><li><p>主流程(<code>main</code>)函数：</p></li><li><ul><li>判断是否已预约。如果未预约，提示用户输入抢票所需的信息。</li><li>根据用户输入的抢票时间，设置具体的年、月、日、小时和分钟，计算出抢票的具体时间戳。</li><li>循环检查当前时间，当达到预定的抢票时间时，执行点击操作尝试抢票。</li><li>在抢票时间到达后，模拟点击立即购票按钮，然后根据用户输入的场次信息和票价信息选择相应的场次和票档。</li><li>尝试点击确认按钮并等待立即支付按钮出现，点击以完成购票。</li></ul></li><li><p>辅助函数：</p></li><li><ul><li><code>get某知名售票平台Timestamp()</code> 用于获取某知名售票平台服务器的当前时间戳，以确保与服务器时间同步。</li><li><code>convertToTime(timestamp)</code> 将时间戳转换为易读的时间格式。</li><li><code>btn_position_click(x)</code> 模拟点击屏幕上指定控件的位置。</li></ul></li></ol><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h1 id="小象超市抢菜脚本" tabindex="-1">小象超市抢菜脚本 <a class="header-anchor" href="#小象超市抢菜脚本" aria-label="Permalink to &quot;小象超市抢菜脚本&quot;">​</a></h1><h3 id="全代码如下" tabindex="-1">全代码如下 <a class="header-anchor" href="#全代码如下" aria-label="Permalink to &quot;全代码如下&quot;">​</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 解锁手机屏幕</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> unLock</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">device</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isScreenOn</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#E5C07B;">		device</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wakeUp</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">500</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		swipe</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">500</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">500</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">500</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> password</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;123456&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">//这里换成自己的手机解锁密码</span></span>
<span class="line"><span style="color:#C678DD;">		for</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> i</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">; </span><span style="color:#E06C75;">i</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#E5C07B;"> password</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">; </span><span style="color:#E06C75;">i</span><span style="color:#56B6C2;">++</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">			let</span><span style="color:#E06C75;"> position</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> text</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">i</span><span style="color:#ABB2BF;">]).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">bounds</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">			click</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">position</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">centerX</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">position</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">centerY</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#61AFEF;">			sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#61AFEF;">	sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//抢菜流程</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> robVeg</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#61AFEF;">	unLock</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">	launchApp</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;小象超市&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">	waitForPackage</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;com.meituan.retail.v.android&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">	auto</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">	const</span><span style="color:#E5C07B;"> btn_skip</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;btn_skip&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">btn_skip</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">		btn_skip</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已跳过首屏广告&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#61AFEF;">	sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">	gotoBuyCar</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">	sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">	checkAll</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">	sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">	submitOrder</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">robVeg</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//打开购物车页面</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> gotoBuyCar</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;img_shopping_cart&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#61AFEF;">		id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;img_shopping_cart&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已进入购物车&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;没找到购物车&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">		exit</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//勾选全部商品</span></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> checkAll</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">	const</span><span style="color:#E5C07B;"> isCheckedAll</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> textStartsWith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;结算(&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">	const</span><span style="color:#E5C07B;"> checkAllBtn</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;全选&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!!</span><span style="color:#E06C75;">checkAllBtn</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#56B6C2;">		!</span><span style="color:#E06C75;">isCheckedAll</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#E5C07B;"> checkAllBtn</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;没找到全选按钮&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">		exit</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> submitOrder</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">count</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">textStartsWith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;结算(&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#61AFEF;">		textStartsWith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;结算(&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;我知道了&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;关闭我知道了&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;我知道了&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;重新加载&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;重新加载&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;重新加载&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;立即支付&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#61AFEF;">		text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;立即支付&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">findOne</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">parent</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;确认支付&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> music</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">			&quot;/storage/emulated/0/netease/cloudmusic/Music/Joel Hanson Sara Groves - Traveling Light.mp3&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;">		media</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">playMusic</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">music</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMusicDuration</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">	} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢个屁！&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">		exit</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#61AFEF;">	sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">800</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">count</span><span style="color:#56B6C2;"> &gt;</span><span style="color:#D19A66;"> 10000</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">		toast</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;没抢到&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">		exit</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">	submitOrder</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">count</span><span style="color:#56B6C2;">++</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h3 id="说明" tabindex="-1">说明 <a class="header-anchor" href="#说明" aria-label="Permalink to &quot;说明&quot;">​</a></h3><p>这段代码是为 Android 设备上的自动化脚本编写的，使用了 Auto.js 这样的工具。Auto.js 是一个可以在 Android 设备上运行 JavaScript 以实现自动化操作的应用。以下是使用 Auto.js 运行这段代码的详细步骤：</p><p><strong>1. 安装 Auto.js</strong></p><p>- 下载安装：您可以从应用市场下载 Auto.js 的 APK 文件并安装到您的 Android 设备上。请确保从可信的来源下载以避免潜在的安全风险。</p><p>- 应用权限：安装并首次运行 Auto.js 后，需要授予应用各种权限，包括无障碍服务权限、悬浮窗权限等，这些权限对于实现自动化操作是必须的。</p><p><strong>2. 编写或导入脚本</strong></p><p>- 创建脚本：打开 Auto.js 应用，可以在应用内直接编写 JavaScript 脚本。</p><p>- 导入脚本：将您的脚本代码（如上述代码）保存为一个 <code>.js</code> 文件，通过 Auto.js 的“打开”功能导入这个脚本文件。</p><p><strong>3. 运行脚本</strong></p><p>- 调试运行：在 Auto.js 中打开脚本后，点击运行按钮开始执行脚本。您可以观察脚本的运行效果，并通过日志输出进行调试。</p><p>- 自动运行：Auto.js 支持设置脚本的定时执行，可以通过应用内的计划任务功能设置脚本的自动运行时间。</p><p><strong>4. 监控和维护</strong></p><p>- 日志和错误处理：Auto.js 提供了日志记录功能，您可以通过查看日志来分析脚本在执行过程中的行为和可能出现的错误。</p><p>- 脚本更新：由于应用的更新可能导致自动化脚本的界面元素发生变化，需要定期检查和更新脚本以确保其正常运行。</p><p><strong>5. 注意事项</strong></p><p>- 电源管理：为了确保脚本可以在屏幕关闭后继续运行，需要在设备的电源管理设置中将 Auto.js 设置为不受电池优化影响。</p><p>- 安全与合规：自动化操作可能违反应用的使用条款，使用此类工具时需谨慎，并确保您的行为符合应用的政策和法律法规。</p><h1 id="自动预约挂号脚本" tabindex="-1">自动预约挂号脚本 <a class="header-anchor" href="#自动预约挂号脚本" aria-label="Permalink to &quot;自动预约挂号脚本&quot;">​</a></h1><p>这是一个用 Python 编写的预约和监控程序</p><h3 id="main-py-全代码如下" tabindex="-1">main.py 全代码如下 <a class="header-anchor" href="#main-py-全代码如下" aria-label="Permalink to &quot;main.py 全代码如下&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> schema </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> AddRegArgs, DeptSchForDocArgs, DocSchArgs, NumberSourceArgs</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> api </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Api</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> appointment</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    预约程序入口 用来测试是否能够正常预约</span></span>
<span class="line"><span style="color:#98C379;">    :return:</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    api </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Api</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    hospitals </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_hospital</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择院区，输入院区前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, hospital </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(hospitals):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, hospital[</span><span style="color:#98C379;">&quot;aliasName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    hospital_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入院区序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    hospital </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> hospitals[hospital_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptlist </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_deptlist</span><span style="color:#ABB2BF;">(hospital[</span><span style="color:#98C379;">&quot;hosId&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择科室类别，输入科室类别前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, deptclass </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(deptlist):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, deptclass[</span><span style="color:#98C379;">&quot;deptName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptclass_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入科室类别序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptclass </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> deptlist[deptclass_index]</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择科室，输入科室前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, dept </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(deptclass[</span><span style="color:#98C379;">&quot;deptList&quot;</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, dept[</span><span style="color:#98C379;">&quot;deptName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    dept_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入科室序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    dept </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> deptclass[</span><span style="color:#98C379;">&quot;deptList&quot;</span><span style="color:#ABB2BF;">][dept_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital}</span></span>
<span class="line"><span style="color:#ABB2BF;">    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> DeptSchForDocArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_dept_sch_for_doc</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择医生，输入医生前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, doc </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(doc_list):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, doc[</span><span style="color:#98C379;">&quot;docName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入医生序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> doc_list[doc_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">doc, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital}</span></span>
<span class="line"><span style="color:#ABB2BF;">    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> DocSchArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_doc_sch</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 筛选出可预约的时间</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">        x</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> x </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> doc_schDate</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> sum</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            [</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(y[</span><span style="color:#98C379;">&quot;numRemain&quot;</span><span style="color:#ABB2BF;">]) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> y[</span><span style="color:#98C379;">&quot;schState&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;0&quot;</span><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> y </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> x[</span><span style="color:#98C379;">&quot;schDateList&quot;</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"><span style="color:#ABB2BF;">        )</span></span>
<span class="line"><span style="color:#56B6C2;">        &gt;</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(doc_schDate) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;没有可预约的时间&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择日期，输入日期前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, schDate </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(doc_schDate):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, schDate[</span><span style="color:#98C379;">&quot;schDate&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    schDate_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入日期序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> doc_schDate[schDate_index]</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择时段,输入时段前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, sch </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(schDate[</span><span style="color:#98C379;">&quot;schDateList&quot;</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, sch[</span><span style="color:#98C379;">&quot;ampmName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    sch_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入时段序号:&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    sch </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> schDate[</span><span style="color:#98C379;">&quot;schDateList&quot;</span><span style="color:#ABB2BF;">][sch_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">sch, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">doc, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital}</span></span>
<span class="line"><span style="color:#ABB2BF;">    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> NumberSourceArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">    appointment_time_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_number_source</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择预约时间，输入预约时间前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, timeDesc </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(appointment_time_list):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, timeDesc[</span><span style="color:#98C379;">&quot;timeDesc&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    time_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入预约时间序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    appointment_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> appointment_time_list[time_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    pat_card_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_pat_card_list</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择就诊卡，输入就诊卡前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, pat_card </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(pat_card_list):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, pat_card[</span><span style="color:#98C379;">&quot;name&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    pat_card_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入就诊卡序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    pat_card </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pat_card_list[pat_card_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">sch, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">doc, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">appointment_time, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">pat_card}</span></span>
<span class="line"><span style="color:#ABB2BF;">    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> AddRegArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">add_reg</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(response)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> monitor</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    监控程序入口 用来实际的抢挂号，每10S检测一次指定日期的指定医生的挂号情况</span></span>
<span class="line"><span style="color:#98C379;">    :return:</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    api </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Api</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    hospitals </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_hospital</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择院区，输入院区前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, hospital </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(hospitals):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, hospital[</span><span style="color:#98C379;">&quot;aliasName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    hospital_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入院区序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    hospital </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> hospitals[hospital_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptlist </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_deptlist</span><span style="color:#ABB2BF;">(hospital[</span><span style="color:#98C379;">&quot;hosId&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择科室类别，输入科室类别前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, deptclass </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(deptlist):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, deptclass[</span><span style="color:#98C379;">&quot;deptName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptclass_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入科室类别序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptclass </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> deptlist[deptclass_index]</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择科室，输入科室前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, dept </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(deptclass[</span><span style="color:#98C379;">&quot;deptList&quot;</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, dept[</span><span style="color:#98C379;">&quot;deptName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    dept_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入科室序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    dept </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> deptclass[</span><span style="color:#98C379;">&quot;deptList&quot;</span><span style="color:#ABB2BF;">][dept_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital}</span></span>
<span class="line"><span style="color:#ABB2BF;">    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> DeptSchForDocArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_dept_sch_for_doc</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择医生，输入医生前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, doc </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(doc_list):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, doc[</span><span style="color:#98C379;">&quot;docName&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入医生序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> doc_list[doc_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">doc, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital}</span></span>
<span class="line"><span style="color:#ABB2BF;">    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> DocSchArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc_schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_doc_sch</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请选择日期，输入日期前方序号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, schDate </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(doc_schDate):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">):</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(index, schDate[</span><span style="color:#98C379;">&quot;schDate&quot;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    schDate_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入日期序号：&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> doc_schDate[schDate_index]</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            doc_schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_doc_sch</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 筛选出可预约的时间</span></span>
<span class="line"><span style="color:#ABB2BF;">            doc_schDate </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">                x</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> x </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> doc_schDate</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#56B6C2;"> sum</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    [</span></span>
<span class="line"><span style="color:#56B6C2;">                        int</span><span style="color:#ABB2BF;">(y[</span><span style="color:#98C379;">&quot;numRemain&quot;</span><span style="color:#ABB2BF;">]) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">                        and</span><span style="color:#ABB2BF;"> y[</span><span style="color:#98C379;">&quot;schState&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#C678DD;">                        and</span><span style="color:#ABB2BF;"> y[</span><span style="color:#98C379;">&quot;schDate&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> schDate</span></span>
<span class="line"><span style="color:#C678DD;">                        for</span><span style="color:#ABB2BF;"> y </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> x[</span><span style="color:#98C379;">&quot;schDateList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ]</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#56B6C2;">                &gt;</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">            ]</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(doc_schDate) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;没有可预约的时间,等待10S后再次检测&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> sch_index, sch </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(schDate[</span><span style="color:#98C379;">&quot;schDateList&quot;</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#ABB2BF;">                all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">sch, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">doc, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">dept, </span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">hospital}</span></span>
<span class="line"><span style="color:#ABB2BF;">                args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> NumberSourceArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">                appointment_time_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_number_source</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> appointment_time_index, appointment_time </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    appointment_time_list</span></span>
<span class="line"><span style="color:#ABB2BF;">                ):</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;目标医师当前存在可预约时间，程序将尝试自动预约。如未收到预约成功消息，请前往预约界面手动预约。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    pat_card_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">get_pat_card_list</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    pat_card </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pat_card_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    all_args </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#56B6C2;">                        **</span><span style="color:#ABB2BF;">sch,</span></span>
<span class="line"><span style="color:#56B6C2;">                        **</span><span style="color:#ABB2BF;">doc,</span></span>
<span class="line"><span style="color:#56B6C2;">                        **</span><span style="color:#ABB2BF;">dept,</span></span>
<span class="line"><span style="color:#56B6C2;">                        **</span><span style="color:#ABB2BF;">hospital,</span></span>
<span class="line"><span style="color:#56B6C2;">                        **</span><span style="color:#ABB2BF;">appointment_time,</span></span>
<span class="line"><span style="color:#56B6C2;">                        **</span><span style="color:#ABB2BF;">pat_card,</span></span>
<span class="line"><span style="color:#ABB2BF;">                    }</span></span>
<span class="line"><span style="color:#ABB2BF;">                    args </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> AddRegArgs</span><span style="color:#ABB2BF;">(**all_args)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">add_reg</span><span style="color:#ABB2BF;">(args)</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> response[</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;0&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;预约成功！请在10分钟内前往订单页面付款并停止程序运行！若未及时停止程序运行，程序将在10分钟后自动重新预约！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">600</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;预约失败！请前往预约界面手动预约！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">600</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;等待10S后重新预约&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> KeyboardInterrupt:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;程序已停止&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            break</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;程序异常，程序将在10S后重新预约&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            continue</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">    monitor</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br></div></div><p><strong>说明</strong></p><p>这段代码是一个用 Python 编写的预约和监控程序，主要用于通过 API 进行医院挂号预约。以下是代码的逐行翻译和解释：</p><p><strong>代码功能简介</strong></p><p>这个脚本定义了两个主要的功能：</p><ol><li>appointment()：允许用户通过命令行界面选择医院、科室、医生和时间，进行手动预约。</li><li>monitor()：持续监控特定医生的可预约情况，并尝试自动预约。</li></ol><p><strong>appointment()函数</strong></p><p>- 初始化 API 连接。</p><p>- 从 API 获取医院列表，并让用户选择一个医院。</p><p>- 根据所选医院获取科室列表，并让用户选择一个科室类别。</p><p>- 在选定的科室类别中选择具体的科室。</p><p>- 获取医生的时间表，并让用户选择一个医生。</p><p>- 显示医生可预约的日期，并让用户选择。</p><p>- 显示所选日期的具体时间段，并让用户选择。</p><p>- 获取可用的预约时间，让用户选择具体的时间点。</p><p>- 获取用户的就诊卡信息，并让用户选择一张就诊卡。</p><p>- 提交预约请求，并显示响应结果。</p><p><strong>monitor()函数</strong></p><p>- 类似于<code>appointment()</code>，但主要用于自动监控和预约。</p><p>- 在用户选择医生和日期后，程序每 10 秒检查一次可预约时间。</p><p>- 如果发现有可预约的时间，程序会尝试预约，并在成功后等待 10 分钟（防止重复预约），然后继续监控。</p><p><strong>主程序入口</strong></p><p>- 当脚本作为主程序运行时，它会启动<code>monitor()</code>函数，开始监控预约情况。</p><p><strong>使用示例</strong></p><p>这个脚本通过命令行交互，用户需要根据提示输入选择的序号来选择医院、科室、医生和时间。这适合需要频繁检查和预约医院挂号的场景，如抢购热门医生的挂号名额。</p><p><strong>实现细节</strong></p><p>- 脚本依赖于外部定义的<code>Api</code>类及其方法（如<code>get_hospital()</code>, <code>get_deptlist()</code>, <code>get_dept_sch_for_doc()</code>, <code>get_doc_sch()</code>, <code>get_number_source()</code>, <code>add_reg()</code>, <code>get_pat_card_list()</code>），这些方法需要与后端 API 正确交互。</p><p>- 使用了 Python 的字典展开语法<code>**</code>来传递参数。</p><p>- 使用了异常处理来管理运行时错误，并允许用户通过<code>Ctrl+C</code>中断程序。</p><p><strong>如何启动运行</strong>：</p><p>将所有文件放在同一目录下， 启动运行<strong>main.py</strong>即可。</p><h3 id="schema-py-文件内容如下" tabindex="-1">schema.py 文件内容如下 <a class="header-anchor" href="#schema-py-文件内容如下" aria-label="Permalink to &quot;schema.py 文件内容如下&quot;">​</a></h3><div class="language-py line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> pydantic </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> BaseModel</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> typing </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Union</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> HospitalArgs</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BaseModel</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    sysCode: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> DeptListArgs</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BaseModel</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    clinicalType: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosId: </span><span style="color:#56B6C2;">int</span></span>
<span class="line"><span style="color:#ABB2BF;">    sysCode: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> DeptSchForDocArgs</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BaseModel</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    clinicalType: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptCode: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptId: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> deptCode</span></span>
<span class="line"><span style="color:#ABB2BF;">    specialtyId: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    visitingArea: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosId: </span><span style="color:#56B6C2;">int</span></span>
<span class="line"><span style="color:#ABB2BF;">    recommendation: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#56B6C2;">    type</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;order&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    source: </span><span style="color:#56B6C2;">int</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 22</span></span>
<span class="line"><span style="color:#ABB2BF;">    sysCode: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> update</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.deptId </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.deptCode</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> DocSchArgs</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BaseModel</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docTitle: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docPhoto: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosId: </span><span style="color:#56B6C2;">int</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#56B6C2;">    type</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;order&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    visitingArea: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    clinicalType: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">    source: </span><span style="color:#56B6C2;">int</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 22</span></span>
<span class="line"><span style="color:#ABB2BF;">    sysCode: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> NumberSourceArgs</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BaseModel</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    sysCode: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    ampm: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    categor: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosId: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    schDate: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    schId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> AddRegArgs</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BaseModel</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # key不一致参数</span></span>
<span class="line"><span style="color:#ABB2BF;">    disNo: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">    schDate: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">    patienId: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 必须参数</span></span>
<span class="line"><span style="color:#ABB2BF;">    clinicalType: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">    visitingArea: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    ampm: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    appointmentNumber: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> disNo</span></span>
<span class="line"><span style="color:#ABB2BF;">    categor: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    categorName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    deptName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    docName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    endTime: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    extend: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    fee: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosId: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    hosName: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    isFlexible: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    numId: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    patientId: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> patienId</span></span>
<span class="line"><span style="color:#ABB2BF;">    resDate: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> schDate</span></span>
<span class="line"><span style="color:#ABB2BF;">    schId: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    source: </span><span style="color:#56B6C2;">int</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 22</span></span>
<span class="line"><span style="color:#ABB2BF;">    startTime: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    sysCode: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    thirdUserId: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    timeDesc: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"><span style="color:#ABB2BF;">    timePoint: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    schQukCategor: </span><span style="color:#56B6C2;">str</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> update</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.appointmentNumber </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.disNo</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.resDate </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.schDate</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.patientId </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.patienId</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><p><strong>说明</strong></p><p>这段代码是一个 Python 模块，使用了<code>pydantic</code>库来定义几个数据模型（schemas），这些模型用于校验和管理数据的结构，主要用于医院预约系统的 API 调用。下面是对每个类的功能和属性的简要说明：</p><p><strong>1. <code>HospitalArgs</code> 类</strong></p><p>- 功能：定义获取医院数据时可能需要的参数。</p><p>- 属性：</p><p>- <code>sysCode</code>：系统代码，可能是一个字符串或整数，预设为&quot;1001035&quot;。</p><p><strong>2. <code>DeptListArgs</code> 类</strong></p><p>- 功能：定义获取科室列表数据时需要的参数。</p><p>- 属性：</p><p>- <code>clinicalType</code>：临床类型，预设为 1。</p><p>- <code>hosId</code>：医院 ID，为整数。</p><p>- <code>sysCode</code>：系统代码，同<code>HospitalArgs</code>。</p><p><strong>3. <code>DeptSchForDocArgs</code> 类</strong></p><p>- 功能：定义获取特定科室下医生的排班信息时需要的参数。</p><p>- 属性：</p><p>- <code>clinicalType</code>：临床类型，预设为 1。</p><p>- <code>deptCode</code>：科室代码。</p><p>- <code>deptId</code>：科室 ID，初始与<code>deptCode</code>相同。</p><p>- <code>specialtyId</code>：专业 ID。</p><p>- <code>deptName</code>：科室名称。</p><p>- <code>visitingArea</code>：访问区域。</p><p>- <code>hosId</code>：医院 ID。</p><p>- <code>recommendation</code>：推荐字段，预设为空字符串。</p><p>- <code>type</code>：类型，预设为&quot;order&quot;。</p><p>- <code>source</code>：来源，预设为 22。</p><p>- <code>sysCode</code>：系统代码。</p><p>- <code>update()</code>：方法用于更新<code>deptId</code>。</p><p><strong>4. <code>DocSchArgs</code> 类</strong></p><p>- 功能：定义获取特定医生的详细排班信息时需要的参数。</p><p>- 属性：</p><p>- 包含医生 ID、姓名、职称、照片、所属医院 ID 和名称等。</p><p>- 其他与<code>DeptSchForDocArgs</code>类似的字段如<code>clinicalType</code>, <code>type</code>, <code>source</code>等。</p><p><strong>5. <code>NumberSourceArgs</code> 类</strong></p><p>- 功能：定义获取某一具体时间段可预约号源信息时需要的参数。</p><p>- 属性：</p><p>- <code>sysCode</code>：系统代码。</p><p>- 其他相关预约详情如时间段（<code>ampm</code>）、分类（<code>categor</code>）、医生 ID、科室 ID、医院 ID 等。</p><p><strong>6. <code>AddRegArgs</code> 类</strong></p><p>- 功能：定义添加预约信息时需要的参数。</p><p>- 属性：</p><p>- 包含预约具体的编号、分类、时间描述、患者 ID 等。</p><p>- 其他预约细节如费用、是否灵活排班、开始时间和结束时间等。</p><p>- <code>update()</code>：方法用于更新与预约编号、日期和患者 ID 相关的属性。</p><p><strong>7.如何启动运行</strong>：</p><p>将所有文件放在同一目录下， 启动运行<strong>main.py</strong>即可。</p><h3 id="api-py-文件内容如下" tabindex="-1">api.py 文件内容如下 <a class="header-anchor" href="#api-py-文件内容如下" aria-label="Permalink to &quot;api.py 文件内容如下&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> hashlib </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> md5</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Crypto.Cipher </span><span style="color:#C678DD;">import</span><span style="color:#D19A66;"> DES</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Crypto.Util.Padding </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pad</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> base64</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> typing </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Union</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> ddddocr </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> DdddOcr</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> configparser </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ConfigParser</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> schema </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> AddRegArgs, DeptSchForDocArgs, DocSchArgs, NumberSourceArgs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">ocr </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> DdddOcr</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">config </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> ConfigParser</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">config.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;conf.ini&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 异常处理装饰器</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> exception_handler</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">func</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> wrapper</span><span style="color:#ABB2BF;">(*</span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> _ </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#61AFEF;"> func</span><span style="color:#ABB2BF;">(*args, **kwargs)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;函数</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">func.</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">出现异常,异常关键词为：&quot;</span><span style="color:#ABB2BF;">, e, </span><span style="color:#98C379;">&quot;程序将在5S后重试&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;程序异常，重试运行后仍无法成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> wrapper</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> Api</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        初始化</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;初始化&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 读取配置</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.sys_code </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;sysCode&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.desKey </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;desKey&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.phsId </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;phsId&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.host </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;host&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.token </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;token&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fallback</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        username </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fallback</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        password </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fallback</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        assert</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">            username </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> password </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        ), </span><span style="color:#98C379;">&quot;初始化，用户名/账号密码必传入其一&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.token:</span></span>
<span class="line"><span style="color:#ABB2BF;">            access_token </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(username, password)</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.token </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_he_ren_token</span><span style="color:#ABB2BF;">(access_token)</span></span>
<span class="line"><span style="color:#ABB2BF;">            config.</span><span style="color:#61AFEF;">set</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;江苏省中医院&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;token&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token)</span></span>
<span class="line"><span style="color:#C678DD;">            with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;conf.ini&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;w&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">                config.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(f)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;获取token成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> encrypt</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;font-style:italic;">        self</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">        key</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">        plaintext</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    ) -&gt; </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        Encrypts a plaintext string using DES</span></span>
<span class="line"><span style="color:#98C379;">        :param key:</span></span>
<span class="line"><span style="color:#98C379;">        :param plaintext:</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> key </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            key </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.desKey</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> plaintext </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            plaintext </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;1001035_&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        key </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> key.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        plaintext </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> plaintext.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        plaintext </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> pad</span><span style="color:#ABB2BF;">(plaintext, </span><span style="color:#D19A66;">DES</span><span style="color:#ABB2BF;">.block_size)</span></span>
<span class="line"><span style="color:#ABB2BF;">        cipher </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> DES</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(key, </span><span style="color:#D19A66;">DES</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">MODE_ECB</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        ciphertext </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cipher.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(plaintext)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> base64.</span><span style="color:#61AFEF;">encodebytes</span><span style="color:#ABB2BF;">(ciphertext).</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_hospital</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">          获取医区信息</span></span>
<span class="line"><span style="color:#98C379;">        :return:院区信息</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-base/getHospital&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&quot;args&quot;</span><span style="color:#ABB2BF;">: {</span><span style="color:#98C379;">&quot;sysCode&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sys_code}, </span><span style="color:#98C379;">&quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token})</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_deptlist</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">hos_id</span><span style="color:#ABB2BF;">: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">]) -&gt; </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取科室列表</span></span>
<span class="line"><span style="color:#98C379;">        :param hos_id:医院id</span></span>
<span class="line"><span style="color:#98C379;">        :return: 科室列表</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-reg/reg/getDeptList&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;args&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;clinicalType&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;hosId&quot;</span><span style="color:#ABB2BF;">: hos_id,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;sysCode&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sys_code,</span></span>
<span class="line"><span style="color:#ABB2BF;">                },</span></span>
<span class="line"><span style="color:#98C379;">                &quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        )</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;dataList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_dept_sch_for_doc</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">: DeptSchForDocArgs) -&gt; </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取医生信息</span></span>
<span class="line"><span style="color:#98C379;">        :param args: 请求参数</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        args.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;args&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#56B6C2;">                **</span><span style="color:#ABB2BF;">args.</span><span style="color:#61AFEF;">dict</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">            },</span></span>
<span class="line"><span style="color:#98C379;">            &quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(payload)</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-reg/reg/getDeptSchForDoc&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;schDocResultList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_doc_sch</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">arg</span><span style="color:#ABB2BF;">: DocSchArgs):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取医生排班信息</span></span>
<span class="line"><span style="color:#98C379;">        :param arg: 请求参数</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-reg/reg/getDocSch&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;args&quot;</span><span style="color:#ABB2BF;">: {</span><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">arg.</span><span style="color:#61AFEF;">dict</span><span style="color:#ABB2BF;">()}, </span><span style="color:#98C379;">&quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token}</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(payload)</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;dataList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_pat_card_list</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#56B6C2;">list</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取就诊卡，即挂号人信息</span></span>
<span class="line"><span style="color:#98C379;">        :param args:请求参数</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;args&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;sysCode&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.sys_code,</span></span>
<span class="line"><span style="color:#ABB2BF;">            },</span></span>
<span class="line"><span style="color:#98C379;">            &quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(payload)</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-base/relevantPatient/getPatCardList&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> add_reg</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">: AddRegArgs) -&gt; </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        提交订单</span></span>
<span class="line"><span style="color:#98C379;">        :param args: 请求参数</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        args.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;args&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#56B6C2;">                    **</span><span style="color:#ABB2BF;">args.</span><span style="color:#61AFEF;">dict</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">                },</span></span>
<span class="line"><span style="color:#98C379;">                &quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        )</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-reg/reg/addReg&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(response.text)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_verification_code</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">) -&gt; [</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取验证码</span></span>
<span class="line"><span style="color:#98C379;">        :return: srt:verifyCode,uniqueId</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;http://wechat.jshtcm.com/cas-wechat/*.jsonRequest&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [{}]</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(payload)</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;X-Service-Id&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;cas-wechat.smsService&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;X-Service-Method&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;getVerifyCodeInfo&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> response.status_code </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;获取验证码失败&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        body </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;body&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">        verifyCode </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> body[</span><span style="color:#98C379;">&quot;verifyCode&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        uniqueId </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> body[</span><span style="color:#98C379;">&quot;uniqueId&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        verifyCode </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> base64.</span><span style="color:#61AFEF;">b64decode</span><span style="color:#ABB2BF;">(verifyCode)</span></span>
<span class="line"><span style="color:#ABB2BF;">        verifyCode </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ocr.</span><span style="color:#61AFEF;">classification</span><span style="color:#ABB2BF;">(verifyCode)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> verifyCode, uniqueId</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">username</span><span style="color:#ABB2BF;">: Union[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">], </span><span style="color:#D19A66;font-style:italic;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        登录</span></span>
<span class="line"><span style="color:#98C379;">        :param username: 用户名/手机号</span></span>
<span class="line"><span style="color:#98C379;">        :param password: 密码</span></span>
<span class="line"><span style="color:#98C379;">        :return:accessToken</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> type</span><span style="color:#ABB2BF;">(username) </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            username </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(username)</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;http://wechat.jshtcm.com/cas-wechat/logon/login&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        verifyCode, uniqueId </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_verification_code</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;tenantId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;hcn.jsszyy&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;pwd&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#61AFEF;">md5</span><span style="color:#ABB2BF;">(password.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">()).</span><span style="color:#61AFEF;">hexdigest</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">                &quot;forAccessToken&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;rid&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;patient&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;verifyCode&quot;</span><span style="color:#ABB2BF;">: verifyCode,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;uniqueId&quot;</span><span style="color:#ABB2BF;">: uniqueId,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;loginName&quot;</span><span style="color:#ABB2BF;">: username,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        )</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> Exception(</span></span>
<span class="line"><span style="color:#ABB2BF;">                response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#98C379;"> &quot;登录失败&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;properties&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;accessToken&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_he_ren_token</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">x_access_token</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取患者端token</span></span>
<span class="line"><span style="color:#98C379;">        :param x_access_token:登陆后的token</span></span>
<span class="line"><span style="color:#98C379;">        :return:token</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;http://wechat.jshtcm.com/cas-wechat/*.jsonRequest&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">([{</span><span style="color:#98C379;">&quot;openId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">}])</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;X-Service-Method&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;getHeRenToken&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;X-Access-Token&quot;</span><span style="color:#ABB2BF;">: x_access_token,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;X-Service-Id&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;cas-wechat.heRenService&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;body&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @exception_handler</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_number_source</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">: NumberSourceArgs) -&gt; </span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取预约时间</span></span>
<span class="line"><span style="color:#98C379;">        :param args:</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;args&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#56B6C2;">                **</span><span style="color:#ABB2BF;">args.</span><span style="color:#61AFEF;">dict</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">            },</span></span>
<span class="line"><span style="color:#98C379;">            &quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.token,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        payload </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(payload)</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsSign&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#98C379;">            &quot;phsId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.phsId,</span></span>
<span class="line"><span style="color:#98C379;">            &quot;Content-Type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/phs-reg/reg/getNumberSource&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">, url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">payload)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#56B6C2;">            str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            and</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        ):</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;msg&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    api </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Api</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(api.</span><span style="color:#61AFEF;">get_hospital</span><span style="color:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br></div></div><p><strong>说明</strong></p><p>这个 Python 脚本定义了一个名为 Api 的类，该类封装了与医院系统的 API 交互功能，包括登录、获取医院信息、获取科室列表、获取医生排班信息、获取预约时间段等。这里对代码进行了逐行翻译和解释：</p><p><strong>导入依赖和初始化对象</strong></p><p>- 使用了 <code>pydantic</code> 模块来定义数据模型，<code>requests</code> 用于发送 HTTP 请求，<code>Crypto</code> 用于数据加密，<code>ddddocr</code> 用于验证码识别，<code>configparser</code> 用于配置文件管理。</p><p>- 实例化了验证码识别对象 <code>ocr</code> 和配置解析对象 <code>config</code>。</p><p><strong>异常处理装饰器 <code>exception_handler</code></strong></p><p>- 定义了一个装饰器用于捕获和处理函数运行中的异常，如果函数运行失败，则在 5 秒后重试，最多重试 3 次。</p><p><strong>Api 类的定义</strong></p><p>- <code>__init__</code> 方法初始化 API 类，从配置文件读取必要的配置项，如系统代码、加密密钥等，并尝试登录获取 token。</p><p>- <code>encrypt</code> 方法使用 DES 加密算法加密文本。</p><p><strong>API 交互方法</strong></p><p>- <code>get_hospital</code>：获取医院信息。</p><p>- <code>get_deptlist</code>：根据医院 ID 获取科室列表。</p><p>- <code>get_dept_sch_for_doc</code>：获取指定科室的医生排班信息。</p><p>- <code>get_doc_sch</code>：获取指定医生的详细排班信息。</p><p>- <code>get_pat_card_list</code>：获取患者的就诊卡列表，用于挂号。</p><p>- <code>add_reg</code>：提交预约挂号请求。</p><p>- <code>get_verification_code</code>：获取验证码信息，用于登录验证。</p><p>- <code>login</code>：用户登录，需要处理验证码。</p><p>- <code>get_he_ren_token</code>：获取登录后的患者端 token，用于后续的 API 请求。</p><p>- <code>get_number_source</code>：获取指定条件下的可预约时间段。</p><p><strong>主函数</strong></p><p>- 实例化 Api 类并调用 get_hospital 方法打印医院信息。</p><p><strong>注意点</strong></p><p>- 此代码依赖于外部的配置文件 (conf.ini) 和网络 API。在运行之前，需要确保所有的配置都已正确设置，并且相关的网络 API 可用。</p><p>- 使用了 DES 加密和 Base64 编码来处理某些敏感信息。</p><p>- 采用了重试机制来处理网络请求中可能遇到的临时错误。</p><p><strong>conf.ini 全文代码如下</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">[江苏省中医院]host </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> https:</span><span style="color:#56B6C2;">//</span><span style="color:#ABB2BF;">www.rjh.com.cn</span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;">deskey </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wewerwephsid </span><span style="color:#56B6C2;">=</span><span style="color:#FFFFFF;"> 4546554654syscode</span><span style="color:#56B6C2;"> =</span><span style="color:#FFFFFF;"> 15654654645username</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> 账号password </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> 密码token </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> token</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注意：项目配置文件，需要修改的配置是<code>username</code>,<code>password</code>,<code>token</code>。如果直接使用<code>token</code>则无需<code>username</code>,<code>password，</code>其他配置基本不需要改动。</p><p><strong>如何启动运行</strong>：</p><p>将所有文件放在同一目录下， 启动运行<strong>main.py</strong>即可。</p><h1 id="tao-宝秒杀活动脚本" tabindex="-1">tao 宝秒杀活动脚本 <a class="header-anchor" href="#tao-宝秒杀活动脚本" aria-label="Permalink to &quot;tao 宝秒杀活动脚本&quot;">​</a></h1><h3 id="taobo-py" tabindex="-1">taobo.py <a class="header-anchor" href="#taobo-py" aria-label="Permalink to &quot;taobo.py&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> time </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sleep</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.common.exceptions </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverException</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.ui </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverWait</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> expected_conditions </span><span style="color:#C678DD;">as</span><span style="color:#D19A66;"> EC</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> utils.utils </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> notify_user</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> utils.utils </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> build_chrome_options</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 抢购失败最大次数</span></span>
<span class="line"><span style="color:#ABB2BF;">max_retry_count </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 30</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 自动抢票类（淘宝）</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> TaoBao</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">chrome_path</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;./chromedriver.exe&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">seckill_time_str</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">password</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 驱动路径</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.chrome_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> chrome_path</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 抢购时间</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.seckill_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(seckill_time_str, </span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 支付密码</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.password </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> password</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # chrome驱动</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 获取chrome驱动</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> start_driver</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            driver </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">find_chromedriver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> WebDriverException:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Unable to find chromedriver, Please check the drive path.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> driver</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 寻找chrome驱动（首先去python安装目录下找，其次再去传入的路径找）</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> find_chromedriver</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> WebDriverException:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">executable_path</span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.chrome_path, </span><span style="color:#E06C75;font-style:italic;">chrome_options</span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;">build_chrome_options</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> WebDriverException:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;Unable to find chromedriver, Please check the drive path.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> driver</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 登录淘宝</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">login_url</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;https://www.taobao.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">login_time_out</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> login_url:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">start_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;Please input the login url.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 打开首页</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(login_url)</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 尝试获取点击登录超链接</span></span>
<span class="line"><span style="color:#ABB2BF;">                a_lists </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//div[@class=&quot;site-nav-sign&quot;]/a&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 获取到了，说明还未登录，进行登录</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(a_lists) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;没登录，开始点击登录按钮...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 亲，请登录</span></span>
<span class="line"><span style="color:#ABB2BF;">                    login_button </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> a_lists[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    login_button.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请在</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">s内扫码登陆!!&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(login_time_out))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 睡眠login_time_out(s)</span></span>
<span class="line"><span style="color:#61AFEF;">                    sleep</span><span style="color:#ABB2BF;">(login_time_out)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 尝试获取登录成功页面的元素，找到了表示已经登录成功。</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;J_SiteNavMytaobao&quot;]/div[1]/a/span&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;登陆成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 进入购物车</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://cart.taobao.com/cart.htm&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 结束循环</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;登陆失败, 刷新重试, 请尽快登陆!!!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                        continue</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e))</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 等待抢购</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> keep_wait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;等待到点抢购...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 获取当前时间</span></span>
<span class="line"><span style="color:#ABB2BF;">            current_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 如果距离抢购时间大于3分钟，则每分钟刷新一次界面，防止登录超时。</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_time </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> current_time).seconds </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 180</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 进入购物车</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://cart.taobao.com/cart.htm&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;每分钟刷新一次界面，防止登录超时...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 调用函数，将浏览器cookie写入文件备用。</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_cookie</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢购时间点将近，停止自动刷新，准备进入抢购阶段...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 抢购时间将近，结束等待抢购</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 抢购的入口函数</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> sec_kill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">login_time_out</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;此次抢购时间：</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(datetime.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill_time, </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 调用登录函数</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">login_time_out</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">login_time_out)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 调用等待抢购函数</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">keep_wait</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 获取全选框</span></span>
<span class="line"><span style="color:#ABB2BF;">        select_all </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">ID</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;J_SelectAll1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> select_all:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;当前未选状态，自动选择全部商品&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 点击全选</span></span>
<span class="line"><span style="color:#ABB2BF;">            select_all.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已经选中全部商品！！！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 记录提交状态</span></span>
<span class="line"><span style="color:#ABB2BF;">        submit_success </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 重试抢购次数</span></span>
<span class="line"><span style="color:#ABB2BF;">        retry_count </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 获取当前时间</span></span>
<span class="line"><span style="color:#ABB2BF;">            now </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> now </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.seckill_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;开始抢购, 尝试次数： </span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(retry_count </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 睡眠一段时间,防止cpu一直工作</span></span>
<span class="line"><span style="color:#61AFEF;">                sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 等待结算按钮可以被点击</span></span>
<span class="line"><span style="color:#ABB2BF;">                button </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">poll_frequency</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;#J_SmallSubmit&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 点击结算</span></span>
<span class="line"><span style="color:#ABB2BF;">                button.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已经点击结算按钮...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 等待跳转到提交订单按钮可以被点击</span></span>
<span class="line"><span style="color:#ABB2BF;">                submit </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">poll_frequency</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;#submitOrderPC_1 &gt; div &gt; a.go-btn&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 点击提交订单</span></span>
<span class="line"><span style="color:#ABB2BF;">                submit.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已经点击提交订单按钮...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 记录提交状态</span></span>
<span class="line"><span style="color:#ABB2BF;">                submit_success </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 退出循环</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;临时写的脚本, 可能出了点问题!!!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                retry_count </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> retry_count </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> max_retry_count:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;重试抢购次数达到上限，放弃重试...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    break</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 提交成功,准备支付</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> submit_success:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.password:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">pay</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> pay</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 等待密码框加载完毕</span></span>
<span class="line"><span style="color:#ABB2BF;">            element </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;sixDigitPassword&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 输入密码</span></span>
<span class="line"><span style="color:#ABB2BF;">            element.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.password)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;密码输入完成&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 等待确认付款按钮加载完成,并付款</span></span>
<span class="line"><span style="color:#61AFEF;">            WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;#J_authSubmit&#39;</span><span style="color:#ABB2BF;">))).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;付款成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            notify_user</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#61AFEF;">            notify_user</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;商品抢购失败&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        finally</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;20s后关闭浏览器...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_cookie</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        将浏览器cookie存入文件</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 获取浏览器cookies（dict类型）</span></span>
<span class="line"><span style="color:#ABB2BF;">        cookies </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get_cookies</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 将cookie转换为json字符串，并写入文件</span></span>
<span class="line"><span style="color:#ABB2BF;">        cookie_json </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(cookies)</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./tb_cookies.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">            f.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(cookie_json)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br></div></div><p><strong>说明</strong></p><p>这段代码是一个 Python 脚本，使用了 Selenium 库来模拟在网页上的用户操作，目的是自动完成淘宝的抢购过程。这个过程包括登录、等待抢购时间、选购商品、结算、提交订单以及支付。以下是对这个脚本关键部分的逐步分析：</p><p><strong>类结构和初始化</strong></p><p>- <code>TaoBao</code>类初始化时，需要指定 Chrome 驱动的路径、抢购时间和支付密码。</p><p>- <code>chrome_path</code>用于指定 ChromeDriver 的路径，<code>seckill_time</code>为抢购时间，<code>password</code>为支付密码。</p><p><strong>方法解析</strong></p><p>- <code>start_driver()</code>: 初始化和启动 Selenium WebDriver。如果在系统默认路径下找不到 ChromeDriver，则会尝试从<code>chrome_path</code>指定的路径加载。</p><p>- <code>find_chromedriver()</code>: 尝试在系统默认路径和提供的<code>chrome_path</code>中寻找并启动 ChromeDriver。</p><p>- <code>login()</code>: 打开淘宝主页，尝试通过扫码登录。这个方法会等待一段时间，允许用户扫码登录。如果登录成功，则跳转到购物车页面。</p><p>- <code>keep_wait()</code>: 在抢购时间之前，该方法会持续刷新页面，防止登录超时。当接近抢购时间时，停止刷新，准备抢购。</p><p>- <code>sec_kill()</code>: 抢购的主要逻辑。在设定的抢购时间点到达时，尝试全选购物车中的商品并进行结算和提交订单。</p><p>- <code>pay()</code>: 如果提交订单成功，该方法会尝试自动填写支付密码并完成支付。</p><p>- <code>get_cookie()</code>: 获取当前会话的 cookie 并保存到文件中，这可能用于后续的会话恢复或分析。</p><p><strong>抢购流程</strong></p><ol><li>登录: 使用扫码登录淘宝。</li><li>等待抢购时间: 在抢购时间到来之前，定期刷新页面以维持会话状态。</li><li>执行抢购: 在设定的抢购时间，自动选择购物车中的所有商品，点击结算并提交订单。</li><li>支付: 在订单提交后，自动填写支付密码并尝试支付。</li></ol><p><strong>异常处理</strong></p><p>- 代码中包含了多处异常处理，以应对在登录、选择商品、结算和支付过程中可能出现的问题。</p><h3 id="main-py-代码如下" tabindex="-1">main.py 代码如下 <a class="header-anchor" href="#main-py-代码如下" aria-label="Permalink to &quot;main.py 代码如下&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tkinter </span><span style="color:#C678DD;">import</span><span style="color:#56B6C2;"> *</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tkinter.ttk </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Combobox</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> seckill.taobao </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TaoBao</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> run_killer</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">time</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">password</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">platform</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 抢购时间</span></span>
<span class="line"><span style="color:#ABB2BF;">    seckill_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 支付密码</span></span>
<span class="line"><span style="color:#ABB2BF;">    password </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(password.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 平台类型</span></span>
<span class="line"><span style="color:#ABB2BF;">    platform </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> platform.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(seckill_time, password)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> platform </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;淘宝&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">        TaoBao</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">seckill_time_str</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">seckill_time, </span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">password).</span><span style="color:#61AFEF;">sec_kill</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">login_time_out</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;未知平台类型&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    win </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Tk</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    win.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;电商秒杀助手&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    win.</span><span style="color:#61AFEF;">iconbitmap</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;img/icon.ico&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    width </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 540</span></span>
<span class="line"><span style="color:#ABB2BF;">    height </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 350</span></span>
<span class="line"><span style="color:#ABB2BF;">    screenwidth </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> win.</span><span style="color:#61AFEF;">winfo_screenwidth</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    screenheight </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> win.</span><span style="color:#61AFEF;">winfo_screenheight</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    align_str </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">x</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">+</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">+</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> (width, height, (screenwidth </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> width) </span><span style="color:#56B6C2;">/</span><span style="color:#D19A66;"> 2</span><span style="color:#ABB2BF;">, (screenheight </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> height) </span><span style="color:#56B6C2;">/</span><span style="color:#D19A66;"> 2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    win.</span><span style="color:#61AFEF;">geometry</span><span style="color:#ABB2BF;">(align_str)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 设置开抢时间</span></span>
<span class="line"><span style="color:#ABB2BF;">    label1 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;开抢时间:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    label1.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    start_time </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> StringVar</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    time </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Entry</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">textvariable</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">start_time, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">23</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;blue&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    start_time.</span><span style="color:#61AFEF;">set</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 支付密码</span></span>
<span class="line"><span style="color:#ABB2BF;">    label2 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;支付密码:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    label2.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    password </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Entry</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">23</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">show</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;*&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;blue&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    password.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 选择平台</span></span>
<span class="line"><span style="color:#ABB2BF;">    label3 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;抢购平台:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    label3.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    platform_value </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> StringVar</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    platform </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Combobox</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">textvariable</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">platform_value, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">18</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    platform[</span><span style="color:#98C379;">&quot;values&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&quot;淘宝&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 默认选择第一个</span></span>
<span class="line"><span style="color:#ABB2BF;">    platform.</span><span style="color:#61AFEF;">current</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    platform.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 开始抢购</span></span>
<span class="line"><span style="color:#ABB2BF;">    b1 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Button</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;开始抢购&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                command</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">lambda</span><span style="color:#ABB2BF;">: </span><span style="color:#61AFEF;">run_killer</span><span style="color:#ABB2BF;">(time, password, platform),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                background</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;green&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">21</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    b1.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">320</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    win.</span><span style="color:#61AFEF;">resizable</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 使用说明</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt0 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;使用说明:&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">11</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt0.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">150</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    txt1 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;1、安装chrome浏览器以及chromeDriver（放置在python安装根目录下）&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt1.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">180</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    txt2 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;2、抢购前要清空购物车，然后把要抢的东西加入购物车&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt2.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">205</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    txt3 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;3、开抢时间必须是 %Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S 形式，如2020-12-29 12:10:15&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt3.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">230</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    txt4 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;4、输入开抢时间和支付密码后点开始，程序会控制浏览器打开淘宝登陆页&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt4.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">255</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    txt5 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;5、扫码登陆后，程序会自动刷新购物车页面，到点会完成抢购动作&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt5.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">280</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    txt6 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Label</span><span style="color:#ABB2BF;">(win, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;6、如果想手动付款，输入开抢时间后不用输入支付密码，直接点开始就可以了&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Lucida Grande&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                 fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;green&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    txt6.</span><span style="color:#61AFEF;">place</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">305</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    win.</span><span style="color:#61AFEF;">mainloop</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">    main</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p><strong>说明</strong></p><p>这段代码实现了一个基于 Tkinter GUI 的电商秒杀助手应用，用于自动化处理京东和淘宝的商品抢购过程。用户可以通过这个界面设置抢购时间、支付密码，并选择抢购平台（淘宝）。下面是对这段代码的具体分析：</p><p><strong>主要功能</strong></p><ol><li>GUI 设置：使用 Tkinter 创建图形用户界面，包括输入框、下拉框和按钮，允许用户输入抢购的详细信息。</li><li>抢购时间和支付密码输入：用户可以输入具体的抢购时间和支付密码。</li><li>平台选择：用户可以通过下拉菜单选择要抢购的电商平台，目前支持淘宝和其他。</li><li>开始抢购按钮：点击后根据输入的时间、密码和选择的平台执行抢购操作。</li></ol><p><strong>代码结构解析</strong></p><p>- run_killer() 函数：根据用户在 GUI 中设置的时间、密码和平台，实例化相应的京东或淘宝秒杀类，并调用其<code>sec_kill()</code>方法开始抢购。</p><p>- main() 函数：设置 GUI 窗口，包括所有的标签、输入框、按钮和文本说明。此外，还设定了窗口的大小和位置。</p><p><strong>GUI 组件</strong></p><p>- 时间输入：使用<code>Entry</code>组件让用户输入抢购的具体时间。</p><p>- 密码输入：使用<code>Entry</code>组件让用户输入支付密码，输入显示为星号(*)以保密。</p><p>- 平台选择：使用<code>Combobox</code>组件让用户选择抢购平台。</p><p>- 开始按钮：使用<code>Button</code>组件，用户点击后调用<code>run_killer()</code>函数。</p><p><strong>使用说明</strong></p><p>界面下方提供了详细的使用说明，指导用户如何使用这个工具，包括如何设置时间、清空购物车、扫码登录等步骤。</p><h3 id="代码运行流程" tabindex="-1">代码运行流程 <a class="header-anchor" href="#代码运行流程" aria-label="Permalink to &quot;代码运行流程&quot;">​</a></h3><ol><li>运行程序后，显示主窗口。</li><li>用户输入抢购时间、支付密码（可选）。</li><li>选择抢购平台。</li><li>点击开始抢购，程序会在后台根据设定的时间自动打开浏览器，登录并执行抢购动作。</li></ol><h3 id="注意事项-2" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项-2" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><p>- 确保已安装 Chrome 浏览器及对应版本的 ChromeDriver，并放置在合适的路径下。</p><p>- 使用前确保购物车是清空的，抢购前将商品加入购物车。</p><p>- 输入时间格式必须符合<code>%Y-%m-%d %H:%M:%S</code>，例如<code>2024-04-24 23:10:15</code>。</p><p>此代码提供了一个基本的自动化秒杀工具的框架，用户可以根据实际需求调整和扩展功能。</p><h1 id="xiao-米有品预约某台脚本" tabindex="-1">xiao 米有品预约某台脚本 <a class="header-anchor" href="#xiao-米有品预约某台脚本" aria-label="Permalink to &quot;xiao 米有品预约某台脚本&quot;">​</a></h1><p><strong>主要代码如下</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> base64</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> functools</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json,sys,hashlib</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pickle</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;">  urllib.parse</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> multiprocessing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> encrpty </span><span style="color:#C678DD;">import</span><span style="color:#56B6C2;"> *</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> mi_logger </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> logger</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> timer </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Timer</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> config </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> global_config</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> concurrent.futures </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ProcessPoolExecutor</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> util </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    parse_json,</span></span>
<span class="line"><span style="color:#ABB2BF;">    send_wechat,</span></span>
<span class="line"><span style="color:#ABB2BF;">    wait_some_time,</span></span>
<span class="line"><span style="color:#ABB2BF;">    get_random_useragent</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">主要用到的加密算法有两个：</span></span>
<span class="line"><span style="color:#98C379;">1、登录接口的加密算法，包括请求头和body，具体加密逻辑在其他文件。</span></span>
<span class="line"><span style="color:#98C379;">2、抢购、预约的入参加密，包括 yp-srs、 yp-ss、 yp-srt三个值。</span></span>
<span class="line"><span style="color:#98C379;">具体加密逻辑比较敏感，暂不公开。</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> MiSeckill</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;"> , </span><span style="color:#D19A66;font-style:italic;">user_name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 初始化信息</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.act_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> global_config.</span><span style="color:#61AFEF;">getRaw</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;config&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;act_id&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.timers </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Timer</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.spider_session </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> SpiderSession</span><span style="color:#ABB2BF;">(user_name)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">load_cookies_from_local</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.login </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Login</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.spider_session,user_name)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">get_session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.user_agent </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.spider_session.user_agent</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.locationUrl </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login_by_accountAndPassword</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        登陆</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.login.is_login:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;登录成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.login.</span><span style="color:#61AFEF;">login_by_accountAndPassword</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.login.is_login:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            #将cookie记录在本地</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.spider_session.</span><span style="color:#61AFEF;">save_cookies_to_local</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.login.nickName)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;账号密码登录失败！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> check_login</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">func</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        用户登陆态校验装饰器。若用户未登陆，则调用登陆</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">        @functools</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wraps</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">func</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        def</span><span style="color:#61AFEF;"> new_func</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, *</span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.login.is_login:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login_by_accountAndPassword</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#61AFEF;"> func</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, *args, **kwargs)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> new_func</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @check_login</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> appoint</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        预约</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_appoint</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> getSignByData</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #核心加密，隐藏</span></span>
<span class="line"><span style="color:#C678DD;">        pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        re </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#98C379;">            &#39;yp-srt&#39;</span><span style="color:#ABB2BF;">:xxx,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;yp-srs&#39;</span><span style="color:#ABB2BF;">: xxx,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;yp-ss&#39;</span><span style="color:#ABB2BF;">: xxx</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> isAppoint</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 核心代码隐藏</span></span>
<span class="line"><span style="color:#C678DD;">        pass</span></span>
<span class="line"><span style="color:#ABB2BF;">        re </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;xxxxxxxxxxxxx&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                               data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(data), </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">header)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;success&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;">  re.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;userStatusInfo&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;userStatusInfo&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ordered&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;获取今日商品信息出错，程序继续执行。&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;">  False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _appoint</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTodayActid</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isAppoint</span><span style="color:#ABB2BF;">() :</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---------您已预约成功，无需再次预约！----------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        nowtime </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [{}, {</span><span style="color:#98C379;">&quot;actId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.act_id, </span><span style="color:#98C379;">&quot;tel&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">}]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #获取校验所需加密参数</span></span>
<span class="line"><span style="color:#ABB2BF;">        signDict </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">  self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignByData</span><span style="color:#ABB2BF;">(data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        headerPhone </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;accept&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;*/*&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;accept-encoding&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;gzip, deflate, br&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;accept-language&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;zh-CN,zh;q=0.9&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;content-type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            ,</span><span style="color:#98C379;">&quot;referer&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.locationUrl</span></span>
<span class="line"><span style="color:#ABB2BF;">            ,</span><span style="color:#98C379;">&quot;user-agent&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;X-Requested-With&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;XMLHttpRequest&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;yp-srs&quot;</span><span style="color:#ABB2BF;">: signDict[</span><span style="color:#98C379;">&#39;yp-srs&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;yp-ss&quot;</span><span style="color:#ABB2BF;">: signDict[</span><span style="color:#98C379;">&#39;yp-ss&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;yp-srt&quot;</span><span style="color:#ABB2BF;">: signDict[</span><span style="color:#98C379;">&#39;yp-srt&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        re </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://m.xiaomiyoupin.com/mtop/act/orderspike/order?_=&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(nowtime),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                               data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(data),</span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headerPhone)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(re.text).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(re.text).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;success&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---------预约成功，记得按时抢购哦！----------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;当前预约人数为：</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(re.text).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;orderCount&quot;</span><span style="color:#ABB2BF;">) ))</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;预约失败，返回结果为：</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(re.text)))</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @check_login</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> seckill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        抢购</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_seckill</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> seckill_by_proc_pool</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">work_count</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        多进程进行抢购</span></span>
<span class="line"><span style="color:#98C379;">        work_count：进程数量</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        multiprocessing.</span><span style="color:#61AFEF;">freeze_support</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#61AFEF;"> ProcessPoolExecutor</span><span style="color:#ABB2BF;">(work_count) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pool:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(work_count):</span></span>
<span class="line"><span style="color:#ABB2BF;">                pool.</span><span style="color:#61AFEF;">submit</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.seckill)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> getUserlevel</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;"> :</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 核心代码隐藏</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"><span style="color:#ABB2BF;">            re </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;xxxx&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(data),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                                   headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">header)</span></span>
<span class="line"><span style="color:#ABB2BF;">            re </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;userLevelVO&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # logger.info(re)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> re:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;获取用户品值为：&quot;</span><span style="color:#56B6C2;">+str</span><span style="color:#ABB2BF;">(re.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">))</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;, 活跃度：&quot;</span><span style="color:#56B6C2;">+str</span><span style="color:#ABB2BF;">(re.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;activity&quot;</span><span style="color:#ABB2BF;">))</span><span style="color:#56B6C2;">+</span></span>
<span class="line"><span style="color:#98C379;">                        &quot;, 名誉值：&quot;</span><span style="color:#56B6C2;">+str</span><span style="color:#ABB2BF;">(re.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;reputation&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e :</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;获取用户品值出现异常【</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">】&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(e))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> getTodayActid</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;"> :</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            #核心代码隐藏</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            ###返回302转跳链接</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> re.headers.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.locationUrl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.headers.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Location&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                urlparse </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> urllib.parse.</span><span style="color:#61AFEF;">urlparse</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.locationUrl)</span></span>
<span class="line"><span style="color:#ABB2BF;">                query_dict </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> urllib.parse.</span><span style="color:#61AFEF;">parse_qs</span><span style="color:#ABB2BF;">(urlparse.query)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.act_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> query_dict.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;actId&#39;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;获取到今日飞天茅台商品id为 -----&gt; </span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.act_id))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            ##访问一次抢购页面</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.locationUrl)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e :</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;获取当天商品id出错：</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(e))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> _seckill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        抢购</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        a</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUserlevel</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTodayActid</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.timers.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;第</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">次抢购。&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(a))</span></span>
<span class="line"><span style="color:#ABB2BF;">                    flag </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">startKill</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    #抢购成功直接返回，失败继续</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> flag :</span></span>
<span class="line"><span style="color:#C678DD;">                        return</span></span>
<span class="line"><span style="color:#ABB2BF;">                    a </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> a </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">                    wait_some_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> a</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;"> :</span></span>
<span class="line"><span style="color:#ABB2BF;">                        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购失败,明天继续努力。&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                        return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;抢购发生异常，稍后继续执行！&#39;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"><span style="color:#61AFEF;">            wait_some_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> startKill</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [{}, {</span><span style="color:#98C379;">&quot;actId&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.act_id,</span></span>
<span class="line"><span style="color:#98C379;">                     &quot;token&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.act_id}]</span></span>
<span class="line"><span style="color:#ABB2BF;">        reDict </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignByData</span><span style="color:#ABB2BF;">(data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        trustType </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> xxx</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        headerPhone </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &quot;accept&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;*/*&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;accept-encoding&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;gzip, deflate, br&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;accept-language&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;zh-CN,zh;q=0.9&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;content-type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            ,</span><span style="color:#98C379;">&quot;referer&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.locationUrl</span></span>
<span class="line"><span style="color:#ABB2BF;">            ,</span><span style="color:#98C379;">&quot;user-agent&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.user_agent</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;X-Requested-With&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;XMLHttpRequest&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;c&quot;</span><span style="color:#ABB2BF;">: xxxx</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;d&quot;</span><span style="color:#ABB2BF;">: xxxx</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;yp-srs&quot;</span><span style="color:#ABB2BF;">: reDict[</span><span style="color:#98C379;">&#39;yp-srs&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;yp-ss&quot;</span><span style="color:#ABB2BF;">: reDict[</span><span style="color:#98C379;">&#39;yp-ss&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            , </span><span style="color:#98C379;">&quot;yp-srt&quot;</span><span style="color:#ABB2BF;">: reDict[</span><span style="color:#98C379;">&#39;yp-srt&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        re </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://m.xiaomiyoupin.com/mtop/act/orderspike/ekips?_=&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                               data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(data), </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headerPhone)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(re.text).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;"> :</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(re.text).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;success&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-------------成功啦，请作者喝杯咖啡吧！！！---------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢购失败:【</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">】&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(re.text.</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#D19A66;"> False</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br></div></div><h3 id="说明-1" tabindex="-1">说明 <a class="header-anchor" href="#说明-1" aria-label="Permalink to &quot;说明&quot;">​</a></h3><p>这个脚本是一个用于小米有品的秒杀助手，基于 Python 编写，使用了多个库和工具来处理登录、预约、和秒杀流程。下面详细解析各部分的功能和工作机制：</p><p><strong>导入的库和模块</strong></p><p>- <code>base64</code>, <code>random</code>, <code>time</code>, <code>requests</code>, <code>functools</code>, <code>json</code>, <code>sys</code>, <code>hashlib</code>, <code>os</code>, <code>pickle</code>, <code>urllib.parse</code>, <code>multiprocessing</code>: 这些是 Python 标准库，用于处理数据编码、时间操作、网络请求、功能扩展、数据序列化和并行计算。</p><p>- <code>encrpty</code>, <code>mi_logger</code>, <code>timer</code>, <code>config</code>, <code>util</code>: 这些是自定义模块，分别处理加密、日志记录、计时、配置管理和一些实用功能，如解析 JSON、发送微信通知、等待随机时间、获取随机用户代理等。</p><p><strong>核心类：<code>MiSeckill</code></strong></p><p>这个类是秒杀流程的主体，包含了登录、预约、秒杀等功能的实现。</p><p>- 初始化 (<code>__init__</code>): 设置活动 ID、计时器、会话管理、用户代理等。</p><p>- 登录 (<code>login_by_accountAndPassword</code>): 尝试通过账号和密码登录，并在成功后保存 cookie 到本地。</p><p>- 登录校验装饰器 (<code>check_login</code>): 一个装饰器，用于确保在执行任何需要登录的操作前用户已经登录。</p><p>- 预约 (<code>appoint</code>): 执行预约动作，如果用户已经预约则不再重复预约。</p><p>- 获取签名 (<code>getSignByData</code>): 用于生成请求的签名，这是秒杀中防止请求伪造的关键步骤，实现细节未公开。</p><p>- 检查预约状态 (<code>isAppoint</code>): 检查用户是否已经成功预约。</p><p>- 执行预约 (<code>_appoint</code>): 包含获取当日活动 ID 和检查预约状态的逻辑。</p><p>- 秒杀 (<code>seckill</code>): 执行秒杀动作。</p><p>- <strong>多进程秒杀</strong> (<code>seckill_by_proc_pool</code>): 使用多进程来同时执行多个秒杀任务，提高成功率。</p><p>- 获取用户等级 (<code>getUserlevel</code>): 获取用户在小米有品上的等级和其他相关信息，可能用于优先级判断。</p><p>- 获取当日活动 ID (<code>getTodayActid</code>): 获取当天的活动 ID，这是进行秒杀所必需的。</p><p>- 实际执行秒杀 (<code>_seckill</code>): 包括用户等级获取、活动 ID 获取、以及反复尝试秒杀的循环逻辑。</p><p>- 开始秒杀 (<code>startKill</code>): 根据提供的数据生成签名，构造请求头，然后发送秒杀请求。</p><h3 id="实际使用" tabindex="-1">实际使用 <a class="header-anchor" href="#实际使用" aria-label="Permalink to &quot;实际使用&quot;">​</a></h3><p>这个脚本配置了多线程运行方式，可以为每个账户创建一个独立的线程，从而同时执行多个秒杀任务。使用了 ProcessPoolExecutor 来管理进程池，这是 Python <code>concurrent.futures</code>模块的一部分，用于简化并行执行的复杂性。</p><h3 id="注意事项-3" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项-3" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><p>- 该脚本涉及加密和网络请求，这可能受到法律和道德的限制，特别是在自动化购买（秒杀）和自动登录等领域。使用此类脚本可能违反服务提供商的使用条款。- 秒杀行为可能对服务器造成压力，且在竞争激烈的情况下可能会导致账户被暂时或永久封禁。</p><h1 id="hua-为商城抢购手机脚本" tabindex="-1">hua 为商城抢购手机脚本 <a class="header-anchor" href="#hua-为商城抢购手机脚本" aria-label="Permalink to &quot;hua 为商城抢购手机脚本&quot;">​</a></h1><p>这是一个使用 Python 和 Selenium 库编写的自动化脚本</p><h3 id="全代码如下-1" tabindex="-1">全代码如下： <a class="header-anchor" href="#全代码如下-1" aria-label="Permalink to &quot;全代码如下：&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#   coding = utf-8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#############用户配置####################################</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 账号密码</span></span>
<span class="line"><span style="color:#D19A66;">ACCOUNTS</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">    &quot;华为账户账号/电话/邮箱&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;账户密码&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># chrome driver路径</span></span>
<span class="line"><span style="color:#ABB2BF;">chrome_driver </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/usr/local/bin/chromedriver&quot;</span><span style="color:#7F848E;font-style:italic;">   # Mac示例</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># chrome_driver = &quot;C:\\Google\\ChromeApplication\\chromedriver.exe&quot;   # Windows示例</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">personalDataPath </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/Users/zhangliang/Downloads/BUY-HW-master/Default&quot;</span><span style="color:#7F848E;font-style:italic;">  # Chrome的个人资料路径</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 手机链接</span></span>
<span class="line"><span style="color:#D19A66;">BUY_URL</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;https://www.vmall.com/product/10086232069466.html&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 开始自动刷新等待抢购按钮出现的时间点,建议提前10-30s，并提前2-5分钟启动python脚本，确保登陆成功，进入页面。</span></span>
<span class="line"><span style="color:#D19A66;">BEGIN_GO</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;2024-04-22 10:07:50&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否启动自动选手机参数。1为开启，0为关闭。当不启用时，无需填写下面的参数，此时抢购会默认网页上的默(第一个颜色、版本、套餐)。若不需要请关闭此选项能加快速度。</span></span>
<span class="line"><span style="color:#D19A66;">AUTO_SELECT</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否启动自动选手机颜色</span></span>
<span class="line"><span style="color:#D19A66;">AUTO_COLOR</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否启动自动选手机版本</span></span>
<span class="line"><span style="color:#D19A66;">AUTO_EDITION</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否启动自动选手机套餐</span></span>
<span class="line"><span style="color:#D19A66;">AUTO_COMBO</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 颜色，仅当AUTO_SELECT=1和AUTO_COLOR=1时才需要写</span></span>
<span class="line"><span style="color:#D19A66;">COLOR</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;翡冷翠&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 版本，仅当AUTO_SELECT=1和AUTO_EDITION=1时才需要写</span></span>
<span class="line"><span style="color:#D19A66;">EDITION</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;5G全网通 8GB+256GB&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 套餐，仅当AUTO_SELECT=1和AUTO_COMBO=1时才需要写</span></span>
<span class="line"><span style="color:#D19A66;">COMBO</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;官方标配&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 登陆信任 0表示不信任，1表示信任。一般无需改动。若信任，当您下次登录时，系统将不会要求您提供验证码。对于HUAWEI STORE普通版脚本，每次运行脚本即创建一个新Chrome，信任意义不大，默认为0，建议设置为0</span></span>
<span class="line"><span style="color:#D19A66;">TRUST</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">###############程序开始#################################</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.action_chains </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ActionChains</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> selenium</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> threading </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Thread</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 登录url,一般无需改动</span></span>
<span class="line"><span style="color:#D19A66;">LOGIN_URL</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;https://hwid1.vmall.com/CAS/portal/login.html?validated=true&amp;themeName=red&amp;service=https%3A</span><span style="color:#D19A66;">%2F%2F</span><span style="color:#98C379;">www.vmall.com</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">account</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">acaslogin</span><span style="color:#D19A66;">%3F</span><span style="color:#98C379;">url%3Dhttps%253A</span><span style="color:#D19A66;">%252F%252F</span><span style="color:#98C379;">www.vmall.com</span><span style="color:#D19A66;">%252F</span><span style="color:#98C379;">&amp;loginChannel=26000000&amp;reqClientType=26&amp;lang=zh-cn&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 进到购买页面后提交订单</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> submitOrder</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#D19A66;"> BUY_URL</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> driver.current_url:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:当前页面还在商品详情！！！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        goToBuy</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        order_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.current_url</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            submitOrder </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;提交订单&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            submitOrder.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:成功提交订单&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            break</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:提交不了订单！！！！！！！！！！！！！！！！！！！！！快去自己提交！！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 到了订单提交页面提交不了订单一直等待</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;请自行查看提交结果！！程序60s后退出&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    exit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 排队中</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> onQueue</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    nowUrl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.current_url</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;开始排队：&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#D19A66;"> BEGIN_GO</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        errorbutton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;boxCloseBtn&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> errorbutton.</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;style&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;display: none;&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">())</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;抢购失败，再试一次&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            goToBuy</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> nowUrl </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> driver.current_url </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> driver.current_url </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> BUY_URL</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:成功！排队页面跳转了!!!!!!!!!!!!!!&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                submitOrder</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">())</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:排队中&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.2</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 排队中</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 选择手机规格</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> select</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#D19A66;"> AUTO_COLOR</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            color </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">COLOR</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            color.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">COLOR</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;选择成功！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                color </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">COLOR</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                color.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">COLOR</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;选择成功！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;颜色选择错误！请手动选择！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;无需选择颜色&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#D19A66;"> AUTO_EDITION</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            edition </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EDITION</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            edition.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">EDITION</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;选择成功！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                edition </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EDITION</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                edition.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">EDITION</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;选择成功！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;版本选择错误！请手动选择！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;无需选择版本&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#D19A66;"> AUTO_COMBO</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            combo </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">COMBO</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            combo.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">COMBO</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;选择成功！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                combo </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">COMBO</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                combo.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">COMBO</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;选择成功！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;套餐选择错误！请手动选择！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;无需选择套餐&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 登录成功去到购买页面</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> goToBuy</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    autoSelect </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> AUTO_SELECT</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">BUY_URL</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#D19A66;"> BUY_URL</span><span style="color:#56B6C2;"> !=</span><span style="color:#ABB2BF;"> driver.current_url:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">BUY_URL</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;打开购买页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 转换成抢购时间戳</span></span>
<span class="line"><span style="color:#ABB2BF;">    timeArray </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">BEGIN_GO</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    timestamp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">mktime</span><span style="color:#ABB2BF;">(timeArray)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 再次登陆</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        denglu1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;top-index-loginUrl&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        denglu1.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;已经登陆&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 结束标志位</span></span>
<span class="line"><span style="color:#ABB2BF;">    over </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;">(autoSelect </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#61AFEF;">        select</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;跳过选择配置&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    isRemind </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;准备完毕，开始等待&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            isRemind </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> timestamp:  </span><span style="color:#7F848E;font-style:italic;"># 到了抢购时间</span></span>
<span class="line"><span style="color:#ABB2BF;">            text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                &#39;//*[@id=&quot;pro-operation&quot;]/a&#39;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].text</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;已售完&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                over </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#ABB2BF;"> text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;立即申购&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                buyButton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;立即申购&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                isRemindd </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> buyButton.</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;class&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">!=</span><span style="color:#98C379;"> &#39;product-button02 disabled&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                            time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;可以开始申购，立即申购&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        buyButton.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                            textnext </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_elements_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                                &#39;//div[@id=&quot;pro-operation-countdown&quot;]/p&#39;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].text</span></span>
<span class="line"><span style="color:#C678DD;">                            if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 2</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> isRemindd </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">, time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span></span>
<span class="line"><span style="color:#ABB2BF;">                                      user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;准备开始下一轮&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> textnext.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;开售:&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;的抢购&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                                isRemindd </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">                        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                            if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 2</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> isRemindd </span><span style="color:#56B6C2;">!=</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                                    time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;准备开始下一轮的抢购&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                                isRemindd </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    buyButton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;立即申购&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#ABB2BF;"> text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;0元预约&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                buyButton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;0元预约&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:请手动进行预约。程序将在一分钟后退出&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                buyButton.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                exit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#ABB2BF;"> text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;参与预约&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                buyButton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;参与预约&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;:请手动进行预约。程序将在一分钟后退出&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                buyButton.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                exit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                over </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> timestamp</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                isRemind </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">, time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span></span>
<span class="line"><span style="color:#ABB2BF;">                      user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;未到脚本开启时间，请选择好抢购的颜色、版本、套餐等(若已经配置则忽略)，将在设定的脚本启动时间前15秒启动&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;-&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">end</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.99</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#C678DD;"> or</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 2</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 2</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                isRemind </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 3</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;即将开始抢购，程序启动&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> over:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;很遗憾，&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                        time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">())</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;抢购结束,程序将在60s后退出&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">        exit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">        onQueue</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 信任浏览器(driver)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> trustdriver</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#D19A66;"> TRUST</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                trust </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;//div[@ht=&quot;click_dialog_leftbtn&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                trust.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;不信任出错，请自行点击不信任&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#D19A66;"> TRUST</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                trust </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;//div[@ht=&quot;click_dialog_rightbtn&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                trust.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;信任出错，请自行点击信任&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 发送验证码</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> sendcode</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        isGetVerification </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">            &#39;//div[@ht=&quot;click_authentication_getAuthcode&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        number </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//div[@id=&quot;accountDiv&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> isGetVerification.text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;获取验证码&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        isGetVerification.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> number </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;验证码已经发送&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(user</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;验证码已经发送至&#39;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">number.text)</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            inputdiv </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                &#39;//input[@ht=&quot;input_authentication_authcode&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            inputdiv.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 自动点击输入框</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 登录商城,登陆成功后至商城首页然后跳转至抢购页面</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> loginMall</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">pwd</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    option </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">ChromeOptions</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    argument </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;--user-data-dir=&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> personalDataPath</span></span>
<span class="line"><span style="color:#ABB2BF;">    option.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(argument)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;配置成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">executable_path</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">chrome_driver, </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">option)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;webDriver打开成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">LOGIN_URL</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;打开登陆页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待页面加载完成</span></span>
<span class="line"><span style="color:#ABB2BF;">        account </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">            &#39;//input[@ht=&quot;input_pwdlogin_account&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        account.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(user)</span></span>
<span class="line"><span style="color:#ABB2BF;">        password </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">            &#39;//input[@ht=&quot;input_pwdlogin_pwd&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        password.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(pwd)</span></span>
<span class="line"><span style="color:#ABB2BF;">        denglu </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">            &#39;//div[@ht=&quot;click_pwdlogin_submitLogin&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        ActionChains</span><span style="color:#ABB2BF;">(driver).</span><span style="color:#61AFEF;">move_to_element</span><span style="color:#ABB2BF;">(denglu).</span><span style="color:#61AFEF;">perform</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        denglu.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;成功输入了账号密码，尝试登陆.&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;账号密码不能输入,请手动输入并登陆！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    isRemind </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">    islogin </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#98C379;"> &quot;登录&quot;</span><span style="color:#C678DD;"> not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> driver.title:  </span><span style="color:#7F848E;font-style:italic;"># 页面跳转登陆成功</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">()) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;登录成功！！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            goToBuy</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#C678DD;">            break</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 没有登陆成功</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> isRemind </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(user </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;请手动完成认证并登陆！&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                isRemind </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 判断是否在获取验证码界面</span></span>
<span class="line"><span style="color:#ABB2BF;">                isGetVerification </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;//div[@class=&quot;hwid-dialog-header paddingBottom18&quot;]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> isGetVerification.text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;身份验证&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">                    sendcode</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    islogin </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    denglu </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_link_text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;登陆&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    denglu.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(denglu)</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> islogin </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 判断是否在信任浏览器界面</span></span>
<span class="line"><span style="color:#ABB2BF;">                    isGetVerification </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                        &#39;//div[@class=&quot;hwid-dialog-header paddingBottom40&quot;]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#98C379;"> &#39;是否信任此浏览器&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> isGetVerification.text:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        islogin </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#61AFEF;">                        trustdriver</span><span style="color:#ABB2BF;">(driver, user)</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> islogin </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> or</span><span style="color:#ABB2BF;"> islogin </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                error </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    error </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_xpath</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                        &#39;//div[@class=&quot;marginTB8 hwid-input-msg-error&quot;]&#39;</span><span style="color:#ABB2BF;">).text</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(error)</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#98C379;"> &#39;图形验证码&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> error:</span></span>
<span class="line"><span style="color:#C678DD;">                    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        denglu.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                    except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                elif</span><span style="color:#98C379;"> &#39;较为频繁&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> error:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;验证码获取频繁，请一小时后再试，或者使用HUAWEI STORE GO DEV版信任浏览器&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;60s后程序退出&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">                    exit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 账号密码</span></span>
<span class="line"><span style="color:#ABB2BF;">    data </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> ACCOUNTS</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 构建线程</span></span>
<span class="line"><span style="color:#ABB2BF;">    threads </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> account, pwd </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">        t </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">target</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">loginMall, </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(account, pwd,))</span></span>
<span class="line"><span style="color:#ABB2BF;">        threads.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(t)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 启动所有线程</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> thr </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> threads:</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        thr.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br></div></div><h3 id="说明-2" tabindex="-1">说明 <a class="header-anchor" href="#说明-2" aria-label="Permalink to &quot;说明&quot;">​</a></h3><p>这是一个使用 Python 和 Selenium 库编写的自动化脚本，用于在华为官方商城自动登录并抢购指定商品。用于抢购限量发售的热门商品，如手机、电子设备等。这里是脚本的逐段解释和说明：</p><p><strong>配置区域</strong></p><p>脚本开头定义了用户需要配置的一些变量：</p><p>- ACCOUNTS：存储用户的华为账号信息。</p><p>- chrome_driver：指定 Chrome WebDriver 的路径，用于 Selenium 控制 Chrome 浏览器。</p><p>- personalDataPath：Chrome 浏览器的个人资料路径，用于保持登录状态。</p><p>- BUY_URL：商品的购买链接。</p><p>- BEGIN_GO：设定脚本开始抢购的时间。</p><p>- AUTO_SELECT、AUTO_COLOR、AUTO_EDITION、AUTO_COMBO：用于自动选择商品的参数，如颜色、版本、套餐等。</p><p><strong>主要函数</strong></p><p>- submitOrder：提交订单的函数。检查当前页面是否正确，然后尝试点击“提交订单”按钮。</p><p>- onQueue：处理排队过程的函数。不断检查当前页面状态，如出现错误提示或页面跳转则处理相应情况。</p><p>- select：根据配置选择商品参数（如颜色、版本、套餐）的函数。</p><p>- goToBuy：导航到购买页面并根据配置选择商品参数的函数。</p><p>- trustdriver：处理浏览器信任的函数。</p><p>- sendcode：处理发送验证码的函数。</p><p>- loginMall：负责登录华为商城的函数。使用 Selenium 模拟用户登录过程，处理登录后的各种可能情况。</p><p><strong>运行脚本</strong></p><p>脚本通过多线程启动，为每个账户创建一个线程来处理登录和购买流程。使用 Thread 类来管理这些线程。</p><h3 id="如何运行这段代码" tabindex="-1">如何运行这段代码 <a class="header-anchor" href="#如何运行这段代码" aria-label="Permalink to &quot;如何运行这段代码&quot;">​</a></h3><ol><li>安装 Python：确保你的电脑上安装了 Python 环境。</li><li>安装 Selenium 库：通过 pip 安装 Selenium。可以在命令行中运行 pip install selenium。</li><li>下载 ChromeDriver：根据你的 Chrome 浏览器版本，从 <a href="https://sites.google.com/a/chromium.org/chromedriver/" target="_blank" rel="noreferrer">ChromeDriver</a> 下载对应版本的驱动程序，并设置 chrome_driver\`变量指向下载的路径。</li><li>配置 Chrome 用户数据：指定 personalDataPath 为你的 Chrome 用户数据路径，这可以让脚本使用你的登录状态和浏览器配置。</li><li>运行脚本：在终端或命令提示符中运行这个 Python 脚本。</li></ol><h3 id="注意事项-4" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项-4" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><ul><li><p>确保你了解使用这种脚本可能违反华为商城的使用条款。在使用前请务必了解相关法律法规及平台规则。</p></li><li><p>自动化抢购可能导致账号被暂时封禁或其他不良后果，需谨慎使用。</p></li><li><p>保护你的账户安全，不要在脚本中硬编码敏感信息</p></li></ul><h1 id="某麦网自动刷新抢票脚本" tabindex="-1">某麦网自动刷新抢票脚本 <a class="header-anchor" href="#某麦网自动刷新抢票脚本" aria-label="Permalink to &quot;某麦网自动刷新抢票脚本&quot;">​</a></h1><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">基于python和selenium实现的某麦网自动刷新抢票脚本</span></span>
<span class="line"><span style="color:#98C379;">用户要提前添加好个人信息和收货地址</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.ui </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverWait</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.keys </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Keys</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> expected_conditions </span><span style="color:#C678DD;">as</span><span style="color:#D19A66;"> EC</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.common.exceptions </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TimeoutException</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置抢票链接和开票时间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># URL = &quot;https://piao.damai.cn/146290.html?spm=a2o6e.search.0.0.7e2b4d157EDtjL&quot;# PC页面</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66;">URL</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;http://m.damai.cn/damai/perform/item.html?projectId=146290&#39;</span><span style="color:#7F848E;font-style:italic;">#手机页面</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># HOUR = 19</span></span>
<span class="line"><span style="color:#D19A66;">MIN</span><span style="color:#56B6C2;">  =</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#D19A66;">USERNAME</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;13112390306&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置等待时间</span></span>
<span class="line"><span style="color:#ABB2BF;">wait </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">URL</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">PC端网页抢票操作</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">seletor</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 控件可点击时才选定</span></span>
<span class="line"><span style="color:#ABB2BF;">        choice </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wait.</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, seletor)))</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> choice</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> TimeoutException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time out!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Not found!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 点击登录</span></span>
<span class="line"><span style="color:#ABB2BF;">    login </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;userLoginInfo&quot;]/span/a[1]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    login.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    username </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;login_email&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    username.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">USERNAME</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    由于密码框控件被设置为不可见</span></span>
<span class="line"><span style="color:#98C379;">    先自行输入密码并记住密码</span></span>
<span class="line"><span style="color:#98C379;">    方便刷新</span></span>
<span class="line"><span style="color:#98C379;">    （也可用cookie实现）</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    password </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;login_pwd_txt&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        password.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        password.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;********&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(password)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Password Can&#39;t click&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> buy</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 点击价格</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        price </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        plus </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        buybtn </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        submit </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        booker </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        select </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        confirm </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">URL</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 选择价格</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> price:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 这里选的是580票面的，如果选其他票面，修改最后的li[*]即可</span></span>
<span class="line"><span style="color:#ABB2BF;">            price </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;priceList&quot;]/div/ul/li[3]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        price.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 数量加1</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> plus:</span></span>
<span class="line"><span style="color:#ABB2BF;">            plus </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;cartList&quot;]/div[1]/ul/li/span[3]/a[2]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        plus.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 立即抢购</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> buybtn:</span></span>
<span class="line"><span style="color:#ABB2BF;">            buybtn </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;btnBuyNow&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, buybtn)</span></span>
<span class="line"><span style="color:#ABB2BF;">        buybtn.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 选择购票人</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> booker:</span></span>
<span class="line"><span style="color:#ABB2BF;">            booker </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[3]/div[3]/div[2]/div[2]/div/a&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, booker)</span></span>
<span class="line"><span style="color:#ABB2BF;">        booker.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 选择、确定</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> select:</span></span>
<span class="line"><span style="color:#ABB2BF;">            select </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[3]/div[3]/div[12]/div/div[2]/div/div[2]/div/table/tbody/tr/label/td[1]/input&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, select)</span></span>
<span class="line"><span style="color:#ABB2BF;">        select.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> confirm:</span></span>
<span class="line"><span style="color:#ABB2BF;">            confirm </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[3]/div[3]/div[12]/div/div[2]/div/p/div/a&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, confirm)</span></span>
<span class="line"><span style="color:#ABB2BF;">        confirm.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 提交订单</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> submit:</span></span>
<span class="line"><span style="color:#ABB2BF;">            submit </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;orderConfirmSubmit&quot;]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, submit)</span></span>
<span class="line"><span style="color:#ABB2BF;">        submit.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢票失败，尝试重新抢票&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        buy</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> test</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#61AFEF;">    login</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开始抢票&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    buy</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢票成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">移动端抢票操作</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> login_mobile</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    点击购买进入登录界面</span></span>
<span class="line"><span style="color:#98C379;">    自行输入帐号密码</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 立即购买</span></span>
<span class="line"><span style="color:#ABB2BF;">    buybtn </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> buybtn:</span></span>
<span class="line"><span style="color:#ABB2BF;">        buybtn </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div[2]/div/div[1]/div[2]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, buybtn)</span></span>
<span class="line"><span style="color:#ABB2BF;">    buybtn.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 默认已经选好时间了，再点击立即购买</span></span>
<span class="line"><span style="color:#ABB2BF;">    buy </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> buy:</span></span>
<span class="line"><span style="color:#ABB2BF;">        buy </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div[3]/div[2]/div[1]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, buy)</span></span>
<span class="line"><span style="color:#ABB2BF;">    buy.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> buy_mobile</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 立即购买</span></span>
<span class="line"><span style="color:#ABB2BF;">        buybtn </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> buybtn:</span></span>
<span class="line"><span style="color:#ABB2BF;">            buybtn </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div[2]/div/div[1]/div[2]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, buybtn)</span></span>
<span class="line"><span style="color:#ABB2BF;">        buybtn.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 默认已经选好时间了，再点击立即购买</span></span>
<span class="line"><span style="color:#ABB2BF;">        buy </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> buy:</span></span>
<span class="line"><span style="color:#ABB2BF;">            buy </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div[3]/div[2]/div[1]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, buy)</span></span>
<span class="line"><span style="color:#ABB2BF;">        buy.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 580票面</span></span>
<span class="line"><span style="color:#ABB2BF;">        price </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> price:</span></span>
<span class="line"><span style="color:#ABB2BF;">            price </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//html/body/div[1]/div/div[2]/ul/li[3]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, price)</span></span>
<span class="line"><span style="color:#ABB2BF;">        price.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 数量+1</span></span>
<span class="line"><span style="color:#ABB2BF;">        count </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> count:</span></span>
<span class="line"><span style="color:#ABB2BF;">            count </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div/div[3]/ul/li/div/div[3]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, count)</span></span>
<span class="line"><span style="color:#ABB2BF;">        count.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 选好了</span></span>
<span class="line"><span style="color:#ABB2BF;">        select </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> select:</span></span>
<span class="line"><span style="color:#ABB2BF;">            select </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div/div[4]/div[3]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, select)</span></span>
<span class="line"><span style="color:#ABB2BF;">        select.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 购票人</span></span>
<span class="line"><span style="color:#ABB2BF;">        booker </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> booker:</span></span>
<span class="line"><span style="color:#ABB2BF;">            booker </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div[1]/div[2]/div[1]/div[2]/div/ul/li/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, booker)</span></span>
<span class="line"><span style="color:#ABB2BF;">        booker.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 去付款</span></span>
<span class="line"><span style="color:#ABB2BF;">        pay </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> None</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> pay:</span></span>
<span class="line"><span style="color:#ABB2BF;">            pay </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> choose</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/html/body/div[1]/div[2]/div[2]/div[2]/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollIntoView();&quot;</span><span style="color:#ABB2BF;">, pay)</span></span>
<span class="line"><span style="color:#ABB2BF;">        pay.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢票失败，尝试重新抢票&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        buy_mobile</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> test_mobile</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#61AFEF;">    login_mobile</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开始抢票&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    buy_mobile</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢票成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 默认PC网页，手机网页对应修改即可</span></span>
<span class="line"><span style="color:#61AFEF;">    login</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 30秒等待用户输入密码后再开始刷</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#D19A66;"> MIN</span><span style="color:#56B6C2;"> ==</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">().tm_min:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开始抢票&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            buy</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;抢票成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # test()</span></span>
<span class="line"><span style="color:#61AFEF;">    test_mobile</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # main()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br></div></div><h1 id="秒抢演唱会门票通用模板" tabindex="-1">秒抢演唱会门票通用模板 <a class="header-anchor" href="#秒抢演唱会门票通用模板" aria-label="Permalink to &quot;秒抢演唱会门票通用模板&quot;">​</a></h1><p><strong>全代码如下</strong>：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># coding: utf-8</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> json </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> loads</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> os.path </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> exists</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> pickle </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> dump, load</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> time </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sleep, time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.common.exceptions </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TimeoutException, NoSuchElementException</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.chrome.service </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Service</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.desired_capabilities </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> DesiredCapabilities</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> expected_conditions </span><span style="color:#C678DD;">as</span><span style="color:#D19A66;"> EC</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.ui </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverWait</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> Concert</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">date</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">session</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">price</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">real_name</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">nick_name</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">ticket_num</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">viewer_person</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">预约平台_url</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">target_url</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;font-style:italic;">                 driver_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> date  </span><span style="color:#7F848E;font-style:italic;"># 日期序号</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> session  </span><span style="color:#7F848E;font-style:italic;"># 场次序号优先级</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price  </span><span style="color:#7F848E;font-style:italic;"># 票价序号优先级</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.real_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> real_name  </span><span style="color:#7F848E;font-style:italic;"># 实名者序号</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.status </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#7F848E;font-style:italic;">  # 状态标记</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.time_start </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#7F848E;font-style:italic;">  # 开始时间</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.time_end </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#7F848E;font-style:italic;">  # 结束时间</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.num </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#7F848E;font-style:italic;">  # 尝试次数</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.ticket_num </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ticket_num  </span><span style="color:#7F848E;font-style:italic;"># 购买票数</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.viewer_person </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> viewer_person  </span><span style="color:#7F848E;font-style:italic;"># 观影人序号优先级</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.nick_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> nick_name  </span><span style="color:#7F848E;font-style:italic;"># 用户昵称</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.预约平台_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> 预约平台_url  </span><span style="color:#7F848E;font-style:italic;"># 预约平台官网网址</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.target_url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> target_url  </span><span style="color:#7F848E;font-style:italic;"># 目标购票网址</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver_path  </span><span style="color:#7F848E;font-style:italic;"># 浏览器驱动地址</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> isClassPresent</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">item</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">ret</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> item.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">name)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> ret:</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#ABB2BF;"> result</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 获取账号的cookie信息</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_cookie</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.预约平台_url)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###请点击登录###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;login-user&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.title.</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;预约平台网-全球演出赛事官方购票平台&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 等待网页加载完成</span></span>
<span class="line"><span style="color:#61AFEF;">            sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###请扫码登录###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.title </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;预约平台登录&#39;</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 等待扫码完成</span></span>
<span class="line"><span style="color:#61AFEF;">            sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">        dump</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get_cookies</span><span style="color:#ABB2BF;">(), </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;cookies.pkl&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;wb&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###Cookie保存成功###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> set_cookie</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            cookies </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;cookies.pkl&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;rb&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 载入cookie</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> cookie </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> cookies:</span></span>
<span class="line"><span style="color:#ABB2BF;">                cookie_dict </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;domain&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;.预约平台.cn&#39;</span><span style="color:#ABB2BF;">,  </span><span style="color:#7F848E;font-style:italic;"># 必须有，不然就是假登录</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;name&#39;</span><span style="color:#ABB2BF;">: cookie.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;value&#39;</span><span style="color:#ABB2BF;">: cookie.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;expires&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;path&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;httpOnly&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;HostOnly&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;Secure&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">add_cookie</span><span style="color:#ABB2BF;">(cookie_dict)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###载入Cookie###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###开始登录###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.target_url)</span></span>
<span class="line"><span style="color:#61AFEF;">        WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">title_contains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;商品详情&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">set_cookie</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> enter_concert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.time_start </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> time</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 记录开始时间</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###打开浏览器，进入预约平台网###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#61AFEF;"> exists</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;cookies.pkl&#39;</span><span style="color:#ABB2BF;">):  </span><span style="color:#7F848E;font-style:italic;"># 如果不存在cookie.pkl,就获取一下</span></span>
<span class="line"><span style="color:#ABB2BF;">            service </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Service</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver_path)</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">service</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">service)</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_cookie</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###成功获取Cookie，重启浏览器###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        options </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">ChromeOptions</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 禁止图片、js、css加载</span></span>
<span class="line"><span style="color:#ABB2BF;">        prefs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;profile.managed_default_content_settings.images&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                 &quot;profile.managed_default_content_settings.javascript&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                 &#39;permissions.default.stylesheet&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        mobile_emulation </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;deviceName&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Nexus 6&quot;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;prefs&quot;</span><span style="color:#ABB2BF;">, prefs)</span></span>
<span class="line"><span style="color:#ABB2BF;">        options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;mobileEmulation&quot;</span><span style="color:#ABB2BF;">, mobile_emulation)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 就是这一行告诉chrome去掉了webdriver痕迹，令navigator.webdriver=false，极其关键</span></span>
<span class="line"><span style="color:#ABB2BF;">        options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-blink-features=AutomationControlled&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;--log-level=3&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 更换等待策略为不等待浏览器加载完全就进行下一步操作</span></span>
<span class="line"><span style="color:#ABB2BF;">        capa </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> DesiredCapabilities.</span><span style="color:#D19A66;">CHROME</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # normal, eager, none</span></span>
<span class="line"><span style="color:#ABB2BF;">        capa[</span><span style="color:#98C379;">&quot;pageLoadStrategy&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;eager&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        service </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Service</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver_path)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">service</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">service, </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">options, </span><span style="color:#E06C75;font-style:italic;">desired_capabilities</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">capa)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 登录到具体抢购页面</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">refresh</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> click_util</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">btn</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">locator</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            btn.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">(locator))</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 实现购买函数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> choose_ticket</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###进入抢票界面###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 如果跳转到了确认界面就算这步成功了，否则继续执行此步</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.title.</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;订单确认&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.num </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span><span style="color:#7F848E;font-style:italic;">  # 尝试次数加1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.current_url.</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;buy.预约平台.cn&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断页面加载情况 确保页面加载完成</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">                WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    lambda</span><span style="color:#D19A66;font-style:italic;"> driver</span><span style="color:#ABB2BF;">: driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;return document.readyState&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;complete&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&quot;***Error: 页面加载超时***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断root元素是否存在</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                box </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">ID</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;root&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&quot;***Error: 页面中ID为root的整体布局元素不存在或加载超时***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查并处理温馨提示遮罩</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                health_info </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;health-info-content&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---检测到温馨提示遮罩---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                health_info_box </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> health_info.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">ID</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;health-info-html-box&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 模拟向上滑动，阅读温馨提示内容</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---正在模拟向上滑动阅读温馨提示内容---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].scrollTop = arguments[0].scrollHeight&quot;</span><span style="color:#ABB2BF;">, health_info_box)</span></span>
<span class="line"><span style="color:#61AFEF;">                sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待滑动完成</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---模拟滑动完成---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 点击“知道了”按钮</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---正在点击“知道了”按钮---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                know_button </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> health_info.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;button&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                know_button.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---“知道了”按钮点击成功---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> TimeoutException:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---不存在温馨提示遮罩---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> NoSuchElementException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;***Error: 温馨提示遮罩操作异常：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查并处理实名制观演提示遮罩</span></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                realname_info </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;realname-content&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---检测到实名制观演提示遮罩---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 点击“知道了”按钮</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---正在点击“知道了”按钮---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                known_button </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> realname_info.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;known&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                known_button.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---“知道了”按钮点击成功---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> TimeoutException:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---不存在实名制观演提示遮罩---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> NoSuchElementException </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;***Error: 实名制观演提示遮罩操作异常：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                buybutton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> box.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;buy__button&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                buybutton_text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> buybutton.text</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---定位购买按钮成功---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;***Error: 定位购买按钮失败***: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#98C379;"> &quot;即将开抢&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> buybutton_text:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.status </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;---尚未开售，刷新等待---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#98C379;"> &quot;缺货&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> buybutton_text:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#98C379;">&quot;---已经缺货，刷新等待---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">            sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            buybutton.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;---点击购买按钮---&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            box </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.sku-pop-wrapper&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 日期选择</span></span>
<span class="line"><span style="color:#ABB2BF;">                toBeClicks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    date </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                        EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;bui-dm-sku-calendar&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    date </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> date </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    date_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> date.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                        by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;bui-calendar-day-box&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.date:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        j </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> date_list[i </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        toBeClicks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(j)</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"><span style="color:#C678DD;">                    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> toBeClicks:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        i.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">                        sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 选定场次</span></span>
<span class="line"><span style="color:#ABB2BF;">                session </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;sku-times-card&#39;</span><span style="color:#ABB2BF;">)))  </span><span style="color:#7F848E;font-style:italic;"># 日期、场次和票档进行定位</span></span>
<span class="line"><span style="color:#ABB2BF;">                session_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                    by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;bui-dm-sku-card-item&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                toBeClicks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.session:  </span><span style="color:#7F848E;font-style:italic;"># 根据优先级选择一个可行场次</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> i </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(session_list):</span></span>
<span class="line"><span style="color:#ABB2BF;">                        i </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(session_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    j </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> session_list[i </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                    k </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isClassPresent</span><span style="color:#ABB2BF;">(j, </span><span style="color:#98C379;">&#39;item-tag&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> k:  </span><span style="color:#7F848E;font-style:italic;"># 如果找到了带presell的类</span></span>
<span class="line"><span style="color:#C678DD;">                        if</span><span style="color:#ABB2BF;"> k.text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;无票&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                            continue</span></span>
<span class="line"><span style="color:#C678DD;">                        elif</span><span style="color:#ABB2BF;"> k.text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;预售&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                            toBeClicks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(j)</span></span>
<span class="line"><span style="color:#C678DD;">                            break</span></span>
<span class="line"><span style="color:#C678DD;">                        elif</span><span style="color:#ABB2BF;"> k.text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;惠&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                            toBeClicks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(j)</span></span>
<span class="line"><span style="color:#C678DD;">                            break</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        toBeClicks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(j)</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 多场次的场要先选择场次才会出现票档</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> toBeClicks:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    i.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">                    sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 选定票档</span></span>
<span class="line"><span style="color:#ABB2BF;">                toBeClicks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">                price </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;sku-tickets-card&#39;</span><span style="color:#ABB2BF;">)))  </span><span style="color:#7F848E;font-style:italic;"># 日期、场次和票档进行定位</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                price_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                    by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;bui-dm-sku-card-item&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 选定票档</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.price:</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> i </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(price_list):</span></span>
<span class="line"><span style="color:#ABB2BF;">                        i </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(price_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    j </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price_list[i </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                    k </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isClassPresent</span><span style="color:#ABB2BF;">(j, </span><span style="color:#98C379;">&#39;item-tag&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> k:  </span><span style="color:#7F848E;font-style:italic;"># 存在notticket代表存在缺货登记，跳过</span></span>
<span class="line"><span style="color:#C678DD;">                        continue</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        toBeClicks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(j)</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> toBeClicks:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    i.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">                    sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                buybutton </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> box.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                    by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;sku-footer-buy-button&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # sleep(1.0)</span></span>
<span class="line"><span style="color:#ABB2BF;">                buybutton_text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> buybutton.text</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> buybutton_text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&quot;***Error: 提交票档按钮文字获取为空,适当调整 sleep 时间***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">                    WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                        EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;bui-dm-sku-counter&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&quot;***购票按钮未开始***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;***Error: 选择日期or场次or票档不成功***: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                ticket_num_up </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> box.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                    by</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;plus-enable&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> buybutton_text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;选座购买&quot;</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 选座购买没有增减票数键</span></span>
<span class="line"><span style="color:#ABB2BF;">                    buybutton.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.status </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 5</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###请自行选择位置和票价###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    break</span></span>
<span class="line"><span style="color:#C678DD;">                elif</span><span style="color:#ABB2BF;"> buybutton_text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;提交缺货登记&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;###票已被抢完，持续捡漏中...或请关闭程序并手动提交缺货登记###&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&quot;***Error: ticket_num_up 位置找不到***&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> buybutton_text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;立即预订&quot;</span><span style="color:#C678DD;"> or</span><span style="color:#ABB2BF;"> buybutton_text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;立即购买&quot;</span><span style="color:#C678DD;"> or</span><span style="color:#ABB2BF;"> buybutton_text </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;确定&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.ticket_num </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">):  </span><span style="color:#7F848E;font-style:italic;"># 设置增加票数</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ticket_num_up.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                buybutton.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.status </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 4</span></span>
<span class="line"><span style="color:#61AFEF;">                WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">title_contains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;确认&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;未定义按钮：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">buybutton_text</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> check_order</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.status </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> [</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 选择观影人</span></span>
<span class="line"><span style="color:#ABB2BF;">            toBeClicks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#61AFEF;">            WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;dmViewerBlock_DmViewerBlock&quot;]/div[2]/div/div&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#ABB2BF;">            people </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;dmViewerBlock_DmViewerBlock&quot;]/div[2]/div/div&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.viewer_person:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> i </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(people):</span></span>
<span class="line"><span style="color:#C678DD;">                    break</span></span>
<span class="line"><span style="color:#ABB2BF;">                j </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> people[i </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                j.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">                sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">            WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    (By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;dmOrderSubmitBlock_DmOrderSubmitBlock&quot;]/div[2]/div/div[2]/div[2]/div[2]&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#ABB2BF;">            comfirmBtn </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;dmOrderSubmitBlock_DmOrderSubmitBlock&quot;]/div[2]/div/div[2]/div[2]/div[2]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            comfirmBtn.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断title是不是支付宝</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###正在跳转到支付宝付款界面###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">                    WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                        EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">title_contains</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;支付宝&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###订单提交成功###&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.status </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 6</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.time_end </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                    break</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 通过人工判断订单提交状态</span></span>
<span class="line"><span style="color:#ABB2BF;">                    step </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                        &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">###</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">1.成功跳转到支付宝付款页面</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">2.未知，没跳转到支付宝界面，尝试重新抢票</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">3.未知，退出脚本</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">###</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">请输入当前状态：&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> step </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;1&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 成功</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;订单提交成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.status </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 6</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.time_end </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"><span style="color:#C678DD;">                    elif</span><span style="color:#ABB2BF;"> step </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;2&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 失败，进入下一轮抢票</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;尝试重新抢票&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                        return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                    elif</span><span style="color:#ABB2BF;"> step </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;3&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 退出脚本</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;脚本退出成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                        return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                        raise</span><span style="color:#ABB2BF;"> Exception(</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;***Error: 未知输入***&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./config.json&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">            config </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> loads</span><span style="color:#ABB2BF;">(f.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # params: 场次优先级，票价优先级，实名者序号, 用户昵称， 购买票数， 官网网址， 目标网址, 浏览器驱动地址</span></span>
<span class="line"><span style="color:#ABB2BF;">        con </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Concert</span><span style="color:#ABB2BF;">(config[</span><span style="color:#98C379;">&#39;date&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;sess&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;price&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;real_name&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;nick_name&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#ABB2BF;">                      config[</span><span style="color:#98C379;">&#39;ticket_num&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;viewer_person&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;预约平台_url&#39;</span><span style="color:#ABB2BF;">], config[</span><span style="color:#98C379;">&#39;target_url&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#ABB2BF;">                      config[</span><span style="color:#98C379;">&#39;driver_path&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">        con.</span><span style="color:#61AFEF;">enter_concert</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 进入到具体抢购页面</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#56B6C2;">        exit</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            con.</span><span style="color:#61AFEF;">choose_ticket</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            retry </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> con.</span><span style="color:#61AFEF;">check_order</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> retry:</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">            con.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(con.target_url)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#C678DD;">            continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> con.status </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 6</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;###经过</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">轮奋斗，耗时</span><span style="color:#D19A66;">%.1f</span><span style="color:#98C379;">秒，成功为您抢票！请及时确认订单信息并完成支付！###&quot;</span><span style="color:#56B6C2;"> %</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">            con.num, </span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(con.time_end </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> con.time_start, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#56B6C2;">        input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;按 Enter 键退出脚本&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br></div></div><p>解析</p><p>这个Python脚本使用了Selenium库来自动化web浏览器操作，目的是自动化购票流程。脚本的主体是一个名为<code>Concert</code>的类，用来处理从登录到购票的所有步骤。以下是代码中关键部分的详细解释：</p><p>### 类定义：<code>Concert</code></p><p><code>Concert</code>类负责配置和执行整个购票流程，它的构造函数接收多个参数来定义购票的具体细节（如日期、场次、票价等）。</p><p>- __init__方法：初始化类的属性，设置购票的相关参数。</p><p>- isClassPresent方法：辅助方法，用于检查特定的CSS类是否存在于页面元素中。</p><p>- get_cookie方法：访问预约平台网主页，引导用户登录以获取cookies，这些cookies随后被保存到本地文件中以便后续使用。</p><p>-set_cookie方法：从本地文件加载cookies，并将它们设置到浏览器驱动中，实现自动登录。</p><p>- login方法：加载目标购票网页，并调用<code>set_cookie</code>来登录。</p><p>- enter_concert方法：设置浏览器驱动并配置（如禁止图片和JavaScript的加载），然后调用<code>login</code>方法进入购票页面。</p><p><strong>购票流程</strong></p><p>- choose_ticket方法：实现购票的核心逻辑。这个方法会不断尝试选票和购买，包括处理多种页面元素（如日历、场次、票档等）。</p><p>- click_util方法：尝试点击特定按钮直到页面上出现期望的元素为止。</p><p>- check_order方法：在成功选择票之后，检查订单信息，并尝试提交订单。</p><p><strong>主程序</strong></p><p>- 主程序部分从配置文件（config.json）加载配置，创建Concert类的实例，并执行购票流程。</p><p>- 使用了异常处理来捕获和处理运行中可能发生的错误。</p><p>- 循环调用choose_ticket和check_order，直到票务成功购买或用户选择退出。</p><p><strong>其他技术细节</strong></p><p>- 使用了WebDriver的Chrome实现，并通过一系列配置来优化性能和掩盖自动化痕迹。</p><p>- 利用显式等待和条件检查来确保页面元素加载完成。</p><p>- 处理了一些常见的弹窗和提示，确保流程不会被意外打断。</p><p>特别适用于那些需要在特定时间抢购门票的场合，例如热门演唱会、体育赛事等。通过自动化这一过程，用户可以显著提高成功购票的机率。</p><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h1 id="python-免滑块验证脚本" tabindex="-1">Python 免滑块验证脚本 <a class="header-anchor" href="#python-免滑块验证脚本" aria-label="Permalink to &quot;Python 免滑块验证脚本&quot;">​</a></h1><p><img src="`+p+`" alt="图片"></p><p>这是一个用于自动登录京东并更新 Cookie 到青龙管理系统的 Python 脚本。脚本支持通过账号密码自动登录，适用于需要定期更新京东 Cookie 的情况，特别是在使用青龙等自动化工具进行京东相关活动脚本运行时。</p><p>全代码如下：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">脚本说明：</span></span>
<span class="line"><span style="color:#98C379;">1、脚本用于使用账号密码自动登录京东获取ck，自动更新ck到青龙</span></span>
<span class="line"><span style="color:#98C379;">2、建议本地登录，不建议使用代理，第一次使用手机验证码之后一般不需要验证码就可以密码登录</span></span>
<span class="line"><span style="color:#98C379;">3、程序仅更新被禁用的ck</span></span>
<span class="line"><span style="color:#98C379;">4、脚本有py源码以及windows版本exe程序</span></span>
<span class="line"><span style="color:#98C379;">5、py脚本需要opencv-python、pyppeteer、Pillow、asyncio、aiohttp等依赖</span></span>
<span class="line"><span style="color:#98C379;">6、linux需要桌面环境，比如gnome用于图形处理</span></span>
<span class="line"><span style="color:#98C379;">7、第一次使用会下载chrome浏览器，生成jdck.ini配置文件，等待即可，后续无需等待</span></span>
<span class="line"><span style="color:#98C379;">8、此脚本适合于青龙内部运行，因青龙大部分不支持opencv插件，仅支持linux以及windows运行，建议使用windows版本，定时运行即可。</span></span>
<span class="line"><span style="color:#98C379;">9、脚本基于python3.12.1编写，目前3.11可以正常使用，其它版本未测试</span></span>
<span class="line"><span style="color:#98C379;">10、脚本需要青龙应用权限——环境变量跟脚本管理</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">jdck.ini配置文件</span></span>
<span class="line"><span style="color:#98C379;">Displaylogin=0  #是否显示登录操作，1显示，0不显示</span></span>
<span class="line"><span style="color:#98C379;">qlip=http://192.168.1.1:5700  #填青龙的ip</span></span>
<span class="line"><span style="color:#98C379;">client_id=*******    #填青龙对接应用的client_id</span></span>
<span class="line"><span style="color:#98C379;">client_secret=*******     #填青龙对接应用的client_secret</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">登陆号码#密码#备注      #多账户换行</span></span>
<span class="line"><span style="color:#98C379;">517123248#ya21udb95#我是备注1</span></span>
<span class="line"><span style="color:#98C379;">15611167798#123456789#我是备注2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">废案：AutoJDCK_DP = http://192.168.2.3:2233      #设置登录代理（不建议设置代理，基本上要验证码）</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">免责声明</span></span>
<span class="line"><span style="color:#98C379;">本脚本仅供学习参考，请在下载后24小时内删除，请勿用于非法用途。</span></span>
<span class="line"><span style="color:#98C379;">作者不对因使用该脚本造成的任何损失或法律问题负责。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> asyncio  </span><span style="color:#7F848E;font-style:italic;"># 异步I/O操作库</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random  </span><span style="color:#7F848E;font-style:italic;">#用于模拟延迟输入</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> re </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> T  </span><span style="color:#7F848E;font-style:italic;"># 随机数生成库</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> cv2  </span><span style="color:#7F848E;font-style:italic;"># OpenCV库，用于图像处理</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os  </span><span style="color:#7F848E;font-style:italic;">#读取配置文件</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> pyppeteer </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> launch  </span><span style="color:#7F848E;font-style:italic;"># pyppeteer库，用于自动化控制浏览器</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> aiohttp   </span><span style="color:#7F848E;font-style:italic;">#用于请求青龙</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> urllib </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> request  </span><span style="color:#7F848E;font-style:italic;"># 用于网络请求，这里主要用来下载图片</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image  </span><span style="color:#7F848E;font-style:italic;">#用于图像处理</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> platform  </span><span style="color:#7F848E;font-style:italic;">#判断系统类型</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> zipfile  </span><span style="color:#7F848E;font-style:italic;">#用于解压文件</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#7F848E;font-style:italic;">#获取时间</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">message</span><span style="color:#ABB2BF;">):     </span><span style="color:#7F848E;font-style:italic;">#初始化异步print</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(message)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> ifconfigfile</span><span style="color:#ABB2BF;">():                           </span><span style="color:#7F848E;font-style:italic;">#判断有没有配置文件</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> configfile            </span><span style="color:#7F848E;font-style:italic;">#配置文件全局变量</span></span>
<span class="line"><span style="color:#ABB2BF;">    configfile </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;jdck.ini&#39;</span><span style="color:#7F848E;font-style:italic;">     #配置文件名称为</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(configfile):     </span><span style="color:#7F848E;font-style:italic;">#看看有没有配置文件</span></span>
<span class="line"><span style="color:#ABB2BF;">        configdata </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#98C379;">&#39;Displaylogin=0  #是否显示登录操作，1显示，0不显示</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;qlip=http://192.168.1.1:5700</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;client_id=*******</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;client_secret=*******</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;517123248#ya21udb95#我是备注1</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;15611167798#123456789#我是备注2</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(configfile, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:     </span><span style="color:#7F848E;font-style:italic;">#打开配置文件</span></span>
<span class="line"><span style="color:#E06C75;">            file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">writelines</span><span style="color:#ABB2BF;">(configdata)       </span><span style="color:#7F848E;font-style:italic;">#写入configdata的内容到配置文件</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;已在当前脚本目录下生成了配置文件，请修改后再运行&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待10秒，等待</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> SystemExit</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> download_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):        </span><span style="color:#7F848E;font-style:italic;">#初始化浏览器下载</span></span>
<span class="line"><span style="color:#ABB2BF;">    timeout </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientTimeout</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">total</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">60000</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 设置超时时间</span></span>
<span class="line"><span style="color:#C678DD;">    async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">timeout</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">timeout) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:</span></span>
<span class="line"><span style="color:#C678DD;">        async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:</span></span>
<span class="line"><span style="color:#C678DD;">            with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                file_size </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(response.headers.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Content-Length&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                downloaded_size </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">                chunk_size </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1024</span></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    chunk </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.content.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(chunk_size)</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> chunk:</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"><span style="color:#E06C75;">                    file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(chunk)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    downloaded_size </span><span style="color:#56B6C2;">+=</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(chunk)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    progress </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (downloaded_size </span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;"> file_size) </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 100</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;已下载</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">progress</span><span style="color:#C678DD;">:.2f</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">%...&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">end</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\r</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;下载完成，进行解压安装....&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> init_web_display</span><span style="color:#ABB2BF;">():                           </span><span style="color:#7F848E;font-style:italic;">#初始化浏览器显示配置</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> WebDisplay                             </span><span style="color:#7F848E;font-style:italic;">#设置为全局变量</span></span>
<span class="line"><span style="color:#ABB2BF;">    WebDisplay </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span><span style="color:#7F848E;font-style:italic;">                             #默认不显示登录</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(configfile, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> line </span><span style="color:#C678DD;">in</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#98C379;"> &#39;Displaylogin=1&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> line:                             </span><span style="color:#7F848E;font-style:italic;">#如果配置文件有Displaylogin=1这个东西</span></span>
<span class="line"><span style="color:#ABB2BF;">                    WebDisplay </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span><span style="color:#7F848E;font-style:italic;">                             #就变更成显示登录操作</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;当前模式：显示web登录图形化界面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    break</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> WebDisplay:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;当前配置不显示web登录图形化界面，若要取消静默登陆，在配置文件中设置参数Displaylogin=1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> FileNotFoundError:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;读取配置文件时出错&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> init_chrome</span><span style="color:#ABB2BF;">():        </span><span style="color:#7F848E;font-style:italic;">#判断chrome是否存在，不存在则下载，仅针对windows</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> platform.</span><span style="color:#61AFEF;">system</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;Windows&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        chrome_dir </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(os.environ[</span><span style="color:#98C379;">&#39;USERPROFILE&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;AppData&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Local&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;pyppeteer&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;pyppeteer&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;local-chromium&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;588429&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;chrome-win32&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        chrome_exe </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(chrome_dir, </span><span style="color:#98C379;">&#39;chrome.exe&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        chmod_dir </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(os.environ[</span><span style="color:#98C379;">&#39;USERPROFILE&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;AppData&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Local&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;pyppeteer&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;pyppeteer&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;local-chromium&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;588429&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;chrome-win32&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;chrome-win32&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(chrome_exe):</span></span>
<span class="line"><span style="color:#C678DD;">            return</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;貌似第一次使用，未找到chrome，正在下载chrome浏览器....&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            chromeurl </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;http://npm.taobao.org/mirrors/chromium-browser-snapshots/Win_x64/588429/chrome-win32.zip&#39;</span><span style="color:#7F848E;font-style:italic;">        #定义下载地址</span></span>
<span class="line"><span style="color:#ABB2BF;">            target_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;chrome-win.zip&#39;</span><span style="color:#7F848E;font-style:italic;">                                                          #定义下载文件名</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> download_file</span><span style="color:#ABB2BF;">(chromeurl, target_file)           </span><span style="color:#7F848E;font-style:italic;">#下载</span></span>
<span class="line"><span style="color:#C678DD;">            with</span><span style="color:#ABB2BF;"> zipfile.</span><span style="color:#61AFEF;">ZipFile</span><span style="color:#ABB2BF;">(target_file, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> zip_ref:</span></span>
<span class="line"><span style="color:#ABB2BF;">                zip_ref.</span><span style="color:#61AFEF;">extractall</span><span style="color:#ABB2BF;">(chrome_dir)</span></span>
<span class="line"><span style="color:#ABB2BF;">            os.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">(target_file)</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(chmod_dir):              </span><span style="color:#7F848E;font-style:italic;">#移动所有文件</span></span>
<span class="line"><span style="color:#ABB2BF;">                source_item </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(chmod_dir, item)</span></span>
<span class="line"><span style="color:#ABB2BF;">                destination_item </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(chrome_dir, item)</span></span>
<span class="line"><span style="color:#ABB2BF;">                os.</span><span style="color:#61AFEF;">rename</span><span style="color:#ABB2BF;">(source_item, destination_item)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;解压安装完成&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待1秒，等待</span></span>
<span class="line"><span style="color:#C678DD;">    elif</span><span style="color:#ABB2BF;"> platform.</span><span style="color:#61AFEF;">system</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;Linux&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        chrome_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">expanduser</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;~/.local/share/pyppeteer/local-chromium/1181205/chrome-linux/chrome&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        download_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">expanduser</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;~/.local/share/pyppeteer/local-chromium/1181205/&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">isfile</span><span style="color:#ABB2BF;">(chrome_path):</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;貌似第一次使用，未找到chrome，正在下载chrome浏览器....&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;文件位于github，请耐心等待，如遇到网络问题可到项目地址手动下载&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            download_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;https://github.com/dsmggm/svjdck/releases/download/jdck/chrome-linux.zip&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(download_path):       </span><span style="color:#7F848E;font-style:italic;">#如果没有路径就创建路径</span></span>
<span class="line"><span style="color:#ABB2BF;">                os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(download_path, </span><span style="color:#E06C75;font-style:italic;">exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 创建下载路径</span></span>
<span class="line"><span style="color:#ABB2BF;">            target_file </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(download_path, </span><span style="color:#98C379;">&#39;chrome-linux.zip&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 定义下载文件路径跟文件名</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#61AFEF;"> download_file</span><span style="color:#ABB2BF;">(download_url, target_file)           </span><span style="color:#7F848E;font-style:italic;">#下载</span></span>
<span class="line"><span style="color:#C678DD;">            with</span><span style="color:#ABB2BF;"> zipfile.</span><span style="color:#61AFEF;">ZipFile</span><span style="color:#ABB2BF;">(target_file, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> zip_ref:</span></span>
<span class="line"><span style="color:#ABB2BF;">                zip_ref.</span><span style="color:#61AFEF;">extractall</span><span style="color:#ABB2BF;">(download_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">            os.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">(target_file)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;删包&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            os.</span><span style="color:#61AFEF;">chmod</span><span style="color:#ABB2BF;">(chrome_path, </span><span style="color:#C678DD;">0o</span><span style="color:#D19A66;">755</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;解压安装完成&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    elif</span><span style="color:#ABB2BF;"> platform.</span><span style="color:#61AFEF;">system</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;Darwin&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#98C379;"> &#39;mac&#39;</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#98C379;"> &#39;unknown&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> initql</span><span style="color:#ABB2BF;">():        </span><span style="color:#7F848E;font-style:italic;">#初始化青龙并获取青龙的token</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> qlip  </span><span style="color:#7F848E;font-style:italic;"># 声明这个是全局变量</span></span>
<span class="line"><span style="color:#ABB2BF;">    client_id </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span><span style="color:#7F848E;font-style:italic;">   #初始化变量</span></span>
<span class="line"><span style="color:#ABB2BF;">    client_secret </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span><span style="color:#7F848E;font-style:italic;">   #初始化变量</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(configfile, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:    </span><span style="color:#7F848E;font-style:italic;">#用UTF-8编码方式打开配置文件</span></span>
<span class="line"><span style="color:#ABB2BF;">            lines </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">readlines</span><span style="color:#ABB2BF;">()           </span><span style="color:#7F848E;font-style:italic;">#遍历每一行</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> line </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> lines:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#98C379;"> &#39;qlip=&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> line:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    qlip </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;qlip=&#39;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()         </span><span style="color:#7F848E;font-style:italic;">#找配置文件中qlip=的值并赋予qlip</span></span>
<span class="line"><span style="color:#C678DD;">                elif</span><span style="color:#98C379;"> &#39;client_id=&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> line:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    client_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;client_id=&#39;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()       </span><span style="color:#7F848E;font-style:italic;">#同上</span></span>
<span class="line"><span style="color:#C678DD;">                elif</span><span style="color:#98C379;"> &#39;client_secret=&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> line:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    client_secret </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;client_secret=&#39;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()     </span><span style="color:#7F848E;font-style:italic;">#同上</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> qlip </span><span style="color:#C678DD;">or</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> client_id </span><span style="color:#C678DD;">or</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> client_secret:         </span><span style="color:#7F848E;font-style:italic;">#如果没有三个参数变量没有值，就报下面的错误，单个检测报错</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> qlip:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;青龙IP配置出错，请确认配置文件&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待10秒，等待</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> client_id:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;青龙client_id配置出错，请确认配置文件&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待10秒，等待</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> client_secret:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;青龙client_secret配置出错，请确认配置文件&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待10秒，等待</span></span>
<span class="line"><span style="color:#C678DD;">            raise</span><span style="color:#ABB2BF;"> SystemExit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:                </span><span style="color:#7F848E;font-style:italic;">#获取青龙的token</span></span>
<span class="line"><span style="color:#C678DD;">            async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">qlip</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/open/auth/token?client_id=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">client_id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&amp;client_secret=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">client_secret</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:</span></span>
<span class="line"><span style="color:#ABB2BF;">                dicts </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;已连接青龙容器...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> dicts[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;token&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;连接青龙发生异常，请确认配置文件：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待10秒，等待</span></span>
<span class="line"><span style="color:#C678DD;">        raise</span><span style="color:#ABB2BF;"> SystemExit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> qlenvs</span><span style="color:#ABB2BF;">():   </span><span style="color:#7F848E;font-style:italic;">#获取青龙全部jdck变量</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:                              </span><span style="color:#7F848E;font-style:italic;"># 异步操作命令</span></span>
<span class="line"><span style="color:#ABB2BF;">            url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">qlip</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/open/envs?searchValue=&quot;</span><span style="color:#7F848E;font-style:italic;">                   #设置设置连接</span></span>
<span class="line"><span style="color:#ABB2BF;">            headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;Authorization&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Bearer &#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> qltoken}                         </span><span style="color:#7F848E;font-style:italic;">#设置api的headers请求头</span></span>
<span class="line"><span style="color:#C678DD;">            async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:                              </span><span style="color:#7F848E;font-style:italic;">#获取变量请求</span></span>
<span class="line"><span style="color:#ABB2BF;">                rjson </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()                             </span><span style="color:#7F848E;font-style:italic;">#解析返回的json数据</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:                                </span><span style="color:#7F848E;font-style:italic;">#如果返回code200,根据青龙api文档</span></span>
<span class="line"><span style="color:#ABB2BF;">                    jd_cookie_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [env </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> env </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> env.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;JD_COOKIE&#39;</span><span style="color:#ABB2BF;">]            </span><span style="color:#7F848E;font-style:italic;">#获取全部jd的变量</span></span>
<span class="line"><span style="color:#C678DD;">                    global</span><span style="color:#ABB2BF;"> notess      </span><span style="color:#7F848E;font-style:italic;">#把备注设置为全部变量</span></span>
<span class="line"><span style="color:#ABB2BF;">                    notess </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [env[</span><span style="color:#98C379;">&#39;remarks&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> env </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> env.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;JD_COOKIE&#39;</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> env.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;status&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">]             </span><span style="color:#7F848E;font-style:italic;">#找到所有name为JD_COOKIE，status为0的字典列表，然后把remarks的值放进notess</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    #global jdckpasswd      #把账号密码变量设为全局变量</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    #jdckpasswd = next((env[&#39;value&#39;].strip().split(&#39;\\n&#39;) for env in rjson[&#39;data&#39;] if env.get(&#39;name&#39;) == &#39;jdckpasswd&#39;), None)      #获取账号密码变量</span></span>
<span class="line"><span style="color:#C678DD;">                    global</span><span style="color:#ABB2BF;"> proxy_server      </span><span style="color:#7F848E;font-style:italic;">#把代理变量设为全局变量</span></span>
<span class="line"><span style="color:#ABB2BF;">                    proxy_server </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> next</span><span style="color:#ABB2BF;">((env[</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> env </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> env.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;AutoJDCK_DP&#39;</span><span style="color:#ABB2BF;">), </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)      </span><span style="color:#7F848E;font-style:italic;">#获取代理变量</span></span>
<span class="line"><span style="color:#C678DD;">                    return</span><span style="color:#ABB2BF;"> jd_cookie_data</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;获取环境变量失败：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rjson[</span><span style="color:#98C379;">&#39;message&#39;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;获取环境变量失败：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> push_message</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">qltoken</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">notes</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    js_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;JdckNotify.js&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    push_data </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">const notify = require(&#39;./sendNotify&#39;)</span></span>
<span class="line"><span style="color:#98C379;">const message = [&quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;"> 账号需要验证登录&quot;];</span></span>
<span class="line"><span style="color:#98C379;">notify.sendNotify(\`JDCK登录验证通知\`, message)</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(notes)       </span><span style="color:#7F848E;font-style:italic;">#脚本内容，{}是notes变量内容</span></span>
<span class="line"><span style="color:#ABB2BF;">    data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">        &quot;filename&quot;</span><span style="color:#ABB2BF;">: js_file,</span></span>
<span class="line"><span style="color:#98C379;">        &quot;path&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;./&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">        &quot;content&quot;</span><span style="color:#ABB2BF;">: push_data    </span><span style="color:#7F848E;font-style:italic;">#脚本内容，如上push_data</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:                             </span><span style="color:#7F848E;font-style:italic;">#推送运行脚本</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">qlip</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/open/scripts/run&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;Authorization&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Bearer &#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> qltoken}, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:            </span><span style="color:#7F848E;font-style:italic;">#更新变量的api</span></span>
<span class="line"><span style="color:#ABB2BF;">                rjson </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;推送验证通知&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;推送验证通知失败,请检查青龙应用《脚本管理》权限&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;推送验证通知失败,请检查青龙连接状态和应用《脚本管理》权限&#39;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> logon_main</span><span style="color:#ABB2BF;">():             </span><span style="color:#7F848E;font-style:italic;">#读取配置文件账户密码，登录</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> qltoken   </span><span style="color:#7F848E;font-style:italic;">#初始化青龙获取青龙ck</span></span>
<span class="line"><span style="color:#ABB2BF;">    qltoken </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> initql</span><span style="color:#ABB2BF;">()      </span><span style="color:#7F848E;font-style:italic;">#初始化青龙token</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> envs               </span><span style="color:#7F848E;font-style:italic;">#青龙环境全局变量</span></span>
<span class="line"><span style="color:#ABB2BF;">    envs </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> qlenvs</span><span style="color:#ABB2BF;">()   </span><span style="color:#7F848E;font-style:italic;">#获取青龙环境变量(仅JC_COOKIE)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> init_web_display</span><span style="color:#ABB2BF;">()     </span><span style="color:#7F848E;font-style:italic;">#初始化WebDisplay</span></span>
<span class="line"><span style="color:#C678DD;">    global</span><span style="color:#ABB2BF;"> asgs</span></span>
<span class="line"><span style="color:#ABB2BF;">    asgs </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> init_proxy_server</span><span style="color:#ABB2BF;">()   </span><span style="color:#7F848E;font-style:italic;">#初始化登录代理（浏览器args的值）</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(configfile, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> jdckpasswd:</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> line </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> jdckpasswd:    </span><span style="color:#7F848E;font-style:italic;"># 去除行尾的换行符</span></span>
<span class="line"><span style="color:#ABB2BF;">            line </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line.</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            userdata </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;#&#39;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;"># 使用&#39;#&#39;分割字符串</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(userdata) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 3</span><span style="color:#ABB2BF;">:   </span><span style="color:#7F848E;font-style:italic;">#分为三段，如果不满足3段，则跳过此行</span></span>
<span class="line"><span style="color:#ABB2BF;">                usernum, passwd, notes</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> userdata     </span><span style="color:#7F848E;font-style:italic;"># 解包列表到四个变量，并按照指定格式打印</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> notes </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> notess:        </span><span style="color:#7F848E;font-style:italic;"># 判断是否不存在 &quot;notes&quot; 在 notess 中</span></span>
<span class="line"><span style="color:#C678DD;">                    await</span><span style="color:#61AFEF;"> validate_logon</span><span style="color:#ABB2BF;">(usernum, passwd, notes)   </span><span style="color:#7F848E;font-style:italic;">#登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> get_user_choice</span><span style="color:#ABB2BF;">():            </span><span style="color:#7F848E;font-style:italic;">#短信验证选择</span></span>
<span class="line"><span style="color:#ABB2BF;">    choice </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#ABB2BF;"> choice </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;2&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            choice </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">wait_for</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                asyncio.</span><span style="color:#61AFEF;">get_event_loop</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">run_in_executor</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;需要进行短信验证，回1进行验证，回2不验证：  &quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                timeout</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">120</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> choice </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;2&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;无效输入，请只输入1或2，请重新输入：  &quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> asyncio.TimeoutError:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">输入超时，跳过登陆&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            choice </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;2&#39;</span></span>
<span class="line"><span style="color:#C678DD;">            break</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;发生错误：&quot;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> choice</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> validate_logon</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">usernum</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">passwd</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">notes</span><span style="color:#ABB2BF;">):                                         </span><span style="color:#7F848E;font-style:italic;">#登录操作</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;正在登录 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">notes</span><span style="color:#D19A66;">}</span><span style="color:#D19A66;"> {</span><span style="color:#ABB2BF;">usernum</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 的账号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    browser </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> launch</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#98C379;">        &#39;headless&#39;</span><span style="color:#ABB2BF;">: WebDisplay,  </span><span style="color:#7F848E;font-style:italic;"># 设置为非无头模式，即可视化浏览器界面</span></span>
<span class="line"><span style="color:#98C379;">        &#39;args&#39;</span><span style="color:#ABB2BF;">: asgs,</span></span>
<span class="line"><span style="color:#ABB2BF;">    })</span></span>
<span class="line"><span style="color:#ABB2BF;">    page </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> browser.</span><span style="color:#61AFEF;">newPage</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 打开新页面</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">setViewport</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;width&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">360</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;height&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">640</span><span style="color:#ABB2BF;">})  </span><span style="color:#7F848E;font-style:italic;"># 设置视窗大小</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">goto</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://plogin.m.jd.com/login/login?appid=300&amp;returnurl=https%3A</span><span style="color:#D19A66;">%2F%2F</span><span style="color:#98C379;">m.jd.com</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">&amp;source=wq_passport&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 访问京东登录页面</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> typeuser</span><span style="color:#ABB2BF;">(page, usernum, passwd)        </span><span style="color:#7F848E;font-style:italic;">#进行账号密码登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    should_break </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span><span style="color:#7F848E;font-style:italic;">  #定义下面不停循环</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:                              </span><span style="color:#7F848E;font-style:italic;">#找ck</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">J</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;#searchWrapper&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#61AFEF;"> SubmitCK</span><span style="color:#ABB2BF;">(page, notes)  </span><span style="color:#7F848E;font-style:italic;">#提交ck</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#ABB2BF;"> browser.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;">#关闭浏览器</span></span>
<span class="line"><span style="color:#ABB2BF;">                should_break </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:                              </span><span style="color:#7F848E;font-style:italic;">#检查是不是要短信验证</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">J</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.sub-title&#39;</span><span style="color:#ABB2BF;">):       </span><span style="color:#7F848E;font-style:italic;">#&lt;p data-v-4c407d20=&quot;&quot; class=&quot;sub-title&quot;&gt;选择认证方式&lt;/p&gt;</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#61AFEF;"> push_message</span><span style="color:#ABB2BF;">(qltoken, notes)          </span><span style="color:#7F848E;font-style:italic;">#推送需要验证登陆通知</span></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        choice </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> get_user_choice</span><span style="color:#ABB2BF;">()            </span><span style="color:#7F848E;font-style:italic;">#调用选择函数</span></span>
<span class="line"><span style="color:#C678DD;">                        if</span><span style="color:#ABB2BF;"> choice </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;1&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;正在发送短信验证&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                            await</span><span style="color:#61AFEF;"> duanxin</span><span style="color:#ABB2BF;">(page)    </span><span style="color:#7F848E;font-style:italic;">#调用短信登录函数</span></span>
<span class="line"><span style="color:#C678DD;">                            break</span></span>
<span class="line"><span style="color:#C678DD;">                        elif</span><span style="color:#ABB2BF;"> choice </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;2&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                            await</span><span style="color:#ABB2BF;"> browser.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;">#关闭浏览器</span></span>
<span class="line"><span style="color:#56B6C2;">                            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;不进行验证，跳过此账户登录&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                            should_break </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                            break</span></span>
<span class="line"><span style="color:#C678DD;">                        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;无效的选择&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    except</span><span style="color:#ABB2BF;"> asyncio.TimeoutError:</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;输入超时，跳过登陆&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        should_break </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                        break</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:                              </span><span style="color:#7F848E;font-style:italic;">#检测是否要过滑块</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;small_img&quot;]&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#61AFEF;"> verification</span><span style="color:#ABB2BF;">(page)  </span><span style="color:#7F848E;font-style:italic;">#过滑块</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;captcha_modal&quot;]/div/div[3]/button&#39;</span><span style="color:#ABB2BF;">):             </span><span style="color:#7F848E;font-style:italic;">#点击图片验证，无法过</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3000</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待3秒</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;验证出错，正在重试……&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">reload</span><span style="color:#ABB2BF;">()                  </span><span style="color:#7F848E;font-style:italic;">#刷新浏览器</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#61AFEF;"> typeuser</span><span style="color:#ABB2BF;">(page, usernum, passwd)        </span><span style="color:#7F848E;font-style:italic;">#进行账号密码登录</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> should_break:  </span><span style="color:#7F848E;font-style:italic;">#检查是否停止循环</span></span>
<span class="line"><span style="color:#C678DD;">            break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> typeuser</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">page</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">usernum</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">passwd</span><span style="color:#ABB2BF;">):         </span><span style="color:#7F848E;font-style:italic;">#输入账户密码</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitForSelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.J_ping.planBLogin&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待元素出现</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.J_ping.planBLogin&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 点击密码登录</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">type</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;#username&#39;</span><span style="color:#ABB2BF;">, usernum, {</span><span style="color:#98C379;">&#39;delay&#39;</span><span style="color:#ABB2BF;">: random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">121</span><span style="color:#ABB2BF;">)})  </span><span style="color:#7F848E;font-style:italic;"># 输入用户名，模拟键盘输入延迟</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">type</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;#pwd&#39;</span><span style="color:#ABB2BF;">, passwd, {</span><span style="color:#98C379;">&#39;delay&#39;</span><span style="color:#ABB2BF;">: random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">151</span><span style="color:#ABB2BF;">)})  </span><span style="color:#7F848E;font-style:italic;"># 输入密码，模拟键盘输入延迟</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">))      </span><span style="color:#7F848E;font-style:italic;">#随机等待1-2秒</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.policy_tip-checkbox&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 点击同意</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">))      </span><span style="color:#7F848E;font-style:italic;">#随机等待1-2秒</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.btn.J_ping.btn-active&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 点击登录按钮</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2000</span><span style="color:#ABB2BF;">))      </span><span style="color:#7F848E;font-style:italic;">#随机等待1-2秒</span></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> SubmitCK</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">page</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">notes</span><span style="color:#ABB2BF;">):  </span><span style="color:#7F848E;font-style:italic;">#提交ck</span></span>
<span class="line"><span style="color:#ABB2BF;">    cookies </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">cookies</span><span style="color:#ABB2BF;">()                             </span><span style="color:#7F848E;font-style:italic;">#设置cookeis变量，用于下面的搜索</span></span>
<span class="line"><span style="color:#ABB2BF;">    pt_key </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#7F848E;font-style:italic;">                             #初始化变量</span></span>
<span class="line"><span style="color:#ABB2BF;">    pt_pin </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#7F848E;font-style:italic;">                             #初始化变量</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> cookie </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> cookies:                              </span><span style="color:#7F848E;font-style:italic;">#找所有网页所有的cookie数据</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> cookie[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;pt_key&#39;</span><span style="color:#ABB2BF;">:                             </span><span style="color:#7F848E;font-style:italic;">#找到pt_key的值</span></span>
<span class="line"><span style="color:#ABB2BF;">            pt_key </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cookie[</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">]                             </span><span style="color:#7F848E;font-style:italic;">#把值设置到变量pt_key</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#ABB2BF;"> cookie[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;pt_pin&#39;</span><span style="color:#ABB2BF;">:                             </span><span style="color:#7F848E;font-style:italic;">#找到pt_pin的值</span></span>
<span class="line"><span style="color:#ABB2BF;">            pt_pin </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cookie[</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">]                             </span><span style="color:#7F848E;font-style:italic;">#把值设置到变量pt_pin</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;"> 登录成功 pt_key=</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">;pt_pin=</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">;&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(notes, pt_key, pt_pin))    </span><span style="color:#7F848E;font-style:italic;"># 打印 pt_key 和 pt_pin 值</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;jdck.log&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;a+&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:    </span><span style="color:#7F848E;font-style:italic;">#打开文件</span></span>
<span class="line"><span style="color:#ABB2BF;">        content </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;</span><span style="color:#D19A66;">{}</span><span style="color:#D19A66;">   {}</span><span style="color:#98C379;">   pt_key=</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">;pt_pin=</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&#39;</span><span style="color:#ABB2BF;">), notes, pt_key, pt_pin)   </span><span style="color:#7F848E;font-style:italic;"># 构造要写入文件的字符串</span></span>
<span class="line"><span style="color:#E06C75;">        file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(content)  </span><span style="color:#7F848E;font-style:italic;"># 写入文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    found_ddhhs </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span><span style="color:#7F848E;font-style:italic;">                             #初始化循环变量，用于后面找不到变量的解决方式</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> env </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> envs:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> notes </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> env[</span><span style="color:#98C379;">&quot;remarks&quot;</span><span style="color:#ABB2BF;">]:      </span><span style="color:#7F848E;font-style:italic;">#在所有变量值中找remarks，找到执行下面的更新ck</span></span>
<span class="line"><span style="color:#ABB2BF;">            envid </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> env[</span><span style="color:#98C379;">&quot;id&quot;</span><span style="color:#ABB2BF;">]                             </span><span style="color:#7F848E;font-style:italic;">#把找到的id设为envid的变量值</span></span>
<span class="line"><span style="color:#ABB2BF;">            remarks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> env[</span><span style="color:#98C379;">&quot;remarks&quot;</span><span style="color:#ABB2BF;">]                             </span><span style="color:#7F848E;font-style:italic;">#同上</span></span>
<span class="line"><span style="color:#ABB2BF;">            found_ddhhs </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span><span style="color:#7F848E;font-style:italic;">                             #把变量设为True，停下循环</span></span>
<span class="line"><span style="color:#ABB2BF;">            data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">                &#39;name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;JD_COOKIE&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;value&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;pt_key=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">pt_key</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">;pt_pin=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">pt_pin</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">;&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;remarks&quot;</span><span style="color:#ABB2BF;">: remarks,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;id&quot;</span><span style="color:#ABB2BF;">: envid,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }                             </span><span style="color:#7F848E;font-style:italic;">#提交青龙的数据</span></span>
<span class="line"><span style="color:#C678DD;">            async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:                             </span><span style="color:#7F848E;font-style:italic;">#下面是提交</span></span>
<span class="line"><span style="color:#ABB2BF;">                url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">qlip</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/open/envs&quot;</span></span>
<span class="line"><span style="color:#C678DD;">                async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;Authorization&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Bearer &#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> qltoken}, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:            </span><span style="color:#7F848E;font-style:italic;">#更新变量的api</span></span>
<span class="line"><span style="color:#ABB2BF;">                    rjson </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        url2 </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">qlip</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/open/envs/enable&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        data2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">                            envid</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ]</span></span>
<span class="line"><span style="color:#C678DD;">                        async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(url2, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;Authorization&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Bearer &#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> qltoken}, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data2) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:            </span><span style="color:#7F848E;font-style:italic;">#启用变量的api</span></span>
<span class="line"><span style="color:#ABB2BF;">                            rjson2 </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                            if</span><span style="color:#ABB2BF;"> rjson2[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;更新</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">notes</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">环境变量成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                                return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;启用</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">notes</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">环境变量失败：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rjson[</span><span style="color:#98C379;">&#39;message&#39;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                                return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">                    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;更新</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">notes</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">环境变量失败：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rjson[</span><span style="color:#98C379;">&#39;message&#39;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                        return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> found_ddhhs:          </span><span style="color:#7F848E;font-style:italic;">#如果没找到pt_pin，执行下面的新建ck，以下同上，只是新建不是更新</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#98C379;">                &#39;name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;JD_COOKIE&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;value&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;pt_key=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">pt_key</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">;pt_pin=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">pt_pin</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">;&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;remarks&quot;</span><span style="color:#ABB2BF;">: notes,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        ]</span></span>
<span class="line"><span style="color:#C678DD;">        async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:</span></span>
<span class="line"><span style="color:#ABB2BF;">            url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">qlip</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/open/envs&quot;</span></span>
<span class="line"><span style="color:#C678DD;">            async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;Authorization&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Bearer &#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> qltoken}, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:</span></span>
<span class="line"><span style="color:#ABB2BF;">                rjson </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> rjson[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;新建</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">notes</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">环境变量成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;新建</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">notes</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">环境变量失败：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rjson[</span><span style="color:#98C379;">&#39;message&#39;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                    return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> get_verification_code</span><span style="color:#ABB2BF;">():  </span><span style="color:#7F848E;font-style:italic;"># 交互输入验证码</span></span>
<span class="line"><span style="color:#ABB2BF;">    code </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        code </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;验证码已发送，请输入验证码: &quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(code) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 6</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> code.</span><span style="color:#61AFEF;">isdigit</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">            break</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入6位数字作为验证码，请重新输入。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> code</span></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> duanxin</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">page</span><span style="color:#ABB2BF;">):   </span><span style="color:#7F848E;font-style:italic;">#短信验证函数</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitForXPath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/div[2]/span/a&#39;</span><span style="color:#ABB2BF;">)   </span><span style="color:#7F848E;font-style:italic;">#等手机短信认证元素  //*[@id=&quot;app&quot;]/div/div[2]</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)      </span><span style="color:#7F848E;font-style:italic;">#随机等待1-3秒</span></span>
<span class="line"><span style="color:#ABB2BF;">        elements </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/div[2]/span/a&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 选择元素</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> elements[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 点击元素</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitForXPath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/div[2]/button&#39;</span><span style="color:#ABB2BF;">)   </span><span style="color:#7F848E;font-style:italic;">#等获取验证码元素</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)      </span><span style="color:#7F848E;font-style:italic;">#随机等待1-3秒</span></span>
<span class="line"><span style="color:#ABB2BF;">        elements </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/div[2]/button&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 选择元素</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> elements[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 点击元素</span></span>
<span class="line"><span style="color:#C678DD;">        await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3000</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待3秒，等待是否要滑块</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:                              </span><span style="color:#7F848E;font-style:italic;">#检测是否要过滑块</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;captcha_modal&quot;]/div/div[3]/div&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">                await</span><span style="color:#61AFEF;"> verification</span><span style="color:#ABB2BF;">(page)  </span><span style="color:#7F848E;font-style:italic;">#过滑块</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitForXPath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/div[2]/div/input&#39;</span><span style="color:#ABB2BF;">)   </span><span style="color:#7F848E;font-style:italic;"># 等待输入框元素出现</span></span>
<span class="line"><span style="color:#ABB2BF;">            code </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> get_verification_code</span><span style="color:#ABB2BF;">()   </span><span style="color:#7F848E;font-style:italic;">#交互输入验证码</span></span>
<span class="line"><span style="color:#ABB2BF;">            input_elements </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/div[2]/div/input&#39;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;"># 选择输入框元素</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> input_elements[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">type</span><span style="color:#ABB2BF;">(code)       </span><span style="color:#7F848E;font-style:italic;"># 输入验证码</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitForXPath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/a[1]&#39;</span><span style="color:#ABB2BF;">)   </span><span style="color:#7F848E;font-style:italic;">#等登录按钮元素</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)      </span><span style="color:#7F848E;font-style:italic;">#随机等待1-3秒</span></span>
<span class="line"><span style="color:#ABB2BF;">            elements </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//*[@id=&quot;app&quot;]/div/div[2]/a[1]&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 选择元素</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> elements[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 点击元素</span></span>
<span class="line"><span style="color:#C678DD;">            await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)      </span><span style="color:#7F848E;font-style:italic;">#随机等待2-3秒</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#C678DD;">            pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> verification</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">page</span><span style="color:#ABB2BF;">):            </span><span style="color:#7F848E;font-style:italic;">#过滑块</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitForSelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;#cpc_img&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    image_src </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">Jeval</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;#cpc_img&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;el =&gt; el.getAttribute(&quot;src&quot;)&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 获取滑块背景图的地址</span></span>
<span class="line"><span style="color:#ABB2BF;">    request.</span><span style="color:#61AFEF;">urlretrieve</span><span style="color:#ABB2BF;">(image_src, </span><span style="color:#98C379;">&#39;image.png&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 下载滑块背景图</span></span>
<span class="line"><span style="color:#ABB2BF;">    width </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">evaluate</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;() =&gt; { return document.getElementById(&quot;cpc_img&quot;).clientWidth; }&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#获取网页的图片尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    height </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">evaluate</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;() =&gt; { return document.getElementById(&quot;cpc_img&quot;).clientHeight; }&#39;</span><span style="color:#ABB2BF;">)   </span><span style="color:#7F848E;font-style:italic;">#获取网页的图片尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;image.png&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#打开图像</span></span>
<span class="line"><span style="color:#ABB2BF;">    resized_image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> image.</span><span style="color:#61AFEF;">resize</span><span style="color:#ABB2BF;">((width, height))</span><span style="color:#7F848E;font-style:italic;"># 调整图像尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    resized_image.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;image.png&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#7F848E;font-style:italic;"># 保存调整后的图像</span></span>
<span class="line"><span style="color:#ABB2BF;">    template_src </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">Jeval</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;#small_img&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;el =&gt; el.getAttribute(&quot;src&quot;)&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 获取滑块图片的地址</span></span>
<span class="line"><span style="color:#ABB2BF;">    request.</span><span style="color:#61AFEF;">urlretrieve</span><span style="color:#ABB2BF;">(template_src, </span><span style="color:#98C379;">&#39;template.png&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 下载滑块图片</span></span>
<span class="line"><span style="color:#ABB2BF;">    width </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">evaluate</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;() =&gt; { return document.getElementById(&quot;small_img&quot;).clientWidth; }&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#获取网页的图片尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    height </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">evaluate</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;() =&gt; { return document.getElementById(&quot;small_img&quot;).clientHeight; }&#39;</span><span style="color:#ABB2BF;">)   </span><span style="color:#7F848E;font-style:italic;">#获取网页的图片尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;template.png&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#打开图像</span></span>
<span class="line"><span style="color:#ABB2BF;">    resized_image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> image.</span><span style="color:#61AFEF;">resize</span><span style="color:#ABB2BF;">((width, height))</span><span style="color:#7F848E;font-style:italic;"># 调整图像尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    resized_image.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;template.png&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#7F848E;font-style:italic;"># 保存调整后的图像</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待1秒，确保图片处理完成</span></span>
<span class="line"><span style="color:#ABB2BF;">    el </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;#captcha_modal &gt; div &gt; div.captcha_footer &gt; div &gt; img&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;"># 定位到滑块按钮</span></span>
<span class="line"><span style="color:#ABB2BF;">    box </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> el.</span><span style="color:#61AFEF;">boundingBox</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#获取滑块按钮信息</span></span>
<span class="line"><span style="color:#ABB2BF;">    distance </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#61AFEF;"> get_distance</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 调用前面定义的get_distance函数计算滑块移动距离</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.mouse.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(box[</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 10</span><span style="color:#ABB2BF;"> , box[</span><span style="color:#98C379;">&#39;y&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.mouse.</span><span style="color:#61AFEF;">down</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 模拟鼠标按下</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.mouse.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(box[</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> distance </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> random.</span><span style="color:#61AFEF;">uniform</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">8</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">25</span><span style="color:#ABB2BF;">), box[</span><span style="color:#98C379;">&#39;y&#39;</span><span style="color:#ABB2BF;">], {</span><span style="color:#98C379;">&#39;steps&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">})  </span><span style="color:#7F848E;font-style:italic;"># 模拟鼠标拖动，考虑到实际操作中可能存在的轻微误差和波动，加入随机偏移量</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">500</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 随机等待一段时间，模仿人类操作的不确定性</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.mouse.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(box[</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> distance, box[</span><span style="color:#98C379;">&#39;y&#39;</span><span style="color:#ABB2BF;">], {</span><span style="color:#98C379;">&#39;steps&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">})  </span><span style="color:#7F848E;font-style:italic;"># 继续拖动滑块到目标位置</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.mouse.</span><span style="color:#61AFEF;">up</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 模拟鼠标释放，完成滑块拖动</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">waitFor</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3000</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待3秒，等待滑块验证结果</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> get_distance</span><span style="color:#ABB2BF;">():   </span><span style="color:#7F848E;font-style:italic;">#图形处理函数</span></span>
<span class="line"><span style="color:#ABB2BF;">    img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">imread</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;image.png&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 读取全屏截图，灰度模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    template </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">imread</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;template.png&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 读取滑块图片，灰度模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">GaussianBlur</span><span style="color:#ABB2BF;">(img, (</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">), </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#图像高斯模糊处理</span></span>
<span class="line"><span style="color:#ABB2BF;">    template </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">GaussianBlur</span><span style="color:#ABB2BF;">(template, (</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">), </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#图像高斯模糊处理</span></span>
<span class="line"><span style="color:#ABB2BF;">    bg_edge </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">Canny</span><span style="color:#ABB2BF;">(img, </span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#识别边缘</span></span>
<span class="line"><span style="color:#ABB2BF;">    cut_edge </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">Canny</span><span style="color:#ABB2BF;">(template, </span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">#识别边缘</span></span>
<span class="line"><span style="color:#ABB2BF;">    img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">cvtColor</span><span style="color:#ABB2BF;">(bg_edge, cv2.</span><span style="color:#D19A66;">COLOR_GRAY2RGB</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#转换图片格式，不知道是啥</span></span>
<span class="line"><span style="color:#ABB2BF;">    template </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">cvtColor</span><span style="color:#ABB2BF;">(cut_edge, cv2.</span><span style="color:#D19A66;">COLOR_GRAY2RGB</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">#转换图片格式，不知道是啥</span></span>
<span class="line"><span style="color:#ABB2BF;">    res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">matchTemplate</span><span style="color:#ABB2BF;">(img, template, cv2.</span><span style="color:#D19A66;">TM_CCOEFF_NORMED</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 使用模板匹配寻找最佳匹配位置</span></span>
<span class="line"><span style="color:#ABB2BF;">    value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cv2.</span><span style="color:#61AFEF;">minMaxLoc</span><span style="color:#ABB2BF;">(res)[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]  </span><span style="color:#7F848E;font-style:italic;"># 获取匹配结果的最小值位置，即为滑块起始位置</span></span>
<span class="line"><span style="color:#ABB2BF;">    distance </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> value </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 10</span><span style="color:#7F848E;font-style:italic;"> # 计算实际滑动距离，这里根据实际页面比例进行调整，+10像素校准算法这傻逼玩意</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> distance</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> init_proxy_server</span><span style="color:#ABB2BF;">():                                             </span><span style="color:#7F848E;font-style:italic;">#初始化代理</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> proxy_server:                 </span><span style="color:#7F848E;font-style:italic;">#如果有配置代理</span></span>
<span class="line"><span style="color:#ABB2BF;">        argszhi </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;--no-sandbox&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;--disable-setuid-sandbox&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;--proxy-server=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">proxy_server[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#7F848E;font-style:italic;">        #设置浏览器参数加了个代理参数</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> argszhi</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        argszhi </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;--no-sandbox&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;--disable-setuid-sandbox&#39;</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> argszhi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> get_latest_version</span><span style="color:#ABB2BF;">():                                             </span><span style="color:#7F848E;font-style:italic;">#获取版本号函数</span></span>
<span class="line"><span style="color:#ABB2BF;">    url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;https://api.github.com/repos/dsmggm/svjdck/releases/latest&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:</span></span>
<span class="line"><span style="color:#C678DD;">            async</span><span style="color:#C678DD;"> with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> response:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> response.status </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    data </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> await</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    tag_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&quot;tag_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;最新版本：&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> tag_name)</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;获取最新版本号失败&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> aiohttp.ClientError </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;最新版本：你网络不行啊老弟，都连不上github，怎么获取最新版本号&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> def</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">():  </span><span style="color:#7F848E;font-style:italic;"># 打开并读取配置文件，主程序</span></span>
<span class="line"><span style="color:#ABB2BF;">    os.</span><span style="color:#61AFEF;">system</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;cls&#39;</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> os.name </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;nt&#39;</span><span style="color:#C678DD;"> else</span><span style="color:#98C379;"> &#39;clear&#39;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;">#清空屏幕</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;**********autojdck自动登陆京东获取ck程序**********&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;注：账户密码已从青龙变量迁移到jdck.ini文件中，在配置文件中进行账密设置&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;脚本需要青龙应用权限——环境变量跟脚本管理&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;项目地址：https://github.com/dsmggm/svjdck&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;当前版本：jdck20240405&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> get_latest_version</span><span style="color:#ABB2BF;">()       </span><span style="color:#7F848E;font-style:italic;">#获取最新版本</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> ifconfigfile</span><span style="color:#ABB2BF;">()    </span><span style="color:#7F848E;font-style:italic;">#检测配置文件并初始化</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> init_chrome</span><span style="color:#ABB2BF;">()     </span><span style="color:#7F848E;font-style:italic;">#检测初始化chrome</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> logon_main</span><span style="color:#ABB2BF;">()    </span><span style="color:#7F848E;font-style:italic;">#登录操作，写入ck到文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    os.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;image.png&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;image.png&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">else</span><span style="color:#D19A66;"> None</span><span style="color:#7F848E;font-style:italic;">     #删除缓存照片</span></span>
<span class="line"><span style="color:#ABB2BF;">    os.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;template.png&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;template.png&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">else</span><span style="color:#D19A66;"> None</span><span style="color:#7F848E;font-style:italic;">     #删除缓存照片</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> print_message</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;完成全部登录&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 等待10秒，等待</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">asyncio.</span><span style="color:#61AFEF;">get_event_loop</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">run_until_complete</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">())  </span><span style="color:#7F848E;font-style:italic;">#使用异步I/O循环运行main()函数，启动整个自动登录和滑块验证流程。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br></div></div><h3 id="脚本说明" tabindex="-1">脚本说明： <a class="header-anchor" href="#脚本说明" aria-label="Permalink to &quot;脚本说明：&quot;">​</a></h3><p>1、脚本用于使用账号密码自动登录京东获取 ck，自动更新 ck 到青龙</p><p>2、建议本地登录，不建议使用代理，第一次使用手机验证码之后一般不需要验证码就可以密码登录</p><p>3、程序仅更新被禁用的 ck</p><p>4、脚本有 py 源码以及 windows 版本 exe 程序</p><p>5、py 脚本需要 opencv-python、pyppeteer、Pillow、asyncio、aiohttp 等依赖</p><p>6、linux 需要桌面环境，比如 gnome 用于图形处理</p><p>7、第一次使用会下载 chrome 浏览器，生成 jdck.ini 配置文件，等待即可，后续无需等待</p><p>8、此脚本适合于青龙内部运行，因青龙大部分不支持 opencv 插件，仅支持 linux 以及 windows 运行，建议使用 windows 版本，定时运行即可。</p><p>9、脚本基于 python3.12.1 编写，目前 3.11 可以正常使用，其它版本未测试</p><p>10、脚本需要青龙应用权限——环境变量跟脚本管理</p><h1 id="某星球预约抢票脚本" tabindex="-1">某星球预约抢票脚本 <a class="header-anchor" href="#某星球预约抢票脚本" aria-label="Permalink to &quot;某星球预约抢票脚本&quot;">​</a></h1><p><strong>代码如下</strong>：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> asyncio</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> remove_duplicates</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">dict_list</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    seen </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> set</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    new_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> d </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> dict_list:</span></span>
<span class="line"><span style="color:#ABB2BF;">        frozen_dict </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> frozenset</span><span style="color:#ABB2BF;">(d.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> frozen_dict </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> seen:</span></span>
<span class="line"><span style="color:#ABB2BF;">            seen.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(frozen_dict)</span></span>
<span class="line"><span style="color:#ABB2BF;">            new_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(d)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> new_list</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> PxqShowMonitor</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.http </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">Session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        ua </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) &#39;</span></span>
<span class="line"><span style="color:#98C379;">              &#39;Version/16.6 Mobile/15E148 Safari/604.1&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.http.headers.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#98C379;">            &#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: ua,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Src&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;H5&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;Terminal-Src&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;H5&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.api_src </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;H5&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.api_ver </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;4.3.5-20240408181716&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_city_list</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://m.xxxx.com/cyy_gatewayapi/home/pub/v3/citys&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">                &#39;src&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.api_src,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;ver&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.api_ver</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">            response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.http.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params)</span></span>
<span class="line"><span style="color:#ABB2BF;">            data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            city_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;allCities&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                city_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;city_id&#39;</span><span style="color:#ABB2BF;">: item[</span><span style="color:#98C379;">&#39;cities&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;cityId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;city_name&#39;</span><span style="color:#ABB2BF;">: item[</span><span style="color:#98C379;">&#39;cities&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;cityName&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">                    &#39;site_id&#39;</span><span style="color:#ABB2BF;">: item[</span><span style="color:#98C379;">&#39;cities&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;siteId&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#ABB2BF;">                })</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> city_list</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;获取城市列表失败, </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e.args</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_show_list</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">city_id</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        获取即将开抢的演唱会列表</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://m.xxxxx.com/cyy_gatewayapi/home/pub/v3/floors&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">                &#39;src&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.api_src,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;ver&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.api_ver,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;cityId&#39;</span><span style="color:#ABB2BF;">: city_id</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">            response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.http.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params)</span></span>
<span class="line"><span style="color:#ABB2BF;">            data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            show_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> show </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> item[</span><span style="color:#98C379;">&#39;rooms&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;items&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#98C379;"> &#39;latestSaleTime&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> show:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        show_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(show)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#ABB2BF;"> show_list</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;获取演出失败:</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e.args</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        city_list </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_city_list</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> city_list:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;获取城市列表失败, 退出程序...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        all_show_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> city </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> city_list:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;正在获取</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">即将开抢的演唱会列表...&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(city[</span><span style="color:#98C379;">&#39;city_name&#39;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">            show_list </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_show_list</span><span style="color:#ABB2BF;">(city[</span><span style="color:#98C379;">&#39;city_id&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">,获取到</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">个演唱会&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(city[</span><span style="color:#98C379;">&#39;city_name&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(show_list)))</span></span>
<span class="line"><span style="color:#ABB2BF;">            all_show_list.</span><span style="color:#61AFEF;">extend</span><span style="color:#ABB2BF;">(show_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        show_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> all_show_list:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 计算三天后的日期时间对象</span></span>
<span class="line"><span style="color:#ABB2BF;">            three_days_later </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> datetime.</span><span style="color:#61AFEF;">timedelta</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">days</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 将三天后的日期时间对象转换为毫秒时间戳</span></span>
<span class="line"><span style="color:#ABB2BF;">            three_days_later_timestamp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> three_days_later.</span><span style="color:#61AFEF;">timestamp</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> item.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;saleTime&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> item[</span><span style="color:#98C379;">&#39;saleTime&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> three_days_later_timestamp:</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> item.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;saleTime&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                sale_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> datetime.datetime.</span><span style="color:#61AFEF;">fromtimestamp</span><span style="color:#ABB2BF;">(item[</span><span style="color:#98C379;">&#39;saleTime&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">/</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                sale_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> item[</span><span style="color:#98C379;">&#39;latestSaleTime&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            show_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#98C379;">                &#39;city_name&#39;</span><span style="color:#ABB2BF;">: item[</span><span style="color:#98C379;">&#39;cityName&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">                &#39;show_name&#39;</span><span style="color:#ABB2BF;">: item[</span><span style="color:#98C379;">&#39;title&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#98C379;">                &#39;sale_time&#39;</span><span style="color:#ABB2BF;">: sale_time,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;id&#39;</span><span style="color:#ABB2BF;">: item[</span><span style="color:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            })</span></span>
<span class="line"><span style="color:#ABB2BF;">        unique_dict_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">(t) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> t </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> {</span><span style="color:#56B6C2;">tuple</span><span style="color:#ABB2BF;">(d.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">()) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> d </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> show_list}]</span></span>
<span class="line"><span style="color:#ABB2BF;">        msg </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;### 近期开售的演出列表: </span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> unique_dict_list:</span></span>
<span class="line"><span style="color:#ABB2BF;">            msg </span><span style="color:#56B6C2;">+=</span><span style="color:#98C379;"> &#39;- </span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">(id:</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">), 开售时间:</span><span style="color:#D19A66;">{}</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(item[</span><span style="color:#98C379;">&#39;show_name&#39;</span><span style="color:#ABB2BF;">], item[</span><span style="color:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;">], item[</span><span style="color:#98C379;">&#39;sale_time&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> msg</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> server_jiang_notify</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">key</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">title</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">msg</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        :param key:</span></span>
<span class="line"><span style="color:#98C379;">        :param title:</span></span>
<span class="line"><span style="color:#98C379;">        :param msg:</span></span>
<span class="line"><span style="color:#98C379;">        :return:</span></span>
<span class="line"><span style="color:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;https://sctapi.ftqq.com/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">key</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.send&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">            &#39;title&#39;</span><span style="color:#ABB2BF;">: title,</span></span>
<span class="line"><span style="color:#98C379;">            &#39;desp&#39;</span><span style="color:#ABB2BF;">: msg,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(url, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;发送通知失败, </span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()[</span><span style="color:#98C379;">&#39;message&#39;</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;发送通知失败:</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e.args</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    app </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PxqShowMonitor</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    message </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> app.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;README.md&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">        content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> f.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">sub</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&lt;!-- SHOW_START --&gt;([\\s\\S]*?)&lt;!-- SHOW_END --&gt;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;">                     f</span><span style="color:#98C379;">&#39;&lt;!-- SHOW_START --&gt;</span><span style="color:#56B6C2;">\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">message</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&lt;!-- SHOW_END --&gt;&#39;</span><span style="color:#ABB2BF;">, content)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;README.md&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">        f.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(content)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">    main</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br></div></div><p><strong>说明</strong></p><p>本文的 Python 脚本是一个自动化工具，用于监控即将开售的演出票务信息，并更新一个 Markdown 文件(<code>README.md</code>)来显示即将开售的演出列表。它利用了网络请求来获取信息，并对数据进行了处理和格式化，最后通过特定的 API 发送通知。让我们逐步分析这段代码的主要功能和组成部分。</p><p><strong>类和函数</strong></p><p>PxqShowMonitor 类</p><p>- 初始化：设置 HTTP 会话头部，包括用户代理和 API 版本。</p><p>- get_city_list 方法：获取一个城市列表，每个城市具有 ID 和名称，从预设的 URL 获取数据。</p><p>- get_show_list 方法：根据城市 ID 获取该城市即将开售的演出列表，筛选出包含<code>latestSaleTime</code>的演出。</p><p>- run 方法：主要的执行流程，获取所有城市的演出列表，筛选出三天内即将开售的演出，并去重，然后格式化成消息字符串。</p><p><strong>辅助函数</strong></p><p>- remove_duplicate：从列表中移除重复的字典项。</p><p>- server_jiang_notify：发送通知到 Server 酱，一个常用于微信消息推送的服务。</p><p>- main<code> 函数：实例化</code>PxqShowMonitor<code>，运行并获取消息，然后将消息插入到</code>README.md\`的指定部分。</p><p><strong>工作流程</strong></p><ol><li>初始化：创建<code>PxqShowMonitor</code>实例，配置必要的 HTTP 头部信息。</li><li>获取数据：首先获取城市列表，然后遍历每个城市获取即将开售的演出信息。</li><li>数据处理：对获取的演出数据进行过滤，只保留三天内开始售票的演出，并进行去重处理。</li><li>消息格式化：将筛选后的演出信息格式化为 Markdown 文本。</li><li>更新文件：使用正则表达式更新<code>README.md</code>文件中的特定部分。</li><li>发送通知：可选地通过 Server 酱发送通知。</li></ol><p><strong>应用场景</strong></p><p>这个脚本可以用于自动化监控票务网站上即将开售的演出信息，为用户提供及时的更新，非常适合那些需要第一时间抢购演出票的用户。此外，它还可以被集成到更大的系统中，提供定时任务运行，自动更新信息和通知用户。</p><p><strong>总结</strong></p><p>此脚本是一个自动化的工具，通过集成多个服务和处理步骤来实现一个完整的业务流程：从获取数据到处理、展示和通知。它展示了 Python 在数据抓取、处理和自动化方面的强大能力，尤其是在处理网络数据和自动化文件操作方面。</p><p><strong>注意</strong>：</p><p>本文部分变量已做脱敏处理，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。技术层面需要提供帮助，可以通过打赏的方式进行探讨。</p><h1 id="简单算命脚本" tabindex="-1">简单算命脚本 <a class="header-anchor" href="#简单算命脚本" aria-label="Permalink to &quot;简单算命脚本&quot;">​</a></h1><h3 id="效果展示" tabindex="-1">效果展示 <a class="header-anchor" href="#效果展示" aria-label="Permalink to &quot;效果展示&quot;">​</a></h3><p><img src="`+o+`" alt="图片"></p><h3 id="文件内容" tabindex="-1">文件内容 <a class="header-anchor" href="#文件内容" aria-label="Permalink to &quot;文件内容&quot;">​</a></h3><h4 id="main-py-文件内容" tabindex="-1">main.py 文件内容 <a class="header-anchor" href="#main-py-文件内容" aria-label="Permalink to &quot;main.py 文件内容&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 别挂配置数据</span></span>
<span class="line"><span style="color:#ABB2BF;">gua_data_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;data.json&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 别卦数据</span></span>
<span class="line"><span style="color:#ABB2BF;">gua_data_map </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">fake_delay </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 10</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 读取别卦数据</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> init_gua_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">json_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(gua_data_path, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> fp:</span></span>
<span class="line"><span style="color:#C678DD;">        global</span><span style="color:#ABB2BF;"> gua_data_map</span></span>
<span class="line"><span style="color:#ABB2BF;">        gua_data_map </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">(fp)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 爻图标映射</span></span>
<span class="line"><span style="color:#ABB2BF;">yao_icon_map </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D19A66;">    0</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;- -&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">    1</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;---&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 经卦名</span></span>
<span class="line"><span style="color:#ABB2BF;">base_gua_name_map </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D19A66;">    0</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;坤&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;震&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;坎&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;兑&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;艮&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;离&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;巽&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;乾&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 数字转化为二进制数组</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> base_gua_to_yao</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">gua</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">yao_length</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#ABB2BF;"> gua </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        level </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> gua </span><span style="color:#56B6C2;">%</span><span style="color:#D19A66;"> 2</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> else</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">        gua </span><span style="color:#56B6C2;">//=</span><span style="color:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#ABB2BF;">        result.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(level)</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(result) </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> yao_length:</span></span>
<span class="line"><span style="color:#ABB2BF;">        result.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> result</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 二进制数组转化为数字</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">array</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    array </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> array[:]</span></span>
<span class="line"><span style="color:#C678DD;">    while</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(array) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> array[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        array.</span><span style="color:#61AFEF;">pop</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    result </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(array)):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> array[i] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            continue</span></span>
<span class="line"><span style="color:#ABB2BF;">        result </span><span style="color:#56B6C2;">+=</span><span style="color:#56B6C2;"> pow</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> result</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 打印一个挂</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> print_gua</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">gua</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_gua_to_yao</span><span style="color:#ABB2BF;">(gua, </span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> yao_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    up </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(up_yao_list)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(yao_icon_map[up_yao_list[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(yao_icon_map[up_yao_list[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]] </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot; &quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> base_gua_name_map[up])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(yao_icon_map[up_yao_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    down_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> yao_list[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    down </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(down_yao_list)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(yao_icon_map[down_yao_list[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(yao_icon_map[down_yao_list[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]] </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot; &quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> base_gua_name_map[down])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(yao_icon_map[down_yao_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]])</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用梅花易数</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> calculate_with_plum_flower</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 起上卦</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;使用梅花易数♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️♣️&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    print_a_wait_animation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;卜上卦：&quot;</span><span style="color:#ABB2BF;">, fake_delay)</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_base_gua </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">%</span><span style="color:#D19A66;"> 8</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_yao_array </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_gua_to_yao</span><span style="color:#ABB2BF;">(up_base_gua)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;上卦获取成功,上卦为:&quot;</span><span style="color:#ABB2BF;">, base_gua_name_map[up_base_gua])</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 起下卦</span></span>
<span class="line"><span style="color:#61AFEF;">    print_a_wait_animation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;正在获取下卦：&quot;</span><span style="color:#ABB2BF;">, fake_delay)</span></span>
<span class="line"><span style="color:#ABB2BF;">    down_base_gua </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">999999999999</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">%</span><span style="color:#D19A66;"> 8</span></span>
<span class="line"><span style="color:#ABB2BF;">    down_yao_array </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_gua_to_yao</span><span style="color:#ABB2BF;">(down_base_gua)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;上卦获取成功,下卦为:&quot;</span><span style="color:#ABB2BF;">, base_gua_name_map[down_base_gua])</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 组成卦象</span></span>
<span class="line"><span style="color:#61AFEF;">    print_a_wait_animation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;正在组成本卦：&quot;</span><span style="color:#ABB2BF;">, fake_delay)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;------------------------------------------------本卦------------------------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> up_yao_array </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> down_yao_array</span></span>
<span class="line"><span style="color:#ABB2BF;">    gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(yao_list)</span></span>
<span class="line"><span style="color:#61AFEF;">    print_gua</span><span style="color:#ABB2BF;">(gua)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 读取本卦象信息</span></span>
<span class="line"><span style="color:#ABB2BF;">    gua_code </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(base_gua_name_map[up_base_gua]) </span><span style="color:#56B6C2;">+</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(base_gua_name_map[down_base_gua])</span></span>
<span class="line"><span style="color:#ABB2BF;">    gua_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> gua_data_map[gua_code]</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;本卦为:&quot;</span><span style="color:#ABB2BF;">, gua_data[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;辞:&quot;</span><span style="color:#ABB2BF;">, gua_data[</span><span style="color:#98C379;">&#39;words&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;译:&quot;</span><span style="color:#ABB2BF;">, gua_data[</span><span style="color:#98C379;">&#39;white_words&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;象:&quot;</span><span style="color:#ABB2BF;">, gua_data[</span><span style="color:#98C379;">&#39;picture&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;译:&quot;</span><span style="color:#ABB2BF;">, gua_data[</span><span style="color:#98C379;">&#39;white_picture&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#61AFEF;">    print_a_wait_animation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;正在组成互卦：&quot;</span><span style="color:#ABB2BF;">, fake_delay)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;------------------------------------------------互卦------------------------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 读取互卦象信息</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_hu_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [yao_list[</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">], yao_list[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">], yao_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_hu_gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(up_hu_yao_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">    down_hu_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [yao_list[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">], yao_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">], yao_list[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"><span style="color:#ABB2BF;">    down_hu_gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(down_hu_yao_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">    hu_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> up_hu_yao_list </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> down_hu_yao_list</span></span>
<span class="line"><span style="color:#ABB2BF;">    hu_gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(hu_yao_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">    hu_gua_code </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(base_gua_name_map[up_hu_gua]) </span><span style="color:#56B6C2;">+</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(base_gua_name_map[down_hu_gua])</span></span>
<span class="line"><span style="color:#ABB2BF;">    hu_gua_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> gua_data_map[hu_gua_code]</span></span>
<span class="line"><span style="color:#61AFEF;">    print_gua</span><span style="color:#ABB2BF;">(hu_gua)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;互卦为:&quot;</span><span style="color:#ABB2BF;">, hu_gua_data[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;辞:&quot;</span><span style="color:#ABB2BF;">, hu_gua_data[</span><span style="color:#98C379;">&#39;words&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;译:&quot;</span><span style="color:#ABB2BF;">, hu_gua_data[</span><span style="color:#98C379;">&#39;white_words&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;象:&quot;</span><span style="color:#ABB2BF;">, hu_gua_data[</span><span style="color:#98C379;">&#39;picture&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;译:&quot;</span><span style="color:#ABB2BF;">, hu_gua_data[</span><span style="color:#98C379;">&#39;white_picture&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#61AFEF;">    print_a_wait_animation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;正在组成变卦：&quot;</span><span style="color:#ABB2BF;">, fake_delay)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;------------------------------------------------变卦------------------------------------------------&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    change_index </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">%</span><span style="color:#D19A66;"> 6</span></span>
<span class="line"><span style="color:#ABB2BF;">    change_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> yao_list[:]</span></span>
<span class="line"><span style="color:#ABB2BF;">    change_yao_list[change_index] </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> change_yao_list[change_index] </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#C678DD;"> else</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_change_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> change_yao_list[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    up_change_gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(up_change_yao_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">    down_change_yao_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> change_yao_list[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    down_change_gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(down_change_yao_list)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    change_gua </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> base_yao_to_gua</span><span style="color:#ABB2BF;">(change_yao_list)</span></span>
<span class="line"><span style="color:#61AFEF;">    print_gua</span><span style="color:#ABB2BF;">(change_gua)</span></span>
<span class="line"><span style="color:#ABB2BF;">    change_gua_code </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(base_gua_name_map[up_change_gua]) </span><span style="color:#56B6C2;">+</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(base_gua_name_map[down_change_gua])</span></span>
<span class="line"><span style="color:#ABB2BF;">    change_gua_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> gua_data_map[change_gua_code]</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;变卦为:&quot;</span><span style="color:#ABB2BF;">, change_gua_data[</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;辞:&quot;</span><span style="color:#ABB2BF;">, change_gua_data[</span><span style="color:#98C379;">&#39;words&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;译:&quot;</span><span style="color:#ABB2BF;">, change_gua_data[</span><span style="color:#98C379;">&#39;white_words&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;象:&quot;</span><span style="color:#ABB2BF;">, change_gua_data[</span><span style="color:#98C379;">&#39;picture&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;译:&quot;</span><span style="color:#ABB2BF;">, change_gua_data[</span><span style="color:#98C379;">&#39;white_picture&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> print_a_wait_animation</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">tips</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">times</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    animation </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;|/-</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    idx </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(times):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(tips </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> animation[idx </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(animation)], animation[idx </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(animation)], animation[idx </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(animation)],</span></span>
<span class="line"><span style="color:#ABB2BF;">              animation[idx </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(animation)], animation[idx </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(animation)], </span><span style="color:#E06C75;font-style:italic;">end</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\r</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        idx </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;">        time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">init_gua_data</span><span style="color:#ABB2BF;">(gua_data_path)</span></span>
<span class="line"><span style="color:#61AFEF;">calculate_with_plum_flower</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br></div></div><h4 id="data-json-文件内容" tabindex="-1">data.json 文件内容 <a class="header-anchor" href="#data-json-文件内容" aria-label="Permalink to &quot;data.json 文件内容&quot;">​</a></h4><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;乾为天&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元亨利贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;真不错，这个挂真不错。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天行健，君子以自强不息。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天道刚健，运行不已。君子观此卦象，从而以天为法，自强不息。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽天夬&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;扬于王庭，孚号，有厉。告自邑，不利即戎，利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;王庭里正跳舞作乐。有人呼告：“有敌人来犯。”邑中传来命令：“出击不利，要严阵以待。”筮遇此爻，出外旅行则吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上于天，夬。君子以施禄及下，居德则忌。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;上卦为兑，兑为泽；下卦为乾，乾为天，可见泽水上涨，浇灌大地，是夬卦的卦象。君子观此卦象，从而泽惠下施，不敢居功自傲，并以此为忌。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火天大有&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元亨。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;昌隆通泰。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火在天上，大有。君子以遏恶扬善，顺天休命。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火在天上，明烛四方，君子观此卦象，取法于火，洞察善恶，抑恶扬善，从而顺应天命，祈获好运。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷天大壮&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;吉利&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷在天上，大壮。君子以非礼弗履。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天上鸣雷是大壮的卦象。君子观此卦象，以迅雷可畏，礼法森严，从而畏威知惧，唯礼是遵。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风天小畜&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。密云不雨，自我西郊。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;吉利。在西郊一带浓云密布，但雨没有下来。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风行天上，小畜。君子以懿文德。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;上卦为巽，巽为风；下卦为乾，乾为天，和风拂地，草木低昂，勃勃滋生，这是小畜的卦象。君子观此卦象，取法催发万物的和风，自励风范，推行德教。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水天需&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;有孚，光亨，贞吉。利涉大川。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;抓到俘虏。大吉大利，吉利的卜问。有利于涉水渡河。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;云上于天，需；君子以饮食宴乐。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;云浮聚于天上，待时降雨是需卦的卦象。君子观此卦象，可以宴饮安乐，待时而动。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山天大畜&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利贞，不家食，吉。利涉大川。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;吉利的贞兆。不食于家，食于朝廷，吉利。筮遇此卦，有利于涉水渡河。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天在山中，大畜。君子以多识前言往行，以畜其德。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;太阳照耀于山中，万物摄取阳光雨露，各遂其生，这是大畜的卦象。君子观此卦象，从而广泛地了解古人的嘉言善行，来培养自己的德行。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤乾&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地天泰&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;小往大来，吉，亨。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;付出小，收益大，吉祥，顺利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天地交，泰；后以财成天地之道，辅相天地之宜，以左右民。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地气上升，乾气下降，为地气居于乾气之上之表象，阴阳二气一升一降，互相交合，顺畅通达。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天泽履&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;履虎尾，不咥人，亨。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;踩着虎尾巴，老虎不咬人，吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;上天下泽，履。君子以辨上下，定民志。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;上天下泽，尊卑显别，这是履卦的卦象。君子观此卦象，从而分别上下尊卑，使人民循规蹈矩，安份守纪。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;兑为泽&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，利，贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨通。吉利的贞卜。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;丽泽，兑。君子以朋友讲习。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;两泽相连，两水交流是兑卦的卦象。君子观此卦象，从而广交朋友，讲习探索，推广见闻。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火泽睽&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;小事吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;筮遇此卦，小事吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;上火下泽，睽。君子以同而异。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;上火下泽，两相乖离，是睽卦的卦象。君子观此卦象，从而综合万物之所同，分析万物之所异。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷泽归妹&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;征凶，无攸利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;筮遇此爻，出征凶险。无所利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上有雷，归妹。君子以永终知敝。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上雷鸣，雷鸣水动，用以喻男女心动相爱而成眷属。这是归妹卦的卦象。君子观此卦象，从而在长期的婚姻生活中，体察到婚姻的成功与失败。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风泽中孚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;豚鱼，吉。利涉大川，利贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;豚鱼献祭，虽物薄但心诚，吉利。并利于涉水过河。这是吉利的贞卜。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上有风，中孚。君子以议狱缓死。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上有风，风起波涌。这是中孚的卦象。君子观此卦象，有感于风化邦国，唯德教为先，因而审议讼狱，不轻置重典。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水泽节&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，苦节不可贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨通。如果以节制为苦，其凶吉则不可卜问。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上有水，节。君子以制数度，议德行。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽中水满，因而须高筑堤防，这是节卦的卦象。君子观此卦象，从而建立政纲制度，确立伦理原则。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山泽损&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;有孚，元吉，无咎，可贞。利有攸往。曷之用？二簋可用享。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;筮遇此卦，将有所俘获，大吉大利，没有灾难，是称心的卜问。而且所往将获利。将有人送来两盆食物，可享口福。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有泽，损。君子以征忿窒欲。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有泽是损卦的卦象。君子观此卦象，以泽水浸蚀山脚为戒，从而制止其忿怒，杜塞其贪欲。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤兑&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地泽临&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元，亨，利，贞。至于八月有凶。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大吉大利，吉利的卜问。到了八月，可能有凶险。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上有地，临。君子以教思无穷，客保民无疆。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;堤岸高出大泽，河泽容于大地，这是临卦的卦象。君子观此卦象，君临天下，教化万民，覃恩极虑，保容万民，德业无疆。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天火同人&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;同人于野，亨。利涉大川，利君子贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;聚众于郊外，将行大事，吉利。有利于涉水渡河，有利于君子的卜问。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天与火，同人；君子以类族辨物。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;同人之卦，上卦为乾为天为君王，下卦为离为火为臣民，上乾下离象征君王上情下达，臣民下情上达，君臣意志和同，这是同人的卦象。君子观此卦象，取法于火，明烛天地，照亮幽隐，从而去分析物类，辨明情状。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽火革&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;己日乃孚。元亨利贞。悔亡。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;祭祀之日用俘虏作人牲，亨通，吉利的卜问。没有悔恨。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽中有火，革。君子以治历明时。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;内蒸外煏，水涸草枯，如同水泽之中，大火燃烧，这是革卦的卦象。君子观此卦象，了解到泽水涨落，草木枯荣的周期变化，从而修治历法，明确时令。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;离为火&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利贞，亨。畜牝牛，吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;吉利的占问，通泰。饲养母牛，吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;明两作，离。大人以继明照四方。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;今朝太阳升，明朝太阳升，相继不停顿，这是离卦的卦象。贵族王公观此卦象，从而以源源不断的光明照临四方。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷火丰&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。王假之，勿忧，宜日中。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;举行祭祀，君王将亲临宗庙。不要担心，最佳时刻当在正午时分。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷电皆至，丰。君子以折狱致刑。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;电闪雷鸣，是上天垂示的重大天象，这也是丰卦的卦象。君子观此卦象，有感于电光雷鸣的精明和威严，从而裁断讼狱，施行刑罚。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风火家人&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利女贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;卜问妇女之事吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风自火出，家人。君子以言有物，而行有恒。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;内火外风，风助火势，火助风威，相辅相成，是家人的卦象。君子观此卦象，从而省悟到言辞须有内容才不致于空洞，德行须持之以恒才能充沛。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水火既济&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，小利贞，初吉终乱。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨通。这是小见吉利的贞卜。起初吉利，最后将发生变故。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水在火上，既济。君子以思患而预防之。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水上火下，水浇火熄，是既济之卦的卦象。君子观此卦象，从而有备于无患之时，防范于未然之际。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山火贲&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。小利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通达。有所往则有小利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有火，贲。君子以明庶政，无敢折狱。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有火，火燎群山，这是贲卦的卦象。君子观此卦象，思及猛火燎山，玉石俱焚，草木皆尽，以此为戒，从而明察各项政事，不敢以威猛断狱。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤离&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地火明夷&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利艰贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;卜问艰难之事则利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;明入地中，明夷。君子以莅众，用晦而明。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;太阳没入地中，是明夷的卦象。君子观此卦象，治民理政，不以苛察为明，而是外愚内慧，容物亲众。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天雷无妄&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元，亨，利，贞。其匪正有眚，不利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;嘉美通泰，卜问得吉兆。行为不正当，则有灾殃，有所往则不利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天下雷行，物与无妄。先王以茂对时，育万物。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天宇之下，春雷滚动，万物萌发，孳生繁衍，这是无妄的卦象。先王观此卦象，从而奋勉努力，顺应时令，保育万物。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽雷随&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元亨，利贞，无咎。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大吉大利，卜得吉兆，没有灾害。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽中有雷，随。君子以向晦入宴息。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷入泽中，大地寒凝，万物蛰伏，是随卦的卦象。君子观此卦象，取法于随天时而沉寂的雷声，随时作息，向晚则入室休息。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火雷噬嗑&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。利用狱。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通泰。利于讼狱。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷电噬嗑。先王以明罚敕法。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷电交合是噬嗑的卦象。先王观此卦象，取法于威风凛凛的雷、照彻幽隐的电，思以严明治政，从而明察其刑罚，修正其法律。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;震为雷&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。震来虩虩，笑言哑哑。震惊百里，不丧匕鬯。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;临祭之时，雷声传来，有的人吓得浑身发抖，片刻之后，才能谈笑如常。巨雷猝响，震惊百里，有的人却神态自若，手里拿着酒勺子，连一滴酒都没有洒出来。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;洊雷，震。君子以恐惧修省。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;巨雷连击，是震卦的卦象。君子观此卦象，从而戒惧恐惧，修省其身。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风雷益&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利有攸往，利涉大川。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;筮遇此爻，利于有所往，利于涉水渡河。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风雷，益。君子以见善则迁，有过则改。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风雷激荡，是益卦的卦象。君子观此卦象，惊恐于风雷的威力，从而见善则从之，有过则改之。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水雷屯&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元，亨，利，贞。勿用，有攸往，利建侯。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大吉大利，吉利的占卜。不利于出门。有利于建国封侯。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;云，雷，屯；君子以经纶。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;云行于上，雷动于下，是屯卦的卦象。君子观此卦象，取法于云雷，用云的恩泽，雷的威严来治理国事。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山雷颐&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;贞吉。观颐，自求口实。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;占卜得吉兆。研究颐养之道，在于自食其力。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有雷，颐。君子以慎言语，节饮食。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷出山中，万物萌发，这是颐卦的卦象。君子观此卦象，思生养之不易，从而谨慎言语，避免灾祸。节制饮食，修身养性。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤震&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地雷复&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。出入无疾，朋来无咎。反复其道，七日来复，利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通泰。出门、居处均无疾病。有钱可赚而可以无灾祸。往返途中，七日可归。有所往则有所利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷在地中，复。先王以至日闭关，商旅不行，后不省方。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天寒地冻，雷返归地中，往而有复，依时回归，这是复卦的卦象。先王观此卦象，取法于雷，在冬至之日关闭城门，不接纳商旅，君王也不巡视邦国&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天风姤&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;女壮，勿用取女。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;梦见女子受伤。筮遇此卦，不利于娶女。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天下有风，姤。后以施命诰四方。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天下有风，是姤卦的卦象，君王观此卦象，从而效法于风之吹拂万物，施教化于天下，昭告四方。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽风大过&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;栋桡。利有攸往，亨。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;屋粱压得弯曲了。有所往则有利，通泰。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽灭木，大过。君子以独立不惧，遁世无闷。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽水淹没木舟，这是大过的卦象。君子观此卦象，以舟重则覆为戒，领悟到遭逢祸变，应守节不屈，稳居不仕，清静淡泊。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火风鼎&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元吉，亨。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大吉大利，亨通。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;木上有火，鼎。君子以正位凝命。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;木上有火，以鼎烹物，这是《鼎》卦的卦象。君子观此卦象，取法于鼎足三分，正立不倚，从而持正守位，为君上所倚重，不负使命。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;雷巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷风恒&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，无咎，利贞。利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通达，没有过失，吉利的卜问。有所往则有利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷风，恒。君子以立不易方。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风雷荡涤，宇宙常新，这是恒卦的卦象。君子观此卦象，从而立于正道，坚守不易。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;巽为风&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;小亨。利有攸往，利见大人。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;稍见亨通。利于出行，利于会见王公贵族。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;随风，巽。君子以申命行事。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;长风相随，吹拂不断，是巽卦的卦象。君子观此卦象，取法于长吹不断的风，从而不断地申明教义，反复地颁行政令，灌输纲常大义。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水风井&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;改邑不改井，无丧无得。往来井井。汔至，亦未繘井，羸其瓶，凶。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;改建邑落而不改建水井，等于什么也没有干。人们往来井边汲水，水井干涸淤塞，不去加以淘洗，反而将吊水罐打破，这是凶险之象。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;木上有水，井。君子以劳民劝相。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水下浸而树木生长，这是井卦的卦象。君子观此卦象，取法于井水养人，从而鼓励人民勤劳而互相劝勉。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山风蛊&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元亨，利涉大川。先甲三日，后甲三日。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大吉大利。利于涉水渡河，但须在甲前三日之辛日与甲后三日之丁日启程。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有风，蛊。君子以振民育德。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;贤人如山居于上，宣布德教施于下，所谓山下有风，这是巽卦盼卦象。君子观此卦象，取法于吹拂万物的风，从而振救万民，施行德教。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤巽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地风升&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元亨。用见大人，勿恤，南征吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;非常亨通，有利于会见王公贵族，不用担忧。占得此爻，出征南方吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地中生木，升。君子以顺德，积小以高大。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;木植于地中，是升卦的卦象。君子观此卦象，从而遵循德义，加强修养，从细小起步，逐步培育崇高的品德。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天水讼&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;有孚，窒惕，中吉，终凶。利见大人，不利涉大川。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;虽有利可图(获得俘虏)，但要警惕戒惧。其事中间吉利，后来凶险。占筮得此爻，有利于会见贵族王公，不利于涉水渡河。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天与水违行，讼。君子以做事谋始。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天水隔绝，流向相背，事理乖舛，这是讼卦的卦象。君子观此卦象，以杜绝争讼为意，从而在谋事之初必须慎之又慎。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽水困&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，贞，大人吉，无咎。有言不信。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通泰。卜问王公贵族之事吉利，没有灾难。筮遇此爻，有罪之人无法申辩清楚。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽无水，困。君子以致命遂志。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水渗泽底，泽中干涸，是困卦的卦象。君子观此卦象，以处境艰难自励，穷且益坚，舍身捐命，以行其夙志。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火水未济&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，小狐汔济，濡其尾，无攸利&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;小狐狸快要渡过河，却打湿了尾巴。看来此行无所利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火在水上，未济。君子以慎辨物居方。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火在水上，水不能克火，是未济卦的卦象。君子观此卦象，有感于水火错位不能相克，从而以谨慎的态度辨辩事物的性质，审视其方位。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷水解&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利西南。无所往，其来复吉。有攸往，夙吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利于西南行，但是，若没有确定的目标，则不如返回，返回吉利。如果有确定的目标，则宜早行，早行吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷雨作，解。君子以赦过宥罪。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷雨并作，化育万物，是解卦的卦象。君子观此卦象，从而赦免过失，宽宥罪人。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风水涣&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，王假有庙。利涉大川，利贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨通，因为君王亲临宗庙，禳灾祈福。利于涉水过江河。这是吉利的贞卜&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风行水上，涣。先王以享于帝，立庙。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风行水上，是涣卦的卦象。先王观此卦象，从而享祭天帝，建立宗庙，推行尊天孝祖的“德教”&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;坎为水&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;习坎，有孚，维心亨，行有尚。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;抓获俘虏，劝慰安抚他们，通泰。途中将得到帮助。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水洊至，习坎。君子以常德行，习教事。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;坎为永，水长流不滞，是坎卦的卦象。君子观此卦象，从而尊尚德行，取法于细水长流之象，学习教化人民的方法。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山水蒙&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。匪我求童蒙，童蒙求我。初筮告，再三渎，渎则不告。利贞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通泰。不是我有求于幼稚愚昧的人，而是幼稚愚昧的人有求于我。第一次占筮，神灵告诉了他。轻慢不敬的再三占筮，轻慢不敬的占筮，神灵就不会告诉他。但还是吉利的卜问。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下出泉，蒙。君子以果行育德。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山下有泉，泉水喷涌而出，这是蒙卦的卦象。君子观此卦象，取法于一往无前的山泉，从而以果敢坚毅的行动来培养自身的品德。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤坎&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地水师&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;贞，丈人吉，无咎。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;占问总指挥的军情，没有灾祸。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地中有水，师。君子以容民畜众。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;“地中有水”，这是师卦的卦象。君子观此卦象，取法于容纳江河的大地，收容和畜养大众。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天山遁&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨。小利贞&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通达。小有利之占问。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天下有山，遁。君子以远小人，不恶而严。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天下有山，天高山远，是遁卦的卦象。君子观此卦象，从而不用以恶报恶的方法对付小人，而是采取严厉的态度，挂冠悬笏，自甘退隐，远离小人。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽山咸&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，利贞。取女吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通达，吉利的贞卜。娶女，吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山上有泽，咸。君子以虚受人。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山中有泽，山气水息，互相感应，是咸卦的卦象。君子观此卦象，取法于深邃的山谷，深广的大泽，从而虚怀若谷，以谦虚的态度，接受他人的教益。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火山旅&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;小亨，旅贞吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;稍见亨通。贞卜旅行，吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山上有火，旅。君子以明慎用刑，而不留狱。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山上有火，洞照幽隐，这是旅卦的卦象。君子观此卦象，从而明察刑狱，慎重判决，既不敢滥施刑罚，也不敢延宕滞留。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷山小过&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，利贞。可小事，不可大事。飞鸟遗之音。不宜上，宜下，大吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨通，这是吉利的贞卜。但是只适宜于小事，不适宜大事。飞鸟空中过，叫声耳边留，警惕人们：登高必遇险，下行则吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山上有雷，小过。君子以行过乎恭，丧过乎衰，用过乎俭。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山上有雷，是小过的卦象。君子观此卦象，惧畏天雷，不敢有过失。因而行事不敢过于恭谦，居丧不敢过度哀伤，用度不敢过于节俭，唯适中而已。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风山渐&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利西南，不利东北。利见大人，贞吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;筮遇此卦，利西南行，不利东北行。利见贵族王公，获吉祥之兆。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山上有水，蹇。君子以反身修德。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山石磷峋，水流曲折，是蹇卦的卦象。君子观此卦象，悟行道之不易，从而反求诸己，修养德行。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;艮为山&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;艮其背，不获其身。行其庭，不见其人。无咎。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;卸掉责任，挂笏隐退，朝列之中已看不到他的身影，在他的庭院中寻找，也没有找到。其人远走高飞，自无灾祸。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;兼山，艮。君子以思不出其位。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;两艮卦相重，艮为山，可见艮卦的卦象是高山重立，渊深稳重。君子观此卦象，以此为戒，谋不踰位，明哲保身。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤艮&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地山谦&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，君子有终。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通泰。筮遇此卦，君子将有所成就。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地中有山，谦。君子以裒多益寡，称物平施。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地中有山，内高外卑，居高不傲，这是谦卦的卦象。君子观此卦象，以谦让为怀，裁取多余昀，增益缺乏的，衡量财物的多寡而公平施予。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	&quot;乾坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天地否&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;否之匪人。不利君子贞。大往小来。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;为小人所隔阂，这是不利于君子的占卜，事业也将由盛转衰。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天地不交，否。君子以俭德辟难，不可荣以禄。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;天地隔阂不能交感，万物咽窒不能畅釜，这是否卦的卦象。君子观此卦象，从而在国家政治否塞之时，应思隐居不仕，以崇尚俭约来躲避灾难，不要以利禄为荣。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;兑泽&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽地萃&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;亨，王假有庙。利见大人，亨，利贞。用大牲吉。利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;通泰。王到宗庙举行祭祀。占得此卦，利于会见贵族王公，亨通，这是吉利的贞兆。用牛牲祭祀，也很吉利，并且出行吉利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽上于地，萃。君子以除戎器，戒不虞。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;泽水淹地，是萃卦的卦象。君子观此卦象，以洪水横流，祸乱丛聚为戒，从而修治兵器，戒备意外的变乱。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;离坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;火地晋&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;康侯用锡马蕃庶，昼日三接。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;康侯用成王赐予的良马来繁殖马匹，一天多次配种。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;明出地上，晋。君子以自昭明德。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;太阳照大地，万物沐光辉”，是晋卦的卦象。君子观此卦象，从而光大自身的光明之德。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;震坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷地豫&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;利建侯行师。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;有利于封侯建国，出兵打仗。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;雷出地奋，豫。先王以作乐崇德，殷荐之上帝，以配祖考。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;春雷轰鸣，大地震动，催发万物，这是豫卦的卦象。先王观此卦象，取法于声满大地的雷鸣，制作音乐，歌功颂德，光荣归于上帝，光荣归于祖考。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;巽坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风地观&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;盥而不荐，有孚顒若。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;祭祀时灌酒降神而不献人牲，因为用作祭祀的俘虏的头部肿了，不能用作祭品。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风行地上，观。先王以省方，观民设教&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;风行大地吹拂万物，这是观的卦象。先王观此卦象取法于周流八方的风，从而巡视邦国，观察民情，推行教化。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坎坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;水地比&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;吉。原筮，元永贞，无咎。不宁方来，后夫凶。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;吉利。同时再卜筮，仍然大吉大利。卜问长时期的吉凶，也没有灾祸。不愿臣服的邦国来朝，迟迟不来者有难。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地上有水，比。先王以建万国，亲诸侯。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地上有水，这是比卦的卦象。先王观此卦象，取法于水附大地，地纳江河之象，封建万国，亲近诸侯。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;艮坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山地剥&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;不利有攸往。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;有所往则不利。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山附于地，剥。上以厚下，安宅。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;山在地上，风雨剥蚀，这是剥卦的卦象。君子观此卦象，以山石剥落，岩角崩塌为戒，从而厚结民心，使人民安居乐业。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	&quot;坤坤&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;name&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;坤为地&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;元，亨，利牝马之贞。君子有攸往，先迷后得主。利西南得朋，东北丧朋。安贞，吉。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_words&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大吉大利。占问雌马得到吉兆。君子前去旅行，先迷失路途，后来找到主人，吉利。西南行获得财物，东北行丧失财物。占问定居，得到吉兆。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;地势坤，君子以厚德载物。。&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		&quot;white_picture&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;大地的形势平铺舒展，顺承天道。君子观此卦象，取法于地，以深厚的德行来承担重大的责任。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br></div></div><h3 id="执行方式" tabindex="-1">执行方式 <a class="header-anchor" href="#执行方式" aria-label="Permalink to &quot;执行方式&quot;">​</a></h3><p>手动执行 main.py 文件</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="自动收集每日黄金价格" tabindex="-1">自动收集每日黄金价格 <a class="header-anchor" href="#自动收集每日黄金价格" aria-label="Permalink to &quot;自动收集每日黄金价格&quot;">​</a></h1><h2 id="场景需求" tabindex="-1">场景需求 <a class="header-anchor" href="#场景需求" aria-label="Permalink to &quot;场景需求&quot;">​</a></h2><p>黄金价格持续上涨，已经成为今年最热的投资资产。</p><p>准备在工商银行买 100g 实体黄金，又拿不准近期的金价走势，最近经常上银行网站看价格，等金价下跌时找个缺口入手。</p><p>每天手动查看黄金价格嫌麻烦，让 AI 帮忙写个脚本自动收集每日黄金价格，用飞书收集数据汇总后展示价格走势。</p><h2 id="工具" tabindex="-1">工具 <a class="header-anchor" href="#工具" aria-label="Permalink to &quot;工具&quot;">​</a></h2><blockquote><p><strong>Claude 3 Opus</strong> 编写 Python、Github Action 脚本</p><p><strong>Github Action</strong> 脚本托管，每日定时执行脚本</p><p><strong>飞书</strong> 数据收集、汇总、展示</p></blockquote><h2 id="📍-实现步骤" tabindex="-1">📍 实现步骤 <a class="header-anchor" href="#📍-实现步骤" aria-label="Permalink to &quot;📍 实现步骤&quot;">​</a></h2><p><img src="`+e+`" alt="图片"></p><p>首先，访问银行网站分析下网页的布局，查看网页元素分析黄金价格的数值对应 prodSkuJson 字段。</p><h3 id="_1-使用-prompt-提示词-让-ai-编写-python、github-action-脚本" tabindex="-1">1.使用 Prompt 提示词，让 AI 编写 Python、Github Action 脚本 <a class="header-anchor" href="#_1-使用-prompt-提示词-让-ai-编写-python、github-action-脚本" aria-label="Permalink to &quot;1.使用 Prompt 提示词，让 AI 编写 Python、Github Action 脚本&quot;">​</a></h3><p>**注：**Prompt 提示词仅供参考，AI 大模型在实际问答中经常会有些小差异，遇到脚本执行问题还需要有一定的技术基础进行手动调试。</p><h4 id="prompt-提示词" tabindex="-1">Prompt 提示词： <a class="header-anchor" href="#prompt-提示词" aria-label="Permalink to &quot;Prompt 提示词：&quot;">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># 新建一个python脚本dailygoldprice.py，</span></span>
<span class="line"><span>访问链接：https://mall.icbc.com.cn/products/pd_9003867817.jhtml，</span></span>
<span class="line"><span>匹配响应文本中prodSkuJson获得100g黄金的价格。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="`+r+'" alt="图片"></p><h4 id="prompt-提示词-1" tabindex="-1">Prompt 提示词： <a class="header-anchor" href="#prompt-提示词-1" aria-label="Permalink to &quot;Prompt 提示词：&quot;">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># 请求飞书webhook地址，收集数据</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+c+'" alt="图片"></p><h4 id="prompt-提示词-2" tabindex="-1">Prompt 提示词： <a class="header-anchor" href="#prompt-提示词-2" aria-label="Permalink to &quot;Prompt 提示词：&quot;">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># 新建github action每天执行一次dailygoldprice.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+t+'" alt="图片"></p><h3 id="_2-配置-github-action" tabindex="-1">2.配置 Github Action <a class="header-anchor" href="#_2-配置-github-action" aria-label="Permalink to &quot;2.配置 Github Action&quot;">​</a></h3><p>配置 Github Action 可以参考 AI 提供的步骤和官方教程，之后在 Actions 页面能够看到脚本的运行状况。</p><p><img src="'+B+'" alt="图片"></p><h3 id="_3-使用飞书收集数据" tabindex="-1">3.使用飞书收集数据 <a class="header-anchor" href="#_3-使用飞书收集数据" aria-label="Permalink to &quot;3.使用飞书收集数据&quot;">​</a></h3><p>先创建一个多维表格，再创建飞书机器人助手接收数据。</p><p><img src="'+y+'" alt="图片"></p><h2 id="实现效果" tabindex="-1">实现效果 <a class="header-anchor" href="#实现效果" aria-label="Permalink to &quot;实现效果&quot;">​</a></h2><p>每日黄金价格列表</p><p><img src="'+i+'" alt="图片"></p><p>每日黄金价格走势</p><p><img src="'+F+'" alt="图片"></p><h1 id="携程机票爬取脚本" tabindex="-1">携程机票爬取脚本 <a class="header-anchor" href="#携程机票爬取脚本" aria-label="Permalink to &quot;携程机票爬取脚本&quot;">​</a></h1><p>效果展示</p><p><img src="'+A+`" alt="图片"></p><p>全代码如下</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> magic</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> io</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> gzip</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> seleniumwire </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> dt, timedelta</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.keys </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Keys</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> expected_conditions </span><span style="color:#C678DD;">as</span><span style="color:#D19A66;"> EC</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.ui </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverWait</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 爬取的城市</span></span>
<span class="line"><span style="color:#ABB2BF;">crawal_citys </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;上海&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;香港&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;东京&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 爬取日期范围：起始日期。格式&#39;2023-12-01&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">begin_date </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 爬取日期范围：结束日期。格式&#39;2023-12-31&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">end_date </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 爬取T+N，即N天后</span></span>
<span class="line"><span style="color:#ABB2BF;">start_interval </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 爬取的日期</span></span>
<span class="line"><span style="color:#ABB2BF;">crawal_days </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 60</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置各城市爬取的时间间隔（单位：秒）</span></span>
<span class="line"><span style="color:#ABB2BF;">crawal_interval </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 日期间隔</span></span>
<span class="line"><span style="color:#ABB2BF;">days_interval </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置页面加载的最长等待时间（单位：秒）</span></span>
<span class="line"><span style="color:#ABB2BF;">max_wait_time </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 最大错误重试次数</span></span>
<span class="line"><span style="color:#ABB2BF;">max_retry_time </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否只抓取直飞信息（True: 只抓取直飞，False: 抓取所有航班）</span></span>
<span class="line"><span style="color:#ABB2BF;">direct_flight </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否删除不重要的信息</span></span>
<span class="line"><span style="color:#ABB2BF;">del_info </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 是否重命名DataFrame的列名</span></span>
<span class="line"><span style="color:#ABB2BF;">rename_col </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调试截图</span></span>
<span class="line"><span style="color:#ABB2BF;">enable_screenshot </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 允许登录（可能必须要登录才能获取数据）</span></span>
<span class="line"><span style="color:#ABB2BF;">login_allowed </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 账号</span></span>
<span class="line"><span style="color:#ABB2BF;">accounts </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 密码</span></span>
<span class="line"><span style="color:#ABB2BF;">passwords </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#利用stealth.min.js隐藏selenium特征</span></span>
<span class="line"><span style="color:#ABB2BF;">stealth_js_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;./stealth.min.js&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义下载stealth.min.js的函数</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> download_stealth_js</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;https://raw.githubusercontent.com/requireCool/stealth.min.js/main/stealth.min.js&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(file_path):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> not found, downloading...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#ABB2BF;">        response.</span><span style="color:#61AFEF;">raise_for_status</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 确保请求成功</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">            file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(response.text)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> downloaded.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> already exists, no need to download.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> init_driver</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # options = webdriver.ChromeOptions() # 创建一个配置对象</span></span>
<span class="line"><span style="color:#ABB2BF;">    options </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">EdgeOptions</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 创建一个配置对象</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--incognito&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 隐身模式（无痕模式）</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # options.add_argument(&#39;--headless&#39;)  # 启用无头模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--no-sandbox&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-dev-shm-usage&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-blink-features&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-blink-features=AutomationControlled&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-extensions&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--pageLoadStrategy=eager&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-gpu&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-software-rasterizer&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--disable-dev-shm-usage&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--ignore-certificate-errors&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--ignore-certificate-errors-spki-list&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--ignore-ssl-errors&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;excludeSwitches&quot;</span><span style="color:#ABB2BF;">, [</span><span style="color:#98C379;">&quot;enable-automation&quot;</span><span style="color:#ABB2BF;">])  </span><span style="color:#7F848E;font-style:italic;"># 不显示正在受自动化软件控制的提示</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # chromeDriverPath = &#39;C:/Program Files/Google/Chrome/Application/chromedriver&#39; #chromedriver位置</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # options.add_argument(&quot;user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.69&quot;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # driver = webdriver.Chrome(executable_path=self.chromeDriverPath,chrome_options=self.options)</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Edge</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">options)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;">        download_stealth_js</span><span style="color:#ABB2BF;">(stealth_js_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 读取并注入stealth.min.js</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(stealth_js_path, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            stealth_js </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            driver.</span><span style="color:#61AFEF;">execute_cdp_cmd</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span><span style="color:#ABB2BF;">, {</span><span style="color:#98C379;">&quot;source&quot;</span><span style="color:#ABB2BF;">: stealth_js})</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">maximize_window</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> driver</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> gen_citys</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">crawal_citys</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 生成城市组合列表</span></span>
<span class="line"><span style="color:#ABB2BF;">    citys </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    ytic </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> list</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">reversed</span><span style="color:#ABB2BF;">(crawal_citys))</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> m </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> crawal_citys:</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> n </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> ytic:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> m </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> n:</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                citys.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">([m, n])</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> citys</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> generate_flight_dates</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">n</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">begin_date</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">end_date</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">start_interval</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">days_interval</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    flight_dates </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> begin_date:</span></span>
<span class="line"><span style="color:#ABB2BF;">        begin_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(begin_date, </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    elif</span><span style="color:#ABB2BF;"> start_interval:</span></span>
<span class="line"><span style="color:#ABB2BF;">        begin_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#61AFEF;"> timedelta</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">days</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">start_interval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, n, days_interval):</span></span>
<span class="line"><span style="color:#ABB2BF;">        flight_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> begin_date </span><span style="color:#56B6C2;">+</span><span style="color:#61AFEF;"> timedelta</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">days</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        flight_dates.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(flight_date.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 如果有结束日期，确保生成的日期不超过结束日期</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> end_date:</span></span>
<span class="line"><span style="color:#ABB2BF;">        end_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(end_date, </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        flight_dates </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [date </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> date </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> flight_dates </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(date, </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#ABB2BF;"> end_date]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 继续生成日期直到达到或超过结束日期</span></span>
<span class="line"><span style="color:#C678DD;">        while</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(flight_dates[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> end_date:</span></span>
<span class="line"><span style="color:#ABB2BF;">            next_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(flight_dates[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">+</span><span style="color:#61AFEF;"> timedelta</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">days</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">days_interval)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> next_date </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#ABB2BF;"> end_date:</span></span>
<span class="line"><span style="color:#ABB2BF;">                flight_dates.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(next_date.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> flight_dates</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># element_to_be_clickable 函数来替代 expected_conditions.element_to_be_clickable 或 expected_conditions.visibility_of_element_located</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> element_to_be_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">element</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> check_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> element.</span><span style="color:#61AFEF;">is_enabled</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> element.</span><span style="color:#61AFEF;">is_displayed</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#ABB2BF;"> element  </span><span style="color:#7F848E;font-style:italic;"># 当条件满足时，返回元素本身</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> check_clickable</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> DataFetcher</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#56B6C2;"> __init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.date </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.city </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#7F848E;font-style:italic;">  # 错误重试次数</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.switch_acc </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#7F848E;font-style:italic;"> #切换账户</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> refresh_driver</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">refresh</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> refresh_driver:刷新页面失败，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 详细错误信息：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 刷新页面</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> refresh_driver：刷新页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断错误次数</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,refresh_driver:不继续重试&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> remove_btn</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            #WebDriverWait(self.driver, max_wait_time).until(lambda d: d.execute_script(&#39;return typeof jQuery !== &quot;undefined&quot;&#39;))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 移除提醒</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;document.querySelectorAll(&#39;.notice-box&#39;).forEach(element =&gt; element.remove());&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 移除在线客服</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;document.querySelectorAll(&#39;.shortcut, .shortcut-link&#39;).forEach(element =&gt; element.remove());&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 移除分享链接</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;document.querySelectorAll(&#39;.shareline&#39;).forEach(element =&gt; element.remove());&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#98C379;">            &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">            # 使用JavaScript删除所有的&lt;dl&gt;标签</span></span>
<span class="line"><span style="color:#98C379;">            self.driver.execute_script(&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">                var elements = document.getElementsByTagName(&#39;dl&#39;);</span></span>
<span class="line"><span style="color:#98C379;">                while(elements.length &gt; 0){</span></span>
<span class="line"><span style="color:#98C379;">                    elements[0].parentNode.removeChild(elements[0]);</span></span>
<span class="line"><span style="color:#98C379;">                }</span></span>
<span class="line"><span style="color:#98C379;">            &quot;&quot;&quot;)</span></span>
<span class="line"><span style="color:#98C379;">            &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> remove_btn:提醒移除失败，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 详细错误信息：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> check_verification_code</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查是否有验证码元素，如果有，则需要人工处理</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">ID</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;verification-code&quot;</span><span style="color:#ABB2BF;">))</span><span style="color:#56B6C2;">+len</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;alert-title&quot;</span><span style="color:#ABB2BF;">))):</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> check_verification_code：验证码被触发verification-code/alert-title，等待</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">crawal_interval</span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;">100}</span><span style="color:#98C379;">后重试。&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(crawal_interval</span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> init_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.switch_acc </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 移除注意事项</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">remove_btn</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 如果没有找到验证码元素，则说明页面加载成功，没有触发验证码</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> check_verification_code:未知错误，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 详细错误信息：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> login_allowed:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            account </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> accounts[</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.switch_acc </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(accounts)]</span></span>
<span class="line"><span style="color:#ABB2BF;">            password </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> passwords[</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.switch_acc </span><span style="color:#56B6C2;">%</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(passwords)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;lg_loginbox_modal&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login:未弹出登录界面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                    WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;tl_nfes_home_header_login_wrapper_siwkn&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 点击飞机图标，返回主界面</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;tl_nfes_home_header_login_wrapper_siwkn&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    #等待页面加载</span></span>
<span class="line"><span style="color:#61AFEF;">                    WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;lg_loginwrap&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login:已经弹出登录界面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;r_input.bbz-js-iconable-input&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(account)</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login:输入账户成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;div[data-testid=&#39;accountPanel&#39;] input[data-testid=&#39;passwordInput&#39;]&quot;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(password)</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login:输入密码成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;[for=&quot;checkboxAgreementInput&quot;]&#39;</span><span style="color:#ABB2BF;">)))</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login:勾选同意成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">element_to_be_clickable</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form_btn.form_btn--block&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login：登录成功&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 保存登录截图</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                        f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(crawal_interval</span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 用f字符串格式化错误类型和错误信息，提供更多的调试信息</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login：页面加载或元素操作失败，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 详细错误信息：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                        f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 刷新页面</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> login：刷新页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 重试</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 判断错误次数</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                        f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,login:重新尝试加载页面，这次指定需要重定向到首页&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">reset_to_homepage</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        next_stage_flag </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> reset_to_homepage </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 前往首页</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;https://flights.ctrip.com/online/channel/domestic&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#61AFEF;">                WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                    EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                        (By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;pc_home-jipiao&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 点击飞机图标，返回主界面</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                    element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                            By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;pc_home-jipiao&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 单程</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                    element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                            By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;radio-label&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 搜索</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                    element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;search-btn&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"><span style="color:#ABB2BF;">                ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                next_stage_flag </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 用f字符串格式化错误类型和错误信息，提供更多的调试信息</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> get_page：页面加载或元素操作失败，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 详细错误信息：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 重新尝试加载页面，这次指定需要重定向到首页</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> next_stage_flag:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 继续下一步</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">change_city</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> change_city</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        next_stage_flag </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> False</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 等待页面完成加载</span></span>
<span class="line"><span style="color:#61AFEF;">            WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#D19A66;">                EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    (By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 若出发地与目标值不符，则更改出发地</span></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(Keys.</span><span style="color:#D19A66;">CONTROL</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &quot;a&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换城市【0】-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 若目的地与目标值不符，则更改目的地</span></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(Keys.</span><span style="color:#D19A66;">CONTROL</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &quot;a&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换城市【1】-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;form-input-v3&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;[aria-label=请选择日期]&quot;</span><span style="color:#ABB2BF;">)[</span></span>
<span class="line"><span style="color:#D19A66;">                        0</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">                    !=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.date</span></span>
<span class="line"><span style="color:#ABB2BF;">                ):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 点击日期选择</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;modifyDate.depart-date&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                            By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ) </span><span style="color:#56B6C2;">&lt;</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                            element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                                    &quot;in-date-picker.icon.next-ico.iconf-right&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                            f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换日期</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">).text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">小于 </span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 向右点击&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                            By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                            element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                                    &quot;in-date-picker.icon.prev-ico.iconf-left&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                            f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换日期</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">).text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">大于 </span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 向左点击&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                            By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ) </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#C678DD;">                        if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                            .</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                            .text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#ABB2BF;">                            ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                                element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                                    self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                        By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                                        &quot;in-date-picker.icon.prev-ico.iconf-left&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                                )</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#56B6C2;">                            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换日期</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">).text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">大于 </span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 向左点击&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#ABB2BF;">                            ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                            By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                        .text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ) </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#C678DD;">                        if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                            .</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                            .text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ) </span><span style="color:#56B6C2;">&lt;</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#ABB2BF;">                            ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                                element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                                    self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                        By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                                        &quot;in-date-picker.icon.next-ico.iconf-right&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                                )</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#56B6C2;">                            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换日期</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">).text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">小于 </span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">])</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 向右点击&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )</span></span>
<span class="line"><span style="color:#ABB2BF;">                            ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                    for</span><span style="color:#ABB2BF;"> m </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                        By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-picker.date-picker-block&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ):</span></span>
<span class="line"><span style="color:#C678DD;">                        if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(m.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;year&quot;</span><span style="color:#ABB2BF;">).text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]) </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.date[:</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ):</span></span>
<span class="line"><span style="color:#C678DD;">                            continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                        if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(m.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">).text[:</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]) </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.date[</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        ):</span></span>
<span class="line"><span style="color:#C678DD;">                            continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                        for</span><span style="color:#ABB2BF;"> d </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> m.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;date-d&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">                            if</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(d.text) </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> int</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">:]):</span></span>
<span class="line"><span style="color:#ABB2BF;">                                ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                                    element_to_be_clickable</span><span style="color:#ABB2BF;">(d)</span></span>
<span class="line"><span style="color:#ABB2BF;">                                )</span></span>
<span class="line"><span style="color:#ABB2BF;">                                ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                                break</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：更换日期-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CSS_SELECTOR</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;[aria-label=请选择日期]&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#98C379;"> &quot;(&quot;</span><span style="color:#C678DD;"> not</span><span style="color:#C678DD;"> in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # Enter搜索</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # ele=WebDriverWait(self.driver, max_wait_time).until(element_to_be_clickable(its[1]))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # ele.send_keys(Keys.ENTER)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 通过低价提醒按钮实现enter键换页</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;low-price-remind&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                while</span><span style="color:#98C379;"> &quot;(&quot;</span><span style="color:#C678DD;"> not</span><span style="color:#C678DD;"> in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;form-input-v3&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">get_attribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # Enter搜索</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # ele=WebDriverWait(self.driver, max_wait_time).until(element_to_be_clickable(its[1]))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # ele.send_keys(Keys.ENTER)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 通过低价提醒按钮实现enter键换页</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> WebDriverWait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver, max_wait_time).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">                        element_to_be_clickable</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E5C07B;">                            self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                                By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;low-price-remind&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                            )[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"><span style="color:#ABB2BF;">                    ele.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                next_stage_flag </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,change_city：更换城市和日期失败，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 详细错误信息：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">find_elements</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">CLASS_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;lg_loginbox_modal&quot;</span><span style="color:#ABB2BF;">)):</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                            f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：检测到登录弹窗，需要登录&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重试</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：重试&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">change_city</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 判断错误次数</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                        f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,change_city:重新尝试加载页面，这次指定需要重定向到首页&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 删除本次请求</span></span>
<span class="line"><span style="color:#C678DD;">                    del</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重新尝试加载页面，这次指定需要重定向到首页</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> next_stage_flag:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 若无错误，执行下一步</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> change_city：成功更换城市和日期，当前路线为：</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> get_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 等待响应加载完成</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.predata </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">wait_for_request</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">                &quot;/international/search/api/search/batchSearch?.*&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">timeout</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">max_wait_time</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            rb </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">(json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.predata.body).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;flightSegments&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,get_data:获取数据超时，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 错误详细：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 删除本次请求</span></span>
<span class="line"><span style="color:#C678DD;">            del</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 刷新页面</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> get_data：刷新页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重试</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断错误次数</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,get_data:重新尝试加载页面，这次指定需要重定向到首页&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重新尝试加载页面，这次指定需要重定向到首页</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 删除本次请求</span></span>
<span class="line"><span style="color:#C678DD;">            del</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查数据获取正确性</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">                rb[</span><span style="color:#98C379;">&quot;departureCityName&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">                and</span><span style="color:#ABB2BF;"> rb[</span><span style="color:#98C379;">&quot;arrivalCityName&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">                and</span><span style="color:#ABB2BF;"> rb[</span><span style="color:#98C379;">&quot;departureDate&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.date</span></span>
<span class="line"><span style="color:#ABB2BF;">            ):</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;get_data:城市匹配成功：出发地-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">，目的地-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 若无错误，执行下一步</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">decode_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,get_data:刷新页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                        f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重新更换城市</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> get_data：重新更换城市:</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rb[</span><span style="color:#98C379;">&quot;departureCityName&quot;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rb[</span><span style="color:#98C379;">&quot;arrivalCityName&quot;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">rb[</span><span style="color:#98C379;">&quot;departureDate&quot;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重试</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">change_city</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> decode_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 使用python-magic库检查MIME类型</span></span>
<span class="line"><span style="color:#ABB2BF;">            mime </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> magic.</span><span style="color:#61AFEF;">Magic</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            file_type </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mime.</span><span style="color:#61AFEF;">from_buffer</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.predata.response.body)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            buf </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> io.</span><span style="color:#61AFEF;">BytesIO</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.predata.response.body)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#98C379;"> &quot;gzip&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> file_type:</span></span>
<span class="line"><span style="color:#ABB2BF;">                gf </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> gzip.</span><span style="color:#61AFEF;">GzipFile</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">fileobj</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">buf)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.dedata </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> gf.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#98C379;"> &quot;JSON data&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> file_type:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(buf.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 未知的压缩格式：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_type</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.dedata </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.dedata)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,decode_data:数据解码失败，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 错误详细：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 保存错误截图</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> enable_screenshot:</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.driver.</span><span style="color:#61AFEF;">save_screenshot</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;screenshot/screenshot_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.png&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 删除本次请求</span></span>
<span class="line"><span style="color:#C678DD;">            del</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.driver.requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 刷新页面</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> decode_data：刷新页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重试</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断错误次数</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,decode_data:重新尝试加载页面，这次指定需要重定向到首页&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重新尝试加载页面，这次指定需要重定向到首页</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 若无错误，执行下一步</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> check_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.flightItineraryList </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.dedata[</span><span style="color:#98C379;">&quot;data&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;flightItineraryList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 倒序遍历,删除转机航班</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.flightItineraryList) </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.flightItineraryList[i][</span><span style="color:#98C379;">&quot;flightSegments&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;transferCount&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#56B6C2;">                    !=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;">                ):</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.flightItineraryList.</span><span style="color:#61AFEF;">pop</span><span style="color:#ABB2BF;">(i)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.flightItineraryList) </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#C678DD;"> and</span><span style="color:#ABB2BF;"> direct_flight:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 不存在直航航班:</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">                return</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 错误次数+1</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 数据检查出错：不存在航班，错误类型：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">type</span><span style="color:#ABB2BF;">(e).</span><span style="color:#E06C75;">__name__</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">, 错误详细：</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.dedata)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#98C379;"> &#39;searchErrorInfo&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.dedata[</span><span style="color:#98C379;">&quot;data&quot;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">                    return</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">                else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#98C379;"> &quot;&#39;needUserLogin&#39;: True&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.dedata[</span><span style="color:#98C379;">&quot;data&quot;</span><span style="color:#ABB2BF;">]):</span></span>
<span class="line"><span style="color:#56B6C2;">                        print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                            f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,check_data:必须要登录才能查看数据，这次指定需要重定向到首页&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        )</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 重新尝试加载页面，这次指定需要重定向到首页</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 刷新页面</span></span>
<span class="line"><span style="color:#56B6C2;">                    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> check_data：刷新页面&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">refresh_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 检查注意事项和验证码</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">check_verification_code</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 重试</span></span>
<span class="line"><span style="color:#E5C07B;">                        self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 判断错误次数</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> max_retry_time:</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 错误次数【</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.err</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">max_retry_time</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">】,check_data:重新尝试加载页面，这次指定需要重定向到首页&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">                )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 重新尝试加载页面，这次指定需要重定向到首页</span></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 重置错误计数</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.err </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">proc_flightSegments</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">proc_priceList</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mergedata</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> proc_flightSegments</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.flights </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> flightlist </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.flightItineraryList:</span></span>
<span class="line"><span style="color:#ABB2BF;">            flightlist </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightlist[</span><span style="color:#98C379;">&quot;flightSegments&quot;</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&quot;flightList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            flightUnitList </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">(flightlist[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            departureday </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightUnitList[</span><span style="color:#98C379;">&quot;departureDateTime&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            departuretime </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightUnitList[</span><span style="color:#98C379;">&quot;departureDateTime&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            arrivalday </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightUnitList[</span><span style="color:#98C379;">&quot;arrivalDateTime&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            arrivaltime </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightUnitList[</span><span style="color:#98C379;">&quot;arrivalDateTime&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot; &quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> del_info:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 删除一些不重要的信息</span></span>
<span class="line"><span style="color:#ABB2BF;">                dellist </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;sequenceNo&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;marketAirlineCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureProvinceId&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureCityId&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureCityCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureAirportShortName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureTerminal&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalProvinceId&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalCityId&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalCityCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalAirportShortName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalTerminal&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;transferDuration&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;stopList&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;leakedVisaTagSwitch&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;trafficType&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;highLightPlaneNo&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;mealType&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;operateAirlineCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalDateTime&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureDateTime&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;operateFlightNo&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;operateAirlineName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                ]</span></span>
<span class="line"><span style="color:#C678DD;">                for</span><span style="color:#ABB2BF;"> value </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> dellist:</span></span>
<span class="line"><span style="color:#C678DD;">                    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        flightUnitList.</span><span style="color:#61AFEF;">pop</span><span style="color:#ABB2BF;">(value)</span></span>
<span class="line"><span style="color:#C678DD;">                    except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                        continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 更新日期格式</span></span>
<span class="line"><span style="color:#ABB2BF;">            flightUnitList.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                {</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureday&quot;</span><span style="color:#ABB2BF;">: departureday,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departuretime&quot;</span><span style="color:#ABB2BF;">: departuretime,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalday&quot;</span><span style="color:#ABB2BF;">: arrivalday,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivaltime&quot;</span><span style="color:#ABB2BF;">: arrivaltime,</span></span>
<span class="line"><span style="color:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.flights </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                [</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.flights,</span></span>
<span class="line"><span style="color:#ABB2BF;">                    pd.DataFrame.</span><span style="color:#61AFEF;">from_dict</span><span style="color:#ABB2BF;">(flightUnitList, </span><span style="color:#E06C75;font-style:italic;">orient</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;index&quot;</span><span style="color:#ABB2BF;">).T,</span></span>
<span class="line"><span style="color:#ABB2BF;">                ],</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> proc_priceList</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E5C07B;">        self</span><span style="color:#ABB2BF;">.prices </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> flightlist </span><span style="color:#C678DD;">in</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.flightItineraryList:</span></span>
<span class="line"><span style="color:#ABB2BF;">            flightNo </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightlist[</span><span style="color:#98C379;">&quot;itineraryId&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;_&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            priceList </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flightlist[</span><span style="color:#98C379;">&quot;priceList&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 经济舱，经济舱折扣</span></span>
<span class="line"><span style="color:#ABB2BF;">            economy, economy_tax, economy_total, economy_full </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [], [], [], []</span></span>
<span class="line"><span style="color:#ABB2BF;">            economy_origin_price, economy_tax_price, economy_total_price, economy_full_price </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 商务舱，商务舱折扣</span></span>
<span class="line"><span style="color:#ABB2BF;">            bussiness, bussiness_tax, bussiness_total, bussiness_full </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [], [], [], []</span></span>
<span class="line"><span style="color:#ABB2BF;">            bussiness_origin_price, bussiness_tax_price, bussiness_total_price, bussiness_full_price </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> price </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> priceList:</span></span>
<span class="line"><span style="color:#ABB2BF;">                adultPrice </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price[</span><span style="color:#98C379;">&quot;adultPrice&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                adultTax </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price[</span><span style="color:#98C379;">&quot;adultTax&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                miseryIndex </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price[</span><span style="color:#98C379;">&quot;miseryIndex&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                cabin </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> price[</span><span style="color:#98C379;">&quot;cabin&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 经济舱</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> cabin </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;Y&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    economy.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(adultPrice)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    economy_tax.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(adultTax)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    economy_full.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(miseryIndex)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    economy_total.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(adultPrice</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">adultTax)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 商务舱</span></span>
<span class="line"><span style="color:#C678DD;">                elif</span><span style="color:#ABB2BF;"> cabin </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;C&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    bussiness.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(adultPrice)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    bussiness_tax.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(adultTax)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    bussiness_full.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(miseryIndex)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    bussiness_total.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(adultPrice</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">adultTax)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 初始化变量</span></span>
<span class="line"><span style="color:#ABB2BF;">            economy_min_index </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#ABB2BF;">            bussiness_min_index </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> economy_total </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> []:</span></span>
<span class="line"><span style="color:#ABB2BF;">                economy_total_price </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> min</span><span style="color:#ABB2BF;">(economy_total)</span></span>
<span class="line"><span style="color:#ABB2BF;">                economy_min_index </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> economy_total.</span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">(economy_total_price)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> bussiness_total </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> []:</span></span>
<span class="line"><span style="color:#ABB2BF;">                bussiness_total_price </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> min</span><span style="color:#ABB2BF;">(bussiness_total)</span></span>
<span class="line"><span style="color:#ABB2BF;">                bussiness_min_index </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> bussiness_total.</span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">(bussiness_total_price)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> economy_min_index </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                economy_origin_price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> economy[economy_min_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">                economy_tax_price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> economy_tax[economy_min_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">                economy_full_price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> economy_full[economy_min_index]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> bussiness_min_index </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                bussiness_origin_price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> bussiness[bussiness_min_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">                bussiness_tax_price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> bussiness_tax[bussiness_min_index]</span></span>
<span class="line"><span style="color:#ABB2BF;">                bussiness_full_price </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> bussiness_full[bussiness_min_index]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            price_info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">                &quot;flightNo&quot;</span><span style="color:#ABB2BF;">: flightNo,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;economy_origin&quot;</span><span style="color:#ABB2BF;">: economy_origin_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;economy_tax&quot;</span><span style="color:#ABB2BF;">: economy_tax_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;economy_total&quot;</span><span style="color:#ABB2BF;">: economy_total_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;economy_full&quot;</span><span style="color:#ABB2BF;">: economy_full_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;bussiness_origin&quot;</span><span style="color:#ABB2BF;">: bussiness_origin_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;bussiness_tax&quot;</span><span style="color:#ABB2BF;">: bussiness_tax_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;bussiness_total&quot;</span><span style="color:#ABB2BF;">: bussiness_total_price,</span></span>
<span class="line"><span style="color:#98C379;">                &quot;bussiness_full&quot;</span><span style="color:#ABB2BF;">: bussiness_full_price,</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # self.prices=self.prices.append(price_info,ignore_index=True)</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.prices </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                [</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.prices, pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">(price_info, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])], </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> mergedata</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.df </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.flights.</span><span style="color:#61AFEF;">merge</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.prices, </span><span style="color:#E06C75;font-style:italic;">on</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;flightNo&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.df[</span><span style="color:#98C379;">&quot;dateGetTime&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> dt.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> rename_col:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 对pandas的columns进行重命名</span></span>
<span class="line"><span style="color:#ABB2BF;">                order </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;数据获取日期&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;航班号&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;航空公司&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;出发日期&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;出发时间&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达日期&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达时间&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;飞行时长&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;出发国家&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;出发城市&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;出发机场&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;出发机场三字码&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达国家&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达城市&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达机场&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达机场三字码&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;飞机型号&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;飞机尺寸&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;飞机型号三字码&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;到达准点率&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;停留次数&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                origin </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;dateGetTime&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;flightNo&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;marketAirlineName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureday&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departuretime&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalday&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivaltime&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;duration&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureCountryName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureCityName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureAirportName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;departureAirportCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalCountryName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalCityName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalAirportName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalAirportCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;aircraftName&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;aircraftSize&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;aircraftCode&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;arrivalPunctuality&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                    &quot;stopCount&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">                columns </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> dict</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">zip</span><span style="color:#ABB2BF;">(origin, order))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">                self</span><span style="color:#ABB2BF;">.df </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.df.</span><span style="color:#61AFEF;">rename</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">columns</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">columns)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> del_info:</span></span>
<span class="line"><span style="color:#E5C07B;">                    self</span><span style="color:#ABB2BF;">.df </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.df[order]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            files_dir </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                os.</span><span style="color:#61AFEF;">getcwd</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.date, dt.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(files_dir):</span></span>
<span class="line"><span style="color:#ABB2BF;">                os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(files_dir)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            filename </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                files_dir, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.csv&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">            self</span><span style="color:#ABB2BF;">.df.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 数据爬取完成 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">            print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 合并数据失败 </span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(e).</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Stacktrace:&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            return</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    driver </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> init_driver</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    citys </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> gen_citys</span><span style="color:#ABB2BF;">(crawal_citys)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    flight_dates </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> generate_flight_dates</span><span style="color:#ABB2BF;">(crawal_days, begin_date, end_date, start_interval, days_interval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    Flight_DataFetcher </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> DataFetcher</span><span style="color:#ABB2BF;">(driver)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> city </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> citys:</span></span>
<span class="line"><span style="color:#ABB2BF;">        Flight_DataFetcher.city </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> city</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> flight_date </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> flight_dates:</span></span>
<span class="line"><span style="color:#ABB2BF;">            Flight_DataFetcher.date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flight_date</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(os.</span><span style="color:#61AFEF;">getcwd</span><span style="color:#ABB2BF;">(), flight_date, dt.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">), </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.csv&quot;</span><span style="color:#ABB2BF;">)):</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#C678DD;">                    f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 文件已存在:</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(os.</span><span style="color:#61AFEF;">getcwd</span><span style="color:#ABB2BF;">(), flight_date, dt.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">), </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">city[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">city[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.csv&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;http&#39;</span><span style="color:#C678DD;"> not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> Flight_DataFetcher.driver.current_url):</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 当前的URL是：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">driver.current_url</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 初始化页面</span></span>
<span class="line"><span style="color:#ABB2BF;">                Flight_DataFetcher.</span><span style="color:#61AFEF;">get_page</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 后续运行只需更换出发与目的地</span></span>
<span class="line"><span style="color:#ABB2BF;">                Flight_DataFetcher.</span><span style="color:#61AFEF;">change_city</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(crawal_interval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 运行结束退出</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Flight_DataFetcher.driver</span></span>
<span class="line"><span style="color:#ABB2BF;">        driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> An error occurred while quitting the driver: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">_%H-%M-%S&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 程序运行完成！！！！&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br><span class="line-number">624</span><br><span class="line-number">625</span><br><span class="line-number">626</span><br><span class="line-number">627</span><br><span class="line-number">628</span><br><span class="line-number">629</span><br><span class="line-number">630</span><br><span class="line-number">631</span><br><span class="line-number">632</span><br><span class="line-number">633</span><br><span class="line-number">634</span><br><span class="line-number">635</span><br><span class="line-number">636</span><br><span class="line-number">637</span><br><span class="line-number">638</span><br><span class="line-number">639</span><br><span class="line-number">640</span><br><span class="line-number">641</span><br><span class="line-number">642</span><br><span class="line-number">643</span><br><span class="line-number">644</span><br><span class="line-number">645</span><br><span class="line-number">646</span><br><span class="line-number">647</span><br><span class="line-number">648</span><br><span class="line-number">649</span><br><span class="line-number">650</span><br><span class="line-number">651</span><br><span class="line-number">652</span><br><span class="line-number">653</span><br><span class="line-number">654</span><br><span class="line-number">655</span><br><span class="line-number">656</span><br><span class="line-number">657</span><br><span class="line-number">658</span><br><span class="line-number">659</span><br><span class="line-number">660</span><br><span class="line-number">661</span><br><span class="line-number">662</span><br><span class="line-number">663</span><br><span class="line-number">664</span><br><span class="line-number">665</span><br><span class="line-number">666</span><br><span class="line-number">667</span><br><span class="line-number">668</span><br><span class="line-number">669</span><br><span class="line-number">670</span><br><span class="line-number">671</span><br><span class="line-number">672</span><br><span class="line-number">673</span><br><span class="line-number">674</span><br><span class="line-number">675</span><br><span class="line-number">676</span><br><span class="line-number">677</span><br><span class="line-number">678</span><br><span class="line-number">679</span><br><span class="line-number">680</span><br><span class="line-number">681</span><br><span class="line-number">682</span><br><span class="line-number">683</span><br><span class="line-number">684</span><br><span class="line-number">685</span><br><span class="line-number">686</span><br><span class="line-number">687</span><br><span class="line-number">688</span><br><span class="line-number">689</span><br><span class="line-number">690</span><br><span class="line-number">691</span><br><span class="line-number">692</span><br><span class="line-number">693</span><br><span class="line-number">694</span><br><span class="line-number">695</span><br><span class="line-number">696</span><br><span class="line-number">697</span><br><span class="line-number">698</span><br><span class="line-number">699</span><br><span class="line-number">700</span><br><span class="line-number">701</span><br><span class="line-number">702</span><br><span class="line-number">703</span><br><span class="line-number">704</span><br><span class="line-number">705</span><br><span class="line-number">706</span><br><span class="line-number">707</span><br><span class="line-number">708</span><br><span class="line-number">709</span><br><span class="line-number">710</span><br><span class="line-number">711</span><br><span class="line-number">712</span><br><span class="line-number">713</span><br><span class="line-number">714</span><br><span class="line-number">715</span><br><span class="line-number">716</span><br><span class="line-number">717</span><br><span class="line-number">718</span><br><span class="line-number">719</span><br><span class="line-number">720</span><br><span class="line-number">721</span><br><span class="line-number">722</span><br><span class="line-number">723</span><br><span class="line-number">724</span><br><span class="line-number">725</span><br><span class="line-number">726</span><br><span class="line-number">727</span><br><span class="line-number">728</span><br><span class="line-number">729</span><br><span class="line-number">730</span><br><span class="line-number">731</span><br><span class="line-number">732</span><br><span class="line-number">733</span><br><span class="line-number">734</span><br><span class="line-number">735</span><br><span class="line-number">736</span><br><span class="line-number">737</span><br><span class="line-number">738</span><br><span class="line-number">739</span><br><span class="line-number">740</span><br><span class="line-number">741</span><br><span class="line-number">742</span><br><span class="line-number">743</span><br><span class="line-number">744</span><br><span class="line-number">745</span><br><span class="line-number">746</span><br><span class="line-number">747</span><br><span class="line-number">748</span><br><span class="line-number">749</span><br><span class="line-number">750</span><br><span class="line-number">751</span><br><span class="line-number">752</span><br><span class="line-number">753</span><br><span class="line-number">754</span><br><span class="line-number">755</span><br><span class="line-number">756</span><br><span class="line-number">757</span><br><span class="line-number">758</span><br><span class="line-number">759</span><br><span class="line-number">760</span><br><span class="line-number">761</span><br><span class="line-number">762</span><br><span class="line-number">763</span><br><span class="line-number">764</span><br><span class="line-number">765</span><br><span class="line-number">766</span><br><span class="line-number">767</span><br><span class="line-number">768</span><br><span class="line-number">769</span><br><span class="line-number">770</span><br><span class="line-number">771</span><br><span class="line-number">772</span><br><span class="line-number">773</span><br><span class="line-number">774</span><br><span class="line-number">775</span><br><span class="line-number">776</span><br><span class="line-number">777</span><br><span class="line-number">778</span><br><span class="line-number">779</span><br><span class="line-number">780</span><br><span class="line-number">781</span><br><span class="line-number">782</span><br><span class="line-number">783</span><br><span class="line-number">784</span><br><span class="line-number">785</span><br><span class="line-number">786</span><br><span class="line-number">787</span><br><span class="line-number">788</span><br><span class="line-number">789</span><br><span class="line-number">790</span><br><span class="line-number">791</span><br><span class="line-number">792</span><br><span class="line-number">793</span><br><span class="line-number">794</span><br><span class="line-number">795</span><br><span class="line-number">796</span><br><span class="line-number">797</span><br><span class="line-number">798</span><br><span class="line-number">799</span><br><span class="line-number">800</span><br><span class="line-number">801</span><br><span class="line-number">802</span><br><span class="line-number">803</span><br><span class="line-number">804</span><br><span class="line-number">805</span><br><span class="line-number">806</span><br><span class="line-number">807</span><br><span class="line-number">808</span><br><span class="line-number">809</span><br><span class="line-number">810</span><br><span class="line-number">811</span><br><span class="line-number">812</span><br><span class="line-number">813</span><br><span class="line-number">814</span><br><span class="line-number">815</span><br><span class="line-number">816</span><br><span class="line-number">817</span><br><span class="line-number">818</span><br><span class="line-number">819</span><br><span class="line-number">820</span><br><span class="line-number">821</span><br><span class="line-number">822</span><br><span class="line-number">823</span><br><span class="line-number">824</span><br><span class="line-number">825</span><br><span class="line-number">826</span><br><span class="line-number">827</span><br><span class="line-number">828</span><br><span class="line-number">829</span><br><span class="line-number">830</span><br><span class="line-number">831</span><br><span class="line-number">832</span><br><span class="line-number">833</span><br><span class="line-number">834</span><br><span class="line-number">835</span><br><span class="line-number">836</span><br><span class="line-number">837</span><br><span class="line-number">838</span><br><span class="line-number">839</span><br><span class="line-number">840</span><br><span class="line-number">841</span><br><span class="line-number">842</span><br><span class="line-number">843</span><br><span class="line-number">844</span><br><span class="line-number">845</span><br><span class="line-number">846</span><br><span class="line-number">847</span><br><span class="line-number">848</span><br><span class="line-number">849</span><br><span class="line-number">850</span><br><span class="line-number">851</span><br><span class="line-number">852</span><br><span class="line-number">853</span><br><span class="line-number">854</span><br><span class="line-number">855</span><br><span class="line-number">856</span><br><span class="line-number">857</span><br><span class="line-number">858</span><br><span class="line-number">859</span><br><span class="line-number">860</span><br><span class="line-number">861</span><br><span class="line-number">862</span><br><span class="line-number">863</span><br><span class="line-number">864</span><br><span class="line-number">865</span><br><span class="line-number">866</span><br><span class="line-number">867</span><br><span class="line-number">868</span><br><span class="line-number">869</span><br><span class="line-number">870</span><br><span class="line-number">871</span><br><span class="line-number">872</span><br><span class="line-number">873</span><br><span class="line-number">874</span><br><span class="line-number">875</span><br><span class="line-number">876</span><br><span class="line-number">877</span><br><span class="line-number">878</span><br><span class="line-number">879</span><br><span class="line-number">880</span><br><span class="line-number">881</span><br><span class="line-number">882</span><br><span class="line-number">883</span><br><span class="line-number">884</span><br><span class="line-number">885</span><br><span class="line-number">886</span><br><span class="line-number">887</span><br><span class="line-number">888</span><br><span class="line-number">889</span><br><span class="line-number">890</span><br><span class="line-number">891</span><br><span class="line-number">892</span><br><span class="line-number">893</span><br><span class="line-number">894</span><br><span class="line-number">895</span><br><span class="line-number">896</span><br><span class="line-number">897</span><br><span class="line-number">898</span><br><span class="line-number">899</span><br><span class="line-number">900</span><br><span class="line-number">901</span><br><span class="line-number">902</span><br><span class="line-number">903</span><br><span class="line-number">904</span><br><span class="line-number">905</span><br><span class="line-number">906</span><br><span class="line-number">907</span><br><span class="line-number">908</span><br><span class="line-number">909</span><br><span class="line-number">910</span><br><span class="line-number">911</span><br><span class="line-number">912</span><br><span class="line-number">913</span><br><span class="line-number">914</span><br><span class="line-number">915</span><br><span class="line-number">916</span><br><span class="line-number">917</span><br><span class="line-number">918</span><br><span class="line-number">919</span><br><span class="line-number">920</span><br><span class="line-number">921</span><br><span class="line-number">922</span><br><span class="line-number">923</span><br><span class="line-number">924</span><br><span class="line-number">925</span><br><span class="line-number">926</span><br><span class="line-number">927</span><br><span class="line-number">928</span><br><span class="line-number">929</span><br><span class="line-number">930</span><br><span class="line-number">931</span><br><span class="line-number">932</span><br><span class="line-number">933</span><br><span class="line-number">934</span><br><span class="line-number">935</span><br><span class="line-number">936</span><br><span class="line-number">937</span><br><span class="line-number">938</span><br><span class="line-number">939</span><br><span class="line-number">940</span><br><span class="line-number">941</span><br><span class="line-number">942</span><br><span class="line-number">943</span><br><span class="line-number">944</span><br><span class="line-number">945</span><br><span class="line-number">946</span><br><span class="line-number">947</span><br><span class="line-number">948</span><br><span class="line-number">949</span><br><span class="line-number">950</span><br><span class="line-number">951</span><br><span class="line-number">952</span><br><span class="line-number">953</span><br><span class="line-number">954</span><br><span class="line-number">955</span><br><span class="line-number">956</span><br><span class="line-number">957</span><br><span class="line-number">958</span><br><span class="line-number">959</span><br><span class="line-number">960</span><br><span class="line-number">961</span><br><span class="line-number">962</span><br><span class="line-number">963</span><br><span class="line-number">964</span><br><span class="line-number">965</span><br><span class="line-number">966</span><br><span class="line-number">967</span><br><span class="line-number">968</span><br><span class="line-number">969</span><br><span class="line-number">970</span><br><span class="line-number">971</span><br><span class="line-number">972</span><br><span class="line-number">973</span><br><span class="line-number">974</span><br><span class="line-number">975</span><br><span class="line-number">976</span><br><span class="line-number">977</span><br><span class="line-number">978</span><br><span class="line-number">979</span><br><span class="line-number">980</span><br><span class="line-number">981</span><br><span class="line-number">982</span><br><span class="line-number">983</span><br><span class="line-number">984</span><br><span class="line-number">985</span><br><span class="line-number">986</span><br><span class="line-number">987</span><br><span class="line-number">988</span><br><span class="line-number">989</span><br><span class="line-number">990</span><br><span class="line-number">991</span><br><span class="line-number">992</span><br><span class="line-number">993</span><br><span class="line-number">994</span><br><span class="line-number">995</span><br><span class="line-number">996</span><br><span class="line-number">997</span><br><span class="line-number">998</span><br><span class="line-number">999</span><br><span class="line-number">1000</span><br><span class="line-number">1001</span><br><span class="line-number">1002</span><br><span class="line-number">1003</span><br><span class="line-number">1004</span><br><span class="line-number">1005</span><br><span class="line-number">1006</span><br><span class="line-number">1007</span><br><span class="line-number">1008</span><br><span class="line-number">1009</span><br><span class="line-number">1010</span><br><span class="line-number">1011</span><br><span class="line-number">1012</span><br><span class="line-number">1013</span><br><span class="line-number">1014</span><br><span class="line-number">1015</span><br><span class="line-number">1016</span><br><span class="line-number">1017</span><br><span class="line-number">1018</span><br><span class="line-number">1019</span><br><span class="line-number">1020</span><br><span class="line-number">1021</span><br><span class="line-number">1022</span><br><span class="line-number">1023</span><br><span class="line-number">1024</span><br><span class="line-number">1025</span><br><span class="line-number">1026</span><br><span class="line-number">1027</span><br><span class="line-number">1028</span><br><span class="line-number">1029</span><br><span class="line-number">1030</span><br><span class="line-number">1031</span><br><span class="line-number">1032</span><br><span class="line-number">1033</span><br><span class="line-number">1034</span><br><span class="line-number">1035</span><br><span class="line-number">1036</span><br><span class="line-number">1037</span><br><span class="line-number">1038</span><br><span class="line-number">1039</span><br><span class="line-number">1040</span><br><span class="line-number">1041</span><br><span class="line-number">1042</span><br><span class="line-number">1043</span><br><span class="line-number">1044</span><br><span class="line-number">1045</span><br><span class="line-number">1046</span><br><span class="line-number">1047</span><br><span class="line-number">1048</span><br><span class="line-number">1049</span><br><span class="line-number">1050</span><br><span class="line-number">1051</span><br><span class="line-number">1052</span><br><span class="line-number">1053</span><br><span class="line-number">1054</span><br><span class="line-number">1055</span><br><span class="line-number">1056</span><br><span class="line-number">1057</span><br><span class="line-number">1058</span><br><span class="line-number">1059</span><br><span class="line-number">1060</span><br><span class="line-number">1061</span><br><span class="line-number">1062</span><br><span class="line-number">1063</span><br><span class="line-number">1064</span><br><span class="line-number">1065</span><br><span class="line-number">1066</span><br><span class="line-number">1067</span><br><span class="line-number">1068</span><br><span class="line-number">1069</span><br><span class="line-number">1070</span><br><span class="line-number">1071</span><br><span class="line-number">1072</span><br><span class="line-number">1073</span><br><span class="line-number">1074</span><br><span class="line-number">1075</span><br><span class="line-number">1076</span><br><span class="line-number">1077</span><br><span class="line-number">1078</span><br><span class="line-number">1079</span><br><span class="line-number">1080</span><br><span class="line-number">1081</span><br><span class="line-number">1082</span><br><span class="line-number">1083</span><br><span class="line-number">1084</span><br><span class="line-number">1085</span><br><span class="line-number">1086</span><br><span class="line-number">1087</span><br><span class="line-number">1088</span><br><span class="line-number">1089</span><br><span class="line-number">1090</span><br><span class="line-number">1091</span><br><span class="line-number">1092</span><br><span class="line-number">1093</span><br><span class="line-number">1094</span><br><span class="line-number">1095</span><br><span class="line-number">1096</span><br><span class="line-number">1097</span><br><span class="line-number">1098</span><br><span class="line-number">1099</span><br><span class="line-number">1100</span><br><span class="line-number">1101</span><br><span class="line-number">1102</span><br><span class="line-number">1103</span><br><span class="line-number">1104</span><br><span class="line-number">1105</span><br><span class="line-number">1106</span><br><span class="line-number">1107</span><br><span class="line-number">1108</span><br><span class="line-number">1109</span><br><span class="line-number">1110</span><br><span class="line-number">1111</span><br><span class="line-number">1112</span><br><span class="line-number">1113</span><br><span class="line-number">1114</span><br><span class="line-number">1115</span><br><span class="line-number">1116</span><br><span class="line-number">1117</span><br><span class="line-number">1118</span><br><span class="line-number">1119</span><br><span class="line-number">1120</span><br><span class="line-number">1121</span><br><span class="line-number">1122</span><br><span class="line-number">1123</span><br><span class="line-number">1124</span><br><span class="line-number">1125</span><br><span class="line-number">1126</span><br><span class="line-number">1127</span><br><span class="line-number">1128</span><br><span class="line-number">1129</span><br><span class="line-number">1130</span><br><span class="line-number">1131</span><br><span class="line-number">1132</span><br><span class="line-number">1133</span><br><span class="line-number">1134</span><br><span class="line-number">1135</span><br><span class="line-number">1136</span><br><span class="line-number">1137</span><br><span class="line-number">1138</span><br></div></div><p><strong>代码说明</strong></p><ol><li>导入模块：代码开始处导入了多个模块，包括网络请求（requests）、数据处理（pandas）、自动化网页操作（selenium）、日期处理（datetime）等。</li><li>配置和初始化：定义了一系列变量来设置爬虫的参数，如爬取的城市、日期范围、时间间隔、是否只抓取直飞信息等。</li><li>驱动器初始化：init_driver() 函数初始化了一个 web 驱动器，这里使用的是 Edge 驱动器。配置了多个浏览器选项，包括隐身模式、禁用 GPU 等，并且通过读取外部的 JavaScript 文件（stealth.min.js）来尝试隐藏自动化操作的痕迹。</li><li>城市和日期生成：gen_citys()函数生成了一个城市组合列表，用于后续爬取不同城市间的航班。generate_flight_dates() 函数根据设置的参数生成了需要爬取的日期列表。</li></ol><p>5.数据抓取逻辑：DataFetcher 类定义了一系列方法来抓取和处理数据。包括登录操作、页面元素点击与交互、航班数据请求、数据解析和处理等。</p><ol start="6"><li>执行流程：在 if <strong>name</strong> == &quot;<strong>main</strong>&quot;: 块中，脚本初始化驱动器，生成城市和日期列表，然后遍历每个城市对和日期，使用 <code>DataFetcher</code> 类的实例来执行数据抓取和处理的各个步骤。</li><li>结果保存：抓取到的数据被处理和合并为 DataFrame，然后保存到 CSV 文件中。</li><li>异常处理和日志：脚本中包含了多处异常处理，以便在抓取过程中遇到问题时记录日志并进行重试。</li><li>退出：最后，脚本尝试关闭驱动器以结束爬虫任务。</li></ol><p>这个脚本显示了高级别的自动化和数据处理能力，但也需要注意维护和执行此脚本可能需要对 selenium 库和网页自动化有相当的了解。由于它与实际的网页交互，其持续运行可能需要定期更新以适应目标网站的更改。此外，长时间或大规模的自动化爬虫可能违反某些网站的服务条款。</p><p>注意事项</p><p>IP 限制解决方案：利用页面特性和用户模拟，规避了 IP 限制，提高了爬取稳定性。</p><p>数据校验与解析：对获取的数据进行严格的数据质量和完整性校验，包括 gzip 解压缩和 JSON 格式解析。</p><h1 id="python-抢票神器助你一票在手" tabindex="-1">Python 抢票神器助你一票在手 <a class="header-anchor" href="#python-抢票神器助你一票在手" aria-label="Permalink to &quot;Python 抢票神器助你一票在手&quot;">​</a></h1><p>五一小长假来临，火车票抢票大战再度上演！每到这个时候，不少人都为了一张回家的火车票而焦头烂额，微信群里各种转发帮助抢票。面对火车票供不应求的局面，许多人只能望票兴叹。然而，现在有了 Python 神器 py12306，或许能帮你在这场抢票大战中脱颖而出，轻松拿到回家的车票，让出行变得更加无忧！</p><p>项目地址：<a href="https://github.com/pjialin/py12306" target="_blank" rel="noreferrer">https://github.com/pjialin/py12306</a></p><p><code>py12306</code> 项目是一个自动抢票工具，用于在 12306 网站上自动化地为用户抢购火车票。而且功能强大。</p><p>使用 py12306 抢票工具的基本步骤如下：</p><p><strong>配置 python 环境</strong></p><p>首先你需要配置 python 环境，py12306 需要运行在 python 3.6 以上版本，下载 python 或者 anaconda 配置环境</p><p><strong>克隆仓库并安装依赖：</strong></p><p>你需要从 GitHub 上克隆 py12306 的仓库到本地，并使用 pip 安装所需的依赖项。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">git</span><span style="color:#98C379;"> clone</span><span style="color:#98C379;"> https://github.com/pjialin/py12306</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> py12306</span></span>
<span class="line"><span style="color:#61AFEF;">pip</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -r</span><span style="color:#98C379;"> requirements.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>配置工具：</strong></p><p>然后，你需要复制示例配置文件并对其进行编辑，填入自己的 12306 账号、密码、乘客信息等。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cp</span><span style="color:#98C379;"> env.py.example</span><span style="color:#98C379;"> env.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>编辑 env.py 文件，填入正确的配置信息。</p><p><strong>测试运行：</strong></p><p>在正式运行抢票之前，可以先进行一些测试，确保配置正确以及通知功能可用。</p><p>开始测试 -t</p><p>测试通知消息 (语音, 邮件) -t -n</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">python</span><span style="color:#98C379;"> main.py</span><span style="color:#D19A66;"> -t</span><span style="color:#7F848E;font-style:italic;">  # 运行测试</span></span>
<span class="line"><span style="color:#61AFEF;">python</span><span style="color:#98C379;"> main.py</span><span style="color:#D19A66;"> -t</span><span style="color:#D19A66;"> -n</span><span style="color:#7F848E;font-style:italic;">  # 运行测试并测试通知功能</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>正式运行：</strong></p><p>当所有配置和测试都完成后，你可以开始正式运行抢票脚本。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">python</span><span style="color:#98C379;"> main.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="`+b+`" alt="image-20240511170544803"></p><p>此外，py12306 还提供了 Web 管理页面，用户可以通过 Web 界面来配置抢票任务、查看抢票结果等。</p><p>需要注意的是，使用自动化抢票工具可能会违反 12306 网站的使用协议，甚至可能涉及违法行为。因此，在使用此类工具时，请务必了解并遵守相关法律法规和网站规定。同时，由于抢票过程涉及到大量网络请求和数据处理，可能会对 12306 服务器造成一定压力，因此在使用时请保持理性，避免过度占用资源。</p><p>最后，抢票成功率不仅取决于工具本身，还受到多种因素的影响，如车次、座位类型、购票时间等。因此，在使用自动化抢票工具时，请保持耐心和理性，不要过分依赖工具而忽略了其他购票途径。</p><h1 id="python-写身份证信息查询-地区、星座、年龄、性别-等" tabindex="-1">Python 写身份证信息查询, 地区、星座、年龄、性别 等 <a class="header-anchor" href="#python-写身份证信息查询-地区、星座、年龄、性别-等" aria-label="Permalink to &quot;Python 写身份证信息查询, 地区、星座、年龄、性别 等&quot;">​</a></h1><p><strong>代码：</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> tkinter </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> tk</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tkinter </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ttk</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tkinter </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> messagebox</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_id_card_info</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    id_card </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> id_entry.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    url </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;https://tools.mgtv100.com/external/v1/identity_info/query?idCard=</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">id_card</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 提取返回的数据</span></span>
<span class="line"><span style="color:#ABB2BF;">        status </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> result[</span><span style="color:#98C379;">&#39;status&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        code </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(result[</span><span style="color:#98C379;">&#39;code&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> result[</span><span style="color:#98C379;">&#39;data&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 提取个人信息</span></span>
<span class="line"><span style="color:#ABB2BF;">        area </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;area&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        province </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;province&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        city </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;city&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        county </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;county&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        gender </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;gender&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        birthday </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;birthday&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        zodiac </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;zodiac&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        age </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;age&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        constellation </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#98C379;">&#39;constellation&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 更新界面显示</span></span>
<span class="line"><span style="color:#ABB2BF;">        status_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;状态：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> status)</span></span>
<span class="line"><span style="color:#ABB2BF;">        code_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;状态码：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> code)</span></span>
<span class="line"><span style="color:#ABB2BF;">        area_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;地区：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> area)</span></span>
<span class="line"><span style="color:#ABB2BF;">        province_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;省份：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> province)</span></span>
<span class="line"><span style="color:#ABB2BF;">        city_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;城市：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> city)</span></span>
<span class="line"><span style="color:#ABB2BF;">        county_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;县区：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> county)</span></span>
<span class="line"><span style="color:#ABB2BF;">        gender_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;性别：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> gender)</span></span>
<span class="line"><span style="color:#ABB2BF;">        birthday_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;生日：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> birthday)</span></span>
<span class="line"><span style="color:#ABB2BF;">        zodiac_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;生肖：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> zodiac)</span></span>
<span class="line"><span style="color:#ABB2BF;">        age_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;年龄：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(age))</span></span>
<span class="line"><span style="color:#ABB2BF;">        constellation_label.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;星座：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> constellation)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> KeyError:</span></span>
<span class="line"><span style="color:#ABB2BF;">        messagebox.</span><span style="color:#61AFEF;">showerror</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;错误&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;请输入正确的身份证号&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建界面</span></span>
<span class="line"><span style="color:#ABB2BF;">window </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Tk</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">window.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;身份证信息查询--微信公众号:蓝胖子之家&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">window.</span><span style="color:#61AFEF;">geometry</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;400x500&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置背景颜色</span></span>
<span class="line"><span style="color:#ABB2BF;">window.</span><span style="color:#61AFEF;">configure</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建输入框和按钮</span></span>
<span class="line"><span style="color:#ABB2BF;">id_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;身份证号码：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">id_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">pady</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">id_entry </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Entry</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#333333&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">insertbackground</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">relief</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;flat&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">id_entry.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">pady</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">search_button </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ttk.</span><span style="color:#61AFEF;">Button</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;查询&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">command</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">get_id_card_info, </span><span style="color:#E06C75;font-style:italic;">style</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;TButton&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">search_button.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">pady</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">search_button.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">pady</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建显示结果的标签</span></span>
<span class="line"><span style="color:#ABB2BF;">status_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;状态：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">status_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">code_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;状态码：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">code_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">area_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;地区：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">area_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">province_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;省份：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">province_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">city_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;城市：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">city_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">county_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;县区：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">county_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">gender_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;性别：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">gender_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">birthday_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;生日：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">birthday_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">zodiac_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;生肖：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">zodiac_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">age_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;年龄：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">age_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">constellation_label </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(window, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;星座：&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">fg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">constellation_label.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置按钮样式</span></span>
<span class="line"><span style="color:#ABB2BF;">style </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ttk.</span><span style="color:#61AFEF;">Style</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">style.</span><span style="color:#61AFEF;">configure</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;TButton&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">foreground</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#00FF00&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">background</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#000000&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">font</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Consolas&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">window.</span><span style="color:#61AFEF;">mainloop</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><ol><li>首先，我们导入了<strong>requests</strong>库用于发送 HTTP 请求，以及<strong>tkinter</strong>库用于创建 GUI 界面。</li><li>然后，我们定义了一个名为<strong>get_id_card_info()<strong>的函数，该函数将在用户点击“查询”按钮时被调用。该函数的作用是获取用户在输入框中输入的身份证号码，并构建了一个</strong>API</strong>的<strong>URL</strong>，该 URL 包含了身份证号码作为查询参数。</li><li>在<strong>get_id_card_info()<strong>函数中，我们使用</strong>requests</strong>库发送了一个<strong>GET</strong>请求到<strong>API</strong>，并获取到了返回的响应。我们将响应的内容解析为<strong>JSON</strong>格式，并提取出了其中的一些字段，如状态、状态码和数据。</li><li>接下来，我们更新了<strong>GUI</strong>界面上的标签，将获取到的信息显示出来。我们创建了多个标签，用于显示状态、状态码、地区、省份、城市、县区、性别、生日、生肖、年龄和星座等信息。</li><li>在主程序中，我们创建了一个<strong>tkinter</strong>的主窗口，并设置了窗口的标题和大小。</li><li><strong>我们创建了一个标签和一个输入框，用于用户输入身份证号码，以及一个按钮用于查询信息。</strong></li><li>我们将按钮绑定到**get_id_card_info()****函数，这样当用户点击按钮时，就会调用该函数进行查询。</li><li><strong>我们还设置了按钮的样式，使其具有一定的外观效果。</strong></li><li>最后，我们启动了<strong>tkinter</strong>的主循环，这样<strong>GUI</strong>界面就会显示出来，并且可以处理用户的交互。</li></ol><p><strong>运行效果：</strong></p><p><img src="`+u+`" alt="image-20240428021246470"></p><h1 id="python-自动化办公实战脚本合集" tabindex="-1">Python 自动化办公实战脚本合集 <a class="header-anchor" href="#python-自动化办公实战脚本合集" aria-label="Permalink to &quot;Python 自动化办公实战脚本合集&quot;">​</a></h1><h2 id="_1、批量文件重命名神器" tabindex="-1">1、批量文件重命名神器 <a class="header-anchor" href="#_1、批量文件重命名神器" aria-label="Permalink to &quot;1、批量文件重命名神器&quot;">​</a></h2><p>在工作中，我们常常需要对大量文件进行批量重命名，Python 帮你轻松搞定！</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> batch_rename</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">prefix</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">suffix</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i, filename </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(path)):</span></span>
<span class="line"><span style="color:#ABB2BF;">        new_name </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">prefix</span><span style="color:#D19A66;">}{</span><span style="color:#ABB2BF;">i</span><span style="color:#C678DD;">:03d</span><span style="color:#D19A66;">}{</span><span style="color:#ABB2BF;">suffix</span><span style="color:#D19A66;">}{</span><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(filename)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        old_file </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(path, filename)</span></span>
<span class="line"><span style="color:#ABB2BF;">        new_file </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(path, new_name)</span></span>
<span class="line"><span style="color:#ABB2BF;">        os.</span><span style="color:#61AFEF;">rename</span><span style="color:#ABB2BF;">(old_file, new_file)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">batch_rename</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/path/to/your/directory&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;file_&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.txt&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_2、自动发送邮件通知" tabindex="-1">2、自动发送邮件通知 <a class="header-anchor" href="#_2、自动发送邮件通知" aria-label="Permalink to &quot;2、自动发送邮件通知&quot;">​</a></h2><p>告别手动发送，用 Python 编写定时发送邮件的自动化脚本。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.text </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEText</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">to_addr</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">subject</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">content</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    smtp_server </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;smtp.example.com&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    username </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;your-email@example.com&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    password </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;your-password&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    msg </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MIMEText</span><span style="color:#ABB2BF;">(content)</span></span>
<span class="line"><span style="color:#ABB2BF;">    msg[</span><span style="color:#98C379;">&#39;Subject&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subject</span></span>
<span class="line"><span style="color:#ABB2BF;">    msg[</span><span style="color:#98C379;">&#39;From&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> username</span></span>
<span class="line"><span style="color:#ABB2BF;">    msg[</span><span style="color:#98C379;">&#39;To&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> to_addr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    server </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> smtplib.</span><span style="color:#61AFEF;">SMTP</span><span style="color:#ABB2BF;">(smtp_server, </span><span style="color:#D19A66;">587</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">starttls</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(username, password)</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(username, to_addr, msg.</span><span style="color:#61AFEF;">as_string</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;receiver@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;每日报告提醒&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;今日报告已生成，请查收。&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_3、定时任务自动化执行" tabindex="-1">3、定时任务自动化执行 <a class="header-anchor" href="#_3、定时任务自动化执行" aria-label="Permalink to &quot;3、定时任务自动化执行&quot;">​</a></h2><p>使用 Python 调度库，实现定时执行任务的自动化脚本。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> schedule</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> job_to_schedule</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;当前时间：&quot;</span><span style="color:#ABB2BF;">, time.</span><span style="color:#61AFEF;">ctime</span><span style="color:#ABB2BF;">(), </span><span style="color:#98C379;">&quot;任务正在执行...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义每天9点执行任务</span></span>
<span class="line"><span style="color:#ABB2BF;">schedule.</span><span style="color:#61AFEF;">every</span><span style="color:#ABB2BF;">().day.</span><span style="color:#61AFEF;">at</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;09:00&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">do</span><span style="color:#ABB2BF;">(job_to_schedule)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">while</span><span style="color:#D19A66;"> True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    schedule.</span><span style="color:#61AFEF;">run_pending</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 运行此脚本后，每天上午9点会自动打印当前时间及提示信息</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="_4、数据库操作自动化" tabindex="-1">4、数据库操作自动化 <a class="header-anchor" href="#_4、数据库操作自动化" aria-label="Permalink to &quot;4、数据库操作自动化&quot;">​</a></h2><p>简化数据库管理，Python 帮你自动化执行 CRUD 操作。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sqlite3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> create_connection</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">db_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    conn </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        conn </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sqlite3.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(db_file)</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;成功连接到SQLite数据库：</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">db_file</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Error </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> conn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> insert_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">conn</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">table_name</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data_dict</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    keys </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;, &#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(data_dict.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    values </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;, &#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">v</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;&quot;</span><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> v </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data_dict.</span><span style="color:#61AFEF;">values</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    sql </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;INSERT INTO </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">table_name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> (</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">keys</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">) VALUES (</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">values</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">);&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        cursor </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> conn.</span><span style="color:#61AFEF;">cursor</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(sql)</span></span>
<span class="line"><span style="color:#ABB2BF;">        conn.</span><span style="color:#61AFEF;">commit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;数据插入成功！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> sqlite3.Error </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#ABB2BF;">conn </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> create_connection</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;my_database.db&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;John Doe&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;age&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#61AFEF;">insert_data</span><span style="color:#ABB2BF;">(conn, </span><span style="color:#98C379;">&#39;users&#39;</span><span style="color:#ABB2BF;">, data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 在适当时候关闭数据库连接</span></span>
<span class="line"><span style="color:#ABB2BF;">conn.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="_5、网页内容自动化抓取" tabindex="-1">5、网页内容自动化抓取 <a class="header-anchor" href="#_5、网页内容自动化抓取" aria-label="Permalink to &quot;5、网页内容自动化抓取&quot;">​</a></h2><p>利用 BeautifulSoup 和 requests 库，编写 Python 爬虫获取所需网页信息。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> bs4 </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> BeautifulSoup</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> fetch_web_content</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> response.status_code </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        soup </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> BeautifulSoup</span><span style="color:#ABB2BF;">(response.text, </span><span style="color:#98C379;">&#39;html.parser&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 示例提取页面标题</span></span>
<span class="line"><span style="color:#ABB2BF;">        title </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> soup.</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;title&#39;</span><span style="color:#ABB2BF;">).text</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> title</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#98C379;"> &quot;无法获取网页内容&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#ABB2BF;">url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;https://example.com&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">web_title </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> fetch_web_content</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;网页标题：&quot;</span><span style="color:#ABB2BF;">, web_title)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_6、数据清洗自动化" tabindex="-1">6、数据清洗自动化 <a class="header-anchor" href="#_6、数据清洗自动化" aria-label="Permalink to &quot;6、数据清洗自动化&quot;">​</a></h2><p>使用 Pandas 库，实现复杂数据处理和清洗的自动化。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> clean_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 示例：处理缺失值</span></span>
<span class="line"><span style="color:#ABB2BF;">    df.</span><span style="color:#61AFEF;">fillna</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;N/A&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">inplace</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 示例：去除重复行</span></span>
<span class="line"><span style="color:#ABB2BF;">    df.</span><span style="color:#61AFEF;">drop_duplicates</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">inplace</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 示例：转换列类型</span></span>
<span class="line"><span style="color:#ABB2BF;">    df[</span><span style="color:#98C379;">&#39;date_column&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">to_datetime</span><span style="color:#ABB2BF;">(df[</span><span style="color:#98C379;">&#39;date_column&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> df</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#ABB2BF;">cleaned_df </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> clean_data</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data.csv&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;数据清洗完成，已准备就绪！&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_7、图片批量压缩" tabindex="-1">7、图片批量压缩 <a class="header-anchor" href="#_7、图片批量压缩" aria-label="Permalink to &quot;7、图片批量压缩&quot;">​</a></h2><p>用 Python 快速压缩大量图片以节省存储空间。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> compress_images</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">dir_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">quality</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">90</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> filename </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(dir_path):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> filename.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.jpg&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> filename.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.png&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(dir_path, filename))</span></span>
<span class="line"><span style="color:#ABB2BF;">            img.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(dir_path, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;compressed_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;font-style:italic;">optimize</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">quality</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">quality)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">compress_images</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/path/to/images&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">quality</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">80</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_8、文件内容查找替换" tabindex="-1">8、文件内容查找替换 <a class="header-anchor" href="#_8、文件内容查找替换" aria-label="Permalink to &quot;8、文件内容查找替换&quot;">​</a></h2><p>Python 脚本帮助你一键在多个文件中搜索并替换指定内容。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> fileinput</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> search_replace_in_files</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">dir_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">search_text</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">replace_text</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> line </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> fileinput.</span><span style="color:#61AFEF;">input</span><span style="color:#ABB2BF;">([</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">dir_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/*&quot;</span><span style="color:#ABB2BF;">], </span><span style="color:#E06C75;font-style:italic;">inplace</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(line.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(search_text, replace_text), </span><span style="color:#E06C75;font-style:italic;">end</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">search_replace_in_files</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/path/to/files&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;old_text&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;new_text&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_9、日志文件分析自动化" tabindex="-1">9、日志文件分析自动化 <a class="header-anchor" href="#_9、日志文件分析自动化" aria-label="Permalink to &quot;9、日志文件分析自动化&quot;">​</a></h2><p>通过 Python 解析日志文件，提取关键信息进行统计分析。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> analyze_log</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">log_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(log_file, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">        lines </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> f.</span><span style="color:#61AFEF;">readlines</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    error_count </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> line </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> lines:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#98C379;"> &quot;ERROR&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> line:</span></span>
<span class="line"><span style="color:#ABB2BF;">            error_count </span><span style="color:#56B6C2;">+=</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;日志文件中包含 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">error_count</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 条错误记录。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">analyze_log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;application.log&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_10、数据可视化自动化" tabindex="-1">10、数据可视化自动化 <a class="header-anchor" href="#_10、数据可视化自动化" aria-label="Permalink to &quot;10、数据可视化自动化&quot;">​</a></h2><p>利用 Matplotlib 库，实现数据的自动图表生成。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> matplotlib.pyplot </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> plt</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> visualize_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">data_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_csv</span><span style="color:#ABB2BF;">(data_file)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 示例：绘制柱状图</span></span>
<span class="line"><span style="color:#ABB2BF;">    df.</span><span style="color:#61AFEF;">plot</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">kind</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;bar&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;category&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;数据分布&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">xlabel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;类别&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">ylabel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;值&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    plt.</span><span style="color:#61AFEF;">show</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">visualize_data</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data.csv&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="_11、邮件附件批量下载" tabindex="-1">11、邮件附件批量下载 <a class="header-anchor" href="#_11、邮件附件批量下载" aria-label="Permalink to &quot;11、邮件附件批量下载&quot;">​</a></h2><p>通过 Python 解析邮件，自动化下载所有附件。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> imaplib</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> email</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.header </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> decode_header</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> download_attachments</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">email_addr</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">password</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">imap_server</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">folder</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;INBOX&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    mail </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> imaplib.</span><span style="color:#61AFEF;">IMAP4_SSL</span><span style="color:#ABB2BF;">(imap_server)</span></span>
<span class="line"><span style="color:#ABB2BF;">    mail.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(email_addr, password)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    mail.</span><span style="color:#61AFEF;">select</span><span style="color:#ABB2BF;">(folder)</span></span>
<span class="line"><span style="color:#ABB2BF;">    result, data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mail.</span><span style="color:#61AFEF;">uid</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;search&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;ALL&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    uids </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> uid </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> uids:</span></span>
<span class="line"><span style="color:#ABB2BF;">        _, msg_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mail.</span><span style="color:#61AFEF;">uid</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;fetch&#39;</span><span style="color:#ABB2BF;">, uid, </span><span style="color:#98C379;">&#39;(RFC822)&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        raw_email </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> msg_data[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        email_message </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> email.</span><span style="color:#61AFEF;">message_from_string</span><span style="color:#ABB2BF;">(raw_email)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> part </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> email_message.</span><span style="color:#61AFEF;">walk</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> part.</span><span style="color:#61AFEF;">get_content_maintype</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;multipart&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> part.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Content-Disposition&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            filename </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> part.</span><span style="color:#61AFEF;">get_filename</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> bool</span><span style="color:#ABB2BF;">(filename):</span></span>
<span class="line"><span style="color:#ABB2BF;">                file_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> part.</span><span style="color:#61AFEF;">get_payload</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">decode</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/path/to/download&#39;</span><span style="color:#ABB2BF;">, filename), </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    f.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(file_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    mail.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    mail.</span><span style="color:#61AFEF;">logout</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">download_attachments</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;your-email@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;your-password&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;imap.example.com&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="_12、定时发送报告自动化" tabindex="-1">12、定时发送报告自动化 <a class="header-anchor" href="#_12、定时发送报告自动化" aria-label="Permalink to &quot;12、定时发送报告自动化&quot;">​</a></h2><p>根据数据库或文件内容，自动生成并定时发送日报/周报。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.text </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEText</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.multipart </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEMultipart</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> generate_report</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">source</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">to_addr</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">subject</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 假设这里是从数据库或文件中获取数据并生成报告内容</span></span>
<span class="line"><span style="color:#ABB2BF;">    report_content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&quot;Data&quot;</span><span style="color:#ABB2BF;">: [</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;Info&quot;</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&quot;A&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;B&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;C&quot;</span><span style="color:#ABB2BF;">]}).</span><span style="color:#61AFEF;">to_html</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    msg </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MIMEMultipart</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    msg[</span><span style="color:#98C379;">&#39;From&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;your-email@example.com&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    msg[</span><span style="color:#98C379;">&#39;To&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> to_addr</span></span>
<span class="line"><span style="color:#ABB2BF;">    msg[</span><span style="color:#98C379;">&#39;Subject&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subject</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    msg.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">MIMEText</span><span style="color:#ABB2BF;">(report_content, </span><span style="color:#98C379;">&#39;html&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    server </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> smtplib.</span><span style="color:#61AFEF;">SMTP</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;smtp.example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">587</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">starttls</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;your-email@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;your-password&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> msg.</span><span style="color:#61AFEF;">as_string</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;your-email@example.com&#39;</span><span style="color:#ABB2BF;">, to_addr, text)</span></span>
<span class="line"><span style="color:#ABB2BF;">    server.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">generate_report</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;receiver@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;每日数据报告&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 结合前面的定时任务脚本，可实现定时发送功能</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_13、自动化性能测试" tabindex="-1">13、自动化性能测试 <a class="header-anchor" href="#_13、自动化性能测试" aria-label="Permalink to &quot;13、自动化性能测试&quot;">​</a></h2><p>使用 Python 的<code>locust</code>库进行 API 接口的压力测试。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> locust </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> HttpUser, task, between</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> WebsiteUser</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpUser</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    wait_time </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> between</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 定义用户操作之间的等待时间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @task</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> load_test_api</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.client.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api/data&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        assert</span><span style="color:#ABB2BF;"> response.status_code </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 200</span><span style="color:#7F848E;font-style:italic;">  # 验证返回状态码为200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @task</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 指定该任务在总任务中的执行频率是其他任务的3倍</span></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> post_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;key&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        response </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> self</span><span style="color:#ABB2BF;">.client.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api/submit&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data)</span></span>
<span class="line"><span style="color:#C678DD;">        assert</span><span style="color:#ABB2BF;"> response.status_code </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 201</span><span style="color:#7F848E;font-style:italic;">  # 验证数据成功提交后的响应状态码</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 运行Locust命令启动性能测试：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># locust -f your_test_script.py --host=http://your-api-url.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_14、自动化部署与回滚脚本" tabindex="-1">14、自动化部署与回滚脚本 <a class="header-anchor" href="#_14、自动化部署与回滚脚本" aria-label="Permalink to &quot;14、自动化部署与回滚脚本&quot;">​</a></h2><p>使用 Fabric 库编写 SSH 远程部署工具，这里以部署 Django 项目为例：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> fabric </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Connection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> deploy</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">host_string</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">password</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">project_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">remote_dir</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    c </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Connection</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">host_string, </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">user, </span><span style="color:#E06C75;font-style:italic;">connect_kwargs</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;">: password})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#ABB2BF;"> c.</span><span style="color:#61AFEF;">cd</span><span style="color:#ABB2BF;">(remote_dir):</span></span>
<span class="line"><span style="color:#ABB2BF;">        c.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;git pull origin master&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 更新代码</span></span>
<span class="line"><span style="color:#ABB2BF;">        c.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;pip install -r requirements.txt&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 安装依赖</span></span>
<span class="line"><span style="color:#ABB2BF;">        c.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;python manage.py migrate&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 执行数据库迁移</span></span>
<span class="line"><span style="color:#ABB2BF;">        c.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;python manage.py collectstatic --noinput&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 静态文件收集</span></span>
<span class="line"><span style="color:#ABB2BF;">        c.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;supervisorctl restart your_project_name&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 重启服务</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例：</span></span>
<span class="line"><span style="color:#61AFEF;">deploy</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">    host_string</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;your-server-ip&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">    user</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;deploy_user&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">    password</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;deploy_password&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">    project_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;/path/to/local/project&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">    remote_dir</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;/path/to/remote/project&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 对于回滚操作，可以基于版本控制系统实现或创建备份，在出现问题时恢复上一版本的部署。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h1 id="python-自动化脚本" tabindex="-1">Python 自动化脚本 <a class="header-anchor" href="#python-自动化脚本" aria-label="Permalink to &quot;Python 自动化脚本&quot;">​</a></h1><p>自动化是现代效率背后的推动力，在 Python 中找到了最佳伙伴——这是一种以其多样化的解决方案而著称的语言，旨在无缝简化任务。凭借其广泛的库支持、内置功能和蓬勃发展的贡献者社区，Python 成为了简化工作流程的终极盟友，提供了无与伦比的便利。在这篇博客中，我们将探讨 10 个令人震惊的使用 Python 的自动化脚本，你需要尝试。 这是你需要尝试的自动化脚本系列的第八部分。</p><h2 id="_1、剪贴板管理器" tabindex="-1">1、剪贴板管理器 <a class="header-anchor" href="#_1、剪贴板管理器" aria-label="Permalink to &quot;1、剪贴板管理器&quot;">​</a></h2><p>📋 你是否曾经在处理多个文本片段时，失去了对你所复制内容的跟踪？是否想过拥有一个可以跟踪你一天所复制所有内容的工具？</p><p>这个自动化脚本监视你复制的一切，无缝地将每个复制的文本存储在一个流畅的图形界面中，这样你就不必在无尽的标签页中搜索，从而避免丢失宝贵的信息。</p><p>这个自动化脚本利用 Pyperclip 库无缝捕捉复制的数据，并集成 Tkinter 来视觉跟踪和管理复制的文本。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入tkinter库，用于创建GUI应用程序，ttk是tkinter的扩展模块，用于提供更现代的界面元素。</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> tkinter astk</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tkinter </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ttk</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入pyperclip库，可以用来复制和粘贴剪贴板内容。</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pyperclip</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，用于更新列表框的内容，将新的剪贴板内容添加到列表中。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">update_listbox</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;"> new_item </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pyperclip.</span><span style="color:#61AFEF;">paste</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 获取当前剪贴板的内容</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> new_item </span><span style="color:#C678DD;">not</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> X:  </span><span style="color:#7F848E;font-style:italic;"># 如果内容不在我们的列表中，则添加它</span></span>
<span class="line"><span style="color:#ABB2BF;"> X.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(new_item)</span></span>
<span class="line"><span style="color:#ABB2BF;"> listbox.</span><span style="color:#61AFEF;">insert</span><span style="color:#ABB2BF;">(tk.</span><span style="color:#D19A66;">END</span><span style="color:#ABB2BF;">, new_item)  </span><span style="color:#7F848E;font-style:italic;"># 在列表框末尾添加新项目</span></span>
<span class="line"><span style="color:#ABB2BF;"> listbox.</span><span style="color:#61AFEF;">insert</span><span style="color:#ABB2BF;">(tk.</span><span style="color:#D19A66;">END</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&quot;----------------------&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 添加分隔线</span></span>
<span class="line"><span style="color:#ABB2BF;"> listbox.</span><span style="color:#61AFEF;">yview</span><span style="color:#ABB2BF;">(tk.</span><span style="color:#D19A66;">END</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 自动滚动到列表框的底部</span></span>
<span class="line"><span style="color:#ABB2BF;"> root.</span><span style="color:#61AFEF;">after</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">, update_listbox)  </span><span style="color:#7F848E;font-style:italic;"># 每1000毫秒（1秒）调用一次此函数，不断更新</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，用于处理列表框中元素的双击事件，将选中的内容复制到剪贴板。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">copy_to_clipboard</span><span style="color:#ABB2BF;">(event):</span></span>
<span class="line"><span style="color:#ABB2BF;"> selected_item </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">listbox.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(listbox.</span><span style="color:#61AFEF;">curselection</span><span style="color:#ABB2BF;">())  </span><span style="color:#7F848E;font-style:italic;"># 获取当前选中的列表项</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> selected_item:</span></span>
<span class="line"><span style="color:#ABB2BF;"> pyperclip.</span><span style="color:#61AFEF;">copy</span><span style="color:#ABB2BF;">(selected_item)  </span><span style="color:#7F848E;font-style:italic;"># 将选中的内容复制到剪贴板</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个空列表，用于存储剪贴板内容。</span></span>
<span class="line"><span style="color:#ABB2BF;">X </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建主窗口</span></span>
<span class="line"><span style="color:#ABB2BF;">root </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tk.</span><span style="color:#61AFEF;">Tk</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">root.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Clipboard</span></span>
<span class="line"><span style="color:#ABB2BF;">Manager</span><span style="color:#98C379;">&quot;)  # 设置窗口标题</span></span>
<span class="line"><span style="color:#ABB2BF;">root.</span><span style="color:#61AFEF;">geometry</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;500x500&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 设置窗口大小</span></span>
<span class="line"><span style="color:#ABB2BF;">root.</span><span style="color:#61AFEF;">configure</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#f0f0f0&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 设置窗口背景颜色</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个框架组件，用于放置其他界面元素</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">frame</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">tk.</span><span style="color:#61AFEF;">Frame</span><span style="color:#ABB2BF;">(root, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#f0f0f0&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">frame.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">padx</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">pady</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 放置框架并设置边距</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 在框架内创建一个标签，显示文本提示</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">label</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">tk.</span><span style="color:#61AFEF;">Label</span><span style="color:#ABB2BF;">(frame, </span><span style="color:#E06C75;font-style:italic;">text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;Clipboard Contents:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">bg</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;#f0f0f0&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">label.</span><span style="color:#61AFEF;">grid</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 使用grid布局管理器放置标签</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个滚动条</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">scrollbar</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">tk.</span><span style="color:#61AFEF;">Scrollbar</span><span style="color:#ABB2BF;">(root)</span></span>
<span class="line"><span style="color:#ABB2BF;">scrollbar.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">side</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">tk.</span><span style="color:#D19A66;">RIGHT</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">fill</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">tk.Y)  </span><span style="color:#7F848E;font-style:italic;"># 放置滚动条在窗口的右侧，填充Y方向</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个列表框，用于显示剪贴板的内容</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">listbox</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">tk.</span><span style="color:#61AFEF;">Listbox</span><span style="color:#ABB2BF;">(root, </span><span style="color:#E06C75;font-style:italic;">width</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">150</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">height</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">150</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">yscrollcommand</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">scrollbar.set)</span></span>
<span class="line"><span style="color:#ABB2BF;">listbox.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">pady</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 放置列表框并设置垂直边距</span></span>
<span class="line"><span style="color:#ABB2BF;">scrollbar.</span><span style="color:#61AFEF;">config</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">command</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">listbox.yview)  </span><span style="color:#7F848E;font-style:italic;"># 设置滚动条控制列表框的垂直滚动</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数，开始更新列表框内容</span></span>
<span class="line"><span style="color:#61AFEF;">update_listbox</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 绑定双击左键事件到copy_to_clipboard函数，实现双击复制功能</span></span>
<span class="line"><span style="color:#ABB2BF;">listbox.</span><span style="color:#61AFEF;">bind</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&lt;Double-Button-1&gt;&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">copy_to_clipboard)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 运行主事件循环，等待用户交互</span></span>
<span class="line"><span style="color:#ABB2BF;">root.</span><span style="color:#61AFEF;">mainloop</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="脚本应用" tabindex="-1">脚本应用： <a class="header-anchor" href="#脚本应用" aria-label="Permalink to &quot;脚本应用：&quot;">​</a></h3><p>•捕获并分类从各种来源复制的研究笔记。</p><p>•扩展脚本可以捕获重要的日历事件、提醒、密码等。</p><h2 id="_2、代码质量检查器" tabindex="-1">2、代码质量检查器 <a class="header-anchor" href="#_2、代码质量检查器" aria-label="Permalink to &quot;2、代码质量检查器&quot;">​</a></h2><p>每个开发者都经历过在 Python 代码中追踪错误的挫败感，只是为了发现自己迷失在错误迷宫中。作为开发者，我们理解编写干净高效代码的重要性——但手动分析代码质量可能是一项压力巨大的任务。 这个自动化脚本利用 Pylint 和 Flake8 Python 包进行全面的代码质量审查。比较你的代码与编码标准，并识别逻辑错误。它确保你的代码符合行业最佳实践，并保持无错误。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入os模块，用于操作文件和目录。</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入subprocess模块，用于执行外部命令。</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> subprocess</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数analyze_code，接受一个参数directory，即要分析的目录路径。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">analyze_code</span><span style="color:#ABB2BF;">(directory):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 列出目录中所有以.py结尾的文件，构成一个列表。</span></span>
<span class="line"><span style="color:#ABB2BF;"> python_files </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#E06C75;">file</span><span style="color:#C678DD;"> for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span></span>
<span class="line"><span style="color:#ABB2BF;">os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(directory) </span><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.py&#39;</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 如果没有找到Python文件，输出提示信息并返回。</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> python_files:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;No Python files found in</span></span>
<span class="line"><span style="color:#ABB2BF;">the specified directory.</span><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#C678DD;"> return</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 遍历找到的Python文件。</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> python_files:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Analyzing file:</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#E06C75;">file</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 打印正在分析的文件名。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> file_path</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory,</span></span>
<span class="line"><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 获取文件的完整路径。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用pylint工具分析代码质量。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">Running</span></span>
<span class="line"><span style="color:#ABB2BF;">pylint</span><span style="color:#D19A66;">...</span><span style="color:#98C379;">&quot;)  # 提示开始运行pylint。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> pylint_command</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;pylint</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#7F848E;font-style:italic;">  # 构造pylint命令。</span></span>
<span class="line"><span style="color:#ABB2BF;"> subprocess.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(pylint_command,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">shell</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 执行命令，shell=True允许在命令行中运行。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用flake8工具分析代码风格。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">Running</span></span>
<span class="line"><span style="color:#ABB2BF;">flake8</span><span style="color:#D19A66;">...</span><span style="color:#98C379;">&quot;)  # 提示开始运行flake8。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> flake8_command</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;flake8</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#7F848E;font-style:italic;">  # 构造flake8命令。</span></span>
<span class="line"><span style="color:#ABB2BF;"> subprocess.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(flake8_command,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">shell</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 执行命令。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果此脚本被直接运行，而不是被导入到另一个脚本中。</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span></span>
<span class="line"><span style="color:#98C379;">&quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> directory</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;C:</span><span style="color:#56B6C2;">\\U</span><span style="color:#E06C75;">sers</span><span style="color:#56B6C2;">\\a</span><span style="color:#E06C75;">bhay</span><span style="color:#56B6C2;">\\O</span><span style="color:#E06C75;">neDrive\\Desktop</span><span style="color:#56B6C2;">\\P</span><span style="color:#E06C75;">art7&quot;</span><span style="color:#7F848E;font-style:italic;">  # 指定要分析的目录。</span></span>
<span class="line"><span style="color:#61AFEF;"> analyze_code</span><span style="color:#ABB2BF;">(directory)  </span><span style="color:#7F848E;font-style:italic;"># 调用分析函数。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><img src="`+m+`" alt="图片"></p><p>脚本应用：</p><p>•自动代码增强器——稍作扩展，可以用来创建一个 Python 脚本，识别代码中的问题并相应地进行更改。</p><p>自动代码审查。</p><h2 id="_3、防篡改-🚫" tabindex="-1">3、防篡改 🚫 <a class="header-anchor" href="#_3、防篡改-🚫" aria-label="Permalink to &quot;3、防篡改 🚫&quot;">​</a></h2><p>文件篡改，也称为数据篡改，是指未经授权故意改变信息，可能包括销毁、操纵或编辑数据。 世界各地的许多威胁者滥用文件篡改技术，并在关键系统文件中引入不同的漏洞或后门，危害安全并实现未经授权的访问。 为了降低这种风险，验证文件的完整性至关重要，确保它们保持原始状态未被改变。这个自动化脚本可以帮助你测试任何文件，并识别它是否被篡改。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入hashlib模块，用于加密哈希功能。</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> hashlib</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入os模块，用于操作文件和目录。</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数calculate_sha256，计算文件的SHA-256哈希值。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">calculate_sha256</span><span style="color:#ABB2BF;">(file_path):</span></span>
<span class="line"><span style="color:#ABB2BF;"> sha256 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> hashlib.</span><span style="color:#61AFEF;">sha256</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 创建一个sha256哈希对象</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 以二进制读取模式打开文件</span></span>
<span class="line"><span style="color:#C678DD;"> with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 读取文件内容，每次读取4096字节</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> chunk </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> iter</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">lambda</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4096</span><span style="color:#ABB2BF;">), </span><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;"> sha256.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(chunk)  </span><span style="color:#7F848E;font-style:italic;"># 更新哈希对象的状态</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> sha256.</span><span style="color:#61AFEF;">hexdigest</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 返回哈希值的十六进制表示</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数check_integrity，验证文件的完整性。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">check_integrity</span><span style="color:#ABB2BF;">(file_path, expected_checksum):</span></span>
<span class="line"><span style="color:#ABB2BF;"> actual_checksum </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">calculate_sha256</span><span style="color:#ABB2BF;">(file_path)  </span><span style="color:#7F848E;font-style:italic;"># 计算文件的实际SHA-256哈希值</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> actual_checksum </span><span style="color:#56B6C2;">==</span></span>
<span class="line"><span style="color:#ABB2BF;">expected_checksum  </span><span style="color:#7F848E;font-style:italic;"># 比较实际哈希值与预期哈希值是否相同</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果此脚本被直接运行。</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span></span>
<span class="line"><span style="color:#98C379;">&quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_path </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Enter the path to</span></span>
<span class="line"><span style="color:#ABB2BF;">the </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;)  # 获取用户输入的文件路径</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> expected_checksum</span><span style="color:#56B6C2;"> =</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Enter the</span></span>
<span class="line"><span style="color:#ABB2BF;">expected </span><span style="color:#D19A66;">SHA</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">256</span><span style="color:#ABB2BF;"> checksum: </span><span style="color:#98C379;">&quot;)  #获取用户输入的预期SHA-256哈希值</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 检查文件是否存在</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">isfile</span><span style="color:#ABB2BF;">(file_path):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 调用check_integrity函数验证文件完整性</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#61AFEF;"> check_integrity</span><span style="color:#ABB2BF;">(file_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">expected_checksum):</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;File integrity</span></span>
<span class="line"><span style="color:#ABB2BF;">verified: The </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;"> has </span><span style="color:#C678DD;">not</span><span style="color:#ABB2BF;"> been tampered </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;">.</span><span style="color:#98C379;">&quot;)  # 验证成功</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;File integrity check</span></span>
<span class="line"><span style="color:#ABB2BF;">failed: The </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;"> may have been tampered </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;">.</span><span style="color:#98C379;">&quot;)  # 验证失败</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Error: File not</span></span>
<span class="line"><span style="color:#ABB2BF;">found.</span><span style="color:#98C379;">&quot;)  # 文件不存在错误提示</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><img src="`+C+'" alt="图片"></p><p><img src="'+d+`" alt="图片"></p><h2 id="_4、智能交易" tabindex="-1">4、智能交易 <a class="header-anchor" href="#_4、智能交易" aria-label="Permalink to &quot;4、智能交易&quot;">​</a></h2><p>交易指的是购买和出售金融工具，如股票、债券、货币、商品或衍生品，目的是为了获利。期刊交易者整天都在查看不同的仪表板，试图找出是否买入或卖出的那一个完美决定。 这个自动化脚本可以帮助交易者和投资者很好地了解你想投资的任何股票。它使用 Python 的 Prophet 库，基于从雅虎财经获取的历史股票数据来预测近期的股票价格。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入Streamlit库用于创建Web应用</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> streamlit</span></span>
<span class="line"><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> st</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入date用于处理日期</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> date</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入yfinance库，用于从Yahoo Finance获取股票数据</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> yfinance</span></span>
<span class="line"><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> yf</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入Prophet库，用于进行时间序列预测</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> prophet</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Prophet</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入Prophet的Plotly绘图接口和Plotly图形对象</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> prophet.plot</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> plot_plotly</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> plotly</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> graph_objs </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> go</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置预测的起始日期和当前日期</span></span>
<span class="line"><span style="color:#D19A66;">START</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">&quot;2015-01-01&quot;</span></span>
<span class="line"><span style="color:#D19A66;">TODAY</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">date.</span><span style="color:#61AFEF;">today</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用Streamlit创建应用标题</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Stock</span></span>
<span class="line"><span style="color:#ABB2BF;">Forecast App</span><span style="color:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置一个选择框，让用户选择股票</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">stocks</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;MSFT&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&quot;TSLA&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;GOOG&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;AAPL&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;NVDA&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">selected_stock</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">selectbox</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Select dataset for prediction&#39;</span><span style="color:#ABB2BF;">, stocks)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个滑动条，让用户选择预测的年数，范围从1到4年</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">n_years</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">slider</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Years of prediction:&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">period</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> n_years</span></span>
<span class="line"><span style="color:#ABB2BF;">* </span><span style="color:#D19A66;">365</span><span style="color:#7F848E;font-style:italic;">  # 将年数转换为天数</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义一个缓存函数，用于加载股票数据，避免每次会话重新加载</span></span>
<span class="line"><span style="color:#56B6C2;">@</span><span style="color:#ABB2BF;">st.cache</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">load_data</span><span style="color:#ABB2BF;">(ticker):</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> data</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> yf.</span><span style="color:#61AFEF;">download</span><span style="color:#ABB2BF;">(ticker, </span><span style="color:#D19A66;">START</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">TODAY</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 从Yahoo Finance下载股票数据</span></span>
<span class="line"><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">inplace</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 重置DataFrame的索引</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> data</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 显示数据加载状态</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">data_load_state</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Loading data...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#61AFEF;">load_data</span><span style="color:#ABB2BF;">(selected_stock)  </span><span style="color:#7F848E;font-style:italic;"># 调用函数加载数据</span></span>
<span class="line"><span style="color:#ABB2BF;">data_load_state.</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Loading</span></span>
<span class="line"><span style="color:#ABB2BF;">data</span><span style="color:#D19A66;">...</span><span style="color:#ABB2BF;"> done!</span><span style="color:#98C379;">&#39;)  # 更新加载状态</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 显示原始数据的最后几行</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">subheader</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Raw</span></span>
<span class="line"><span style="color:#ABB2BF;">data</span><span style="color:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(data.</span><span style="color:#61AFEF;">tail</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，绘制原始数据的开盘和收盘价格</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">plot_raw_data</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> fig</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> go.</span><span style="color:#61AFEF;">Figure</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;"> fig.</span><span style="color:#61AFEF;">add_trace</span><span style="color:#ABB2BF;">(go.</span><span style="color:#61AFEF;">Scatter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data[</span><span style="color:#98C379;">&#39;Date&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data[</span><span style="color:#98C379;">&#39;Open&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;stock_open&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;"> fig.</span><span style="color:#61AFEF;">add_trace</span><span style="color:#ABB2BF;">(go.</span><span style="color:#61AFEF;">Scatter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">x</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data[</span><span style="color:#98C379;">&#39;Date&#39;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">y</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data[</span><span style="color:#98C379;">&#39;Close&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;stock_close&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;"> fig.layout.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">title_text</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;Time Series</span></span>
<span class="line"><span style="color:#ABB2BF;">data </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> Rangeslider</span><span style="color:#98C379;">&#39;, xaxis_rangeslider_visible=True)</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">plotly_chart</span><span style="color:#ABB2BF;">(fig)</span></span>
<span class="line"><span style="color:#61AFEF;">plot_raw_data</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用Prophet进行预测</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">df_train</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">data[[</span><span style="color:#98C379;">&#39;Date&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;Close&#39;</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">df_train</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">df_train.</span><span style="color:#61AFEF;">rename</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">columns</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&quot;Date&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ds&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;Close&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">&quot;y&quot;</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">m</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> Prophet</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">m.</span><span style="color:#61AFEF;">fit</span><span style="color:#ABB2BF;">(df_train)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">future</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">m.</span><span style="color:#61AFEF;">make_future_dataframe</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">periods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">period)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">forecast</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">m.</span><span style="color:#61AFEF;">predict</span><span style="color:#ABB2BF;">(future)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 显示并绘制预测数据</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">subheader</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Forecast</span></span>
<span class="line"><span style="color:#ABB2BF;">data</span><span style="color:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(forecast.</span><span style="color:#61AFEF;">tail</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;Forecast</span></span>
<span class="line"><span style="color:#98C379;">plot for </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">n_years</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> years&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">fig1</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#61AFEF;">plot_plotly</span><span style="color:#ABB2BF;">(m, forecast)</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">plotly_chart</span><span style="color:#ABB2BF;">(fig1)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 显示预测组件</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Forecast</span></span>
<span class="line"><span style="color:#ABB2BF;">components</span><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">fig2</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">m.</span><span style="color:#61AFEF;">plot_components</span><span style="color:#ABB2BF;">(forecast)</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(fig2)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><p><img src="`+D+`" alt="图片"></p><p>脚本应用</p><p>算法交易</p><p>股价比较仪表板</p><h2 id="_5、autoimage-下载器" tabindex="-1">5、AutoImage 下载器 <a class="header-anchor" href="#_5、autoimage-下载器" aria-label="Permalink to &quot;5、AutoImage 下载器&quot;">​</a></h2><p>在计算机视觉项目中，收集图像数据是一个关键挑战。正如 Andrew Ng 所说，如果你能收集到大量数据集，那么算法就不重要了。数据在提高模型性能和准确性方面起着关键作用。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入所需的模块和函数</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">simple_image_download </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> simple_image_download </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> simp</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个响应对象，用于处理图片下载</span></span>
<span class="line"><span style="color:#ABB2BF;">response </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">simp.simple_image_download</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置关键词</span></span>
<span class="line"><span style="color:#ABB2BF;">keyword </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#98C379;">&quot;Dog&quot;</span><span style="color:#7F848E;font-style:italic;">  # 指定下载的图片关键词为“Dog”</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 下载图片</span></span>
<span class="line"><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;"> response</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">download</span><span style="color:#ABB2BF;">(keyword, </span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 调用下载方法，尝试下载20张关键词为“Dog”的图片</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Images downloaded</span></span>
<span class="line"><span style="color:#ABB2BF;">successfully.</span><span style="color:#98C379;">&quot;)  # 如果下载成功，则输出成功消息</span></span>
<span class="line"><span style="color:#C678DD;">except</span><span style="color:#ABB2BF;"> Exception</span></span>
<span class="line"><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;An error occurred:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">e)  </span><span style="color:#7F848E;font-style:italic;"># 如果下载过程中出现异常，输出错误信息</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><img src="`+E+`" alt="图片"></p><h2 id="_6、端口扫描器" tabindex="-1">6、端口扫描器 <a class="header-anchor" href="#_6、端口扫描器" aria-label="Permalink to &quot;6、端口扫描器&quot;">​</a></h2><p>让我们谈谈网络安全！ 在计算机网络中，端口是允许不同进程或服务连接并通过网络交换数据的通信端点。端口通过数值标识，并与特定协议相关联。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入socket库用于网络连接</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> socket</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入PrettyTable库用于生成表格，使输出结果更易于阅读</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> prettytable</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PrettyTable</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义一个字典，其中包含常用端口及其潜在的安全漏洞描述</span></span>
<span class="line"><span style="color:#ABB2BF;">vulnerabilities </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#D19A66;"> 80</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;HTTP（超文本传输协议） - 用于非加密的网页流量&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 443</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;HTTPS（安全的HTTP） -</span></span>
<span class="line"><span style="color:#ABB2BF;">用于加密的网页流量</span><span style="color:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#D19A66;"> 22</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;SSH（安全外壳协议） - 用于安全的远程访问&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 21</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;FTP（文件传输协议） - 用于文件传输&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 25</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;SMTP（简单邮件传输协议） - 用于电子邮件传输&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 23</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Telnet - 用于远程终端访问&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 53</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;DNS（域名系统） - 用于域名解析&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 110</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;POP3（邮局协议第3版） - 用于电子邮件获取&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 143</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;IMAP（互联网消息访问协议） -</span></span>
<span class="line"><span style="color:#ABB2BF;">用于电子邮件获取</span><span style="color:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#D19A66;"> 3306</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;MySQL - 用于MySQL数据库访问&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 3389</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;RDP（远程桌面协议） -</span></span>
<span class="line"><span style="color:#ABB2BF;">用于Windows的远程桌面连接</span><span style="color:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#D19A66;"> 8080</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;HTTP备用端口 - 常用作HTTP的次要端口&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 8000</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;HTTP备用端口 - 常用作HTTP的次要端口&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;"> 8443</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;HTTPS备用端口 -</span></span>
<span class="line"><span style="color:#ABB2BF;">常用作HTTPS的次要端口</span><span style="color:#98C379;">&quot;,</span></span>
<span class="line"><span style="color:#D19A66;"> 5900</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;VNC（虚拟网络计算） - 用于远程桌面访问&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 根据需要可继续添加更多端口及其安全漏洞描述</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义一个函数，显示开放端口及其潜在的安全问题</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">display_table</span><span style="color:#ABB2BF;">(open_ports):</span></span>
<span class="line"><span style="color:#ABB2BF;"> table </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> PrettyTable</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&quot;开放端口&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&quot;潜在安全问题&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> port </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> open_ports:</span></span>
<span class="line"><span style="color:#ABB2BF;"> vulnerability </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">vulnerabilities.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(port, </span><span style="color:#98C379;">&quot;此端口没有与常见服务相关联的已知漏洞&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> table.</span><span style="color:#61AFEF;">add_row</span><span style="color:#ABB2BF;">([port, vulnerability])</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(table)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义一个函数，扫描目标主机的常用端口</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">scan_top_ports</span><span style="color:#ABB2BF;">(target):</span></span>
<span class="line"><span style="color:#ABB2BF;"> open_ports </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []  </span><span style="color:#7F848E;font-style:italic;"># 存储开放端口的列表</span></span>
<span class="line"><span style="color:#ABB2BF;"> top_ports </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#D19A66;">21</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">22</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">23</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">25</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">53</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">80</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">110</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">143</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">443</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3306</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3389</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5900</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">8000</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">8080</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">8443</span><span style="color:#ABB2BF;">] </span><span style="color:#7F848E;font-style:italic;"># 定义常见的15个端口</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> port </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> top_ports:</span></span>
<span class="line"><span style="color:#C678DD;"> try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> sock </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">socket.</span><span style="color:#61AFEF;">socket</span><span style="color:#ABB2BF;">(socket.</span><span style="color:#D19A66;">AF_INET</span><span style="color:#ABB2BF;">, socket.</span><span style="color:#D19A66;">SOCK_STREAM</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> sock.</span><span style="color:#61AFEF;">settimeout</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 设置连接超时时间</span></span>
<span class="line"><span style="color:#ABB2BF;"> result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sock.</span><span style="color:#61AFEF;">connect_ex</span><span style="color:#ABB2BF;">((target,</span></span>
<span class="line"><span style="color:#ABB2BF;">port))</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> result </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> open_ports.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(port)</span></span>
<span class="line"><span style="color:#ABB2BF;"> sock.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;"> except</span><span style="color:#ABB2BF;"> KeyboardInterrupt:</span></span>
<span class="line"><span style="color:#ABB2BF;"> sys.</span><span style="color:#61AFEF;">exit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;"> except</span><span style="color:#ABB2BF;"> socket.error:</span></span>
<span class="line"><span style="color:#C678DD;"> pass</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> open_ports</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 主函数</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;"> target </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入要扫描的网站URL或IP地址：&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> open_ports </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> scan_top_ports</span><span style="color:#ABB2BF;">(target)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> open_ports:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;目标主机没有开放的端口。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开放的端口及其相关的潜在安全问题：&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;"> display_table</span><span style="color:#ABB2BF;">(open_ports)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果这个脚本被直接运行</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span></span>
<span class="line"><span style="color:#98C379;">&quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p><img src="`+f+`" alt="图片"></p><h2 id="_7、密码管理器" tabindex="-1">7、密码管理器 <a class="header-anchor" href="#_7、密码管理器" aria-label="Permalink to &quot;7、密码管理器&quot;">​</a></h2><p>关于成为数字自由职业者最糟糕的部分之一是，你需要记住许多密码，因为你每天都在为新网站注册。 这个自动化脚本可以帮助你管理所有密码，使它们既安全又只有你能访问，使用不同的加密技术。 这个脚本的最好之处在于它是一个网络应用，这意味着通过几处修改，你可以将其部署在云存储上，并且可以在任何地方访问所有密码，而不用担心安全问题。 它使用一个硬编码的自定义密钥进行加密和解密。如果你计划在共享平台上使用这个脚本，请确保将这个密钥保存在一个单独的安全文件中。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入所需的库</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> streamlit</span></span>
<span class="line"><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> st</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> csv</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">cryptography.fernet </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Fernet</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">cryptography.fernet </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> InvalidToken</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 自定义加密密钥（硬编码）</span></span>
<span class="line"><span style="color:#D19A66;">CUSTOM_ENCRYPTION_KEY</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> b</span><span style="color:#98C379;">&#39;u7wGgNdDFefqpr_kGxb8wJf6XRVsRwvb3QgITsD5Ft4=&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果您计划在共享平台上使用此脚本，请确保将此密钥保存在一个单独的安全文件中。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 函数用于加密密码</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">encrypt_password</span><span style="color:#ABB2BF;">(password):</span></span>
<span class="line"><span style="color:#ABB2BF;"> cipher_suite </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">Fernet</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">CUSTOM_ENCRYPTION_KEY</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">cipher_suite.</span><span style="color:#61AFEF;">encrypt</span><span style="color:#ABB2BF;">(password.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">()) </span><span style="color:#7F848E;font-style:italic;"># 将密码编码后加密</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> encrypted_password</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 函数用于解密密码</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">decrypt_password</span><span style="color:#ABB2BF;">(encrypted_password):</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#56B6C2;"> isinstance</span><span style="color:#ABB2BF;">(encrypted_password,</span></span>
<span class="line"><span style="color:#56B6C2;">bytes</span><span style="color:#ABB2BF;">):  </span><span style="color:#7F848E;font-style:italic;"># 检查加密密码是否为bytes类型</span></span>
<span class="line"><span style="color:#C678DD;"> try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> cipher_suite </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">Fernet</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">CUSTOM_ENCRYPTION_KEY</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> decrypted_password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">cipher_suite.</span><span style="color:#61AFEF;">decrypt</span><span style="color:#ABB2BF;">(encrypted_password) </span><span style="color:#7F848E;font-style:italic;"># 解密</span></span>
<span class="line"><span style="color:#C678DD;"> return</span></span>
<span class="line"><span style="color:#ABB2BF;">decrypted_password.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 将bytes解码为字符串</span></span>
<span class="line"><span style="color:#C678DD;"> except</span><span style="color:#ABB2BF;"> InvalidToken:</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#98C379;"> &quot;Invalid</span></span>
<span class="line"><span style="color:#ABB2BF;">Token</span><span style="color:#98C379;">&quot;  # 若密钥不正确，返回无效令牌信息</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 函数用于将网站名和密码保存到CSV文件</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">save_credentials</span><span style="color:#ABB2BF;">(website_name, password):</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">encrypt_password</span><span style="color:#ABB2BF;">(password)  </span><span style="color:#7F848E;font-style:italic;"># 先加密密码</span></span>
<span class="line"><span style="color:#C678DD;"> with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;credentials.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> csvfile:</span></span>
<span class="line"><span style="color:#ABB2BF;"> writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">writer</span><span style="color:#ABB2BF;">(csvfile)</span></span>
<span class="line"><span style="color:#ABB2BF;"> writer.</span><span style="color:#61AFEF;">writerow</span><span style="color:#ABB2BF;">([website_name,</span></span>
<span class="line"><span style="color:#ABB2BF;">encrypted_password.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">()])  </span><span style="color:#7F848E;font-style:italic;">#将加密后的密码解码为字符串后存储</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 函数用于从CSV文件检索密码</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">retrieve_password</span><span style="color:#ABB2BF;">(website_name):</span></span>
<span class="line"><span style="color:#C678DD;"> with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;credentials.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span></span>
<span class="line"><span style="color:#ABB2BF;">csvfile:</span></span>
<span class="line"><span style="color:#ABB2BF;"> reader </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">reader</span><span style="color:#ABB2BF;">(csvfile)</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> reader:</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> row[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> website_name:</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">row[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 重新编码为bytes</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> encrypted_password</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用Streamlit创建Web界面</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;密码管理器&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 输入字段用于输入网站名和密码</span></span>
<span class="line"><span style="color:#ABB2BF;">website_name </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">text_input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;输入网站名:&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">text_input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;输入密码:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 保存按钮用于保存网站名和密码</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">button</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;保存&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> website_name </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> password:</span></span>
<span class="line"><span style="color:#61AFEF;"> save_credentials</span><span style="color:#ABB2BF;">(website_name,</span></span>
<span class="line"><span style="color:#ABB2BF;">password)</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">success</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;网站名和密码已成功保存。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请填写所有字段。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 检索按钮用于检索密码</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">checkbox</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;检索密码&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;"> website_name </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">selectbox</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;选择网站名:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> [row[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span></span>
<span class="line"><span style="color:#ABB2BF;">csv.</span><span style="color:#61AFEF;">reader</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;credentials.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">))])</span></span>
<span class="line"><span style="color:#ABB2BF;"> key </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">text_input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;输入您的加密密钥:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">button</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;检索密码&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> key </span><span style="color:#56B6C2;">==</span></span>
<span class="line"><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">CUSTOM_ENCRYPTION_KEY</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">()):</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> website_name:</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">retrieve_password</span><span style="color:#ABB2BF;">(website_name)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> encrypted_password:</span></span>
<span class="line"><span style="color:#ABB2BF;"> decrypted_password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">decrypt_password</span><span style="color:#ABB2BF;">(encrypted_password)</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">success</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;网站</span></span>
<span class="line"><span style="color:#98C379;">**</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">website_name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">** 的密码 -&gt; **</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">decrypted_password</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">**&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;数据库中未找到密码。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> elif</span><span style="color:#ABB2BF;"> key </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;"> pass</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;无效的加密密钥！&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><p><img src="`+_+'" alt="图片"></p><p><img src="'+q+`" alt="图片"></p><h2 id="_8、批量邮件发送器-🆕" tabindex="-1">8、批量邮件发送器 🆕 <a class="header-anchor" href="#_8、批量邮件发送器-🆕" aria-label="Permalink to &quot;8、批量邮件发送器 🆕&quot;">​</a></h2><p>电子邮件列表是在线互动的货币，每个订阅者都是你数字部落中的宝贵成员。它们是有效数字营销的核心。 作为一个数字影响者，与你的粉丝保持互动很重要，但手动进行这一工作很困难，使用工具则可能花费一大笔钱。 这个自动化脚本利用 Gmail 自己的 SMTP 服务器发送批量电子邮件，仅需几分钟，允许你完全自定义并掌控。 确保你不要发送垃圾邮件给接收者，否则你会被 Gmail 列入黑名单。尝试将你的邮件限制在每天少于 100 封。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入smtplib库用于邮件传输</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入ssl库用于建立安全的连接</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ssl</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># SMTP服务器的详细信息</span></span>
<span class="line"><span style="color:#ABB2BF;">smtp_server </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#98C379;">&#39;smtp.gmail.com&#39;</span><span style="color:#7F848E;font-style:italic;">  # 使用的Gmail的SMTP服务器地址</span></span>
<span class="line"><span style="color:#ABB2BF;">smtp_port </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#D19A66;">465</span><span style="color:#7F848E;font-style:italic;">  # 使用的端口号，Gmail的SSL端口是465</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 发送者和接收者的详细信息</span></span>
<span class="line"><span style="color:#ABB2BF;">from_address </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#98C379;">&#39;Winzo Shop&#39;</span><span style="color:#7F848E;font-style:italic;">  # 发件人地址或名称</span></span>
<span class="line"><span style="color:#ABB2BF;">to_address </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">]  </span><span style="color:#7F848E;font-style:italic;"># 接收者列表，可以添加多个接收邮箱地址</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 认证信息</span></span>
<span class="line"><span style="color:#ABB2BF;">username </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;</span><span style="color:#7F848E;font-style:italic;">  # 发件人的邮箱账号</span></span>
<span class="line"><span style="color:#ABB2BF;">password </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;</span><span style="color:#7F848E;font-style:italic;">  # 发件人的邮箱密码</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 邮件内容的详细信息</span></span>
<span class="line"><span style="color:#ABB2BF;">subject</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;🎉 独家优惠！您下次购物可享受10%的折扣&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">body </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;&#39;</span><span style="color:#D19A66;">\\</span></span>
<span class="line"><span style="color:#98C379;">亲爱的顾客，</span></span>
<span class="line"><span style="color:#98C379;">作为我们尊贵的客户，为了表达我们的感激之情，我们为您的下次购买提供了一项独家折扣。在结账时使用下面的优惠码，您可以享受订单10%的折扣：</span></span>
<span class="line"><span style="color:#98C379;">优惠码：DISCOUNT10</span></span>
<span class="line"><span style="color:#98C379;">无论您是在寻找时尚的服饰、潮流的配饰还是高质量的产品，现在是购物并节省开支的最佳时机！探索我们的最新系列，并给自己买些特别的东西。</span></span>
<span class="line"><span style="color:#98C379;">抓紧时间！此优惠仅限时有效。不要错过节省您最爱物品的机会。</span></span>
<span class="line"><span style="color:#98C379;">立即购物：https://xyz.com</span></span>
<span class="line"><span style="color:#98C379;">感谢您选择WinzoShop。我们期待着不久再次为您服务！</span></span>
<span class="line"><span style="color:#98C379;">最好的祝福，</span></span>
<span class="line"><span style="color:#98C379;">Winzo Shop</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个SSL/TLS的上下文环境</span></span>
<span class="line"><span style="color:#ABB2BF;">context </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">ssl.</span><span style="color:#61AFEF;">create_default_context</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用SSL/TLS通过SMTP服务器连接</span></span>
<span class="line"><span style="color:#C678DD;">with</span></span>
<span class="line"><span style="color:#ABB2BF;">smtplib.</span><span style="color:#61AFEF;">SMTP_SSL</span><span style="color:#ABB2BF;">(smtp_server, smtp_port, </span><span style="color:#E06C75;font-style:italic;">context</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">context) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> server:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 启用调试级别，打印服务器的响应信息</span></span>
<span class="line"><span style="color:#ABB2BF;"> server.</span><span style="color:#61AFEF;">set_debuglevel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 登录SMTP服务器</span></span>
<span class="line"><span style="color:#ABB2BF;"> server.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(username, password)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建电子邮件消息</span></span>
<span class="line"><span style="color:#ABB2BF;"> message </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;From:</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">from_address</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\r\\n</span><span style="color:#98C379;">Subject: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">subject</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\r\\n</span><span style="color:#98C379;">To: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">to_address</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\r\\n\\r\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">body</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;"> message </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> message.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 将消息转换为字节格式</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 发送邮件</span></span>
<span class="line"><span style="color:#ABB2BF;"> server.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(from_address, to_address,</span></span>
<span class="line"><span style="color:#ABB2BF;">message)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><img src="`+h+`" alt="图片"></p><h2 id="_9、readme-md-生成器" tabindex="-1">9、Readme.md 生成器 <a class="header-anchor" href="#_9、readme-md-生成器" aria-label="Permalink to &quot;9、Readme.md 生成器&quot;">​</a></h2><p>README.md 文件作为你项目的门户，提供必要信息并吸引访客进一步探索。它被认为是你仓库中最重要的文件之一，但同时也是创建起来相当耗时的。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入所需的模块</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> hashlib</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> shutil</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，用于获取文件的哈希值</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">get_file_hash</span><span style="color:#ABB2BF;">(file_path):</span></span>
<span class="line"><span style="color:#C678DD;"> with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:  </span><span style="color:#7F848E;font-style:italic;"># 以二进制读取模式打开文件</span></span>
<span class="line"><span style="color:#C678DD;"> return</span></span>
<span class="line"><span style="color:#ABB2BF;">hashlib.</span><span style="color:#61AFEF;">sha256</span><span style="color:#ABB2BF;">(f.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()).</span><span style="color:#61AFEF;">hexdigest</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 使用SHA-256算法计算文件的哈希值并返回</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，用于整理文件夹并移动重复的文件</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">organize_and_move_duplicates</span><span style="color:#ABB2BF;">(folder_path):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建一个字典来存储基于文件扩展名的目标文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;"> extension_folders </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 如果不存在“Duplicates”文件夹，则创建它</span></span>
<span class="line"><span style="color:#ABB2BF;"> duplicates_folder </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path, </span><span style="color:#98C379;">&#39;Duplicates&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(duplicates_folder,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">使用exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">True避免在文件夹已存在时引发错误</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建一个字典来存储文件哈希值</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_hashes </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 遍历文件夹中的文件</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> filename </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(folder_path):</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">filename)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">isfile</span><span style="color:#ABB2BF;">(file_path):  </span><span style="color:#7F848E;font-style:italic;"># 确保是文件而不是目录</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取文件扩展名</span></span>
<span class="line"><span style="color:#ABB2BF;"> _, extension </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(filename)</span></span>
<span class="line"><span style="color:#ABB2BF;"> extension </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> extension.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 将扩展名转换为小写，以避免大小写差异导致的分类错误</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 确定目标文件夹</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> extension </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> extension_folders:</span></span>
<span class="line"><span style="color:#ABB2BF;"> destination_folder </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">extension_folders[extension]</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> destination_folder </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path, extension[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:]) </span><span style="color:#7F848E;font-style:italic;"># 移除扩展名前的点并创建目录</span></span>
<span class="line"><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(destination_folder,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> extension_folders[extension] </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">destination_folder</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 计算文件哈希值</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_hash </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">get_file_hash</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 检查文件是否重复</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> file_hash </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> file_hashes:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 文件是重复的，将其移动到“Duplicates”文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;"> shutil.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(file_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(duplicates_folder, filename))</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;将重复文件 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">移动到 Duplicates 文件夹。</span><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 存储文件哈希值</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_hashes[file_hash] </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">filename</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将文件移动到目标文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;"> shutil.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(file_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">destination_folder)</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;将 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 移动到</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">destination_folder</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果这个脚本被直接运行</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span></span>
<span class="line"><span style="color:#98C379;">&quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> folder_path</span><span style="color:#56B6C2;"> =</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入您要整理的文件夹路径:</span></span>
<span class="line"><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#61AFEF;"> organize_and_move_duplicates</span><span style="color:#ABB2BF;">(folder_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p><img src="`+g+'" alt="图片"></p><p><img src="'+x+`" alt="图片"></p><h2 id="_10、organizeit-2-0" tabindex="-1">10、OrganizeIT 2.0 <a class="header-anchor" href="#_10、organizeit-2-0" aria-label="Permalink to &quot;10、OrganizeIT 2.0&quot;">​</a></h2><p>你的下载文件夹是一团乱麻吗？</p><p>当你最需要时，你是否发现自己在寻找关键文件时手忙脚乱？</p><p>你是否尝试过多次组织文件夹，但总是无法成功？</p><p>这个自动化脚本可以帮助你在几分钟内整理你的文件夹。你只需要指定你想要清理的路径，这个脚本将自动根据文件扩展名将所有文件分到不同的文件夹中。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入所需的模块</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> hashlib</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> shutil</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，用于获取文件的哈希值</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">get_file_hash</span><span style="color:#ABB2BF;">(file_path):</span></span>
<span class="line"><span style="color:#C678DD;"> with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:  </span><span style="color:#7F848E;font-style:italic;"># 以二进制读取模式打开文件</span></span>
<span class="line"><span style="color:#C678DD;"> return</span></span>
<span class="line"><span style="color:#ABB2BF;">hashlib.</span><span style="color:#61AFEF;">sha256</span><span style="color:#ABB2BF;">(f.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()).</span><span style="color:#61AFEF;">hexdigest</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 使用SHA-256算法计算文件的哈希值并返回</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义函数，用于整理文件夹并移动重复的文件</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">organize_and_move_duplicates</span><span style="color:#ABB2BF;">(folder_path):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建一个字典来存储基于文件扩展名的目标文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;"> extension_folders </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 如果不存在“Duplicates”文件夹，则创建它</span></span>
<span class="line"><span style="color:#ABB2BF;"> duplicates_folder </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path, </span><span style="color:#98C379;">&#39;Duplicates&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(duplicates_folder,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 使用exist_ok=True避免在文件夹已存在时引发错误</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建一个字典来存储文件哈希值</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_hashes </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 遍历文件夹中的文件</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> filename </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(folder_path):</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">filename)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">isfile</span><span style="color:#ABB2BF;">(file_path):  </span><span style="color:#7F848E;font-style:italic;"># 确保是文件而不是目录</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取文件扩展名</span></span>
<span class="line"><span style="color:#ABB2BF;"> _, extension </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(filename)</span></span>
<span class="line"><span style="color:#ABB2BF;"> extension </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> extension.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 将扩展名转换为小写，以避免大小写差异导致的分类错误</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 确定目标文件夹</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> extension </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> extension_folders:</span></span>
<span class="line"><span style="color:#ABB2BF;"> destination_folder </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">extension_folders[extension]</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> destination_folder </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path, extension[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:]) </span><span style="color:#7F848E;font-style:italic;"># 移除扩展名前的点并创建目录</span></span>
<span class="line"><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(destination_folder,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> extension_folders[extension] </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">destination_folder</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 计算文件哈希值</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_hash </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">get_file_hash</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 检查文件是否重复</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> file_hash </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> file_hashes:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 文件是重复的，将其移动到“Duplicates”文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;"> shutil.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(file_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(duplicates_folder, filename))</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;将重复文件 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">移动到 Duplicates 文件夹。</span><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 存储文件哈希值</span></span>
<span class="line"><span style="color:#ABB2BF;"> file_hashes[file_hash] </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">filename</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将文件移动到目标文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;"> shutil.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(file_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">destination_folder)</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;将 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 移动到</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">destination_folder</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果这个脚本被直接运行</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span></span>
<span class="line"><span style="color:#98C379;">&quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> folder_path</span><span style="color:#56B6C2;"> =</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;请输入您要整理的文件夹路径:</span></span>
<span class="line"><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#61AFEF;"> organize_and_move_duplicates</span><span style="color:#ABB2BF;">(folder_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p><img src="`+v+'" alt="图片"></p><p><img src="'+k+`" alt="图片"></p><h2 id="_10行代码实现所有表格自动化截图" tabindex="-1">10行代码实现所有表格自动化截图 <a class="header-anchor" href="#_10行代码实现所有表格自动化截图" aria-label="Permalink to &quot;10行代码实现所有表格自动化截图&quot;">​</a></h2><h3 id="一、问题痛点-每日数据截图-繁琐且耗时" tabindex="-1">一、问题痛点：每日数据截图，繁琐且耗时 <a class="header-anchor" href="#一、问题痛点-每日数据截图-繁琐且耗时" aria-label="Permalink to &quot;一、问题痛点：每日数据截图，繁琐且耗时&quot;">​</a></h3><p>你是否也曾经历过这样的场景：作为打工人，每天都需要汇总当天公司运营情况如：销售情况和库存情况等，然后一张一张地将表格截图发微信给老板看。这样的工作流程不仅效率低下，而且容易出错。每当有新的表格需要汇总时，都需要重新进行截图操作，简直是重复劳动的噩梦。</p><p>需要将Excel转为图片，说白了就是需要将表格进行自动化截图。</p><h3 id="二、解决方案-python自动化办公-十行代码解决繁琐" tabindex="-1">二、解决方案：Python自动化办公，十行代码解决繁琐 <a class="header-anchor" href="#二、解决方案-python自动化办公-十行代码解决繁琐" aria-label="Permalink to &quot;二、解决方案：Python自动化办公，十行代码解决繁琐&quot;">​</a></h3><p>在这个科技日新月异的时代，我们为何还要被这种繁琐的工作所束缚呢？Python，作为一种强大的编程语言，为我们提供了一个绝佳的解决方案。通过Python的自动化办公功能，我们可以轻松地实现表格截图的自动化处理。</p><p>下面，我将为你展示一段仅需十行代码的Python代码，让你轻松实现表格数据截图的自动化处理：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> excel2img</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> out_img</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">excel_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">sheet_list</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;开始截图，请耐心等待。。。&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(sheet_list)):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # sheet_list[i] + &quot;.png&quot; 为保存的图片名称（以sheet名称.png命名）</span></span>
<span class="line"><span style="color:#ABB2BF;">            excel2img.</span><span style="color:#61AFEF;">export_img</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                excel_file, sheet_list[i] </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;.png&quot;</span><span style="color:#ABB2BF;">, sheet_list[i], </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;截图失败！&quot;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    file</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;mergeEx.xlsx&#39;</span></span>
<span class="line"><span style="color:#C678DD;">    from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    sheet_names </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.</span><span style="color:#61AFEF;">get_sheet_names</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 获得工作簿的所有工作表名</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(sheet_names)</span></span>
<span class="line"><span style="color:#61AFEF;">    out_img</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">, sheet_names)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="三、效果展示-秒级实现截图-效率翻倍" tabindex="-1">三、效果展示：秒级实现截图，效率翻倍 <a class="header-anchor" href="#三、效果展示-秒级实现截图-效率翻倍" aria-label="Permalink to &quot;三、效果展示：秒级实现截图，效率翻倍&quot;">​</a></h3><p>通过运行上述代码，可以轻松实现表格数据截图的自动化处理。无论文件中有多少个Sheet表格需要截图，只需一键运行Python脚本，即可在指定的文件夹中生成对应的截图文件。这样的操作不仅大大提高了工作效率，而且减少了出错的可能性。</p><h2 id="批量去除电脑中的重复图像" tabindex="-1">批量去除电脑中的重复图像 <a class="header-anchor" href="#批量去除电脑中的重复图像" aria-label="Permalink to &quot;批量去除电脑中的重复图像&quot;">​</a></h2><p>在数字化时代，我们经常会遇到图像文件大量堆积的情况，其中不乏重复的图片。这些重复的图片不仅占用了宝贵的存储空间，还使得文件管理和备份变得繁琐。为了解决这个问题，我们可以利用 Python 编写一个脚本来自动检测和删除重复的图像文件。</p><h3 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h3><p>在开始编写代码之前，我们需要确保已经安装了 Python 环境，并安装了一个用于比较图像相似度的库，如<code>imagehash</code>和<code>Pillow</code>（PIL 的分支）。这两个库可以帮助我们生成图像的哈希值，并基于这些哈希值来比较图像的相似性。</p><p>你可以使用 pip 来安装这两个库：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install imagehash pillow</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="编写代码" tabindex="-1">编写代码 <a class="header-anchor" href="#编写代码" aria-label="Permalink to &quot;编写代码&quot;">​</a></h3><p>下面是一个简单的 Python 脚本，用于查找并删除重复的图像文件：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> imagehash</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> itertools </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> combinations</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> image_hash</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    hash_object </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> imagehash.</span><span style="color:#61AFEF;">average_hash</span><span style="color:#ABB2BF;">(Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(file_path))</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> hash_object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> find_duplicate_images</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    images </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [f </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> f </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(directory) </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">isfile</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory, f)) </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> f.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;.png&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.jpg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.jpeg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.gif&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.bmp&#39;</span><span style="color:#ABB2BF;">))]</span></span>
<span class="line"><span style="color:#ABB2BF;">    hashes </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {f: </span><span style="color:#61AFEF;">image_hash</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory, f)) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> f </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> images}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    duplicates </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> img1, img2 </span><span style="color:#C678DD;">in</span><span style="color:#61AFEF;"> combinations</span><span style="color:#ABB2BF;">(images, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> hashes[img1] </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> hashes[img2] </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;"> 5</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 设定一个阈值来判断是否相似</span></span>
<span class="line"><span style="color:#ABB2BF;">            duplicates.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">((img1, img2))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> duplicates</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> remove_duplicates</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">duplicates</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> img1, img2 </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> duplicates:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 假设我们保留第一个文件，删除第二个文件</span></span>
<span class="line"><span style="color:#ABB2BF;">        os.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory, img2))</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Removed duplicate: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">img2</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例</span></span>
<span class="line"><span style="color:#ABB2BF;">directory </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;path/to/your/image/directory&#39;</span><span style="color:#7F848E;font-style:italic;">  # 替换为你的图像目录</span></span>
<span class="line"><span style="color:#ABB2BF;">duplicates </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> find_duplicate_images</span><span style="color:#ABB2BF;">(directory)</span></span>
<span class="line"><span style="color:#61AFEF;">remove_duplicates</span><span style="color:#ABB2BF;">(directory, duplicates)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>注意：这个脚本使用了简单的平均哈希算法来比较图像，并设定了一个阈值（在这个例子中是 5）来判断两个哈希值是否足够接近，从而认为图像是相似的。然而，这种方法的准确性可能因图像质量和内容的复杂性而有所不同。你可能需要根据你的具体需求来调整这个阈值。</p><p>此外，这个脚本会删除所有相似的图像中的第二个图像，保留第一个图像。如果你想要更复杂的逻辑（例如，只删除完全相同的图像，或者基于某种策略来选择要保留的图像），你需要在 remove_duplicates 函数中添加更多的逻辑。</p><p>最后，这个脚本并没有提供备份或撤销删除的选项，因此请确保在运行脚本之前备份你的图像文件，以防止误删除重要文件。</p><h3 id="代码实战" tabindex="-1">代码实战 <a class="header-anchor" href="#代码实战" aria-label="Permalink to &quot;代码实战&quot;">​</a></h3><p><img src="`+w+'" alt="image-20240511163904249"></p><p>我有一批图片，每张图片都被备份了两次，利用以上代码识别出重复图片</p><p><img src="'+P+'" alt="image-20240511163922849"></p><p>删除图片后，所有的图片都只剩下一张原图</p><p><img src="'+S+`" alt="image-20240511163942229"></p><h2 id="实现从-word-到-excel-的数据提取与转换" tabindex="-1">实现从 Word 到 Excel 的数据提取与转换 <a class="header-anchor" href="#实现从-word-到-excel-的数据提取与转换" aria-label="Permalink to &quot;实现从 Word 到 Excel 的数据提取与转换&quot;">​</a></h2><p>在数字化办公的浪潮中，数据的高效处理与转换已成为企业和教育机构不可或缺的一环。</p><p>想象一下，当你面对成百上千的 Word 文档，需要从中提取关键信息并整理到 Excel 表格中进行深入分析时，手动操作不仅耗时费力，而且容易出错。现在，借助 Python 的强大功能，我们可以轻松实现这一过程的自动化，提高数据处理效率，减少人为错误。</p><h3 id="正文" tabindex="-1">正文： <a class="header-anchor" href="#正文" aria-label="Permalink to &quot;正文：&quot;">​</a></h3><p>在企业运营和学术研究中，经常需要从 Word 文档中提取文本数据，并整理到 Excel 表格中进行后续的分析和报告。例如，从合同、报告或调查表格中提取关键信息，是日常工作中的常见需求。通过自动化这个过程，可以显著提高数据处理效率和准确性。</p><h3 id="技术实现" tabindex="-1">技术实现： <a class="header-anchor" href="#技术实现" aria-label="Permalink to &quot;技术实现：&quot;">​</a></h3><ul><li><p><strong>输入</strong>：包含需要提取的文本数据的 Word 文档。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>使用<code>python-docx</code>库读取 Word 文档中的文本。</li><li>使用<code>openpyxl</code>或<code>pandas</code>库将提取的数据写入 Excel。</li></ul></li><li><p><strong>输出</strong>：包含 Word 文档数据的 Excel 文件。</p></li></ul><p><strong>实战操作</strong>：</p><p>假设我们有一个 Word 文档，其中包含多个部分的标题和对应的内容，我们需要将这些内容提取到 Excel 的不同单元格中。以下是一个具体的 Python 脚本示例，用于实现这一需求：</p><h3 id="python-脚本" tabindex="-1">Python 脚本： <a class="header-anchor" href="#python-脚本" aria-label="Permalink to &quot;Python 脚本：&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Document</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> extract_text_from_word</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">doc_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载Word文档</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Document</span><span style="color:#ABB2BF;">(doc_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 提取每个段落的文本</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> para </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> doc.paragraphs:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> para.text:  </span><span style="color:#7F848E;font-style:italic;"># 确保段落包含文本</span></span>
<span class="line"><span style="color:#ABB2BF;">            data.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(para.text)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> save_data_to_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">excel_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 创建DataFrame</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">(data, </span><span style="color:#E06C75;font-style:italic;">columns</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;Text&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存到Excel</span></span>
<span class="line"><span style="color:#ABB2BF;">    df.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(excel_path, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Word文档路径和Excel文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">doc_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;example.docx&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">excel_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;output.xlsx&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 提取Word内容</span></span>
<span class="line"><span style="color:#ABB2BF;">extracted_data </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> extract_text_from_word</span><span style="color:#ABB2BF;">(doc_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 保存到Excel</span></span>
<span class="line"><span style="color:#61AFEF;">save_data_to_excel</span><span style="color:#ABB2BF;">(extracted_data, excel_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="总结" tabindex="-1"><strong>总结</strong>： <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;**总结**：&quot;">​</a></h3><p>通过上面的代码示例，我们可以看到如何利用<code>python-docx</code>和<code>pandas</code>库，轻松实现从 Word 文档中提取文本数据，并将其保存到 Excel 文件中的自动化过程。这种方法适用于需要从大量文档中提取结构化信息并进行进一步数据分析或报告的场景。通过自动化从 Word 到 Excel 的数据转移，用户可以节省大量的手动数据录入时间，并减少因人工处理导致的错误。</p><h2 id="一行代码实现-pdf-转为-word" tabindex="-1">一行代码实现 PDF 转为 Word <a class="header-anchor" href="#一行代码实现-pdf-转为-word" aria-label="Permalink to &quot;一行代码实现 PDF 转为 Word&quot;">​</a></h2><p>在日常的办公场景中，PDF 文件因其优秀的排版效果和兼容性，成为了文档交换的常用格式。然而，PDF 文件的一个显著缺点是其可编辑性极低，一旦我们需要对其中的内容进行修改或复制粘贴时，就会面临诸多不便。这时，将 PDF 文件转换为 Word 格式就显得尤为重要，因为 Word 文档不仅易于编辑，还支持各种格式调整和文本操作。</p><p>幸运的是，Python 自动化办公技术为我们提供了一个简单高效的解决方案。通过 Python 的第三方库 pdf2docx，我们可以编写脚本，仅需一行代码就可以实现 PDF 到 Word 的自动转换，从而大大提高工作效率，减少因手动操作带来的错误<code>。</code></p><h3 id="场景分析" tabindex="-1">场景分析 <a class="header-anchor" href="#场景分析" aria-label="Permalink to &quot;场景分析&quot;">​</a></h3><p>我们经常需要复制或借鉴网上下载的 PDF 文档内容，比如行政人员可能需要参考其他公司的制度流程，而学生则可能需要借鉴已经发表的论文资料。然而，直接复制 PDF 文档的内容往往会出现格式错乱、文字丢失或乱码等问题，这给我们的工作和学习带来了极大的不便。</p><p><img src="`+T+`" alt="image-20240511164342838"></p><h3 id="数据分析" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li><p><strong>输入</strong>：PDF 文档</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>使用<code>pdf2docx</code>库读取 PDF 的内容。</li><li>提取每一页的文字</li><li>将文本存储到 word 文档中</li></ul></li><li><p><strong>输出</strong>：一个包含所有报告的合并文档。</p></li></ul><h3 id="实战代码" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pdf2docx</span></span>
<span class="line"><span style="color:#ABB2BF;">pdf2docx.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;一句顶一万句.pdf&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;output_word.docx&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="`+I+'" alt="image-20240511164423298"></p><h3 id="总结-1" tabindex="-1">总结 <a class="header-anchor" href="#总结-1" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>将 PDF 转换为 Word 后，我们可以轻松地对文档进行编辑、修改和复制粘贴。无论是调整文本内容、更改格式还是添加注释，都变得简单快捷。此外，Word 文档还支持丰富的文本样式和排版功能，使得文档更加美观易读。</p><p>Python 自动化办公技术为我们提供了一个方便快捷的 PDF 到 Word 转换方案。通过编写简单的 Python 脚本，我们可以轻松实现 PDF 文件的自动转换和编辑处理，从而大大提高工作效率和准确性。</p><h2 id="一键从-pdf-中批量提取-excel-表格" tabindex="-1">一键从 PDF 中批量提取 Excel 表格 <a class="header-anchor" href="#一键从-pdf-中批量提取-excel-表格" aria-label="Permalink to &quot;一键从 PDF 中批量提取 Excel 表格&quot;">​</a></h2><p>在当今高效、快速的工作环境中，自动化办公已成为提高工作效率、节省时间成本的必备技能。Python，作为一种强大的编程语言，凭借其丰富的库和强大的数据处理能力，在自动化办公领域大放异彩。本文将介绍如何利用 Python 实现从 PDF 中自动批量提取 Excel 表格的功能，让办公变得更加轻松、高效。</p><p>在日常办公中，我们经常需要处理大量的 PDF 文件，如网上下载的参考资料、同事或领导发送的工作交接文件等。然而，PDF 文件的可编辑性并不高，如果我们需要从中提取数据并编辑，通常只能依赖手动复制粘贴的方式，这不仅效率低下，而且容易出错。Python 自动化办公技术的引入，可以极大地改善这一问题。通过编写 Python 脚本，我们可以实现一键式批量处理 PDF 文件，自动提取其中的表格数据，并转换为 Excel 格式，极大地提高了工作效率和准确性。</p><h3 id="场景分析-1" tabindex="-1">场景分析 <a class="header-anchor" href="#场景分析-1" aria-label="Permalink to &quot;场景分析&quot;">​</a></h3><p>想象一下，你拥有数十甚至数百个需要表格的 PDF 文档。手动复制粘贴这些表格，无疑是一项繁琐且容易出错的任务。</p><p><img src="'+N+`" alt="image-20240511164510019"></p><h3 id="数据处理流程" tabindex="-1">数据处理流程 <a class="header-anchor" href="#数据处理流程" aria-label="Permalink to &quot;数据处理流程&quot;">​</a></h3><ul><li><p><strong>输入</strong>：包含多个表格的 PDF 文档。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>使用<code>tabula-py</code>库读取文档中的表格</li><li>遍历表格并用 pandas 转化为 DataFrame 形式</li><li>将 DataFrame 格式保存到 Excel 中。</li></ul></li><li><p><strong>输出</strong>：文档中所有表格的 Excel 文件。</p></li></ul><h3 id="实战演练" tabindex="-1">实战演练 <a class="header-anchor" href="#实战演练" aria-label="Permalink to &quot;实战演练&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> tabula</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># PDF文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">pdf_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;你的待提取文档.pdf&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 读取PDF中的所有表格</span></span>
<span class="line"><span style="color:#ABB2BF;">tables </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tabula.</span><span style="color:#61AFEF;">read_pdf</span><span style="color:#ABB2BF;">(pdf_path, </span><span style="color:#E06C75;font-style:italic;">pages</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;all&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">multiple_tables</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 遍历每个表格，并转换为pandas DataFrame</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i, table </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(tables):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">(table)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 清洗数据，根据具体表格结构可能需要进行额外的处理</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 例如，删除空行、处理列名等</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # df = df.dropna(how=&#39;all&#39;)  # 删除全空行</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # df.columns = [&#39;Column1&#39;, &#39;Column2&#39;, ...]  # 设置列名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 将清洗后的DataFrame保存为Excel文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    excel_path </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;extracted_table_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">i</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.xlsx&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    df.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(excel_path, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><img src="`+L+'" alt="image-20240511164549862"></p><p><img src="'+j+`" alt="image-20240511164610981"></p><h4 id="总结-2" tabindex="-1">总结 <a class="header-anchor" href="#总结-2" aria-label="Permalink to &quot;总结&quot;">​</a></h4><p>Python 自动化办公技术的引入为我们的工作带来了极大的便利和效率提升。通过编写 Python 脚本实现 PDF 到 Excel 的自动转换功能只是其中的一个小小应用示例。相信在未来的工作中我们还会发现更多 Python 自动化办公的神奇之处！</p><h2 id="一键批量提取word表格到excel" tabindex="-1">一键批量提取Word表格到Excel <a class="header-anchor" href="#一键批量提取word表格到excel" aria-label="Permalink to &quot;一键批量提取Word表格到Excel&quot;">​</a></h2><h3 id="导语" tabindex="-1">导语 <a class="header-anchor" href="#导语" aria-label="Permalink to &quot;导语&quot;">​</a></h3><p>在繁忙的办公环境中，文档处理往往占据了大量的时间和精力。特别是当面对大量Word文档中的表格数据时，手动复制粘贴到Excel中进行整理分析，不仅效率低下，而且容易出错。现在，借助Python自动化办公的神奇力量，我们可以轻松实现一键批量提取Word文档中的表格到Excel，让办公效率翻倍，准确性也大幅提升！</p><h3 id="场景分析-2" tabindex="-1">场景分析 <a class="header-anchor" href="#场景分析-2" aria-label="Permalink to &quot;场景分析&quot;">​</a></h3><p>在不少企业中，文档管理是一项重要的工作。然而，当涉及到大量Word文档中的表格数据时，传统的处理方式就显得捉襟见肘。员工们需要手动打开每个Word文档，复制表格内容，再粘贴到Excel中进行整理和分析。这样的处理方式不仅耗时耗力，而且容易在复制粘贴过程中出现数据丢失或格式错乱的问题。</p><h3 id="数据处理流程-1" tabindex="-1">数据处理流程 <a class="header-anchor" href="#数据处理流程-1" aria-label="Permalink to &quot;数据处理流程&quot;">​</a></h3><ul><li><p><strong>输入</strong>：包含多个表格的WORD文档。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>使用docx库读取WORD文档，并获取表格</li><li>遍历表格并用openpyxl 将表格存储在Excel中</li></ul></li><li><p><strong>输出</strong>：文档中所有表格的Excel文件。</p></li></ul><h3 id="实战演练-1" tabindex="-1">实战演练 <a class="header-anchor" href="#实战演练-1" aria-label="Permalink to &quot;实战演练&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Document</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Workbook</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#获取待处理的文件的路径</span></span>
<span class="line"><span style="color:#ABB2BF;">path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;word文件&#39;</span><span style="color:#7F848E;font-style:italic;">  #文件所在文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;">files </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [path</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(path)] </span><span style="color:#7F848E;font-style:italic;">#获取文件夹下的文件名,并拼接完整路径</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> files:</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Document</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Workbook</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">(wb.worksheets[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span><span style="color:#7F848E;font-style:italic;">#删除工作簿自带的工作表</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> index, table </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(doc.tables, </span><span style="color:#E06C75;font-style:italic;">start</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">): </span><span style="color:#7F848E;font-style:italic;">#从1开始给表格编号</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.</span><span style="color:#61AFEF;">create_sheet</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Sheet</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">index</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#7F848E;font-style:italic;">#创建新工作表，以&quot;Sheet&quot; + word中表格的编号命名</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(table.rows)): </span><span style="color:#7F848E;font-style:italic;">#遍历word中表格的所有行</span></span>
<span class="line"><span style="color:#ABB2BF;">            row_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [] </span><span style="color:#7F848E;font-style:italic;">#储存表格中每行的数据</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> j </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(table.columns)): </span><span style="color:#7F848E;font-style:italic;">#遍历word中表格的所有列</span></span>
<span class="line"><span style="color:#ABB2BF;">                row_data.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(table.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(i,j).text)</span></span>
<span class="line"><span style="color:#ABB2BF;">            ws.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(row_data) </span><span style="color:#7F848E;font-style:italic;">#每取一行就写入数据到Excel表的行中</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;excel文件</span><span style="color:#56B6C2;">\\\\</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">.xlsx&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])) </span><span style="color:#7F848E;font-style:italic;">#保存excel文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="`+M+'" alt="image-20240517185959561"></p><p><img src="'+O+'" alt="image-20240517190011652"></p><h3 id="自动化办公带来的变化" tabindex="-1">自动化办公带来的变化 <a class="header-anchor" href="#自动化办公带来的变化" aria-label="Permalink to &quot;自动化办公带来的变化&quot;">​</a></h3><p>通过Python自动化办公解决方案，我们可以实现一键批量提取Word文档中的表格到Excel，从而带来以下变化：</p><ol><li>工作效率大幅提高：相比手动复制粘贴的方式，自动化办公可以大大缩短处理时间。员工们可以将更多的精力投入到其他有价值的工作中，提高整体工作效率。</li><li>文档格式更加规范：自动化办公可以确保提取到的表格数据在Excel中保持一致的格式和样式。这有助于减少因格式错乱而导致的误解和错误。</li><li>数据准确性得到保障：自动化办公可以减少人为因素对数据的影响。通过自动化提取和转换过程，我们可以确保数据的准确性和一致性。</li></ol><h3 id="结语" tabindex="-1">结语： <a class="header-anchor" href="#结语" aria-label="Permalink to &quot;结语：&quot;">​</a></h3><p>Python自动化办公解决方案为我们提供了一个高效、准确、规范的文档处理方式。通过一键批量提取Word文档中的表格到Excel，我们可以轻松应对大量文档处理任务，提高工作效率和质量。让我们一起拥抱Python自动化办公的神奇力量吧！</p><h2 id="自动向word文档中添加数据和图片-智能调整版面" tabindex="-1">自动向Word文档中添加数据和图片，智能调整版面 <a class="header-anchor" href="#自动向word文档中添加数据和图片-智能调整版面" aria-label="Permalink to &quot;自动向Word文档中添加数据和图片，智能调整版面&quot;">​</a></h2><h4 id="痛点分析" tabindex="-1">痛点分析 <a class="header-anchor" href="#痛点分析" aria-label="Permalink to &quot;痛点分析&quot;">​</a></h4><p>在日常的办公中，图片是文档中不可或缺的一部分，但手动添加和调整图片往往耗费大量时间和精力。尤其是当需要添加的图片数量较多时，重复性的操作更是让人苦不堪言。比如：在日常的6S稽核工作中，我们不仅要记录问题、描述情况，还要将现场拍摄的照片添加到Word文档中。然而，直接将图片粘贴到文档中，往往会导致文档排版混乱，图片大小不合适，需要手动调整。这样的重复性工作，不仅耗时耗力，还容易出错。此时，如果能有一种自动化工具来帮助我们完成这些任务，将极大地提高我们的工作效率。</p><h4 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h4><p>有了Python的助力，我们可以轻松实现Word文档的自动化处理。首先，将序号、问题描述和责任部门等信息录入Excel表格，然后利用Python读取这些信息，并自动在Word文档的指定位置添加图片，同时调整图片大小，使其符合排版要求。</p><h4 id="实现步骤" tabindex="-1">实现步骤 <a class="header-anchor" href="#实现步骤" aria-label="Permalink to &quot;实现步骤&quot;">​</a></h4><ol><li><p><strong>准备材料</strong>：将稽核记录整理成Excel表格，同时收集好对应的图片文件。 <img src="'+R+'" alt="image-20240605143351987"></p><p><img src="'+H+'" alt="image-20240605143409737"></p><p><img src="'+W+`" alt="image-20240605143420141"></p><ol><li><strong>编写代码</strong>：使用Python的<code>python-docx</code>库来操作Word文档，<code>openpyxl</code>库来读取Excel表格数据</li><li><strong>读取数据</strong>：遍历Excel表格，读取每条记录的信息（序号、问题描述、责任部门）和对应的图片路径。</li><li><strong>添加图片</strong>：在Word文档中指定位置添加图片，并调整图片大小，使其适应文档排版，并在指定位置添加问题、时间等信息</li><li><strong>保存文档</strong>：完成所有记录的处理后，保存Word文档。</li></ol></li></ol><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#提取Excel表中的数据</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook </span><span style="color:#7F848E;font-style:italic;">#用于读取Excel中的信息</span></span>
<span class="line"><span style="color:#ABB2BF;">wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;数据.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active</span></span>
<span class="line"><span style="color:#ABB2BF;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[]</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,ws.max_row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    number </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#98C379;">&#39;A&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value</span></span>
<span class="line"><span style="color:#ABB2BF;">    problem </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#98C379;">&#39;B&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value</span></span>
<span class="line"><span style="color:#ABB2BF;">    owner </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#98C379;">&#39;C&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value</span></span>
<span class="line"><span style="color:#ABB2BF;">    info_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [number,problem,owner]</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(info_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Document</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx.shared </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Cm</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;">  os</span></span>
<span class="line"><span style="color:#ABB2BF;">doc </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Document</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;6S稽查问题模板.docx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#将图片按修改时间排序(这样才能与图片的描述一致)，将路径存入列表，以便后面逐个插入图片时调用</span></span>
<span class="line"><span style="color:#ABB2BF;">path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;6s_pictures&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">list_p </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [path</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(path)] </span><span style="color:#7F848E;font-style:italic;">#获取图片的文件名,并拼接完整路径</span></span>
<span class="line"><span style="color:#ABB2BF;">list_p.</span><span style="color:#61AFEF;">sort</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">lambda</span><span style="color:#D19A66;font-style:italic;"> path</span><span style="color:#ABB2BF;">: os.path.</span><span style="color:#61AFEF;">getmtime</span><span style="color:#ABB2BF;">(path)) </span><span style="color:#7F848E;font-style:italic;">#将列表中的文件按其修改时间排序，os.path.getmtime() 函数是获取文件最后修改时间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">table </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> doc.tables[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#7F848E;font-style:italic;">#已确定是第一个表格，其索引是0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#增加需要的行，以便足够填入数据</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(data)</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    table.</span><span style="color:#61AFEF;">add_row</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#写入数据及图片</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(data)</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    table.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(row,</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">).text </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(data[row</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]) </span><span style="color:#7F848E;font-style:italic;">#往第1列写入序号</span></span>
<span class="line"><span style="color:#ABB2BF;">    table.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(row,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">).text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[row</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">] </span><span style="color:#7F848E;font-style:italic;">#往第2列写入问题描述</span></span>
<span class="line"><span style="color:#ABB2BF;">    table.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(row,</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data[row</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">][</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">] </span><span style="color:#7F848E;font-style:italic;">#往第4列写入责任部门</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #插入图片并调整图片的高度和宽度，以适合模板中的单元格尺寸</span></span>
<span class="line"><span style="color:#ABB2BF;">    run </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> table.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(row,</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">).paragraphs[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">add_run</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#新增一个文字块</span></span>
<span class="line"><span style="color:#ABB2BF;">    picture </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> run.</span><span style="color:#61AFEF;">add_picture</span><span style="color:#ABB2BF;">(list_p[row</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]) </span><span style="color:#7F848E;font-style:italic;">#插入图片</span></span>
<span class="line"><span style="color:#ABB2BF;">    picture.height </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Cm</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4.4</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#设置图片高度</span></span>
<span class="line"><span style="color:#ABB2BF;">    picture.width </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Cm</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">6.2</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">#设置图片宽度</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">doc.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;6S稽查问题.docx&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h4 id="效果展示-1" tabindex="-1"><strong>效果展示</strong> <a class="header-anchor" href="#效果展示-1" aria-label="Permalink to &quot;**效果展示**&quot;">​</a></h4><p>经过Python的自动化处理，原本混乱的Word文档变得整洁有序，图片大小适中，排版美观。而且，整个过程只需要几分钟时间，大大节省了人力成本和时间成本。</p><p><img src="`+G+'" alt="image-20240605143518275"></p><p><img src="'+U+`" alt="image-20240605143530012"></p><h2 id="自动化表格汇总与邮件发送-告别重复性工作" tabindex="-1">自动化表格汇总与邮件发送，告别重复性工作 <a class="header-anchor" href="#自动化表格汇总与邮件发送-告别重复性工作" aria-label="Permalink to &quot;自动化表格汇总与邮件发送，告别重复性工作&quot;">​</a></h2><p>在日常的办公环境中，我们常常面临着一种既重复又繁琐的工作挑战：每个月都需要手动收集和整理来自各个城市分公司的经营数据表格。这些表格可能格式各异，内容繁多，包含销售额、成本、利润等关键信息，对于公司决策层来说至关重要。然而，手动处理这些表格不仅耗时耗力，而且容易出错，极大地影响了工作效率和数据的准确性。</p><p>想象一下，每个月的这个时候，你都需要打开数十个甚至上百个 Excel 文件，逐个查看、核对数据，然后将它们一一输入到一个新的汇总表格中。接下来，你还需要编写邮件，将这个汇总报告发送给领导和相关部门。这种机械式的重复工作不仅让人感到枯燥无味，而且很容易因为疏忽而引入错误。</p><p>为了打破这种办公瓶颈，提高工作效率和数据的准确性，我们可以借助 Python 进行自动化办公。通过编写 Python 脚本，我们可以轻松实现经营数据的自动汇总和邮件发送。这不仅能够节省我们大量的时间和精力，而且能够减少人为错误，提高数据的可靠性。</p><p>在接下来的内容中，我们将详细介绍如何利用 Python 实现经营数据的自动化汇总和邮件发送。首先，我们将介绍如何读取和处理来自不同分公司的经营数据表格；然后，我们将展示如何将处理后的数据汇总到一个新的表格中；最后，我们将演示如何自动发送带有附件的邮件给领导和相关部门。通过这个过程，你将看到 Python 在自动化办公中的强大功能，以及它如何帮助我们摆脱繁琐的重复工作，提高工作效率。</p><h3 id="一、自动化汇总经营数据" tabindex="-1">一、自动化汇总经营数据 <a class="header-anchor" href="#一、自动化汇总经营数据" aria-label="Permalink to &quot;一、自动化汇总经营数据&quot;">​</a></h3><h4 id="处理流程" tabindex="-1">处理流程 <a class="header-anchor" href="#处理流程" aria-label="Permalink to &quot;处理流程&quot;">​</a></h4><p><strong>输入</strong>：多个具有相似数据结构的 Excel 工作簿。</p><p><strong>处理</strong>：</p><ol><li><ul><li>使用 Python 脚本遍历指定文件夹中的所有 Excel 文件。</li><li>从每个文件中提取特定的数据列。</li><li>将提取的数据整合到一个新的 pandas DataFrame 中。</li></ul></li><li></li><li><p><strong>输出</strong>：一个包含所有提取数据的新的 Excel 工作簿。</p></li></ol><h4 id="示例数据" tabindex="-1">示例数据 <a class="header-anchor" href="#示例数据" aria-label="Permalink to &quot;示例数据&quot;">​</a></h4><p>假设我们需要从各个分支机构的年度报告中提取“营业收入”和“净利润”数据。文件名可能如下：</p><ul><li>山东分公司财务报名.xlsx</li><li>上海分公司财务报名.xlsx</li><li>东北分公司财务报名.xlsx</li><li>广东分公司财务报名.xlsx</li><li>...</li></ul><p>每个文件包含以下列：</p><ul><li>日期</li><li>营业收入</li><li>净利润</li><li>其他费用</li><li>...</li></ul><h4 id="实战代码-1" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-1" aria-label="Permalink to &quot;实战代码&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> batch_extract_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">columns</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_filename</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历指定文件夹中的所有Excel文件</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(directory):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xlsx&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">columns)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 添加文件来源信息，以便知道数据来自哪个分支机构</span></span>
<span class="line"><span style="color:#ABB2BF;">            df[</span><span style="color:#98C379;">&#39;Source&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 将数据添加到总数据列表中</span></span>
<span class="line"><span style="color:#ABB2BF;">            all_data.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(df)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 将列表中的DataFrame合并成一个</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data_frame </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(all_data, </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 将汇总的数据输出到新的Excel文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data_frame.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(output_filename, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数</span></span>
<span class="line"><span style="color:#61AFEF;">batch_extract_data</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;日期&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;营业收入&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;净利润&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;path_to_financial_reports&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Consolidated_Financials.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="二、自动发送邮件给领导和相关部门" tabindex="-1">二、自动发送邮件给领导和相关部门 <a class="header-anchor" href="#二、自动发送邮件给领导和相关部门" aria-label="Permalink to &quot;二、自动发送邮件给领导和相关部门&quot;">​</a></h3><p>当我们完成了经营数据的汇总后，下一步就是将这个汇总报告发送给领导和相关部门。</p><p>Python 中的 smtplib 和 email 库可以帮助我们实现邮件的自动发送。</p><p>下面是一个简单的示例代码，用于发送带有附件的邮件：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.multipart </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEMultipart</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.text </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEText</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.base </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEBase</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> encoders</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置邮件服务器、发件人、收件人、邮件主题和正文</span></span>
<span class="line"><span style="color:#ABB2BF;">mailserver </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;smtp.163.com&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 发件人-填写自己的邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">userName_SendMail </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;zdy15921159716@163.com&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 邮箱发件授权码-为发件人生成的授权码，详见下文</span></span>
<span class="line"><span style="color:#ABB2BF;">userName_AuthCode </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;BOEFGGZHRAHEXGRN&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">receivers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;boss_email@example.com&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;department_email@example.com&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">subject </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;经营数据汇总报告&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">body </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;请查阅附件中的经营数据汇总报告。&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 读取要发送的附件文件</span></span>
<span class="line"><span style="color:#C678DD;">with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;summary_report.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> attachment:</span></span>
<span class="line"><span style="color:#ABB2BF;">    part </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MIMEBase</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;application&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;octet-stream&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    part.</span><span style="color:#61AFEF;">set_payload</span><span style="color:#ABB2BF;">(attachment.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    encoders.</span><span style="color:#61AFEF;">encode_base64</span><span style="color:#ABB2BF;">(part)</span></span>
<span class="line"><span style="color:#ABB2BF;">    part.</span><span style="color:#61AFEF;">add_header</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Content-Disposition&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;attachment; filename=&quot;summary_report.xlsx&quot;&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建邮件对象并添加附件</span></span>
<span class="line"><span style="color:#ABB2BF;">msg </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MIMEMultipart</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">msg[</span><span style="color:#98C379;">&#39;From&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sender</span></span>
<span class="line"><span style="color:#ABB2BF;">msg[</span><span style="color:#98C379;">&#39;To&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;, &#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(receivers)</span></span>
<span class="line"><span style="color:#ABB2BF;">msg[</span><span style="color:#98C379;">&#39;Subject&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subject</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">MIMEText</span><span style="color:#ABB2BF;">(body, </span><span style="color:#98C379;">&#39;plain&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(part)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 发送邮件</span></span>
<span class="line"><span style="color:#ABB2BF;">smtp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> smtplib.</span><span style="color:#61AFEF;">SMTP_SSL</span><span style="color:#ABB2BF;">(mailserver, </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">465</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">smtp.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(userName_SendMail, userName_AuthCode)</span></span>
<span class="line"><span style="color:#ABB2BF;">smtp.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(userName_SendMail, </span><span style="color:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(received_mail), msg.</span><span style="color:#61AFEF;">as_string</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">smtp.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>163 邮箱安全码设置【python 代码中的密码使用这个而不是邮箱密码】</p><p><img src="`+K+'" alt="image-20240511164848486"></p><p><img src="'+z+'" alt="image-20240511164917121"></p><p><img src="'+Y+'" alt="image-20240511164928150"></p><p>通过结合以上两个步骤，我们就可以实现经营数据的自动化汇总和邮件发送了。这将大大提高我们的工作效率和准确性，让我们有更多的时间专注于其他重要的工作。</p><h2 id="汇总20年400个产品表数据" tabindex="-1">汇总20年400个产品表数据 <a class="header-anchor" href="#汇总20年400个产品表数据" aria-label="Permalink to &quot;汇总20年400个产品表数据&quot;">​</a></h2><h3 id="困境重重-百表难归一-传统方法耗时费力" tabindex="-1">困境重重：<strong>百表难归一，传统方法耗时费力</strong> <a class="header-anchor" href="#困境重重-百表难归一-传统方法耗时费力" aria-label="Permalink to &quot;困境重重：**百表难归一，传统方法耗时费力**&quot;">​</a></h3><p>首当其冲的难题便是如何整理那数以万计、分散在各个业务员手中的产品数据表。每个业务员都负责着不同的产品和客户，他们的工作方式、数据记录习惯各不相同，这导致了数据表格格式的五花八门。有的业务员可能偏好使用Excel的某些特定功能，而有的则可能只是简单地用文字记录了关键信息。更让人头疼的是，这些表格的数量高达上百个，且每个表格都可能包含不同的字段、不同的数据格式，甚至不同的语言描述。</p><p>面对这样的困境，传统的数据整理方式显得力不从心。据初步估算，如果按照传统方法进行数据格式统一和表格汇总，恐怕一个月的时间都难以完成。更糟糕的是，即使完成了这一工作，也无法保证数据的准确性和完整性。这对于即将上线ERP系统的企业来说，无疑是一个巨大的隐患。</p><h3 id="逆袭之路-python自动化神奇助力" tabindex="-1">逆袭之路：Python自动化神奇助力 <a class="header-anchor" href="#逆袭之路-python自动化神奇助力" aria-label="Permalink to &quot;逆袭之路：Python自动化神奇助力&quot;">​</a></h3><p>寻找一种高效、准确的数据整理方法迫在眉睫。幸运的是，随着科技的发展，我们已经有了更好的选择——Python自动化办公工具。它能够帮助我们快速、准确地完成数据格式的统一和表格的汇总工作，为企业的数字化转型提供有力的支持。</p><h3 id="三大步骤-轻松实现数据汇总" tabindex="-1">三大步骤：轻松实现数据汇总 <a class="header-anchor" href="#三大步骤-轻松实现数据汇总" aria-label="Permalink to &quot;三大步骤：轻松实现数据汇总&quot;">​</a></h3><h4 id="第一步-建立数据库模式表" tabindex="-1">第一步：建立数据库模式表 <a class="header-anchor" href="#第一步-建立数据库模式表" aria-label="Permalink to &quot;第一步：建立数据库模式表&quot;">​</a></h4><p>首先，我们建立了一个规定好格式的数据库模式表，作为产品数据库的雏形。这个表格规定好了需要包含的列和产品项目，且部分新业务员已经将自己的数据进行了录入，但对于老业务员的表格，由于多了一列货号数据，我们需要在数据库模式表的C列添加一个空列。</p><p><img src="'+X+`" alt="image-20240526153035637"></p><h4 id="向表格中所有sheet增加一个空列c列的python-代码" tabindex="-1">向表格中所有Sheet增加一个空列C列的Python 代码 <a class="header-anchor" href="#向表格中所有sheet增加一个空列c列的python-代码" aria-label="Permalink to &quot;向表格中所有Sheet增加一个空列C列的Python 代码&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> add_column_with_header</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">sheet_name</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">header_name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;Item No&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历工作簿中的所有sheet，或者只处理指定的sheet</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> sheet_name:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheets_to_process </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [workbook[sheet_name]]</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheets_to_process </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook.sheetnames</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> sheet_name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sheets_to_process:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheet </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook[sheet_name]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 检查是否需要插入新列（确保至少有一个单元格在C列有数据或sheet已经存在D列）</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> sheet[</span><span style="color:#98C379;">&#39;B2&#39;</span><span style="color:#ABB2BF;">].value </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#C678DD;"> or</span><span style="color:#ABB2BF;"> sheet.max_column </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 2</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 在D列的位置插入新列（如果D列已经存在则不会再次插入）</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 注意：openpyxl的insert_cols会自动处理列的移动</span></span>
<span class="line"><span style="color:#ABB2BF;">            sheet.</span><span style="color:#61AFEF;">insert_cols</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">idx</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 在第3列（C列）的位置插入新列</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 在新插入的C列的第一行设置列名为“货号”</span></span>
<span class="line"><span style="color:#ABB2BF;">            sheet.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">header_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(file_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="第二步-格式化老业务员表格" tabindex="-1">第二步：格式化老业务员表格 <a class="header-anchor" href="#第二步-格式化老业务员表格" aria-label="Permalink to &quot;第二步：格式化老业务员表格&quot;">​</a></h4><p>接下来，我们对老业务员的表格进行了格式化处理。从下图可以看出，老业务员们是非常不愿意按公司规定的标准填表的，首先A列是完全无用的列需要删除，B列同一信息分行写到了两行，重复信息图省事儿，没有进行重复录入。</p><p>针对B列数据，我采用了特殊规则：当上下两行都不为空时，将两行内容汇总到一行；同时，确保相邻两个有数据行之间的空行填充前一个非空行的数据。</p><p><img src="`+V+`" alt="image-20240526153111986"></p><p><strong>格式化所有业务员所有表格中的所有Sheet表的代码</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> process_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(input_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    sheet_names </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.</span><span style="color:#61AFEF;">get_sheet_names</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 获得工作簿的所有工作表名  # 假设处理的是活动工作表</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> sheet_name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sheet_names:</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb[sheet_name]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 标记上一个非空单元格的值</span></span>
<span class="line"><span style="color:#ABB2BF;">        last_non_empty_value </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 遍历所有行（从第二行开始，假设第一行是标题）</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, ws.max_row </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查当前行和下一行是否都不为空</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> row </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> ws.max_row </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 合并两行内容到上一行</span></span>
<span class="line"><span style="color:#ABB2BF;">                new_value </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> \\</span></span>
<span class="line"><span style="color:#98C379;">                    &#39; &#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value)</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> new_value</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span><span style="color:#7F848E;font-style:italic;">  # 可以设置为None或者删除整行，取决于需求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 更新上一个非空值，用于填充</span></span>
<span class="line"><span style="color:#ABB2BF;">                last_non_empty_value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> new_value</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> last_non_empty_value </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 填充空行为上一个非空值</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws[</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;B</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">].value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> last_non_empty_value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存更改到新的工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(input_file)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># process_excel(&#39;SPINNING.xlsx&#39;, &#39;output.xlsx&#39;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>在格式化完成后，我们删除了老业务员明细表中的A列，因为它包含了与数据库模式表无关的信息。</p><p><strong>删除所有老业务员所有表格中的所有sheet表A列的代码</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> delete_column_a_in_all_sheets</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历工作簿中的所有工作表</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> sheet </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> workbook.worksheets:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 检查A列是否有内容</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # if sheet[&#39;A1&#39;].value is not None or sheet.max_column &gt; 1:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 复制B列及其后所有列的内容到A列及其后一列的位置</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # for row in range(1, sheet.max_row + 1):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     for col in range(2, sheet.max_column + 1):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #         sheet.cell(row=row, column=col -</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #                    1).value = sheet.cell(row=row, column=col).value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 删除最后一列（现在实际上是原来的A列的内容）</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheet.</span><span style="color:#61AFEF;">delete_cols</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 删除第一列（即原来的A列）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(file_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="第三步-智能汇总所有数据" tabindex="-1">第三步：智能汇总所有数据 <a class="header-anchor" href="#第三步-智能汇总所有数据" aria-label="Permalink to &quot;第三步：智能汇总所有数据&quot;">​</a></h4><p>最后，我们利用Python的强大数据处理能力，将所有老业务员的明细表汇总到数据库模式表中。当明细表的sheet名称与模式表相同时（忽略大小写），我们将明细表的数据添加到模式表相应数据的后面；如果明细表的sheet名称在模式表中不存在，我们则在模式表中新建sheet表，并将数据复制到里面。</p><p><strong>按照规则汇总所有业务员所有表格的所有sheet表的汇总代码</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> copy_worksheet_contents</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">source_ws</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">target_ws</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">max_row</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">max_col</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;  </span></span>
<span class="line"><span style="color:#98C379;">    复制源工作表的内容到目标工作表。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">    :param source_ws: 源工作表对象  </span></span>
<span class="line"><span style="color:#98C379;">    :param target_ws: 目标工作表对象  </span></span>
<span class="line"><span style="color:#98C379;">    :param max_row: 复制的最大行数（默认复制所有行）  </span></span>
<span class="line"><span style="color:#98C379;">    :param max_col: 复制的最大列数（默认复制所有列）  </span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> max_row </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        max_row </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> source_ws.max_row</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> max_col </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        max_col </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> source_ws.max_column</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> source_ws.</span><span style="color:#61AFEF;">iter_rows</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">min_row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">max_row</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">max_row, </span><span style="color:#E06C75;font-style:italic;">max_col</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">max_col, </span><span style="color:#E06C75;font-style:italic;">values_only</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> cell </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> row:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 复制单元格值（如果需要，也可以复制样式、公式等）</span></span>
<span class="line"><span style="color:#ABB2BF;">            target_cell </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> target_ws.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">cell.row, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">cell.column)</span></span>
<span class="line"><span style="color:#ABB2BF;">            target_cell.value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cell.value</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> merge_excel_workbooks</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_a_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">file_b_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载两个工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook_a </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        file_a_path, </span><span style="color:#E06C75;font-style:italic;">keep_vba</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">keep_links</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook_b </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        file_b_path, </span><span style="color:#E06C75;font-style:italic;">keep_vba</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">keep_links</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历B工作簿的所有sheet</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> sheet_b </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> workbook_b.sheetnames:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheet_b_obj </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook_b[sheet_b]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 查找A工作簿中是否有同名（忽略大小写）的sheet</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheet_a_name </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> sheet_a_name_candidate </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> workbook_a.sheetnames:</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> sheet_a_name_candidate.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> sheet_b.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                sheet_a_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sheet_a_name_candidate</span></span>
<span class="line"><span style="color:#C678DD;">                break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 如果找到同名sheet，则将B表的内容追加到A表的同名sheet中</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> sheet_a_name:</span></span>
<span class="line"><span style="color:#ABB2BF;">            sheet_a_obj </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook_a[sheet_a_name]</span></span>
<span class="line"><span style="color:#ABB2BF;">            max_row_a </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sheet_a_obj.max_row</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sheet_b_obj.</span><span style="color:#61AFEF;">iter_rows</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">min_row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">values_only</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                sheet_a_obj.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(row)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            sheet_a_obj </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook_a.</span><span style="color:#61AFEF;">create_sheet</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">title</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">sheet_b)</span></span>
<span class="line"><span style="color:#61AFEF;">            copy_worksheet_contents</span><span style="color:#ABB2BF;">(sheet_b_obj, sheet_a_obj)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 如果没有找到同名sheet，则将B表的sheet移动到A工作簿中</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # else:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     worksheet_to_add = workbook_b[sheet_b]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #     workbook_a._add_sheet(workbook_b[sheet_b], index=workbook_a.sheetnames.index(</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #         workbook_a.active.title) + 1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存合并后的工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook_a.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(output_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="成果展示-秒速完成几百个表格的数据汇总" tabindex="-1">成果展示：秒速完成几百个表格的数据汇总 <a class="header-anchor" href="#成果展示-秒速完成几百个表格的数据汇总" aria-label="Permalink to &quot;成果展示：秒速完成几百个表格的数据汇总&quot;">​</a></h3><p>经过Python自动化工具的处理，原本需要一个月才能完成的数据汇总工作，现在只需几秒钟就能轻松搞定。这不仅大大提高了工作效率，还确保了数据的准确性和完整性。</p><p><img src="`+J+'" alt="image-20240526153218638"></p><h2 id="轻松实现跨-sheet-表查询功能" tabindex="-1">轻松实现跨 sheet 表查询功能 <a class="header-anchor" href="#轻松实现跨-sheet-表查询功能" aria-label="Permalink to &quot;轻松实现跨 sheet 表查询功能&quot;">​</a></h2><p>在日常的办公场景中，我们经常需要处理包含多个工作表（sheet）的 Excel 文件，并在这些工作表之中进行数据查询和匹配。传统的做法通常是手动打开 Excel 文件，然后逐个工作表进行搜索，这种方法效率低下，费事费力。</p><p><strong>场景描述</strong></p><p>朋友是一家品牌公司的电商运营，在繁忙的电商运营中，处理来自客户的咨询是一项日常且重要的工作。当客户在抖音官方店铺中询问特定产品时，如果能快速定位到产品信息，无疑会极大提升客户满意度和运营效率。但是，朋友手里的产品资料是按照系列进行分表的，也就是一个系列产品是一个 sheet，当客户询问的不是具体的产品名称而是一些产品参数时，这就涉及到了多表查询的问题了，传统的 WPS 和 Office 是不支持多表查询的，传统的 Excel 操作方式——逐个工作表使用 Ctrl+F 进行搜索，不仅效率低下，还容易出错。幸运的是，我们可以利用 Python 的强大功能来自动化这一过程，实现轻松快捷的跨表查询功能。</p><p>【比如粉丝的这个问题，就需要打开所有的产品表格去挨个查找整个表格里是否有 MH 这个信息，我的产品系列有上百个，就需要重复上百次切换 sheet 表—&gt;Ctrl+F 操作】</p><p><img src="'+Q+`" alt="image-20240511165016030"></p><h3 id="数据分析-1" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析-1" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li><p><strong>输入</strong>：一个包含上百个 Sheet 表的 Excel 文件。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>查找每个 Sheet 表中是否包含需要的信息</li><li>返回 Sheet 表名和查找信息所在的单元格</li></ul></li><li><p><strong>输出</strong>：查询信息所在的 Sheet 表名和单元格位置。</p></li></ul><h3 id="示例数据-1" tabindex="-1">示例数据 <a class="header-anchor" href="#示例数据-1" aria-label="Permalink to &quot;示例数据&quot;">​</a></h3><p>假设我们有一个包含上百个 Sheet 表，名为<code>data.xlsx</code>的 Excel 文件，其中每个 Sheet 表都包含以下列：</p><ul><li>货品编码</li><li>货品描述</li><li>其他一些列</li></ul><h3 id="实战代码-2" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-2" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> openpyxl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> search_product_in_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">search_value</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    results </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历每个工作表</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> sheet_name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> workbook.sheetnames:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sheet </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook[sheet_name]</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;正在搜索表格</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">sheet</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 遍历每个单元格</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sheet.</span><span style="color:#61AFEF;">iter_rows</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">min_row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">min_col</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">max_col</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">sheet.max_column, </span><span style="color:#E06C75;font-style:italic;">max_row</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">sheet.max_row):</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> cell </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> row:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> cell.value:</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(cell.value).</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(search_value)</span><span style="color:#56B6C2;">!=-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                        # 找到值，添加结果到列表中</span></span>
<span class="line"><span style="color:#ABB2BF;">                        results.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">((sheet_name, cell.coordinate))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> results</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">file_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;your_excel_file.xlsx&#39;</span><span style="color:#7F848E;font-style:italic;">  # 替换为你的Excel文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">search_value </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;MH&#39;</span><span style="color:#7F848E;font-style:italic;">  # 替换为你要搜索的值</span></span>
<span class="line"><span style="color:#ABB2BF;">results </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> cross_sheet_search</span><span style="color:#ABB2BF;">(file_path, search_value)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> result </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> results:</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;在工作表 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">result[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 的单元格 </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">result[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> 找到了值 &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">result[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="运行结果" tabindex="-1">运行结果 <a class="header-anchor" href="#运行结果" aria-label="Permalink to &quot;运行结果&quot;">​</a></h3><p><img src="`+Z+`" alt="image-20240511165107665"></p><h3 id="总结-3" tabindex="-1">总结 <a class="header-anchor" href="#总结-3" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>通过 Python 和 openpyxl 库，我们可以轻松地实现跨表查询功能，极大地提高了办公效率。无论是处理单个 Excel 文件还是批量处理多个文件，Python 都能帮助我们快速、准确地完成任务。希望本文的介绍和示例代码能够帮助你更好地应对日常办公中的挑战，提升工作效率。</p><h2 id="批量-pdf-转图片-高效响应客户需求" tabindex="-1">批量 PDF 转图片，高效响应客户需求 <a class="header-anchor" href="#批量-pdf-转图片-高效响应客户需求" aria-label="Permalink to &quot;批量 PDF 转图片，高效响应客户需求&quot;">​</a></h2><p>在现代商业竞争中，快速高效反应已成为企业争夺客户的秘诀。随着全球化和互联网的普及，供需双方信息的透明化程度不断提高，企业能否高效快速地匹配客户需求并解决问题，成为决定其竞争力的关键因素。最近，我通过运用 Python 自动化办公技术，帮助朋友的公司迅速响应客户需求，取得了客户的信任和大订单。</p><p>事情是这样的，一个大客户由于品牌更改和领导层的变动，需要批量修改之前已经制作好的产品样册。这些样册以 PDF 格式提供而且数量巨大。为了尽早上市，这个客户给所有的合作供应商都发送了 PDF 产品册，也就意味着谁能第一时间完成修改，谁就能拿到这个大订单。</p><p>当对这些 PDF 图册直接进行修改时，问题就出现了。由于 PDF 文件本身的特性，直接编辑它们会遇到各种解析问题，使得修改过程变得困难且耗时。为了解决这个问题，公司美工提出将 PDF 文件转换为图片格式，再使用专业的图像编辑软件 PS 进行修改。但是客户给的产品册数量巨大，手动将每个 PDF 文件转换为图片格式是一项繁琐且耗时的任务，特别是在处理大量文件时。</p><p>面对这一挑战，我提出了一个解决方案：利用 Python 脚本将客户给的所有 PDF 文件批量转换为图片格式，再由美工使用专业的图像编辑软件进行修改。</p><h3 id="python-代码" tabindex="-1">python 代码 <a class="header-anchor" href="#python-代码" aria-label="Permalink to &quot;python 代码&quot;">​</a></h3><p>安装库</p><div class="language-py line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">pip install PyMuPDF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> fitz  </span><span style="color:#7F848E;font-style:italic;"># PyMuPDF库，用于处理PDF文件</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># from PIL import Image</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> pdf_to_images</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">pdf_folder</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_folder</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历指定文件夹中的所有PDF文件</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> pdf_file </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(pdf_folder):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> pdf_file.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.PDF&#39;</span><span style="color:#ABB2BF;">)):</span></span>
<span class="line"><span style="color:#ABB2BF;">            pdf_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(pdf_folder, pdf_file)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 打开PDF文件</span></span>
<span class="line"><span style="color:#ABB2BF;">            doc </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> fitz.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(pdf_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 创建输出文件夹（如果不存在）</span></span>
<span class="line"><span style="color:#ABB2BF;">            output_subfolder </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(output_folder, os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(pdf_file)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(output_subfolder):</span></span>
<span class="line"><span style="color:#ABB2BF;">                os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(output_subfolder)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 遍历PDF的每一页</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> page_num </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(doc)):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 获取当前页的Pixmap对象</span></span>
<span class="line"><span style="color:#ABB2BF;">                page </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> doc.</span><span style="color:#61AFEF;">load_page</span><span style="color:#ABB2BF;">(page_num)</span></span>
<span class="line"><span style="color:#ABB2BF;">                image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> page.</span><span style="color:#61AFEF;">get_pixmap</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # pix = doc.get_page_pixmap(page_num, alpha=False)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 将Pixmap对象转换为PIL Image对象</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # image = Image.frombytes(</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     &quot;RGB&quot;,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     [pix.width, pix.height],</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     pix.samples[&quot;RGB&quot;],</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     &quot;raw&quot;,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     &quot;RGB&quot;,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     pix.stride,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                #     -1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 保存图片到指定文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;">                output_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(output_subfolder, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">pdf_file.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">_page_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">page_num</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1}</span><span style="color:#98C379;">.png&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                image.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(output_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 关闭PDF文件</span></span>
<span class="line"><span style="color:#ABB2BF;">            doc.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 示例使用</span></span>
<span class="line"><span style="color:#ABB2BF;">pdf_folder </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;./&quot;</span><span style="color:#7F848E;font-style:italic;">  # PDF文件所在文件夹路径</span></span>
<span class="line"><span style="color:#ABB2BF;">output_folder </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;product_images&quot;</span><span style="color:#7F848E;font-style:italic;">  # 输出文件夹路径</span></span>
<span class="line"><span style="color:#61AFEF;">pdf_to_images</span><span style="color:#ABB2BF;">(pdf_folder, output_folder)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>这个脚本将遍历指定文件夹中的所有 PDF 文件，并将每个文件的每一页转换为 PNG 图片。转换后的图片将保存在与原始 PDF 文件同名的子文件夹中，并以特定的命名规则进行命名。</p><p><img src="`+$+'" alt="image-20240511165233544"></p><h3 id="结语-1" tabindex="-1">结语 <a class="header-anchor" href="#结语-1" aria-label="Permalink to &quot;结语&quot;">​</a></h3><p>通过 Python 自动化批量 PDF 转图片的操作，我成功帮助朋友的公司快速响应了客户需求，提升了客户满意度，成为第一个完成任务的公司成功拿下客户大订单，当其他合作商还在拼命地堆人力解决批量 PDF 转图片的问题时，我们已经将修改好的产品册发给客户了。</p><p>这就是 Python 自动化办公技术的强大能力，掌握这一技能将使我们在未来的工作中更加高效、专业。</p><h2 id="pdf文件的拆分和合并" tabindex="-1">PDF文件的拆分和合并 <a class="header-anchor" href="#pdf文件的拆分和合并" aria-label="Permalink to &quot;PDF文件的拆分和合并&quot;">​</a></h2><p>在快节奏的商海中，产品线更新速度犹如企业的“生命之脉”。当新品如雨后春笋般涌现，你是否还在为如何快速更新电子样册而烦恼？产品册一年一更新，其实很多时候只需要在去年样品册的基础上，增加新的一年同系列追加的产品和全新系列的产品，通过pdf的合并和拆分即可实现</p><hr><h3 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h3><p>在日新月异的商业环境中，产品线的快速更新是企业保持市场竞争力的关键。然而，面对不断更新的产品，产品册往往只需要在原有样品册的基础上，更新上新品。公司之前样品册更新，总是需要找外包美工进行电子样册更新，不仅增加了公司费用，还需要协调外包人员的时间，无法保证交期，效率低下且成本高昂。</p><p>随着2023年和2024年新产品的不断涌现，公司原有的2022年电子样册已经无法满足展示新产品的需求。这些新产品既包括在原有系列中追加的，也有全新开发的新系列。为了及时展示公司的最新产品阵容，我们需要对电子样册进行更新。</p><p><img src="'+ss+'" alt="图片"></p><p><strong><img src="'+ns+`" alt="图片"></strong></p><h3 id="一、传统更新方式的弊端" tabindex="-1">一、传统更新方式的弊端 <a class="header-anchor" href="#一、传统更新方式的弊端" aria-label="Permalink to &quot;一、传统更新方式的弊端&quot;">​</a></h3><p>在过去，每当新品上市，公司都需要联系外包美工团队，将新品的图片、描述等信息交给他们，然后等待他们完成电子样册的更新。这种方式存在诸多弊端：</p><ol><li><strong>成本高昂</strong>：外包美工团队通常收费不菲，而且随着更新次数的增加，成本也会不断攀升。</li><li><strong>时间成本高</strong>：需要不断与外包团队沟通协调，等待他们完成更新，这往往需要花费大量的时间和精力。</li><li><strong>质量难以保证</strong>：外包团队可能对产品的理解不够深入，导致更新后的电子样册与预期不符，甚至存在错误。</li></ol><h3 id="二、python-你的自动化办公神器" tabindex="-1">二、Python：你的自动化办公神器 <a class="header-anchor" href="#二、python-你的自动化办公神器" aria-label="Permalink to &quot;二、Python：你的自动化办公神器&quot;">​</a></h3><p>为了摆脱传统更新方式的弊端，我们引入了Python自动化办公技术。通过Python的PyPDF2库，我们可以轻松实现PDF的拆分和合并，让电子样册的更新变得简单快捷。</p><h4 id="_1-pdf拆分" tabindex="-1">1.PDF拆分 <a class="header-anchor" href="#_1-pdf拆分" aria-label="Permalink to &quot;1.PDF拆分&quot;">​</a></h4><p>首先，我们需要将2022年的电子样册PDF文件进行拆分。这可以通过Python的PyPDF2库实现。通过读取PDF文件，我们可以获取每个页面的内容，并将其单独保存为一个新的PDF文件。这样，我们就可以将新追加的产品页面从原始PDF中拆分出来。</p><h4 id="_2-pdf合并" tabindex="-1">2.PDF合并 <a class="header-anchor" href="#_2-pdf合并" aria-label="Permalink to &quot;2.PDF合并&quot;">​</a></h4><p>接下来，我们需要将新追加的产品页面合并到原系列中，并将新开发的系列页面合并到一起。这同样可以通过PyPDF2库实现。我们可以创建一个新的PDF写入对象，然后依次将需要合并的页面添加到该对象中，并最终将合并后的内容写入一个新的PDF文件。</p><h3 id="三、实现过程" tabindex="-1">三、实现过程 <a class="header-anchor" href="#三、实现过程" aria-label="Permalink to &quot;三、实现过程&quot;">​</a></h3><h4 id="安装pypdf2库" tabindex="-1">安装PyPDF2库 <a class="header-anchor" href="#安装pypdf2库" aria-label="Permalink to &quot;安装PyPDF2库&quot;">​</a></h4><p>首先，确保您已经安装了PyPDF2库。如果没有安装，可以通过以下命令进行安装：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install PyPDF2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="编写python脚本" tabindex="-1">编写Python脚本 <a class="header-anchor" href="#编写python脚本" aria-label="Permalink to &quot;编写Python脚本&quot;">​</a></h4><p>接下来，可以编写一个Python脚本来实现PDF的拆分和合并。以下是一个简单的示例脚本：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> PyPDF2  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> split_pdf</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_pdf_path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_folder</span><span style="color:#ABB2BF;">):  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 拆分PDF文件  </span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(input_pdf_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> input_pdf_file:  </span></span>
<span class="line"><span style="color:#ABB2BF;">        pdf_reader </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> PyPDF2.</span><span style="color:#61AFEF;">PdfFileReader</span><span style="color:#ABB2BF;">(input_pdf_file)  </span></span>
<span class="line"><span style="color:#ABB2BF;">        num_pages </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pdf_reader.</span><span style="color:#61AFEF;">getNumPages</span><span style="color:#ABB2BF;">()  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> page_num </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(num_pages):  </span></span>
<span class="line"><span style="color:#ABB2BF;">            output_pdf_path </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">output_folder</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/page_</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">page_num</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1}</span><span style="color:#98C379;">.pdf&quot;</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">            pdf_writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> PyPDF2.</span><span style="color:#61AFEF;">PdfFileWriter</span><span style="color:#ABB2BF;">()  </span></span>
<span class="line"><span style="color:#ABB2BF;">            pdf_writer.</span><span style="color:#61AFEF;">addPage</span><span style="color:#ABB2BF;">(pdf_reader.</span><span style="color:#61AFEF;">getPage</span><span style="color:#ABB2BF;">(page_num))  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(output_pdf_path, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> output_pdf_file:  </span></span>
<span class="line"><span style="color:#ABB2BF;">                pdf_writer.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(output_pdf_file)  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> merge_pdfs</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">input_pdf_paths</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_pdf_path</span><span style="color:#ABB2BF;">):  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 合并PDF文件  </span></span>
<span class="line"><span style="color:#ABB2BF;">    pdf_writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> PyPDF2.</span><span style="color:#61AFEF;">PdfFileWriter</span><span style="color:#ABB2BF;">()  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> input_pdf_path </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> input_pdf_paths:  </span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(input_pdf_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> input_pdf_file:  </span></span>
<span class="line"><span style="color:#ABB2BF;">            pdf_reader </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> PyPDF2.</span><span style="color:#61AFEF;">PdfFileReader</span><span style="color:#ABB2BF;">(input_pdf_file)  </span></span>
<span class="line"><span style="color:#ABB2BF;">            num_pages </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pdf_reader.</span><span style="color:#61AFEF;">getNumPages</span><span style="color:#ABB2BF;">()  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> page_num </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(num_pages):  </span></span>
<span class="line"><span style="color:#ABB2BF;">                pdf_writer.</span><span style="color:#61AFEF;">addPage</span><span style="color:#ABB2BF;">(pdf_reader.</span><span style="color:#61AFEF;">getPage</span><span style="color:#ABB2BF;">(page_num))  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(output_pdf_path, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> output_pdf_file:  </span></span>
<span class="line"><span style="color:#ABB2BF;">        pdf_writer.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(output_pdf_file)  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例  </span></span>
<span class="line"><span style="color:#61AFEF;">split_pdf</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;2022_catalog.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;split_pages&#39;</span><span style="color:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#61AFEF;">merge_pdfs</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;split_pages/page_1.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;split_pages/page_2.pdf&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;updated_series.pdf&#39;</span><span style="color:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#61AFEF;">merge_pdfs</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;new_series_page_1.pdf&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;new_series_page_2.pdf&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;new_series.pdf&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>在上述示例中，split_pdf函数用于拆分PDF文件，merge_pdfs函数用于合并多个PDF文件。您可以根据自己的需求修改输入和输出路径，以及要拆分和合并的页面。</p><h3 id="结语-2" tabindex="-1">结语 <a class="header-anchor" href="#结语-2" aria-label="Permalink to &quot;结语&quot;">​</a></h3><p>Python自动化办公技术已经成为企业提升效率、降低成本的重要工具。通过引入Python自动化办公技术，我们成功摆脱了传统电子样册更新方式的弊端，实现了快速、准确、低成本的更新过程。</p><h2 id="一键查找文件-告别手动翻找的烦恼-拯救你的-文件堆" tabindex="-1">一键查找文件，告别手动翻找的烦恼！拯救你的“文件堆”！ <a class="header-anchor" href="#一键查找文件-告别手动翻找的烦恼-拯救你的-文件堆" aria-label="Permalink to &quot;一键查找文件，告别手动翻找的烦恼！拯救你的“文件堆”！&quot;">​</a></h2><h3 id="小李的-文件堆" tabindex="-1">小李的&quot;文件堆&quot; <a class="header-anchor" href="#小李的-文件堆" aria-label="Permalink to &quot;小李的&quot;文件堆&quot;&quot;">​</a></h3><p>我的朋友小李是他们公司的核心设计元老。自公司成立以来，所有的产品设计都出自小李之手，而所有的产品参数也都是他在精心记录。但是，小李有一个小小的“坏习惯”——他并不是一个擅长文件整理的人。</p><p>在小李的电脑里，无数的文件直接存放在 C 盘或者微信的缓存路径中，犹如一座座未开发的“矿山”。每当公司需要回顾某个产品的设计原稿或者查找某个产品的参数时，小李就需要花费大量的时间去手动翻找这些文件。这不仅浪费了他宝贵的时间，也给他的工作带来了不少麻烦。这时就需要能够按照文件名和文件关键词的工具</p><p>按照文件名查找，轻松定位目标文件</p><p>在浩如烟海的文件中，有时我们只需要根据文件名就能快速定位到目标文件。Windows 自带的这个功能有两大问题：一是无法全局搜索，二是搜索速度极慢。</p><p>当你知道文件名或文件名模式时，Python 的 glob 模块就能大显身手。通过简单的几行代码，你就能按照文件名模式查找文件，Python 的 glob 模块就能派上大用场。通过简单的几行代码，你就能按照文件名模式查找文件，无论是全局文件还是当前目录还是子目录中的文件，只需要你输入你想要查找的硬盘范围和文件名格式，都能轻松找到。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> glob</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> find_files_by_name</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">pattern</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;.&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    按照文件名查找文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">    :param pattern: 文件名模式，例如 &quot;*vft*.pdf,文件名包含vft的pdf文件&quot;</span></span>
<span class="line"><span style="color:#98C379;">    :param path: 查找的目录路径，默认为当前目录</span></span>
<span class="line"><span style="color:#98C379;">    :return: 匹配到的文件列表</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> glob.</span><span style="color:#61AFEF;">glob</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">/**/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">pattern</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">recursive</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用示例</span></span>
<span class="line"><span style="color:#ABB2BF;">file_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> find_files_by_name</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;*vft*.pdf&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;E:</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">code</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">pdf2word</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> file_path </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> file_list:</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(file_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="`+as+`" alt="image-20240514153728881"></p><h3 id="按照文件内容查找文件" tabindex="-1">按照文件内容查找文件 <a class="header-anchor" href="#按照文件内容查找文件" aria-label="Permalink to &quot;按照文件内容查找文件&quot;">​</a></h3><p>但是，有时我们可能只知道文件内容中的某个关键词或特定格式，这时就需要按照文件内容来查找文件了。Python 的 os 和 re 模块将助你一臂之力。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">st </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 假设小李要查找包含&quot;import&quot;关键词的文件</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> search_content</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">key_word</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;font-style:italic;">root_dir</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    pattern </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">compile</span><span style="color:#ABB2BF;">(key_word)</span></span>
<span class="line"><span style="color:#ABB2BF;">    matching_files </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> root, dirs, files </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">walk</span><span style="color:#ABB2BF;">(root_dir):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> files:</span></span>
<span class="line"><span style="color:#ABB2BF;">            file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(root, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> file_path.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;.psd&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.ai&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.csv&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;.xlsx&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;.docx&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;.py&quot;</span><span style="color:#ABB2BF;">)):  </span><span style="color:#7F848E;font-style:italic;"># 假设小李的文件主要是这些类型</span></span>
<span class="line"><span style="color:#C678DD;">                with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">errors</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;ignore&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> f.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> pattern.</span><span style="color:#61AFEF;">search</span><span style="color:#ABB2BF;">(content):</span></span>
<span class="line"><span style="color:#ABB2BF;">                        matching_files.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> matching_files</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 输出匹配到的文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">file_paths </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> search_content</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;import&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;E:</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> file_path </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> file_paths:</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">et </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">u_t </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> et </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> st</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;一共查找到了</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(file_paths)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">个文件&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;用时</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">u_t</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">s&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>仅需 6s 就能从 370G 的硬盘中，查找到了 29000 多个匹配的文件，效率惊人</p><h3 id="一键查找文件-让你的电脑井井有条" tabindex="-1">一键查找文件，让你的电脑井井有条 <a class="header-anchor" href="#一键查找文件-让你的电脑井井有条" aria-label="Permalink to &quot;一键查找文件，让你的电脑井井有条&quot;">​</a></h3><p>通过将以上代码打包成 exe 文件【方法可以参照另一篇文章《<a href="http://mp.weixin.qq.com/s?__biz=Mzk0ODYxNzY5Nw==&amp;mid=2247484780&amp;idx=1&amp;sn=70c47650d878c801dc634e27400af975&amp;chksm=c365ade2f41224f4e49514b6f9edafa23478ed7367315861501b3a1821db5451174c78626373&amp;scene=21#wechat_redirect" target="_blank" rel="noreferrer">人人都能享受办公自动化的便利——三步将 Python 程序转为软件</a>》】，小李终于能够轻松实现一键查找文件的功能了。他的工作效率大大提高，再也不用为了找一个文件而烦恼了。更重要的是，他的电脑也变得更加井井有条了！</p><h2 id="pdf-转-word" tabindex="-1">pdf 转 word <a class="header-anchor" href="#pdf-转-word" aria-label="Permalink to &quot;pdf 转 word&quot;">​</a></h2><p>最近，我手上有个 PDF 资料需要转换为 Word 格式，这种转换功能在众多文档处理工具中已经相当普遍。</p><p>然而，出于好奇，我决定探索一下某宝平台，看看是否有人针对这一常见需求提供专门的商品服务。</p><p>搜索了一下关键词 <strong>“pdf 转 word”</strong> ，瞬间惊呆了，这种小功能竟然需求量这么大，都是几万人付款：</p><p><img src="`+ls+'" alt="图片"></p><p>看完后，我想着这个用代码来实现是很简单的。</p><p>然后就找了一个 python 开源库 <strong>pdf2docx</strong> 来试试。</p><p>**官方地址：**<a href="https://pdf2docx.readthedocs.io/en/latest/" target="_blank" rel="noreferrer">https://pdf2docx.readthedocs.io/en/latest/</a></p><p>**开源地址：**<a href="https://github.com/ArtifexSoftware/pdf2docx" target="_blank" rel="noreferrer">https://github.com/ArtifexSoftware/pdf2docx</a></p><p>**项目介绍：**Python 开源库 pdf2docx 是一个功能强大的工具，它专门用于将 PDF 文件转换为 DOCX 格式的文档，pdf2docx 利用了 PyMuPDF 和 python-docx 两个库，通过规则解析 PDF 文件的布局，并生成 Microsoft Word 兼容的 DOCX 文件。</p><p><img src="'+ps+`" alt="图片"></p><p><strong>安装</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pip</span><span style="color:#98C379;"> install</span><span style="color:#98C379;"> pdf2docx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装完成后，我就拿了一个简单的 PDF 文件来测试，测试代码如下：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> pdf2docx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Converter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">pdf_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./sample.pdf&#39;</span><span style="color:#7F848E;font-style:italic;">   # pdf 文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">docx_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./sample.docx&#39;</span><span style="color:#7F848E;font-style:italic;"> # docx 文件路径</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">cv </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Converter</span><span style="color:#ABB2BF;">(pdf_file)   </span><span style="color:#7F848E;font-style:italic;">#  pdf 转为 docx</span></span>
<span class="line"><span style="color:#ABB2BF;">cv.</span><span style="color:#61AFEF;">convert</span><span style="color:#ABB2BF;">(docx_file)      </span><span style="color:#7F848E;font-style:italic;"># 默认转换所有页面</span></span>
<span class="line"><span style="color:#ABB2BF;">cv.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后，我找了个 PDF 文件 <strong>sample.pdf</strong>，执行以上代码，转化效果非常完美，如下图所示：</p><p><img src="`+os+`" alt="图片"></p><p>感觉我可以直接用这 6 行代码去开店赚钱了，哈哈哈 😂 ～～～</p><p>这个需求还可以实现自动化：用户在聊天窗口提出要转换的需求，我用聊天系统自动回复一个链接给他，用户打开链接，提交 PDF 文件，就自动转换成 docx 返回给他（也可以在转换成功后，弹出付费下载按钮），这样就很完美，不用每次转换完后还要回复客户，躺着睡觉也可以在赚钱。</p><p>其实这种小需求某宝上还有很多，只是平时我们没有特别去关注，自己以为很简单的功能，对不懂的人来说都是一个巨大的困难，而我们要做的就是给别人解决问题，提供帮助，顺便获取点收益。</p><p>想想有时候我们开发人员也要有产品思维，因为即使是看似简单的技术，只要能够满足特定用户群体的需求，都有可能转化为一个有利可图的商业机会。</p><p>这个案例也为我提供了一个新的视角，要多去发现和挖掘日常生活中可能被忽视的商机。</p><p>还有很多有意思的小信息差项目，其实技术实现都不难，主要还是信息差的问题。</p><p>比如最近比较热门的公众号运营赚钱、视频号视频内容下载等，均是不错的小而美的项目哦！</p><h2 id="轻松合并批量-word-文档并统一格式" tabindex="-1">轻松合并批量 Word 文档并统一格式 <a class="header-anchor" href="#轻松合并批量-word-文档并统一格式" aria-label="Permalink to &quot;轻松合并批量 Word 文档并统一格式&quot;">​</a></h2><p>在企业运营中，各个部门常常需要提交定期报告，如周报或月报。为了全面掌握各部门的工作情况，管理层通常希望将这些报告合并成一个单独的文档进行汇总和审阅，并保持一个统一的格式。然而，手动合并这些文档既耗时又容易出错。幸运的是，我们可以利用 Python 自动化合并 Word 文档，大幅提升效率和准确性。</p><h3 id="数据分析-2" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析-2" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li><p><strong>输入</strong>：多个 Word 文档（每个部门的周报或月报）。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>使用<code>python-docx</code>库读取每个文档的内容。</li><li>将所有文档内容按顺序合并到一个新的 Word 文档中，并统一文档格式。</li></ul></li><li><p><strong>输出</strong>：一个包含所有报告的合并文档。</p></li></ul><h3 id="实例数据" tabindex="-1">实例数据 <a class="header-anchor" href="#实例数据" aria-label="Permalink to &quot;实例数据&quot;">​</a></h3><p>假设我们有三个部门的月度报告，文件名如下：</p><ul><li>Marketing_Report.docx</li><li>Sales_Report.docx</li><li>HR_Report.docx</li></ul><h3 id="实战代码-3" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-3" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Document</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx.shared </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Pt</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx.enum.text </span><span style="color:#C678DD;">import</span><span style="color:#D19A66;"> WD_ALIGN_PARAGRAPH</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> merge_documents_with_uniform_format</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">files</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">font_name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;Calibri&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">font_size</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">line_spacing</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">1.15</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    merged_document </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Document</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 设置统一的样式</span></span>
<span class="line"><span style="color:#ABB2BF;">    style </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> merged_document.styles[</span><span style="color:#98C379;">&#39;Normal&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    font </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> style.font</span></span>
<span class="line"><span style="color:#ABB2BF;">    font.name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> font_name</span></span>
<span class="line"><span style="color:#ABB2BF;">    font.size </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Pt</span><span style="color:#ABB2BF;">(font_size)</span></span>
<span class="line"><span style="color:#ABB2BF;">    paragraph_format </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> style.paragraph_format</span></span>
<span class="line"><span style="color:#ABB2BF;">    paragraph_format.line_spacing </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line_spacing</span></span>
<span class="line"><span style="color:#ABB2BF;">    paragraph_format.alignment </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> WD_ALIGN_PARAGRAPH</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">JUSTIFY</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历并合并所有文档</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> files:</span></span>
<span class="line"><span style="color:#ABB2BF;">        sub_doc </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Document</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 复制子文档中的每个元素到合并文档中</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> element </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sub_doc.element.body:</span></span>
<span class="line"><span style="color:#ABB2BF;">            merged_document.element.body.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(element)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存合并后的文档</span></span>
<span class="line"><span style="color:#ABB2BF;">    merged_document.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(output_file)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 文档列表</span></span>
<span class="line"><span style="color:#ABB2BF;">files </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;Marketing_Report.docx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Sales_Report.docx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;HR_Report.docx&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">output_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;Merged_Monthly_Report_With_Uniform_Format.docx&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数合并文档并设置统一格式</span></span>
<span class="line"><span style="color:#61AFEF;">merge_documents_with_uniform_format</span><span style="color:#ABB2BF;">(files, output_file)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><img src="`+es+`" alt="image-20240511165332063"></p><h3 id="总结-4" tabindex="-1">总结 <a class="header-anchor" href="#总结-4" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>这段代码演示了如何使用 python-docx 库自动化合并多个 Word 文档。通过逐个读取并合并各个部门的报告内容，我们成功创建了一个统一的月度汇总报告。这种自动化合并不仅保证了报告的一致性和准确性，还显著节省了手动处理的时间和精力。自动化合并文档的方法非常适合需要定期整理大量文档的企业和机构，能够大幅提升他们的工作效率。</p><h2 id="自动化提取-word-文档信息-助力商业文档数据解析" tabindex="-1">自动化提取 Word 文档信息：助力商业文档数据解析 <a class="header-anchor" href="#自动化提取-word-文档信息-助力商业文档数据解析" aria-label="Permalink to &quot;自动化提取 Word 文档信息：助力商业文档数据解析&quot;">​</a></h2><p>在繁忙的商业环境中，文档处理是一项繁重且至关重要的任务。合同、报告和其他业务文档往往包含大量关键信息，如日期、金额和合同方名称等。手动提取这些信息不仅耗时费力，而且容易出错。幸运的是，借助 Python 的自动化能力，我们可以高效地提取这些关键数据，显著提升工作效率和准确性。</p><h3 id="场景描述" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述" aria-label="Permalink to &quot;场景描述&quot;">​</a></h3><p>在商业世界中，快速准确地从合同、报告等文档中提取特定信息是一项常见需求。这些信息对于决策制定、数据分析和报告编写至关重要。然而，手动处理这些文档不仅效率低下，而且容易出错。为了解决这个问题，我们可以利用 Python 编写自动化脚本来提取这些信息。</p><h3 id="数据分析-3" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析-3" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li><p><strong>输入</strong>：包含关键业务数据的 Word 文档。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>使用<code>python-docx</code>库读取 Word 文档。</li><li>利用正则表达式搜索并提取所需信息。</li><li>将提取的信息存储或输出。</li></ul></li><li><p><strong>输出</strong>：提取的关键信息，例如以列表或字典形式。</p></li></ul><h3 id="实战代码-4" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-4" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> docx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Document</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> extract_info</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">doc_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    doc </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Document</span><span style="color:#ABB2BF;">(doc_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">    extracted_info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 定义正则表达式以匹配日期和金额</span></span>
<span class="line"><span style="color:#ABB2BF;">    date_pattern </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">compile</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;\\d</span><span style="color:#D19A66;">{4}</span><span style="color:#E06C75;">年\\d</span><span style="color:#D19A66;">{1,2}</span><span style="color:#E06C75;">月\\d</span><span style="color:#D19A66;">{1,2}</span><span style="color:#E06C75;">日&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    amount_pattern </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">compile</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;</span><span style="color:#56B6C2;">\\$</span><span style="color:#E06C75;">\\d</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">,</span><span style="color:#D19A66;">*</span><span style="color:#E06C75;">\\d</span><span style="color:#D19A66;">*</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历文档的每个段落，提取信息</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> para </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> doc.paragraphs:</span></span>
<span class="line"><span style="color:#ABB2BF;">        date_matches </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> date_pattern.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(para.text)</span></span>
<span class="line"><span style="color:#ABB2BF;">        amount_matches </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> amount_pattern.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(para.text)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> date_matches </span><span style="color:#C678DD;">or</span><span style="color:#ABB2BF;"> amount_matches:</span></span>
<span class="line"><span style="color:#ABB2BF;">            extracted_info.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#98C379;">                &#39;date&#39;</span><span style="color:#ABB2BF;">: date_matches[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> date_matches </span><span style="color:#C678DD;">else</span><span style="color:#98C379;"> &#39;N/A&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">                &#39;amount&#39;</span><span style="color:#ABB2BF;">: amount_matches[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> amount_matches </span><span style="color:#C678DD;">else</span><span style="color:#98C379;"> &#39;N/A&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> extracted_info</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">doc_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;Contract.docx&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数并打印结果</span></span>
<span class="line"><span style="color:#ABB2BF;">info </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> extract_info</span><span style="color:#ABB2BF;">(doc_path)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(info)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="总结-5" tabindex="-1">总结 <a class="header-anchor" href="#总结-5" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>通过使用 python-docx 库和正则表达式，我们成功地从 Word 文档中自动化提取了日期和金额信息。这种自动化方法不仅节省了大量的人力和时间，而且减少了人为错误，提高了数据处理的可靠性。对于需要处理大量相似文档的法律、金融和行政部门来说，这种技术特别有用。</p><h2 id="秒级汇总批量excel数据" tabindex="-1">秒级汇总批量Excel数据 <a class="header-anchor" href="#秒级汇总批量excel数据" aria-label="Permalink to &quot;秒级汇总批量Excel数据&quot;">​</a></h2><p>这个脚本能够自动读取指定文件夹下的所有Excel文件，提取其中的数据，并按照预设的规则进行整理。当朋友第一次看到这个脚本的运行结果时，他简直不敢相信自己的眼睛。以前需要一周时间才能完成的任务，现在只需要几秒钟就完成了！而且，由于脚本的自动化处理，数据的准确性也得到了极大的提高。</p><p>各个分公司汇总上来的表格</p><p><img src="`+rs+'" alt="image-20240526152206096"></p><p>每个表格中的大体内容</p><p><img src="'+cs+`" alt="image-20240526152222785"></p><p><strong>将所有表格内容汇总到一个表格的代码</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> traverse_excel_files</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">folder_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    df_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历文件夹下的所有文件和子文件夹</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> root, dirs, files </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">walk</span><span style="color:#ABB2BF;">(folder_path):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> files:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 根据文件扩展名判断是否为 Excel 文件</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xls&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xlsx&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(root, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 在这里可以对 Excel 文件进行进一步的操作，例如打印文件路径等</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">                df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">                df_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(df)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> df_list</span></span>
<span class="line"><span style="color:#ABB2BF;">folder_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./Excel&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">df_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> traverse_excel_files</span><span style="color:#ABB2BF;">(folder_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">merged_df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(df_list, </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">merged_df.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;merged.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>所有的excel内容都到一个表里了【案例中每个表格的内容都是一样的】</p><p><img src="`+ts+`" alt="image-20240526152255927"></p><p><strong>将所有Excel表的内容合并到一个Excel文件里，每个表单独成一个Sheet</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> traverse_excel_files</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">folder_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # # 创建一个空的 Excel 文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">ExcelWriter</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;mergeEx.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历文件夹下的所有文件和子文件夹</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> root, dirs, files </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">walk</span><span style="color:#ABB2BF;">(folder_path):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> files:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 根据文件扩展名判断是否为 Excel 文件</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xls&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">or</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xlsx&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">                file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(root, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                sheetname </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">9</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                # 在这里可以对 Excel 文件进行进一步的操作，例如打印文件路径等</span></span>
<span class="line"><span style="color:#56B6C2;">                print</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">                df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">                df.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(writer, </span><span style="color:#E06C75;font-style:italic;">sheet_name</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">sheetname,</span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    writer.</span><span style="color:#61AFEF;">_save</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">folder_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;./Excel&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">traverse_excel_files</span><span style="color:#ABB2BF;">(folder_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><img src="`+Bs+'" alt="image-20240526152335719"></p><h2 id="批量处理300多个表格" tabindex="-1">批量处理300多个表格 <a class="header-anchor" href="#批量处理300多个表格" aria-label="Permalink to &quot;批量处理300多个表格&quot;">​</a></h2><h3 id="一、背景故事-erp上线-数据规范化成拦路虎" tabindex="-1">一、背景故事：ERP上线，数据规范化成拦路虎 <a class="header-anchor" href="#一、背景故事-erp上线-数据规范化成拦路虎" aria-label="Permalink to &quot;一、背景故事：ERP上线，数据规范化成拦路虎&quot;">​</a></h3><p>随着企业数字化转型的加速，ERP（企业资源规划）系统成为了众多企业提升管理效率、降低成本的利器。然而，在ERP系统上线的过程中，历史数据的规范化却成为了一道难以逾越的坎。某传统企业就遭遇了这样的困境：他们需要上传的300多个表格中，数据规范性极差，无法满足ERP系统规范化的数据模板。</p><p><img src="'+ys+'" alt="image-20240526152410443"></p><p>10条数据清洗替换规则</p><p><img src="'+is+'" alt="image-20240526152429428"></p><p>待清理的300多个表格</p><p><img src="'+Fs+`" alt="image-20240526152446491"></p><h3 id="二、传统方法-耗时耗力-效率低下" tabindex="-1">二、传统方法：耗时耗力，效率低下 <a class="header-anchor" href="#二、传统方法-耗时耗力-效率低下" aria-label="Permalink to &quot;二、传统方法：耗时耗力，效率低下&quot;">​</a></h3><p>面对如此庞大的数据规范化需求，传统方法通常是打开表格，然后逐一查找内容，进行替换并保存。然而，这种方法不仅效率低下，而且容易出错。据估算，按照传统方法进行操作，一个表格的一项替换规则平均需要3分钟左右，那么对于300多个表格和10个替换规则来说，就需要惊人的9600分钟，约合160个小时！这无疑是一个巨大的时间成本。</p><h3 id="三、python自动化办公-两秒钟搞定规范化" tabindex="-1">三、Python自动化办公：两秒钟搞定规范化 <a class="header-anchor" href="#三、python自动化办公-两秒钟搞定规范化" aria-label="Permalink to &quot;三、Python自动化办公：两秒钟搞定规范化&quot;">​</a></h3><p>正当项目陷入困境之际，Python自动化办公技术如同救星般降临。通过编写Python脚本，企业可以轻松实现对原始数据的规范化清理。具体来说，只需要根据数据规范化的需求，编写相应的Python代码，然后运行脚本即可。整个过程只需两秒钟时间，极大地提高了工作效率。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook  </span><span style="color:#7F848E;font-style:italic;"># 用于读取Excel中的信息</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 获取Excel表格中的数据</span></span>
<span class="line"><span style="color:#ABB2BF;">s_t </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;查找替换.xlsx&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 读取工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active  </span><span style="color:#7F848E;font-style:italic;"># 读取活动工作表</span></span>
<span class="line"><span style="color:#ABB2BF;">data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}  </span><span style="color:#7F848E;font-style:italic;"># 新建字典，用于储存数据</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, ws.max_row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    chazhao </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(ws[</span><span style="color:#98C379;">&#39;A&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value)  </span><span style="color:#7F848E;font-style:italic;"># 转换成字符串，以免后续比对时出现数据类型冲突</span></span>
<span class="line"><span style="color:#ABB2BF;">    tihuan </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(ws[</span><span style="color:#98C379;">&#39;B&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value)  </span><span style="color:#7F848E;font-style:italic;"># 转换成字符串，以免后续比对时出现数据类型冲突</span></span>
<span class="line"><span style="color:#ABB2BF;">    data[chazhao] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tihuan  </span><span style="color:#7F848E;font-style:italic;"># 键值对应存入字典</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># print(data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;原表.xlsx&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 读取目标工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">sheet_names </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.</span><span style="color:#61AFEF;">get_sheet_names</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 获得工作簿的所有工作表名</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> sheet_name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sheet_names[:</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]:  </span><span style="color:#7F848E;font-style:italic;"># 遍历每个工作表，更改A4单元格的数据</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb[sheet_name]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(sheet_name)</span></span>
<span class="line"><span style="color:#D19A66;">    ID_list</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> []  </span><span style="color:#7F848E;font-style:italic;"># 新建一个列表，用于储存原表D列的信息</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, ws.max_row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#D19A66;">        ID</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#98C379;">&#39;D&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value  </span><span style="color:#7F848E;font-style:italic;"># 遍历整个工作表，将D列的数据逐个存入ID变量</span></span>
<span class="line"><span style="color:#D19A66;">        ID_list</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">ID</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 将读取到的结果存入列表</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(ID_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">    code </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#D19A66;"> ID_list</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> i </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 如果是None，则放入None占位，以保持列表的值的顺序与原表一致</span></span>
<span class="line"><span style="color:#ABB2BF;">            code.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 不是None,则按&quot;：&quot;符号分割，并放分割后的最后一个值进入新列表code</span></span>
<span class="line"><span style="color:#ABB2BF;">            code.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(i.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;：&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(code)</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(code)):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> code[i] </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data:</span></span>
<span class="line"><span style="color:#ABB2BF;">            ws.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                row</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">i</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> ID_list</span><span style="color:#ABB2BF;">[i].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;：&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;：&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#ABB2BF;"> data[code[i]]</span></span>
<span class="line"><span style="color:#ABB2BF;">wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;原表-替换.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">e_t </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;一共用时</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e_t</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">s_t</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">s&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="excel-数据自动化验证与清理-强化数据处理策略" tabindex="-1">Excel 数据自动化验证与清理，强化数据处理策略 <a class="header-anchor" href="#excel-数据自动化验证与清理-强化数据处理策略" aria-label="Permalink to &quot;Excel 数据自动化验证与清理，强化数据处理策略&quot;">​</a></h2><p>在数据处理流程中，Excel 数据的质量是确保后续分析准确性的基石。然而，格式错误、重复条目以及空字段等常见问题往往导致数据质量下降，进而影响分析结果的准确性。为了提升数据处理效率和准确性，我们采用 Python 的 openpyxl 库进行自动化验证与清理。</p><h3 id="场景描述-1" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述-1" aria-label="Permalink to &quot;场景描述&quot;">​</a></h3><p>在处理 Excel 数据时，数据验证和清理是确保数据质量的关键步骤。常见的数据问题包括格式错误、重复条目和空字段，这些问题如果不加以处理，将会对后续的数据分析造成严重的偏差。通过使用 openpyxl 库，我们可以自动检测和修正这些问题，或者在无法自动修正的情况下生成详细的错误报告，从而帮助数据分析师更好地维护数据的准确性和可靠性。</p><h3 id="数据分析-4" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析-4" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li><p><strong>输入</strong>：一个包含原始数据的 Excel 文件。</p></li><li><p><strong>处理</strong>：</p></li><li><ul><li>检查数值字段的格式是否正确，如日期和数字的格式。</li><li>检测并删除重复的条目。</li><li>标识并填充或标记空字段。</li></ul></li><li><p><strong>输出</strong>：被清理后的 Excel 文件以及一个错误报告（如果需要）。</p></li></ul><h3 id="示例数据-2" tabindex="-1">示例数据 <a class="header-anchor" href="#示例数据-2" aria-label="Permalink to &quot;示例数据&quot;">​</a></h3><p>假设我们有一个名为<code>data.xlsx</code>的 Excel 文件，其中包含以下列：</p><ul><li>日期（可能包含错误的格式）</li><li>销售额（应为数字，可能包含文本或空字段）</li><li>客户名（可能包含重复项或空字段）</li></ul><h3 id="实战代码-5" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-5" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> datetime </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> validate_and_clean</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 加载工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(file_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    rows </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> list</span><span style="color:#ABB2BF;">(ws.rows)</span></span>
<span class="line"><span style="color:#ABB2BF;">    header </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [cell.value </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> cell </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rows[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"><span style="color:#ABB2BF;">    errors </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    seen </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> set</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 用于检查重复</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 从第二行开始遍历（跳过表头）</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> idx, row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(rows[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:], </span><span style="color:#E06C75;font-style:italic;">start</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> col, cell </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(row, </span><span style="color:#E06C75;font-style:italic;">start</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cell.value</span></span>
<span class="line"><span style="color:#ABB2BF;">            column </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> header[col</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查空字段</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> value </span><span style="color:#C678DD;">is</span><span style="color:#D19A66;"> None</span><span style="color:#C678DD;"> or</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(value).</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                errors.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Row </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">idx</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">: &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">column</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39; is empty.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 数据格式验证和清理</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> column </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;日期&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    datetime.</span><span style="color:#61AFEF;">strptime</span><span style="color:#ABB2BF;">(value, </span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 尝试解析日期格式</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;"> ValueError:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    errors.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Row </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">idx</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">: &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">value</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39; is not a valid date in column &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">column</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            elif</span><span style="color:#ABB2BF;"> column </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;销售额&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">                    float</span><span style="color:#ABB2BF;">(value)  </span><span style="color:#7F848E;font-style:italic;"># 确保销售额是数字</span></span>
<span class="line"><span style="color:#C678DD;">                except</span><span style="color:#ABB2BF;"> ValueError:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    errors.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Row </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">idx</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">: &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">value</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39; is not a number in column &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">column</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 检查重复</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> column </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;客户名&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> value </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> seen:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    errors.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Row </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">idx</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">: Duplicate entry &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">value</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39; found in column &#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">column</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                seen.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(value)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 输出错误报告</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> errors:</span></span>
<span class="line"><span style="color:#C678DD;">        with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;error_report.txt&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;w&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> error </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> errors:</span></span>
<span class="line"><span style="color:#ABB2BF;">                f.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(error </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;No errors found. Data is clean.&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 保存清理后的数据</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;cleaned_data.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数</span></span>
<span class="line"><span style="color:#61AFEF;">validate_and_clean</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="总结-6" tabindex="-1">总结 <a class="header-anchor" href="#总结-6" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>通过上述 Python 脚本，我们利用 openpyxl 库实现了 Excel 数据的自动化验证与清理。该方法能够自动检测并修正格式错误、删除重复条目以及处理空字段，提高了数据处理的效率和准确性。同时，对于无法自动修正的问题，脚本还会生成详细的错误报告，帮助数据分析师快速定位并处理数据中的问题。这种自动化处理方式大大减少了手动审查数据的工作量，为数据分析师提供了更加高效和可靠的数据处理工具。</p><h2 id="批量提取-excel-数据-数据秒级汇总" tabindex="-1">批量提取 Excel 数据，数据秒级汇总 <a class="header-anchor" href="#批量提取-excel-数据-数据秒级汇总" aria-label="Permalink to &quot;批量提取 Excel 数据，数据秒级汇总&quot;">​</a></h2><p>在数字化时代，Excel 作为数据处理的利器，广泛应用于各个领域。然而，当面对大量需要提取和整合的 Excel 数据时，传统的手动操作方式显得繁琐且效率低下。这时，Python 自动化办公的神奇魅力便凸显出来。通过 Python 的自动化处理，我们能够实现批量提取 Excel 数据，并在短时间内完成数据的汇总和分析。本文将带您领略 Python 自动化办公的新高度，让您惊艳于数据秒级汇总的高效与便捷。</p><h3 id="场景描述-2" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述-2" aria-label="Permalink to &quot;场景描述&quot;">​</a></h3><p>在商业研究和数据分析的实际应用中，批量提取 Excel 数据是一个常见的任务。例如，当一家企业需要对全国范围内的分支机构提交的年度财务报告进行集中分析时，通常需要批量提取关键财务指标，如营业收入和净利润，以便进行综合分析和比较。</p><h3 id="自动化处理" tabindex="-1">自动化处理 <a class="header-anchor" href="#自动化处理" aria-label="Permalink to &quot;自动化处理&quot;">​</a></h3><p>在 Python 的协助下，这种批量提取工作可以变得自动化且高效。Python 的 pandas 库能够轻松处理 Excel 数据，使得批量提取特定列的数据变得简单快捷。</p><h3 id="处理流程-1" tabindex="-1">处理流程 <a class="header-anchor" href="#处理流程-1" aria-label="Permalink to &quot;处理流程&quot;">​</a></h3><p><strong>输入</strong>：多个具有相似数据结构的 Excel 工作簿。</p><p><strong>处理</strong>：</p><ol><li><ul><li>使用 Python 脚本遍历指定文件夹中的所有 Excel 文件。</li><li>从每个文件中提取特定的数据列。</li><li>将提取的数据整合到一个新的 pandas DataFrame 中。</li></ul></li><li><p><strong>输出</strong>：一个包含所有提取数据的新的 Excel 工作簿。</p></li></ol><h3 id="示例数据-3" tabindex="-1">示例数据 <a class="header-anchor" href="#示例数据-3" aria-label="Permalink to &quot;示例数据&quot;">​</a></h3><p>假设我们需要从各个分支机构的年度报告中提取“营业收入”和“净利润”数据。文件名可能如下：</p><ul><li>山东分公司财务报名.xlsx</li><li>上海分公司财务报名.xlsx</li><li>东北分公司财务报名.xlsx</li><li>广东分公司财务报名.xlsx</li><li>...</li></ul><p>每个文件包含以下列：</p><ul><li>日期</li><li>营业收入</li><li>净利润</li><li>其他费用</li><li>...</li></ul><h3 id="实战代码-6" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-6" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> batch_extract_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">columns</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_filename</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历指定文件夹中的所有Excel文件</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(directory):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xlsx&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">columns)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 添加文件来源信息，以便知道数据来自哪个分支机构</span></span>
<span class="line"><span style="color:#ABB2BF;">            df[</span><span style="color:#98C379;">&#39;Source&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 将数据添加到总数据列表中</span></span>
<span class="line"><span style="color:#ABB2BF;">            all_data.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(df)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 将列表中的DataFrame合并成一个</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data_frame </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(all_data, </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 将汇总的数据输出到新的Excel文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data_frame.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(output_filename, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数</span></span>
<span class="line"><span style="color:#61AFEF;">batch_extract_data</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;日期&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;营业收入&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;净利润&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;path_to_financial_reports&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Consolidated_Financials.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="总结-7" tabindex="-1">总结 <a class="header-anchor" href="#总结-7" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>此脚本充分利用了 Python 和 pandas 库的优势，实现了批量提取 Excel 数据的功能。通过自动化处理，不仅提高了数据处理效率，还保证了数据的准确性和可追溯性，为后续的数据分析和决策提供了可靠的基础。在大数据和自动化的时代，利用 Python 进行此类任务可以极大地简化工作流程，提高工作效率。</p><h2 id="自动化打开、修改、保存excel表格" tabindex="-1">自动化打开、修改、保存Excel表格&#39; <a class="header-anchor" href="#自动化打开、修改、保存excel表格" aria-label="Permalink to &quot;自动化打开、修改、保存Excel表格&#39;&quot;">​</a></h2><p>想象一下，你在办公桌前忙碌地打开、修改、保存着一个个Excel表格，这些表格堆积如山，仿佛永远也做不完。每当你以为终于完成了一个，却发现还有更多的表格在等待着你。这种场景是否让你感到窒息和绝望？</p><p>但利用Python自动化办公，仅需7行代码，在短短9秒钟内就完成了原本需要1390分钟的重复性劳动。</p><h3 id="故事背景" tabindex="-1">故事背景 <a class="header-anchor" href="#故事背景" aria-label="Permalink to &quot;故事背景&quot;">​</a></h3><p>在某家大型企业中，一位负责管理的朋友，每天都需要记录入库出库情况。去年，他辛勤地制作了278个Excel表格，每个表格对应一天的出入库情况。然而，由于疏忽，这些表格的标题一直未能按照公司新上线的ERP系统的识别规则进行修改。</p><p><img src="`+As+'" alt="图片"></p><p><img src="'+bs+`" alt="图片"></p><h3 id="挑战与困境" tabindex="-1">挑战与困境 <a class="header-anchor" href="#挑战与困境" aria-label="Permalink to &quot;挑战与困境&quot;">​</a></h3><p>随着ERP系统的全面上线，这位同事面临了一个巨大的挑战：如何将这278个历史表格中的标题信息【计划外出\\入库及仓库调整单】按照ERP识别系统的规则修改成【零件测试领料单】，要知道，传统的操作方法——打开表格、修改内容、保存表格——不仅费时费力，而且容易出错。</p><p>他试了一天，采用传统方法完成一个表格的内容更新需要大约5分钟。那么，对于278个表格来说，这将是一个耗时1390分钟的庞大工程！更糟糕的是，频繁打开和关闭表格还可能增加出错的风险。</p><h3 id="python自动化登场" tabindex="-1">Python自动化登场 <a class="header-anchor" href="#python自动化登场" aria-label="Permalink to &quot;Python自动化登场&quot;">​</a></h3><p>在这位同事即将陷入绝望之际，我用Python自动化帮他解决困境！仅需编写7行代码，就可以在短短9秒钟内完成原本需要1390分钟的重复性劳动。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook</span></span>
<span class="line"><span style="color:#ABB2BF;">wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data\\领料单（每日）.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">sheet_names</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">wb.</span><span style="color:#61AFEF;">get_sheet_names</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">#获得工作簿的所有工作表名</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> sheet_name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sheet_names: </span><span style="color:#7F848E;font-style:italic;">#遍历每个工作表，更改A4单元格的数据</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">wb[sheet_name]</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws[</span><span style="color:#98C379;">&#39;A4&#39;</span><span style="color:#ABB2BF;">].value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;零件测试领料单&quot;</span><span style="color:#7F848E;font-style:italic;"> #直接将A4单元格的值改为需要的</span></span>
<span class="line"><span style="color:#ABB2BF;">wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data\\领料单（每日）-更改后.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="`+us+'" alt="图片"></p><p>当朋友运行完脚本后，他惊讶地发现：原本需要数小时才能完成的任务，现在竟然在几秒钟内就完成了！而且，由于整个过程完全由计算机自动完成，出错的可能性大大降低。</p><h3 id="结语-3" tabindex="-1"><strong>结语</strong> <a class="header-anchor" href="#结语-3" aria-label="Permalink to &quot;**结语**&quot;">​</a></h3><p>这个故事告诉我们：在数字化时代，掌握一门编程语言并掌握自动化技能对于提高工作效率具有重要意义。Python作为一种简单易学、功能强大的编程语言，在自动化办公领域具有广泛的应用前景。</p><h2 id="实现抖音视频批量下载" tabindex="-1">实现抖音视频批量下载 <a class="header-anchor" href="#实现抖音视频批量下载" aria-label="Permalink to &quot;实现抖音视频批量下载&quot;">​</a></h2><p>在数字化时代，短视频已成为品牌宣传的重要渠道之一。某品牌公司在抖音平台上拥有两个账号，并发布了大量短视频内容，这些视频在推广品牌形象和产品方面发挥了重要作用。随着公司战略调整，他们计划在其他短视频平台继续扩大品牌影响力，决定将之前抖音上发布过的视频迁移到新的平台上。但因电脑故障，这些视频文件全部丢失。无法直接在其他平台上重新发布，面对这一困境，公司团队陷入了沉思。抖音平台本身并不提供视频下载功能，难道要手动一条一条地去复制视频链接，然后再通过第三方工具或网站进行下载吗？这样不仅效率低下，而且容易出错。</p><p>正当团队一筹莫展之际，我用爬虫技术轻松破局，而且学会一个小技巧，只需要自己编写几行代码就能轻松实现抖音视频的批量下载，对于从事视频搬用与二次创作的朋友们而言，这无疑是最大的福音！</p><p>通过复制访问网站的 cURL 并在线转换。curl 是一个常用的命令行工具，用于发送 HTTP 请求。在浏览器中打开抖音页面，我们可以通过开发者工具（通常按 F12 打开）找到请求视频信息的 cURL 命令。复制这个 CURL 命令后，我们可以将其粘贴到网址：<a href="https://curlconverter.com/%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%B0%86curl%E5%91%BD%E4%BB%A4%E8%BD%AC%E6%8D%A2%E6%88%90%E5%90%84%E7%A7%8D%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%9A%84HTTP%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%8C%85%E6%8B%ACPython%E7%9A%84requests%E5%BA%93%E4%BB%A3%E7%A0%81%E3%80%82" target="_blank" rel="noreferrer">https://curlconverter.com/，这个网站会自动将curl命令转换成各种编程语言的HTTP请求代码，包括Python的requests库代码。</a></p><p>利用这个技巧，我们可以分秒间得到爬虫所需要的各类访问参数，如请求头（headers）、请求方法（GET 或 POST）、查询参数（query parameters）等，从而快速构建出能够模拟浏览器行为的 Python 爬虫脚本。</p><p><img src="'+ms+'" alt="image-20240511165849202"></p><p><img src="'+Cs+`" alt="image-20240511165902883"></p><p>这个技巧已经帮我们完成了网站访问和网站响应的全部工作，只需要再对结果进行解析就完成了爬虫工作</p><p>网站代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> threading</span></span>
<span class="line"><span style="color:#ABB2BF;">headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">&#39;accept&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/json, text/plain, */*&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;accept-language&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;cookie&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;bd_ticket_guard_client_web_domain=2; _bd_ticket_crypt_doamin=2; __security_server_data_status=1; store-region=cn-sd; store-region-src=uid; d_ticket=110b1253f4bafca1e36ad981a84f1a3a15332; my_rd=2; passport_csrf_token=b2cf60354334595a7f39915640e9f4f4; passport_csrf_token_default=b2cf60354334595a7f39915640e9f4f4; xgplayer_device_id=69499535982; xgplayer_user_id=172535869193; MONITOR_WEB_ID=aa78c3e9-d188-496b-ad3e-a7f8907c99cf; ttwid=1%7CTWWWFMKfVOzVscCQVGKFtzLExlzpvIf7IG8JiEC1C9k%7C1711760081%7C04ac83727b6862d22b92023fdc2fa1b249ae419f2a12f359851429c1a9770820; SEARCH_RESULT_LIST_TYPE=</span><span style="color:#D19A66;">%22s</span><span style="color:#98C379;">ingle%22; volume_info=%7B</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">sUserMute</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3Afalse%2C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">sMute</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3Atrue%2C%22volume</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A0.265%7D; publish_badge_show_info=</span><span style="color:#D19A66;">%221%</span><span style="color:#98C379;">2C0%2C0%2C1714205266266%22; FORCE_LOGIN=%7B%22videoConsumedRemainSeconds</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A180%2C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">sForcePopClose</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A1%7D; n_mh=t31eWtoAuFgYdM06vjqH0Ui2OcSTTQuhwpGv8WzTXkU; passport_auth_status=f66b4e4a43c3cc0b5832c4bd4297cfd9%2C; passport_auth_status_ss=f66b4e4a43c3cc0b5832c4bd4297cfd9%2C; _bd_ticket_crypt_cookie=09b55f12ffe1a546cbdc829126c849d2; download_guide=</span><span style="color:#D19A66;">%223%</span><span style="color:#98C379;">2F20240427</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">0%22; pwa2=</span><span style="color:#D19A66;">%220%</span><span style="color:#98C379;">7C0%7C3%7C1%22; FOLLOW_LIVE_POINT_INFO=%22MS4wLjABAAAAwlWHPatdZHVmBwSfQZ2Rpx0CQBWo6gU4A-BCugurXoopcvyuhP9QQMThc4T4QPe3</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">1714233600000</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">0</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">0</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">1714227835012%22; FOLLOW_NUMBER_YELLOW_POINT_INFO=%22MS4wLjABAAAAwlWHPatdZHVmBwSfQZ2Rpx0CQBWo6gU4A-BCugurXoopcvyuhP9QQMThc4T4QPe3</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">1714233600000</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">0</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">1714227235013</span><span style="color:#D19A66;">%2F</span><span style="color:#98C379;">0%22; LOGIN_STATUS=0; dy_swidth=1920; dy_sheight=1080; odin_tt=524137479da105e2b529ad2a0cd38f489b9c8eb666d8ba48f6f0a294add99ef06652039b01a973bdcca617059b9de593ca6270de7aeaaadcfe01c64f78ca6c4608b630dc68a096e390c33bb4ee5557c9; douyin.com; device_web_cpu_core=20; device_web_memory_size=8; architecture=amd64; csrf_session_id=6b1694c9b1c243d95d40626d07ac688f; strategyABtestKey=</span><span style="color:#D19A66;">%221714268100.552%</span><span style="color:#98C379;">22; xg_device_score=7.588453342179008; stream_player_status_params=</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">7B%5C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">s_auto_play%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A0%2C%5C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">s_full_screen%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A0%2C%5C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">s_full_webscreen%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A0%2C%5C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">s_mute%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A1%2C%5C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">s_speed%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A1%2C%5C</span><span style="color:#D19A66;">%22i</span><span style="color:#98C379;">s_visible%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A0%7D%22; __ac_nonce=0662dc22100b53cfdebbe; __ac_signature=_02B4Z6wo00f01w5qLvQAAIDAM8M0a8oplE8OSipAAKXBpZHno8qZal065pT-0WD29v3aqTcjPfM92SpDzuXIxzTF-lLHxNtachWKr9IEptj73IUNDtWwastI72Tp2vGyMRny2MpCGguZNFpC17; stream_recommend_feed_params=</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">7B%5C</span><span style="color:#D19A66;">%22c</span><span style="color:#98C379;">ookie_enabled%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3Atrue%2C%5C</span><span style="color:#D19A66;">%22s</span><span style="color:#98C379;">creen_width%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A1920%2C%5C</span><span style="color:#D19A66;">%22s</span><span style="color:#98C379;">creen_height%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A1080%2C%5C</span><span style="color:#D19A66;">%22b</span><span style="color:#98C379;">rowser_online%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3Atrue%2C%5C</span><span style="color:#D19A66;">%22c</span><span style="color:#98C379;">pu_core_num%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A20%2C%5C</span><span style="color:#D19A66;">%22d</span><span style="color:#98C379;">evice_memory%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A8%2C%5C</span><span style="color:#D19A66;">%22d</span><span style="color:#98C379;">ownlink%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A10%2C%5C</span><span style="color:#D19A66;">%22e</span><span style="color:#98C379;">ffective_type%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A%5C</span><span style="color:#D19A66;">%224g</span><span style="color:#98C379;">%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">2C%5C</span><span style="color:#D19A66;">%22r</span><span style="color:#98C379;">ound_trip_time%5C</span><span style="color:#D19A66;">%22%</span><span style="color:#98C379;">3A50%7D%22; IsDouyinActive=true; home_can_add_dy_2_desktop=</span><span style="color:#D19A66;">%221%</span><span style="color:#98C379;">22; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCRkVYRStQcXdnLzdPZEZCMWdRUTQ1L3p1VnZFdTBTbWJ0eXN3UWttRGdhem1FNVo5ZlpEL2YyQUtUOWlzSDVEL2VrMVV1ZGVQMmZxZzNzN3JXM1k3bGM9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoxfQ%3D%3D; msToken=YAnzmZUwDm55Z4rof_W_iqXkD-HQud-3bf1SPNX0YpYFRwSiMPbuMc99Rj8T-RHB8POFBPeSTrDlLljDZM4v77VRuqlsWs0_cQwumItQ55lKra9mnwg=&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;referer&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://www.douyin.com/user/MS4wLjABAAAAIVYCOtxmRjv3iXP-Z2h1B8m7wK1UbxsnSKbgk-d5wpc&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec-ch-ua&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&quot;Google Chrome&quot;;v=&quot;123&quot;, &quot;Not:A-Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;123&quot;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec-ch-ua-mobile&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;?0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec-ch-ua-platform&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&quot;Windows&quot;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec-fetch-dest&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;empty&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec-fetch-mode&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;cors&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec-fetch-site&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;same-origin&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;user-agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">params </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;">&#39;device_platform&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;webapp&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;aid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;6383&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;channel&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;channel_pc_web&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;sec_user_id&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;MS4wLjABAAAAIVYCOtxmRjv3iXP-Z2h1B8m7wK1UbxsnSKbgk-d5wpc&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;max_cursor&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1692695420000&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;locate_query&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;false&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;show_live_replay_strategy&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;need_time_list&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;time_list_query&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;whale_cut_token&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;cut_version&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;count&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;18&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;publish_video_strategy_type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;2&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;pc_client_type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;version_code&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;290100&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;version_name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;29.1.0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;cookie_enabled&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;true&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;screen_width&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1920&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;screen_height&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1080&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;browser_language&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;zh-CN&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;browser_platform&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Win32&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;browser_name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Chrome&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;browser_version&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;123.0.0.0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;browser_online&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;true&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;engine_name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Blink&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;engine_version&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;123.0.0.0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;os_name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Windows&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;os_version&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;10&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;cpu_core_num&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;20&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;device_memory&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;8&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;platform&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;PC&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;downlink&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;10&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;effective_type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;4g&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;round_trip_time&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;50&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;webid&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;7313179785457747493&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;msToken&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;cXXtUg2jdRwMT7ADUW_nzzvVFLs6WMLNi12-9NHGmFwoAMT5CS68kiuusXfRuyao8vNdUdNXjfuxLlRp_NbETy3-89ZQDrWnAc9zV_ZGwq9BScVokuo=&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;a_bogus&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;dX8MBmLXDkIBvDWD555LfY3q6vP3YBa00trEMD2fzdvbEL39HMTV9exEzAXvVz8jLG/lIeDjy4hCTNFMx5AJA3vRHWfKUIchsESDSFl2sokj5Z7rejusJUkNmktISlc25k3WE/i8wwIaSYukW9Fe-XolO6Z7aryk96EtO939lNE6HBv0&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://www.douyin.com/aweme/v1/web/aweme/post/&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">params, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">aweme_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;aweme_list&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># print(aweme_list)</span></span>
<span class="line"><span style="color:#ABB2BF;">url_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [aweme.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;video&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;play_addr&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;url_list&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> aweme </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> aweme_list]</span></span>
<span class="line"><span style="color:#ABB2BF;">desc_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#61AFEF;">extract_chinese</span><span style="color:#ABB2BF;">(aweme.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;desc&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> aweme </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> aweme_list]</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> extract_chinese</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">s</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    chinese_pattern </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">compile</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;</span><span style="color:#D19A66;">[\\u4e00-\\u9fa5]</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">return</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(chinese_pattern.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(s))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 示例使用</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># original_string = &quot;Hello, 你好，世界，Hello&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># chinese_string = extract_chinese(original_string)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># print(chinese_string)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_one_video</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">c</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 文件写操作</span></span>
<span class="line"><span style="color:#C678DD;">with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;F:</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">抖音已发布视频</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">VFT</span><span style="color:#56B6C2;">\\\\</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">c</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.mp4&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;wb&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:  </span><span style="color:#7F848E;font-style:italic;"># w：写文本 wb写字节</span></span>
<span class="line"><span style="color:#ABB2BF;">        f.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(res.content)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">c</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">.mp4下载成功！&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">t_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i,url </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(url_list):</span></span>
<span class="line"><span style="color:#ABB2BF;">    t </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> threading.</span><span style="color:#61AFEF;">Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">target</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">get_one_video, </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(url, desc_list[i]))</span></span>
<span class="line"><span style="color:#ABB2BF;">    t.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    t_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(t)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> t </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> t_list:</span></span>
<span class="line"><span style="color:#ABB2BF;">    t.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p>前 58 行代码全是：<a href="https://curlconverter.com/%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%8C%E5%85%B6%E4%BB%96%E4%BB%A3%E7%A0%81%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E6%98%AF%E8%A7%A3%E6%9E%90%E5%BE%97%E5%88%B0%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%EF%BC%8C%E4%B8%8B%E8%BD%BD%E8%A7%86%E9%A2%91%EF%BC%8C%E6%8F%90%E5%8F%96%E8%A7%86%E9%A2%91%E6%8F%8F%E8%BF%B0%E4%B8%AD%E7%9A%84%E4%B8%AD%E6%96%87%E5%B9%B6%E4%BD%9C%E4%B8%BA%E8%A7%86%E9%A2%91%E4%BF%9D%E5%AD%98%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%E3%80%82" target="_blank" rel="noreferrer">https://curlconverter.com/这个网站自动生成的，其他代码主要功能是解析得到视频下载地址，下载视频，提取视频描述中的中文并作为视频保存的文件名。</a></p><p>代码运行结果</p><p><img src="`+ds+'" alt="image-20240511165944023"></p><p><img src="'+Ds+'" alt="image-20240511165955042"></p><p><img src="'+Es+`" alt="image-20240511170011096"></p><p>几分钟搞定几百个抖音视频的下载</p><p>现在，你可以轻松地将抖音视频批量下载到本地，重新加工后，再在其他短视频平台上重新发布，Python 自动化办公神器，让你的工作更高效、更便捷</p><h2 id="高效批量查找-excel-数据-轻松应对海量数据处理" tabindex="-1">高效批量查找 Excel 数据，轻松应对海量数据处理 <a class="header-anchor" href="#高效批量查找-excel-数据-轻松应对海量数据处理" aria-label="Permalink to &quot;高效批量查找 Excel 数据，轻松应对海量数据处理&quot;">​</a></h2><h3 id="场景描述-3" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述-3" aria-label="Permalink to &quot;场景描述&quot;">​</a></h3><p>在处理海量的 Excel 数据时，我们经常会遇到需要跨多个工作簿查找特定信息的情况。比如，一家大型企业可能需从多个部门上报的报表中，检索特定项目的进度更新或某员工的业绩记录。传统做法通常是挨个打开 Excel 表格查找到需要的数据后复制粘贴到结果表里，有 100 个表格就需要如此重复操作 100 次，而且过程中还容易出错。利用 Python 进行批量查找 Excel 数据，可以迅速定位并整合这些信息，从而节约时间并提升工作效率。</p><h3 id="数据分析-5" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析-5" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li><p>输入：包含相似数据结构的多个 Excel 工作簿。</p></li><li><p>处理流程：</p></li><li><ul><li>遍历所有工作簿及其工作表。</li><li>查找包含特定关键词或数据的条目。</li><li>提取并整合这些数据。</li></ul></li><li><p>输出：一个整合了所有相关数据的全新 Excel 工作簿。</p></li></ul><h3 id="示例数据-4" tabindex="-1">示例数据 <a class="header-anchor" href="#示例数据-4" aria-label="Permalink to &quot;示例数据&quot;">​</a></h3><p>假设企业有多个部门，每个部门每月都会上报销售数据。现需检索所有包含特定产品“Y”的销售记录。</p><p>部门文件如下：</p><ul><li>SalesReport_Dept1.xlsx</li><li>SalesReport_Dept2.xlsx</li><li>SalesReport_Dept3.xlsx</li><li>...</li><li>SalesReport_DeptN.xlsx</li><li></li></ul><p>每个文件包含以下列：</p><ul><li>ReportDate（报告日期）</li><li>ProductName（产品名称）</li><li>SalesVolume（销售数量）</li><li>SalesPerson（销售员）</li></ul><h3 id="实战代码-7" tabindex="-1">实战代码 <a class="header-anchor" href="#实战代码-7" aria-label="Permalink to &quot;实战代码&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> batch_search_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">keyword</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_filename</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历指定文件夹中的所有Excel文件</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> filename </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(directory):</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> filename.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.xlsx&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            filepath </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(directory, filename)</span></span>
<span class="line"><span style="color:#ABB2BF;">            df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(filepath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 搜索包含特定关键词的数据</span></span>
<span class="line"><span style="color:#ABB2BF;">            matched_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&#39;ProductName&#39;</span><span style="color:#ABB2BF;">].str.</span><span style="color:#61AFEF;">contains</span><span style="color:#ABB2BF;">(keyword, </span><span style="color:#E06C75;font-style:italic;">na</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">case</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 如果找到匹配的数据，将其添加到总数据中</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> matched_data.empty:</span></span>
<span class="line"><span style="color:#ABB2BF;">                all_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">([all_data, matched_data], </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 将汇总的数据输出到新的Excel文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(output_filename, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用函数</span></span>
<span class="line"><span style="color:#61AFEF;">batch_search_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;产品Y&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;path_to_sales_reports&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;Matched_Product_Sales.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="总结-8" tabindex="-1">总结 <a class="header-anchor" href="#总结-8" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>本段代码展示了如何通过 Python 和 pandas 库，批量查找包含特定关键词的 Excel 数据。通过自动遍历文件夹中的所有 Excel 文件，搜索含有特定产品名称的记录，并将这些记录整合到一个新的 Excel 文件中。这种方法在处理需要从大量分散的数据源中提取信息的情况时特别有效，能显著提高数据处理的效率。</p><h2 id="excel-中图片的批量导入与导出" tabindex="-1">Excel 中图片的批量导入与导出 <a class="header-anchor" href="#excel-中图片的批量导入与导出" aria-label="Permalink to &quot;Excel 中图片的批量导入与导出&quot;">​</a></h2><p>在日常办公中，我们经常需要在 Excel 表格中插入或导出图片，特别是在制作产品目录、报告或展示数据时。现在有这样一份任务，产品名录表里需要将每个产品的实拍图片插入到 D 列上，产品有上百个，传统方法需要将图片一个个贴到 excel 里，然后将图片调整好大小，这个过程费时费力，而且容易出错。幸运的是，Python 提供了强大的库来帮助我们实现这些任务的自动化。</p><p><img src="`+fs+`" alt="image-20240511170146116"></p><h3 id="一、python-导入图片到-excel" tabindex="-1">一、Python 导入图片到 Excel <a class="header-anchor" href="#一、python-导入图片到-excel" aria-label="Permalink to &quot;一、Python 导入图片到 Excel&quot;">​</a></h3><p>使用 Python 将图片批量导入 Excel 表格中，可以极大地提高我们的工作效率。以下是一个简单的示例代码，展示了如何使用<code>openpyxl</code>库将图片添加到 Excel 工作表中：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> glob</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl.drawing.image </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> write_images_to_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">image_paths</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">excel_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(excel_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> path </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> image_paths:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 创建Image对象</span></span>
<span class="line"><span style="color:#ABB2BF;">        img </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Image</span><span style="color:#ABB2BF;">(path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 调整图⽚⼤⼩，假设放在A列，1:1⽐例</span></span>
<span class="line"><span style="color:#ABB2BF;">        img.width, img.height </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 150</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">50</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 添加图⽚到⼯作表，放在图⽚名对应的⾏</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws.</span><span style="color:#61AFEF;">add_image</span><span style="color:#ABB2BF;">(img, </span><span style="color:#98C379;">&#39;D&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(image_paths.</span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">(path) </span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;"> 3</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(excel_file)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># ⽰例图⽚路径和Excel⽂件名</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> get_image_paths</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">folder_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    image_paths </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 使用glob模块匹配所有jpg和png图片</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> extension </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;*.jpg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;*.png&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#ABB2BF;">        image_paths.</span><span style="color:#61AFEF;">extend</span><span style="color:#ABB2BF;">(glob.</span><span style="color:#61AFEF;">glob</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(folder_path, extension)))</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> image_paths</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用你的文件夹路径替换下面的&#39;your_folder_path&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">folder_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;extracted_images&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">image_paths </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_image_paths</span><span style="color:#ABB2BF;">(folder_path)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(image_paths)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">excel_file </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;test.xlsx&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">write_images_to_excel</span><span style="color:#ABB2BF;">(image_paths, excel_file)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>这段代码首先打开需要插入图片的 Excel，并获取活动工作表。然后，它遍历了一个包含图片路径的列表，并为每个路径创建了一个<code>Image</code>对象。接着，它设置了图片的大小，并将图片添加到了工作表的指定位置。最后，保存工作簿。</p><p><img src="`+_s+'" alt="image-20240511170220150"></p><p><img src="'+qs+`" alt="image-20240511170230697"></p><h3 id="二、python-从-excel-导出图片" tabindex="-1">二、Python 从 Excel 导出图片 <a class="header-anchor" href="#二、python-从-excel-导出图片" aria-label="Permalink to &quot;二、Python 从 Excel 导出图片&quot;">​</a></h3><p>有时候，我们可能需要从 Excel 文件中提取图片，比如为了备份、进一步处理或在其他应用程序中使用。虽然<code>openpyxl</code>库本身不提供直接从 Excel 提取图片的功能，但我们可以结合其他方法来实现这一需求。以下是一个示例代码：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> zipfile</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 加载包含图片的Excel工作簿</span></span>
<span class="line"><span style="color:#ABB2BF;">wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;VFTLURE.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建输出目录来保存提取的图片</span></span>
<span class="line"><span style="color:#ABB2BF;">output_dir </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;extracted_images&#39;</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(output_dir):</span></span>
<span class="line"><span style="color:#ABB2BF;">    os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(output_dir)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Excel文件作为ZIP归档处理</span></span>
<span class="line"><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> zipfile.</span><span style="color:#61AFEF;">ZipFile</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;VFTLURE.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> zip_ref:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历ZIP归档中的文件，查找图片文件</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> zip_info </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> zip_ref.</span><span style="color:#61AFEF;">infolist</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#ABB2BF;"> zip_info.filename.</span><span style="color:#61AFEF;">endswith</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;.png&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.jpg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.jpeg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.gif&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;.bmp&#39;</span><span style="color:#ABB2BF;">)):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 提取图片到输出目录</span></span>
<span class="line"><span style="color:#ABB2BF;">            img_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(output_dir, os.path.</span><span style="color:#61AFEF;">basename</span><span style="color:#ABB2BF;">(zip_info.filename))</span></span>
<span class="line"><span style="color:#C678DD;">            with</span><span style="color:#ABB2BF;"> zip_ref.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(zip_info) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> img_file, </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(img_path, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> out_file:</span></span>
<span class="line"><span style="color:#ABB2BF;">                out_file.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(img_file.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Images extracted to </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">output_dir</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>这段代码首先加载了包含图片的 Excel 工作簿。然后，它创建了一个输出目录来保存提取的图片。接下来，它将 Excel 文件视为一个 ZIP 归档文件，并遍历其中的所有文件。对于每个以图片格式结尾的文件，它将其提取到输出目录中。最后，它打印了一条消息，指示图片已成功提取到指定目录。上面 Excel 中的所有图片就被提取到制定文件夹里了</p><p><img src="`+hs+'" alt="image-20240511170302941"></p><h3 id="总结-9" tabindex="-1">总结 <a class="header-anchor" href="#总结-9" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>通过 Python 自动化办公，我们可以轻松实现 Excel 中图片的批量导入与导出，大大提高了工作效率和准确性。无论是制作产品目录、报告还是其他需要处理大量图片的场景，这些自动化脚本都能为我们节省大量时间和精力。</p><h2 id="八行代码轻松解决278张excel表的汇总与排序" tabindex="-1">八行代码轻松解决278张Excel表的汇总与排序 <a class="header-anchor" href="#八行代码轻松解决278张excel表的汇总与排序" aria-label="Permalink to &quot;八行代码轻松解决278张Excel表的汇总与排序&quot;">​</a></h2><p>在忙碌的职场中，我们时常被繁琐的数据处理任务所困扰，特别是当面对成百上千张Excel表格时，那种无力感和焦虑感几乎让人崩溃。想象一下，去年公司共有278天领用物料，这些领用记录分散在278张不同的Excel表中。如果让你手动合并这些表格，再统计物料的领用量，并按领用量从高到低排序，恐怕你会觉得这是一项几乎不可能完成的任务。但是，别担心！今天，我们就来介绍一种神奇的方法，利用Python编程语言中的<code>pandas</code>库，让你一键解决这个看似不可能的任务，让你的工作效率瞬间飙升！</p><h3 id="故事背景-1" tabindex="-1">故事背景 <a class="header-anchor" href="#故事背景-1" aria-label="Permalink to &quot;故事背景&quot;">​</a></h3><p>去年共有278天领用了物料，这些领用记录分散在278张Excel表中。现在，老板想要了解哪些物料领用得最多，以便做出相应的决策。面对如此庞大的数据量，如果采用手工操作，无疑将耗费大量时间和精力。然而，幸运的是，我们有Python这个强大的助手！</p><p><img src="'+gs+`" alt="图片"></p><h3 id="痛点分析-1" tabindex="-1">痛点分析 <a class="header-anchor" href="#痛点分析-1" aria-label="Permalink to &quot;痛点分析&quot;">​</a></h3><p><strong>效率低下</strong>：手动汇总和复制这些表格费时费力，效率低下。</p><p><strong>容易出错</strong>：由于手动操作，难免会出现输入错误或遗漏的情况。</p><p><strong>工作量大</strong>：随着公司人员的增加，汇总时间周期的增加，表格的数量也在不断增加，工作负担越来越重。</p><h3 id="解决方案-1" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案-1" aria-label="Permalink to &quot;解决方案&quot;">​</a></h3><p>针对以上痛点，利用Python自动化办公技术，量身定制一个解决方案。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#新建一个DataFrame用于存储汇总所有工作表的结果</span></span>
<span class="line"><span style="color:#ABB2BF;">result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#读取整个Excel文件中的所有表</span></span>
<span class="line"><span style="color:#ABB2BF;">df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;日领料单.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">sheet_name</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#按表名遍历，处理数据</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> sheet_name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">():    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #按物料编号加总领料数量</span></span>
<span class="line"><span style="color:#ABB2BF;">    df_sum </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[sheet_name].</span><span style="color:#61AFEF;">groupby</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;物料编号&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;物料描述&#39;</span><span style="color:#ABB2BF;">])[</span><span style="color:#98C379;">&#39;批号批数量&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">sum</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">()    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    result </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">([result,df_sum])</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">final </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> result.</span><span style="color:#61AFEF;">groupby</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;物料编号&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;物料描述&#39;</span><span style="color:#ABB2BF;">])[</span><span style="color:#98C379;">&#39;批号批数量&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">sum</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">sort_values</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;批号批数量&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">ascending</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">final.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;汇总.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="`+xs+'" alt="图片"></p><h2 id="图片重命名" tabindex="-1">图片重命名 <a class="header-anchor" href="#图片重命名" aria-label="Permalink to &quot;图片重命名&quot;">​</a></h2><p>你是否也曾遇到这样的情况：同事A喝着咖啡，悠然自得地完成工作任务，得到领导的赏识；而同事B却加班加点，忙碌不堪，却总是难以完成任务，陷入困境。这其中的关键，往往不在于谁更努力，而在于谁掌握了更高效的工作方法。今天，就让我们一起探讨如何通过Python自动化办公，提升职场效率，解放双手！告别加班苦海！轻松逆袭职场巅峰！</p><p>最近，我的一位做摄影的朋友遇到了一个棘手的问题。他们正在为一家服装电商上线夏秋季新品，但由于经费压力，只能招了几个大学生兼职模特。为了让学生模特能够准确地摆出专业模特的姿势，他们需要提前准备好大量专业模特的动作图片，并<strong>按****一定规则进行重命名和排序，站姿排在前面并改成&quot;1_&quot;，手部类的姿势排在其次命名为&quot;2_&quot;类似此类就不赘述了</strong>。重命名后的文件名如下。面对这个繁琐的任务，我的朋友和他的同事们选择了传统的手动重命名方式，但显然，这是一项既耗时又耗力的工作。</p><p><img src="'+vs+`" alt="图片"></p><p>当我得知这个情况后，我立即想到了Python自动化办公。通过编写简单的Python脚本，<strong>我仅用10行代码就轻松解决了上万张照片的重命名问题，不到5分钟就完成了原本需要十几个小时的任务</strong>。这不仅让我的朋友大感惊讶，也让他深刻体会到了自动化办公的高效和便捷。</p><p>代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#ABB2BF;">data_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/home/young/data/myself/men/&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">dir_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/home/young/data/myself/man/&quot;</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(data_path):</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(i)</span></span>
<span class="line"><span style="color:#ABB2BF;">    j </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> i.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;站姿&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;1_&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;手部&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;2_&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;衣服&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;3_&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;动态&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;4_&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;坐姿&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;5_&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(j)</span></span>
<span class="line"><span style="color:#ABB2BF;">    img </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(data_path,i))</span></span>
<span class="line"><span style="color:#ABB2BF;">    img.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(dir_path,j))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>然而，事情并没有就此结束。在拍摄当天，现场又出现了一个紧急问题：原本计划在两个大屏上分别放映男女模特的动作图片，两个模特分别根据图片去模仿动作，但由于设备故障，一个大屏坏了。这意味着男女模特需要间隔拍摄，原来并行的流程变成了串行，这将严重影响拍摄进度。面对这个突发情况，我再次利用Python编程技能，实现了男女模特图片的合并功能，一个大屏同时播出男女模特合并的图片。通过编写代码，我成功地将男女模特的图片合并到一张图上，并确保了两张图片的宽度和高度相同。这不仅解决了现场的问题，还节省了宝贵的时间。</p><p>原来的图片男女生模特姿势分别在两个文件夹中。</p><p><img src="`+ks+'" alt="图片"></p><p><img src="'+ws+`" alt="图片"></p><p>我实现图片合并的代码如下：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">man_pic </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/home/young/data/model/man_final/&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">woman_pic </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/home/young/data/model/woman/&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">man_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(man_pic)</span></span>
<span class="line"><span style="color:#ABB2BF;">woman_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(woman_pic)</span></span>
<span class="line"><span style="color:#ABB2BF;">men_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [man_pic</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> man_list]</span></span>
<span class="line"><span style="color:#ABB2BF;">women_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [woman_pic</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> woman_list]</span></span>
<span class="line"><span style="color:#ABB2BF;">save_dir </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;/home/young/data/model/joint/&quot;</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(save_dir):</span></span>
<span class="line"><span style="color:#ABB2BF;">    os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(save_dir)</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> torchvision </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> transforms</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> image_Splicing</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">img_1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">img_2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">flag</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;font-style:italic;">save_dir</span><span style="color:#ABB2BF;"> ,</span><span style="color:#D19A66;font-style:italic;">pic_name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;joint&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    img1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(img_1)</span></span>
<span class="line"><span style="color:#ABB2BF;">    img2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(img_2)</span></span>
<span class="line"><span style="color:#ABB2BF;">    size1, size2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> img1.size, img2.size</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#     radio = size1[0]/size1[1]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#     img_org = cv2.imread(str(img_1))</span></span>
<span class="line"><span style="color:#ABB2BF;">    img2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> transforms.</span><span style="color:#61AFEF;">Resize</span><span style="color:#ABB2BF;">([size1[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">],size1[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]])(img2)</span></span>
<span class="line"><span style="color:#ABB2BF;">    size2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> img2.size</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#     max_height = max(size1[1])</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> flag </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;x&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        joint </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;RGB&quot;</span><span style="color:#ABB2BF;">, (size1[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> size2[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">], size1[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">        loc1, loc2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">), (size1[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">], </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        joint </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;RGB&quot;</span><span style="color:#ABB2BF;">, (size1[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">], size2[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">size1[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]))</span></span>
<span class="line"><span style="color:#ABB2BF;">        loc1, loc2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">), (</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, size1[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">    joint.</span><span style="color:#61AFEF;">paste</span><span style="color:#ABB2BF;">(img1, loc1)</span></span>
<span class="line"><span style="color:#ABB2BF;">    joint.</span><span style="color:#61AFEF;">paste</span><span style="color:#ABB2BF;">(img2, loc2)</span></span>
<span class="line"><span style="color:#ABB2BF;">    joint.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(save_dir</span><span style="color:#56B6C2;">+str</span><span style="color:#ABB2BF;">(pic_name)</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;.png&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i,(men,women)</span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">zip</span><span style="color:#ABB2BF;">(women_list,men_list)):</span></span>
<span class="line"><span style="color:#61AFEF;">    image_Splicing</span><span style="color:#ABB2BF;">(men,women,</span><span style="color:#98C379;">&quot;x&quot;</span><span style="color:#ABB2BF;">,save_dir,i</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>实现了图片合并，还保证了合并后的两个图片的宽度高度是相同的。不仅实现了横向合并，还赠送了纵向合并。</p><p><img src="`+Ps+'" alt="图片"></p><p><img src="'+Ss+`" alt="图片"></p><p>通过这两个案例，我们可以深刻体会到Python自动化办公的强大魅力。它不仅可以让我们从繁琐的工作中解脱出来，还能大大提高工作效率和准确性。在当今这个信息化、数字化的时代，掌握一门编程语言，尤其是像Python这样的通用性强的语言，对于职场人来说已经变得至关重要。</p><h2 id="弥补-vlookup-不足-实现自定义规则的模糊匹配" tabindex="-1">弥补 VLOOKUP 不足，实现自定义规则的模糊匹配 <a class="header-anchor" href="#弥补-vlookup-不足-实现自定义规则的模糊匹配" aria-label="Permalink to &quot;弥补 VLOOKUP 不足，实现自定义规则的模糊匹配&quot;">​</a></h2><p>在日常工作中，我们经常需要处理大量的 Excel 数据。当多个表格经过多人之手时，数据输入规范的不一致性往往成为数据处理的难题。尤其是当需要使用 Vlookup 进行多表匹配时，因数据格式的差异导致匹配失败的情况屡见不鲜。而 Python 自动化办公工具的出现，则为解决这类问题提供了强大的支持。</p><p>近期，我就遇到了这样一个挑战：需要匹配两个 Excel 表中的数据，但匹配列的数据是多个人经手的，格式存在较大的差异。具体来说，匹配列的数据非常相近却又不同，比如同一数据在一个表里是 Solid carbon tipUltra light Spinn 195 Up to 35g Light FAST，在另一个表里就变成了 Ultra light Spinn Solid carbon tip 195 Up to 35g FASTLight 也就是数据的基本元素是相同的，只不过是字符顺序、大小写、空格不尽相同，面对这样的问题，传统的 Vlookup 方法显然无法满足需求。虽然 Vlookup 提供了模糊匹配的功能，但其在处理大小写、空格以及字符顺序等方面无法进行规则自定义，往往难以得到准确的结果。</p><p>Python 自动化办公工具，为我们提供了更加灵活和强大的数据处理能力。通过编写自定义的模糊匹配规则，我们可以轻松实现对大小写、空格以及字符顺序的忽略，从而实现精确的数据匹配。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 读取两个Excel文件</span></span>
<span class="line"><span style="color:#ABB2BF;">df1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;file1.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">df2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;file2.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义一个函数来预处理字符串，以忽略大小写、空格和字符顺序</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> preprocess_string</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">s</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 转换为小写</span></span>
<span class="line"><span style="color:#ABB2BF;">    s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> s.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 移除多余的空格</span></span>
<span class="line"><span style="color:#ABB2BF;">    s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">sub</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;\\s</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39; &#39;</span><span style="color:#ABB2BF;">, s).</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 分割字符串为字符列表，然后排序</span></span>
<span class="line"><span style="color:#ABB2BF;">    s </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">sorted</span><span style="color:#ABB2BF;">(s))</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 对df1和df2中需要匹配的列进行预处理</span></span>
<span class="line"><span style="color:#ABB2BF;">df1[</span><span style="color:#98C379;">&#39;column_to_match_processed&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df1[</span><span style="color:#98C379;">&#39;column_to_match&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">apply</span><span style="color:#ABB2BF;">(preprocess_string)</span></span>
<span class="line"><span style="color:#ABB2BF;">df2[</span><span style="color:#98C379;">&#39;column_to_match_against_processed&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df2[</span><span style="color:#98C379;">&#39;column_to_match_against&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">apply</span><span style="color:#ABB2BF;">(preprocess_string)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建一个空列来存储匹配结果</span></span>
<span class="line"><span style="color:#ABB2BF;">df1[</span><span style="color:#98C379;">&#39;matched_data&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 遍历df1，尝试在df2中找到匹配项</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> index, row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df1.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    processed_string </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&#39;column_to_match_processed&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    matches </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df2[df2[</span><span style="color:#98C379;">&#39;column_to_match_against_processed&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> processed_string]</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> matches.empty:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 假设每个处理后的字符串在df2中只匹配一次，取第一个匹配项</span></span>
<span class="line"><span style="color:#ABB2BF;">        df1.at[index, </span><span style="color:#98C379;">&#39;matched_data&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> matches[</span><span style="color:#98C379;">&#39;data_column&#39;</span><span style="color:#ABB2BF;">].iloc[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]  </span><span style="color:#7F848E;font-style:italic;"># 假设&#39;data_column&#39;是df2中你想要匹配的数据列名</span></span>
<span class="line"><span style="color:#C678DD;">    else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 如果没有找到匹配项，可以保持为None或者设置为其他默认值</span></span>
<span class="line"><span style="color:#C678DD;">        pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 移除预处理列（如果需要）</span></span>
<span class="line"><span style="color:#ABB2BF;">df1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df1.</span><span style="color:#61AFEF;">drop</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">columns</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;column_to_match_processed&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 保存结果到新的Excel文件</span></span>
<span class="line"><span style="color:#ABB2BF;">df1.</span><span style="color:#61AFEF;">to_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;matched_data.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>请注意，上面的脚本假设<code>df1</code>中的<code>column_to_match</code>是你要匹配的列，而<code>df2</code>中的<code>column_to_match_against</code>是你要与之匹配的列。同时，假设<code>df2</code>中有一个名为<code>data_column</code>的列，其中包含你想要从<code>df2</code>中获取的数据。你需要将这些列名替换为你实际 Excel 文件中的列名，preprocess_string 函数可以根据自己的需要自定义任意的规则。</p><p>此外，这个脚本假设每个处理后的字符串在<code>df2</code>中只匹配一次。如果可能存在多个匹配项，你需要决定如何处理这种情况（例如，取第一个、最后一个、随机一个，或者所有匹配项）。</p><h2 id="一分钟搞定原来一个部门几个周的工作" tabindex="-1">一分钟搞定原来一个部门几个周的工作 <a class="header-anchor" href="#一分钟搞定原来一个部门几个周的工作" aria-label="Permalink to &quot;一分钟搞定原来一个部门几个周的工作&quot;">​</a></h2><p>Python 办公⾃动化是利⽤ Python 编程语⾔来创建脚本和程序，以简化、加速和⾃动化⽇常办公任务和⼯作流程的过程。它基于 Python 的强⼤功能和丰富的第三⽅库，使得能够处理各种办公任务，如⽂档处理、数据分析、电⼦邮件管理、⽹络通信等等。</p><p>下面就用一个真实的案例感受 python 自动化的高效，一分钟搞定原来一个部门五六个人一周的表格汇总工作。</p><hr><p>在国企的季度绩效考核中，领导对员工进行评分是一项重要而繁琐的任务。由于公司规模较大，员工众多，每个领导都需要对自己所管辖的员工进行评分，同时员工之间还需要进行互评，以体现公平民主，而这些评分数据通常以 Excel 表格的形式提交。人事就肩负着将这些评分数据进行汇总并计算平均值的重任。</p><h3 id="员工互评表" tabindex="-1">员工互评表 <a class="header-anchor" href="#员工互评表" aria-label="Permalink to &quot;员工互评表&quot;">​</a></h3><p><img src="`+Ts+'" alt="image-20240511170638118"></p><h3 id="领导评分表" tabindex="-1">领导评分表 <a class="header-anchor" href="#领导评分表" aria-label="Permalink to &quot;领导评分表&quot;">​</a></h3><p><img src="'+Is+'" alt="image-20240511170653295"></p><p>传统的汇总方式需要人工手动打开每个 Excel 文件，提取出每位领导和员工对每个员工的评分数据，然后再按照员工姓名进行汇总，并计算平均值。这个过程不仅耗时耗力，而且容易出错。一旦数据出现偏差，就需要重新核对，进一步增加了工作量。</p><p>汇总结果是这样的，每个人每个月的考核分数及结果表</p><p><img src="'+Ns+'" alt="image-20240511170709321"></p><p><img src="'+Ls+'" alt="image-20240511170723940"></p><p><img src="'+js+'" alt="image-20240511170735156"></p><p>行政人事收上来的文件是这样的：</p><p><img src="'+Ms+'" alt="image-20240511170747321"></p><p>每个文件夹就是每个部门领导或者员工给所有人打分</p><p><img src="'+Os+`" alt="image-20240511170801963"></p><p>为了解决这个问题，我尝试利用 Python 的自动化处理能力来优化整个个工作流程。经过一段时间的努力，我成功开发出了一个自动化汇总软件。</p><p>核心代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> logging</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> openpyxl</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66;">LOG_FORMAT</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;</span><span style="color:#D19A66;">%(asctime)s</span><span style="color:#98C379;"> - </span><span style="color:#D19A66;">%(levelname)s</span><span style="color:#98C379;"> - </span><span style="color:#D19A66;">%(message)s</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">logging.</span><span style="color:#61AFEF;">basicConfig</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">filename</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;./datacount.log&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">                    level</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">logging.</span><span style="color:#D19A66;">WARN</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">format</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">LOG_FORMAT</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">dx_dir </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;定性打分表&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">dl_dir </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;定量打分表&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> all_files</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">file_type</span><span style="color:#ABB2BF;">):    </span><span style="color:#7F848E;font-style:italic;"># 生成path路径下全部file_type类型文件绝对路径列表</span></span>
<span class="line"><span style="color:#ABB2BF;">    f_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    def</span><span style="color:#61AFEF;"> files_list</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">father_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        sub_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">listdir</span><span style="color:#ABB2BF;">(father_path)    </span><span style="color:#7F848E;font-style:italic;"># 读取父路径下全部文件或文件夹名称</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> sp </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> sub_path:</span></span>
<span class="line"><span style="color:#ABB2BF;">            full_sub_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(father_path, sp)    </span><span style="color:#7F848E;font-style:italic;"># 生成完整子路径</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">isfile</span><span style="color:#ABB2BF;">(full_sub_path):    </span><span style="color:#7F848E;font-style:italic;"># 判断是否为文件</span></span>
<span class="line"><span style="color:#ABB2BF;">                file_name, post_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    full_sub_path)    </span><span style="color:#7F848E;font-style:italic;"># 获取文件后缀名</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> file_type </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> post_name:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    f_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(file_name </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> post_name)</span></span>
<span class="line"><span style="color:#C678DD;">            else</span><span style="color:#ABB2BF;">:    </span><span style="color:#7F848E;font-style:italic;"># 如果是文件夹，递归调用</span></span>
<span class="line"><span style="color:#61AFEF;">                files_list</span><span style="color:#ABB2BF;">(full_sub_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    files_list</span><span style="color:#ABB2BF;">(path)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> f_list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> read_all_dl_exl</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">fs_list</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;font-style:italic;">mons</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> excel_file </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> fs_list:</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(excel_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">        excel_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(excel_file)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(excel_name)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # rated_name = excel_file.split(&quot;\\\\&quot;)[-1].split(&quot;.&quot;)[0]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    #     rated_name_mon = re.split(r&quot;[- _  --]&quot;,excel_name)[-2]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rater_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> excel_file.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rater_name)</span></span>
<span class="line"><span style="color:#ABB2BF;">        rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;</span><span style="color:#D19A66;">[- _  --]</span><span style="color:#E06C75;">&quot;</span><span style="color:#ABB2BF;">,excel_name)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rated_name)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(mons[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;月&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> excel_name:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(mons[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;月&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> excel_name:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(mons[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">])</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;月&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> excel_name:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">99</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;rated_name&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [rated_name]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [rater_name]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [mon]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#98C379;"> &quot;.xlsx&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> excel_file:</span></span>
<span class="line"><span style="color:#ABB2BF;">            data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file,</span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;I&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">engine</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;openpyxl&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(data_s)</span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file,</span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;I&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">engine</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;openpyxl&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">sheet_name</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(data_s)</span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file,</span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;I&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">engine</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;openpyxl&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">sheet_name</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file,</span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;I&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(data_s)</span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file,</span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;I&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">sheet_name</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(data_s)</span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file,</span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;I&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">sheet_name</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [data_s[data_s.iloc[:,</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">notna</span><span style="color:#ABB2BF;">()].iloc[:,</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].iloc[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        all_data_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(rate_df)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> all_data_list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> read_all_dx_exl</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">fs_list</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">mons</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_data_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> excel_file </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> fs_list:</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(excel_file)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # rated_name = excel_file.split(&quot;\\\\&quot;)[-1].split(&quot;.&quot;)[0]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rated_name_mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> excel_file.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rater_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> excel_file.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rater_name)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#98C379;"> &quot;-&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> rated_name_mon:</span></span>
<span class="line"><span style="color:#ABB2BF;">            rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> rated_name_mon.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;\\d&quot;</span><span style="color:#ABB2BF;">, rated_name_mon)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rated_name)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(mons[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]) </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rated_name_mon:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(mons[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]) </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rated_name_mon:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        elif</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(mons[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]) </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rated_name_mon:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            mon </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">99</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;rated_name&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [rated_name]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [rater_name]</span></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [mon]</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#98C379;"> &quot;.xlsx&quot;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> excel_file:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                excel_file, </span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;G&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">engine</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;openpyxl&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(data_s) </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    excel_file, </span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">engine</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;openpyxl&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_s[data_s.columns[[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]]]</span></span>
<span class="line"><span style="color:#C678DD;">        else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file, </span><span style="color:#E06C75;font-style:italic;">usecols</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;G&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">            if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(data_s) </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(excel_file, </span><span style="color:#E06C75;font-style:italic;">header</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                data_s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_s[data_s.columns[[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]]]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        rate_df[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">            data_s[data_s.iloc[:, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">notna</span><span style="color:#ABB2BF;">()].iloc[:, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].iloc[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]]</span></span>
<span class="line"><span style="color:#ABB2BF;">        all_data_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(rate_df)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> all_data_list</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> save_dx_result</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">rated_group</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">mons</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> rated_per, df </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rated_group:</span></span>
<span class="line"><span style="color:#ABB2BF;">        wb1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./模板表.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb1[</span><span style="color:#98C379;">&quot;Sheet1&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rated_per)</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(df)</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> rated_per</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">11</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> rated_per</span></span>
<span class="line"><span style="color:#ABB2BF;">        ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> rated_per</span></span>
<span class="line"><span style="color:#ABB2BF;">        df_7 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]].</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">drop</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(df_7) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i, row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df_7.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df_7.score.</span><span style="color:#61AFEF;">mean</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        df_8 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]].</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">drop</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(df_8) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i, row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df_8.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">14</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df_8.score.</span><span style="color:#61AFEF;">mean</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        df_9 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> mons[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]].</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">drop</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(df_9) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i, row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df_9.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">21</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">22</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">i).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">            ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">23</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df_9.score.</span><span style="color:#61AFEF;">mean</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        wb1.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./result/&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">rated_per</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> save_dl_result</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">rated_group</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">mons</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> rated_per,df </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rated_group:</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            wb1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> openpyxl.</span><span style="color:#61AFEF;">load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./result/&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">rated_per</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            ws1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb1[</span><span style="color:#98C379;">&quot;Sheet1&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">        except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rated_per)</span></span>
<span class="line"><span style="color:#ABB2BF;">            logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(e)</span></span>
<span class="line"><span style="color:#C678DD;">            continue</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(rated_per)</span></span>
<span class="line"><span style="color:#ABB2BF;">        logging.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(df)</span></span>
<span class="line"><span style="color:#ABB2BF;">        df_7 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">]</span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">mons[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]].</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">drop</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(df_7)</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i,row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df_7.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        df_8 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">]</span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">mons[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]].</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">drop</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(df_8)</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i,row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df_8.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        df_9 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> df[df[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">]</span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;">mons[</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">]].</span><span style="color:#61AFEF;">reset_index</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">drop</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">        if</span><span style="color:#56B6C2;"> len</span><span style="color:#ABB2BF;">(df_9)</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> i,row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df_9.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">24</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;rater_name&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                ws1.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">25</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">).value </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> row[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        wb1.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./result/&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">rated_per</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot;.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> clean_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;《&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;</span><span style="color:#56B6C2;">\\（</span><span style="color:#E06C75;">.</span><span style="color:#D19A66;">*?</span><span style="color:#56B6C2;">\\）</span><span style="color:#E06C75;">&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot; &quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;  &quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;\\s*&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;   &quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;    &quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;《定性指标考核表（员工层）》&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;1月&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;2月&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;3月&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;《定性指标考核表》&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.rated_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.rated_name.str.</span><span style="color:#61AFEF;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;《&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> data</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    save_dir </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;./result/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(save_dir):</span></span>
<span class="line"><span style="color:#ABB2BF;">        os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(save_dir)</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;config.json&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> json_file:</span></span>
<span class="line"><span style="color:#ABB2BF;">        config </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">(json_file)</span></span>
<span class="line"><span style="color:#ABB2BF;">    mons </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> config[</span><span style="color:#98C379;">&quot;mons&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    fs_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> all_files</span><span style="color:#ABB2BF;">(dx_dir, </span><span style="color:#98C379;">&quot;xls&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_dx_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> read_all_dx_exl</span><span style="color:#ABB2BF;">(fs_list, mons)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(all_dx_list, </span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_score_dx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dx[data_dx.score </span><span style="color:#56B6C2;">==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_mon_dx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dx[data_dx[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">99</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_score_dx.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;wrong_data_dx.csv&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">mode</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;a&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_mon_dx.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;wrong_data_dx.csv&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">mode</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;a&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dx[data_dx.score </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dx[data_dx[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">99</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dx[</span><span style="color:#98C379;">&quot;score&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">to_numeric</span><span style="color:#ABB2BF;">(data_dx.score, </span><span style="color:#E06C75;font-style:italic;">errors</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;coerce&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dx[data_dx.score.</span><span style="color:#61AFEF;">notnull</span><span style="color:#ABB2BF;">()]</span></span>
<span class="line"><span style="color:#ABB2BF;">    data </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> clean_data</span><span style="color:#ABB2BF;">(data_dx)</span></span>
<span class="line"><span style="color:#ABB2BF;">    rated_group </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">groupby</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;rated_name&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    save_dx_result</span><span style="color:#ABB2BF;">(rated_group, mons)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    dl_fs_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> all_files</span><span style="color:#ABB2BF;">(dl_dir,</span><span style="color:#98C379;">&quot;xls&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    all_dl_list </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> read_all_dl_exl</span><span style="color:#ABB2BF;">(dl_fs_list, mons)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">concat</span><span style="color:#ABB2BF;">(all_dl_list,</span><span style="color:#E06C75;font-style:italic;">ignore_index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_score_dl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dl[data_dl.score </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_mon_dl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dl[data_dl[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">==</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">99</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_score_dl.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;wrong_data_dl.csv&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">mode</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;a&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    wrong_mon_dl.</span><span style="color:#61AFEF;">to_csv</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;wrong_data_dl.csv&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">mode</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;a&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    data_dl </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data_dl[data_dl[</span><span style="color:#98C379;">&quot;month&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">!=</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;">99</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    data2 </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> clean_data</span><span style="color:#ABB2BF;">(data_dl)</span></span>
<span class="line"><span style="color:#ABB2BF;">    dl_rated_group </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data2.</span><span style="color:#61AFEF;">groupby</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;rated_name&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    save_dl_result</span><span style="color:#ABB2BF;">(dl_rated_group, mons)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br></div></div><p>为了进一步让国企的朋友都能使用这段程序，我用 pyinstaller 对程序打包成了 EXE 软件，朋友就像使用微信 QQ 一样使用这段代码，不在需要搭建 python 环境</p><p><img src="`+Rs+'" alt="image-20240511170851523"></p><p>这个软件的操作非常简单。只需要将本季度的所有评分表格导入到软件中，它就能自动识别表格中的数据，并按照员工姓名进行汇总形成汇总表。软件会自动计算每个员工的总分，并计算出平均值。一分钟的时间，软件就能生成一个包含每个员工平均分的汇总表。</p><p><img src="'+Hs+`" alt="image-20240511170909563"></p><p>自从使用了这个自动化汇总软件后，朋友的工作效率得到了极大的提升。原本需要整个部门一周时间才能完成的工作，现在只需要几分钟就能轻松搞定。这不仅大大减轻了我们的工作负担，还提高了数据的准确性和可靠性。</p><h2 id="几行代码实现文件自动分类-告别混乱文件夹" tabindex="-1">几行代码实现文件自动分类，告别混乱文件夹 <a class="header-anchor" href="#几行代码实现文件自动分类-告别混乱文件夹" aria-label="Permalink to &quot;几行代码实现文件自动分类，告别混乱文件夹&quot;">​</a></h2><p>在日常工作中，我们经常会遇到这样一个问题：大量的文件被随意存放在同一个文件夹中，导致文件查找变得异常困难，甚至需要花费大量时间去手动整理。这种混乱的文件夹管理方式不仅影响了工作效率，也增加了出错的可能性。</p><p>不过，现在有了 Python 这个强大的自动化办公工具，我们可以轻松解决这个问题。通过编写简单的 Python 脚本，我们可以根据文件类型自动将文件分类，让文件夹变得井井有条。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> shutil</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> classify_files</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">directory</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">destination_directory</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">config</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    将目录下的文件按照配置中的后缀分类到不同的文件夹中。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">    Args:</span></span>
<span class="line"><span style="color:#98C379;">    - directory: 要分类的目录路径</span></span>
<span class="line"><span style="color:#98C379;">    - destination_directory: 分类后文件夹的目标路径</span></span>
<span class="line"><span style="color:#98C379;">    - config: 包含后缀、目标文件夹和操作标识的元组的配置列表</span></span>
<span class="line"><span style="color:#98C379;">              格式为 [(&#39;后缀1&#39;, &#39;目标文件夹1&#39;, &#39;移动/复制&#39;), (&#39;后缀2&#39;, &#39;目标文件夹2&#39;, &#39;移动/复制&#39;), ...]</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 遍历目录下的所有文件</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> root, dirs, files </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">walk</span><span style="color:#ABB2BF;">(directory):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#E06C75;"> file</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> files:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 获取文件的绝对路径</span></span>
<span class="line"><span style="color:#ABB2BF;">            file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(root, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 获取文件后缀</span></span>
<span class="line"><span style="color:#ABB2BF;">            _, extension </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">splitext</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            extension </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> extension.</span><span style="color:#61AFEF;">lower</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 统一转换为小写</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">            # 在配置列表中查找后缀对应的配置项</span></span>
<span class="line"><span style="color:#C678DD;">            for</span><span style="color:#ABB2BF;"> ext, dest, action </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> config:</span></span>
<span class="line"><span style="color:#C678DD;">                if</span><span style="color:#ABB2BF;"> extension </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> ext:</span></span>
<span class="line"><span style="color:#ABB2BF;">                    destination_folder </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(destination_directory, dest)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 如果目标文件夹不存在，则创建它</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(destination_folder):</span></span>
<span class="line"><span style="color:#ABB2BF;">                        os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(destination_folder)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    # 执行移动或复制操作</span></span>
<span class="line"><span style="color:#C678DD;">                    if</span><span style="color:#ABB2BF;"> action </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;移动&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        shutil.</span><span style="color:#61AFEF;">move</span><span style="color:#ABB2BF;">(file_path, destination_folder)</span></span>
<span class="line"><span style="color:#C678DD;">                    elif</span><span style="color:#ABB2BF;"> action </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39;复制&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                        shutil.</span><span style="color:#61AFEF;">copy</span><span style="color:#ABB2BF;">(file_path, destination_folder)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> __name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 配置文件后缀、目标文件夹和操作标识的元组列表</span></span>
<span class="line"><span style="color:#ABB2BF;">    file_extension_config </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">        (</span><span style="color:#98C379;">&#39;.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;TextFiles&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;移动&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        (</span><span style="color:#98C379;">&#39;.jpg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;ImageFiles&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;复制&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        (</span><span style="color:#98C379;">&#39;.png&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;ImageFiles&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;复制&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        (</span><span style="color:#98C379;">&#39;.jpeg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;ImageFiles&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;移动&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        (</span><span style="color:#98C379;">&#39;.mp3&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;AudioFiles&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;移动&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        (</span><span style="color:#98C379;">&#39;.mp4&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;AudioFiles&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;复制&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        # 可以根据需要扩展更多的后缀、目标文件夹和操作标识的元组</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 要分类的目录路径</span></span>
<span class="line"><span style="color:#ABB2BF;">    source_directory </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;D:</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">AI</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">massdir&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 分类后文件夹的目标路径</span></span>
<span class="line"><span style="color:#ABB2BF;">    destination_directory </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;./path/classify&quot;</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#C678DD;"> not</span><span style="color:#ABB2BF;"> os.path.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">(destination_directory):</span></span>
<span class="line"><span style="color:#ABB2BF;">        os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(destination_directory)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 调用分类函数</span></span>
<span class="line"><span style="color:#61AFEF;">    classify_files</span><span style="color:#ABB2BF;">(source_directory, destination_directory, file_extension_config)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>代码运行效果</p><p>整理前</p><p><img src="`+Ws+'" alt="image-20240511171006983"></p><p>整理后</p><p><img src="'+Gs+'" alt="image-20240511171027590"></p><p><img src="'+Us+`" alt="image-20240511171058971"></p><p>当然，这个脚本只是一个简单的示例，你可以根据自己的需求进行灵活配置。比如，你可以根据需要添加更多的文件类型，或者将文件移动到目标文件夹而不是复制。此外，你还可以考虑添加一些错误处理的逻辑，以处理可能出现的异常情况。</p><p>总之，通过 Python 自动化办公，我们可以轻松实现文件自动分类，让工作变得更加高效和有序。只需要几行简单的代码，就能告别混乱的文件夹，享受更加愉快的办公体验！</p><h2 id="一键解决工资条发放大难题" tabindex="-1">一键解决工资条发放大难题 <a class="header-anchor" href="#一键解决工资条发放大难题" aria-label="Permalink to &quot;一键解决工资条发放大难题&quot;">​</a></h2><h3 id="办公需求" tabindex="-1">办公需求 <a class="header-anchor" href="#办公需求" aria-label="Permalink to &quot;办公需求&quot;">​</a></h3><p>我有一个好朋友，在一家国企的分公司担任人事一职。每个月，总公司的人事都会将分公司人员的工资表格通过微信截图的形式发给她。她需要一张张打开图片，对照着内容手动输入到 Excel 表格中，然后再将这些数据制作成工资条，通过邮件发送给相关人员。整个过程繁琐至极，每个月都需要耗费两天的时间才能完成。对于领导以截图形式发送的方式也是敢怒不敢言。</p><h3 id="痛点分析-2" tabindex="-1"><strong>痛点分析：</strong> <a class="header-anchor" href="#痛点分析-2" aria-label="Permalink to &quot;**痛点分析：**&quot;">​</a></h3><p><strong>效率低下</strong>：手动输入和制作工资条的过程耗时耗力，效率低下。</p><p><strong>容易出错</strong>：由于手动操作，难免会出现输入错误或遗漏的情况。</p><p><strong>工作量大</strong>：随着公司人员的增加，工资条的数量也在不断增加，工作负担越来越重。</p><h3 id="解决方案-2" tabindex="-1">解决方案： <a class="header-anchor" href="#解决方案-2" aria-label="Permalink to &quot;解决方案：&quot;">​</a></h3><p>针对以上痛点，我利用 Python 自动化办公技术，为朋友量身定制了一个解决方案。</p><h4 id="第一步-ocr-算法自动提取工资表格" tabindex="-1">第一步：OCR 算法自动提取工资表格 <a class="header-anchor" href="#第一步-ocr-算法自动提取工资表格" aria-label="Permalink to &quot;第一步：OCR 算法自动提取工资表格&quot;">​</a></h4><p>利用 OCR（光学字符识别）算法，我们可以轻松地将微信截图中的工资表格自动提取到 Excel 中。这个过程只需要将图片复制到指定文件夹，程序会自动识别并转换。</p><p>python 代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pytesseract</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Workbook</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> load_image</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">image_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(image_path)</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> image</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> convert_to_grayscale</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">image</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> image.</span><span style="color:#61AFEF;">convert</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;L&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> extract_text</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">image</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> pytesseract.</span><span style="color:#61AFEF;">image_to_string</span><span style="color:#ABB2BF;">(image)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> extract_table_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">text</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    rows </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> text.</span><span style="color:#61AFEF;">strip</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    table_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [row.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> rows]</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> table_data</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> save_as_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">table_data</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">output_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    workbook </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Workbook</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    sheet </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> workbook.active</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> row_index, row_data </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(table_data, </span><span style="color:#E06C75;font-style:italic;">start</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#C678DD;">        for</span><span style="color:#ABB2BF;"> column_index, cell_data </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> enumerate</span><span style="color:#ABB2BF;">(row_data, </span><span style="color:#E06C75;font-style:italic;">start</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">            sheet.</span><span style="color:#61AFEF;">cell</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">row</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">row_index, </span><span style="color:#E06C75;font-style:italic;">column</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">column_index, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">cell_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    workbook.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(output_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 调用示例</span></span>
<span class="line"><span style="color:#ABB2BF;">image_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;table_image.jpg&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">output_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;table_data.xlsx&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">image </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_image</span><span style="color:#ABB2BF;">(image_path)</span></span>
<span class="line"><span style="color:#ABB2BF;">grayscale_image </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> convert_to_grayscale</span><span style="color:#ABB2BF;">(image)</span></span>
<span class="line"><span style="color:#ABB2BF;">text </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> extract_text</span><span style="color:#ABB2BF;">(grayscale_image)</span></span>
<span class="line"><span style="color:#ABB2BF;">table_data </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> extract_table_data</span><span style="color:#ABB2BF;">(text)</span></span>
<span class="line"><span style="color:#61AFEF;">save_as_excel</span><span style="color:#ABB2BF;">(table_data, output_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p><img src="`+Ks+'" alt="image-20240513165835111"></p><p>可以看到用这种方式提取到的信息不仅没有错误，而且还完美的保持了表格的结构</p><p>总之，Python 自动化工具为我们提供了一种高效、精准的方法，可以一键提取图片中的表格数据，并将其转换为可编辑的 Excel 格式。它不仅可以解决我们手动输入表格数据的繁琐问题，还可以保证数据的准确性和完整性。</p><h4 id="第二步-自动制作工资条" tabindex="-1">第二步：自动制作工资条 <a class="header-anchor" href="#第二步-自动制作工资条" aria-label="Permalink to &quot;第二步：自动制作工资条&quot;">​</a></h4><p>在成功将工资表格导入 Excel 后，程序会自动根据预设的格式将表格转换成工资条形式。这样，原本需要手动一条一条复制粘贴的工作，现在只需一秒钟就能完成。</p><p><img src="'+zs+`" alt="image-20240513165911570"></p><p><strong>python 代码</strong></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导入Excel写入库</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Workbook</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">df </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">read_excel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;employee_data.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(df)</span></span>
<span class="line"><span style="color:#ABB2BF;">os.</span><span style="color:#61AFEF;">makedirs</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;工资条&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">exist_ok</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> i,row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> df.</span><span style="color:#61AFEF;">iterrows</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Workbook</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">list</span><span style="color:#ABB2BF;">(df.columns))</span></span>
<span class="line"><span style="color:#ABB2BF;">    ws.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">list</span><span style="color:#ABB2BF;">(row))</span></span>
<span class="line"><span style="color:#ABB2BF;">    file_name </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&quot;./工资条/</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">row[</span><span style="color:#98C379;">&#39;姓名&#39;</span><span style="color:#ABB2BF;">]</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">_工资条.xlsx&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    wb.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">filename</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">file_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;工资条生成完毕&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><img src="`+Ys+'" alt="image-20240513165937452"></p><p><img src="'+Xs+`" alt="image-20240513165947756"></p><h4 id="第三步-根据人名自动发送邮件" tabindex="-1">第三步：根据人名自动发送邮件 <a class="header-anchor" href="#第三步-根据人名自动发送邮件" aria-label="Permalink to &quot;第三步：根据人名自动发送邮件&quot;">​</a></h4><p>最后，程序会根据工资表中的员工姓名和邮箱信息，自动将工资条以邮件的形式发送给对应的人员。这样，不仅省去了手动发送邮件的繁琐过程，还能确保工资条准确无误地发送到每个员工的邮箱中。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> datetime</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 处理邮件内容的库，email.mine</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.text </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEText</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> email.mime.application </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> MIMEApplication</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> logging</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">logging.</span><span style="color:#61AFEF;">basicConfig</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">filename</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;E:\\code\\Plan_m\\log.log&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">level</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">logging.</span><span style="color:#D19A66;">INFO</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">filemode</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">format</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;【</span><span style="color:#D19A66;">%(asctime)s</span><span style="color:#98C379;">】 【</span><span style="color:#D19A66;">%(levelname)s</span><span style="color:#98C379;">】 &gt;&gt;&gt;  </span><span style="color:#D19A66;">%(message)s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">datefmt</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 邮箱属性配置</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#61AFEF;"> send_email</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">text_msg</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 邮箱服务端</span></span>
<span class="line"><span style="color:#ABB2BF;">    mailserver </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;smtp.163.com&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 发件人-填写自己的邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">    userName_SendMail </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;zdy15921159716@163.com&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 邮箱发件授权码-为发件人生成的授权码，详见下文</span></span>
<span class="line"><span style="color:#ABB2BF;">    userName_AuthCode </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;BOEFGGZHRAHEXGRN&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 定义邮件的接收者-我随便写的，若收件人较多，可用列表表示</span></span>
<span class="line"><span style="color:#ABB2BF;">    per_email </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> email_dict.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(text_msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;姓名&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;None&quot;</span><span style="color:#ABB2BF;">),</span><span style="color:#98C379;">&quot;None&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> text_msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;姓名&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&quot;None&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(per_email)</span></span>
<span class="line"><span style="color:#ABB2BF;">    received_mail </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;young@example.com&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#7F848E;font-style:italic;"># 加入祖总 刘总 张总邮箱</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # final_received_mail = received_mail+per_email</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # print(final_received_mail)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 发送一封简单的邮件，处理邮件内容</span></span>
<span class="line"><span style="color:#ABB2BF;">    content </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;本月工资条请查收&#39;</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(content)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 纯文本形式的邮件内容的定义，通过MIMEText进行操作，plain为默认的文本的展示形式</span></span>
<span class="line"><span style="color:#ABB2BF;">    email </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MIMEMultipart</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    email[</span><span style="color:#98C379;">&#39;Subject&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;工资条&#39;</span><span style="color:#7F848E;font-style:italic;">  # 定义邮件主题</span></span>
<span class="line"><span style="color:#ABB2BF;">    email[</span><span style="color:#98C379;">&#39;From&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;人事部&quot;</span><span style="color:#7F848E;font-style:italic;">  # 发件人</span></span>
<span class="line"><span style="color:#ABB2BF;">    email[</span><span style="color:#98C379;">&#39;To&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;,&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(received_mail)  </span><span style="color:#7F848E;font-style:italic;"># 收件人（可以添加多个，若只有一个收件人，可直接写邮箱号）</span></span>
<span class="line"><span style="color:#ABB2BF;">    filename </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">_工资条.xlsx&#39;</span></span>
<span class="line"><span style="color:#C678DD;">    with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> attachment:</span></span>
<span class="line"><span style="color:#ABB2BF;">        part </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> MIMEApplication</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        attachment.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">        Name</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">filename</span></span>
<span class="line"><span style="color:#ABB2BF;">    )</span></span>
<span class="line"><span style="color:#ABB2BF;">      part[</span><span style="color:#98C379;">&#39;Content-Disposition&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> f</span><span style="color:#98C379;">&#39;attachment; filename=&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">filename</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">      email.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(part)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 发送邮件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # QQ邮箱的端口号是465，其他邮箱的端口号可自行百度，非QQ邮箱，一般使用SMTP即可，不需要有SSL</span></span>
<span class="line"><span style="color:#ABB2BF;">    smtp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> smtplib.</span><span style="color:#61AFEF;">SMTP_SSL</span><span style="color:#ABB2BF;">(mailserver, </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">465</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    smtp.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(userName_SendMail, userName_AuthCode)</span></span>
<span class="line"><span style="color:#ABB2BF;">    smtp.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(userName_SendMail, </span><span style="color:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(received_mail), email.</span><span style="color:#61AFEF;">as_string</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    smtp.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    logging.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;恭喜，邮件发送成功了&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># data = pd.read_excel(&quot;E:\\Plan_m\\批量样品跟进计划表.xlsx&quot;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># # data[&#39;下单时间&#39;] = pd.to_datetime(data[&#39;下单时间&#39;])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>163 邮箱安全码设置【python 代码中的密码使用这个而不是邮箱密码】</p><p><img src="`+Vs+'" alt="image-20240513170027955"></p><p><img src="'+Js+'" alt="image-20240513170050286"></p><p><img src="'+Qs+'" alt="image-20240513170059555"></p><h3 id="效果展示-2" tabindex="-1">效果展示： <a class="header-anchor" href="#效果展示-2" aria-label="Permalink to &quot;效果展示：&quot;">​</a></h3><p>经过实施这个解决方案后，朋友的工作负担得到了极大的减轻。现在，她每个月只需花费一秒钟的时间将图片复制到指定文件夹中，剩下的工作就全部交给了 Python 自动化办公神器。而且，由于程序的高度自动化和准确性，再也不用担心出现错误或遗漏的情况了。</p><h2 id="基于-excel-构建全方位销售管理系统" tabindex="-1">基于 Excel 构建全方位销售管理系统 <a class="header-anchor" href="#基于-excel-构建全方位销售管理系统" aria-label="Permalink to &quot;基于 Excel 构建全方位销售管理系统&quot;">​</a></h2><p>下载地址：<a href="https://pan.baidu.com/s/1_gahdoDJjFQEyKc65O0_rA?pwd=1dlk" target="_blank" rel="noreferrer">销售管理系统.xlsx_免费高速下载|百度网盘-分享无限制 (baidu.com)</a></p><p>在当今数字化时代，有效的销售管理对于企业的发展至关重要。然而，对于许多中小型企业来说，资金和技术上的限制使得他们无法承担昂贵的企业资源规划（ERP）系统。在这样的背景下，利用 Excel 构建一套全面而实用的销售管理系统，成为了中小型企业实现数字化销售管理的高效途径。</p><p>近期，我花费一周的时间，基于 Excel 为一家中小型企业打造了一个销售管理系统。该系统涵盖了客户、产品、员工、销售价目表、营销、销售报价、开票申请、合同、订单明细、出库明细、收款明细、发票明细以及各类报表等多个模块，实现了销售管理流程的数字化和自动化。</p><h3 id="一、系统架构设计" tabindex="-1">一、系统架构设计 <a class="header-anchor" href="#一、系统架构设计" aria-label="Permalink to &quot;一、系统架构设计&quot;">​</a></h3><p>该系统利用 Excel 的表格、函数、图表等功能，构建了一个集数据管理、查询、分析和报告于一体的销售管理平台。通过简单的操作，用户可以轻松录入、查询和修改销售数据，实现销售流程的全程跟踪和管理。</p><p>通过对销售管理的各个模块进行梳理，确定系统的基本架构。在本系统中，我们将分为以下几个模块：客户管理、产品管理、员工管理、营销管理、合同管理、订单管理以及报表管理。每个模块都对应一个或多个 Excel 工作表，通过数据链接和公式实现数据的互通和计算。</p><p><img src="'+Zs+'" alt="image-20240511171206902"></p><p><img src="'+$s+'" alt="image-20240511171216652"></p><h3 id="二、模块功能实现" tabindex="-1">二、模块功能实现 <a class="header-anchor" href="#二、模块功能实现" aria-label="Permalink to &quot;二、模块功能实现&quot;">​</a></h3><p><strong>涵盖基本信息模块、营销模块、订单管理、报表管理和系统信息</strong></p><p><img src="'+sn+'" alt="image-20240511171352762"></p><p><strong>客户管理</strong>：在客户管理模块中，我们可以记录客户的基本信息、交易历史、信用评级等内容。通过设置筛选和排序功能，销售人员可以迅速定位目标客户，提高销售效率。</p><p><img src="'+nn+'" alt="image-20240511171410934"></p><p><strong>产品管理</strong>：产品管理模块用于记录产品的详细信息，包括产品名称、规格、价格、库存等。通过 Excel 的数据验证功能，可以确保输入的数据格式正确，减少错误。</p><p><img src="'+an+'" alt="image-20240511171425260"></p><p><strong>员工管理</strong>：员工管理模块可以记录员工的个人信息、销售业绩、提成计算等内容。通过设置权限，可以限制不同级别员工对数据的访问和修改权限，确保数据安全。</p><p><img src="'+ln+'" alt="image-20240511171609709"></p><p><img src="'+pn+'" alt="image-20240511171620516"></p><p><strong>营销管理</strong>：营销管理模块用于策划和执行营销活动，包括活动计划、预算、执行效果等。通过图表展示营销数据，可以帮助企业更好地了解市场动态和效果评估。</p><p><img src="'+on+'" alt="image-20240511171634401"></p><p><strong>合同管理</strong>：合同管理模块可以记录合同的详细信息，包括合同编号、签订日期、合同金额、履行情况等。通过设置提醒功能，可以确保合同履行的及时性和准确性。</p><p><img src="'+en+'" alt="image-20240511171659774"></p><p><strong>订单管理</strong>：订单管理模块用于记录订单的生成、执行和结算过程。通过 Excel 的公式和函数，可以自动计算订单金额、折扣、税金等，提高订单处理的准确性。</p><p><img src="'+rn+'" alt="image-20240511171712733"></p><p>**库存管理：**库存管理模块负责记录所有产品的进、销存、数据</p><p><img src="'+cn+'" alt="image-20240511171730682"></p><p><strong>报表管理</strong>：报表管理模块可以根据需要生成各类销售报表，如销售汇总表、客户分析表、产品销量表、收款报表等。这些报表可以帮助企业全面了解销售情况，为决策提供支持。</p><p><img src="'+tn+'" alt="image-20240511171746907"></p><p>基于 Excel 构建的销售管理系统，以其灵活、易用的特点，为中小型企业提供了一种经济高效的销售管理解决方案。通过合理利用 Excel 的各项功能，企业可以实现销售管理的数字化和智能化，提升销售效率和管理水平。未来，随着 Excel 功能的不断完善和更新，基于 Excel 的销售管理系统将有更大的发展空间和应用前景。</p><h2 id="_4-秒钟生成-399-份荣誉证书" tabindex="-1">4 秒钟生成 399 份荣誉证书 <a class="header-anchor" href="#_4-秒钟生成-399-份荣誉证书" aria-label="Permalink to &quot;4 秒钟生成 399 份荣誉证书&quot;">​</a></h2><p>如果有一个工具可以在短短 4 秒钟内完成一周的工作量，你会怎么想？这不是天方夜谭，这是 Python 编程语言带给我们的现实奇迹！</p><h3 id="_1-故事背景" tabindex="-1"><strong>1. 故事背景</strong> <a class="header-anchor" href="#_1-故事背景" aria-label="Permalink to &quot;**1. 故事背景**&quot;">​</a></h3><p>在每个学期的尾声，幼儿园的小朋友们都会收到一份特别的“好孩子”荣誉证书。这份荣誉证书是每个孩子都能得到的一份鼓励和认可。如果哪个小朋友没有收到这份证书，那么家长和孩子都会感到非常失望，甚至会找到老师进行一番理论。</p><p>在我朋友的幼儿园，每学期结束时，发放荣誉证书成了一项重要的活动。整个幼儿园有将近 400 份荣誉证书需要填写，这通常需要专人花费几天的时间来完成。可这一次我用 Python 几秒钟就解决了这个难题。</p><h3 id="_2-传统方法的局限性" tabindex="-1"><strong>2. 传统方法的局限性</strong> <a class="header-anchor" href="#_2-传统方法的局限性" aria-label="Permalink to &quot;**2. 传统方法的局限性**&quot;">​</a></h3><ul><li><strong>耗时</strong>：每份奖状的制作至少需要 5 分钟，总计将近 25 个小时。</li><li><strong>重复劳动</strong>：工作内容机械重复，效率低下。</li><li><strong>易出错</strong>：手工填写信息容易出现错误。</li></ul><h3 id="_3-python-自动化的解决方案" tabindex="-1"><strong>3. Python 自动化的解决方案</strong> <a class="header-anchor" href="#_3-python-自动化的解决方案" aria-label="Permalink to &quot;**3. Python 自动化的解决方案**&quot;">​</a></h3><p>使用 Python 自动化办公工具来批量自动化生成 PPT 版荣誉证书。</p><h3 id="_4-如何实现自动化" tabindex="-1"><strong>4. 如何实现自动化？</strong> <a class="header-anchor" href="#_4-如何实现自动化" aria-label="Permalink to &quot;**4. 如何实现自动化？**&quot;">​</a></h3><h4 id="_4-1-准备工作" tabindex="-1">4.1 准备工作 <a class="header-anchor" href="#_4-1-准备工作" aria-label="Permalink to &quot;4.1 准备工作&quot;">​</a></h4><ul><li><p><strong>收集信息</strong>：整理好所有获奖孩子的名单和相关信息，存储到 Excel 里。</p></li><li><p><strong>设计模板</strong>：在 PowerPoint 中设计一个奖状模板，包括姓名、学年、时间等可变字段。</p><p><img src="'+Bn+'" alt="图片"></p></li></ul><p><img src="'+yn+`" alt="图片"></p><h4 id="_4-2-python-脚本开发" tabindex="-1">4.2 Python 脚本开发 <a class="header-anchor" href="#_4-2-python-脚本开发" aria-label="Permalink to &quot;4.2 Python 脚本开发&quot;">​</a></h4><ul><li><p><strong>编写脚本</strong>：利用 Python 的<code>python-pptx</code>库来操作 PPT 文件。</p></li><li><p><strong>批量填充</strong>：编写循环，自动填充每个孩子的信息到模板中。</p><p>Python 代码</p></li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> pptx </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Presentation</span></span>
<span class="line"><span style="color:#ABB2BF;">prs </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Presentation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data\\荣誉证书模板.pptx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">slide </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> prs.slides.</span><span style="color:#61AFEF;">add_slide</span><span style="color:#ABB2BF;">(prs.slide_layouts[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]) </span><span style="color:#7F848E;font-style:italic;"># 第一个模板的第0个板式</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> ph </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> slide.placeholders: </span><span style="color:#7F848E;font-style:italic;">#遍历这页PPT的所有占位符</span></span>
<span class="line"><span style="color:#ABB2BF;">    phf </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ph.placeholder_format </span><span style="color:#7F848E;font-style:italic;">#获取占位符的格式</span></span>
<span class="line"><span style="color:#56B6C2;">    print</span><span style="color:#ABB2BF;">(phf.idx) </span><span style="color:#7F848E;font-style:italic;">#打印其ID编号</span></span>
<span class="line"><span style="color:#ABB2BF;">    ph.text </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(phf.idx)</span><span style="color:#7F848E;font-style:italic;"># 将编号写入PPT对应的位置中，以便后面一一对应</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 以上读取到占位符的ID方便后面调用</span></span>
<span class="line"><span style="color:#ABB2BF;">prs.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data\\荣誉证书模板-占位符编号.pptx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> openpyxl </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> load_workbook</span></span>
<span class="line"><span style="color:#ABB2BF;">wb </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> load_workbook</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;data\\名单.xlsx&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">ws </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wb.active</span></span>
<span class="line"><span style="color:#ABB2BF;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{}</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,ws.max_row</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    class_id </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#98C379;">&#39;A&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value</span></span>
<span class="line"><span style="color:#ABB2BF;">    name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ws[</span><span style="color:#98C379;">&#39;B&#39;</span><span style="color:#56B6C2;"> +</span><span style="color:#56B6C2;"> str</span><span style="color:#ABB2BF;">(row)].value</span></span>
<span class="line"><span style="color:#ABB2BF;">    data.</span><span style="color:#61AFEF;">setdefault</span><span style="color:#ABB2BF;">(class_id,[])</span></span>
<span class="line"><span style="color:#ABB2BF;">    data[class_id].</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(name)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#ABB2BF;">t0</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span><span style="color:#7F848E;font-style:italic;"># 程序开始运行的时间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">prs </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Presentation</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data\\荣誉证书模板.pptx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">slide_layout </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> prs.slide_layouts[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#7F848E;font-style:italic;">#调用设置好的母版，因为是母版的第一版式，所以取[0]</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> class_id </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data:</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> name </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> data[class_id]:</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> prs.slides.</span><span style="color:#61AFEF;">add_slide</span><span style="color:#ABB2BF;">(slide_layout) </span><span style="color:#7F848E;font-style:italic;">#以母版的版式为基础新增一页幻灯片</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        #往幻灯片中写入内容</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide.placeholders[</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">].text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;"> 班 </span><span style="color:#D19A66;">{}</span><span style="color:#98C379;"> 同学：&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(class_id,name) </span><span style="color:#7F848E;font-style:italic;">#此处是班级和姓名</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide.placeholders[</span><span style="color:#D19A66;">11</span><span style="color:#ABB2BF;">].text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;在2023-2024学年度第一学期获得&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide.placeholders[</span><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">].text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;“好孩子”称号。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide.placeholders[</span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">].text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;特发此证，以资鼓励。&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide.placeholders[</span><span style="color:#D19A66;">14</span><span style="color:#ABB2BF;">].text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;市幼儿园&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        slide.placeholders[</span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;">].text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;2024年4月&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">prs.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;data\\荣誉证书(总).pptx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">t1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;程序用时：&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">round</span><span style="color:#ABB2BF;">(t1</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">t0))</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;秒。&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h4 id="_4-3-自动化流程" tabindex="-1">4.3 自动化流程 <a class="header-anchor" href="#_4-3-自动化流程" aria-label="Permalink to &quot;4.3 自动化流程&quot;">​</a></h4><ul><li><strong>一键运行</strong>：通过 pyinstaller 将整个项目代码打包成 EXE 软件，具体方法可以看我另一篇文章《<a href="http://mp.weixin.qq.com/s?__biz=Mzk0ODYxNzY5Nw==&amp;mid=2247484780&amp;idx=1&amp;sn=70c47650d878c801dc634e27400af975&amp;chksm=c365ade2f41224f4e49514b6f9edafa23478ed7367315861501b3a1821db5451174c78626373&amp;scene=21#wechat_redirect" target="_blank" rel="noreferrer">人人都能享受办公自动化的便利——三步将 Python 程序转为软件</a>》，老师只需点击运行按钮，程序便开始工作。</li><li><strong>快速生成</strong>：程序会迅速生成 399 份奖状，每份奖状的信息都是准确无误的。</li></ul><h3 id="_5-实际效果" tabindex="-1"><strong>5. 实际效果</strong> <a class="header-anchor" href="#_5-实际效果" aria-label="Permalink to &quot;**5. 实际效果**&quot;">​</a></h3><ul><li><strong>时间节省</strong>：从 25 小时缩短到 4 秒钟，效率提升了 22500 倍！</li><li><strong>零错误</strong>：自动化避免了手工填写可能出现的错误。</li><li><strong>易于调整</strong>：未来若要增加或修改奖状内容，只需调整模板和脚本即可。</li></ul><h3 id="_6-结语" tabindex="-1"><strong>6. 结语</strong> <a class="header-anchor" href="#_6-结语" aria-label="Permalink to &quot;**6. 结语**&quot;">​</a></h3><p>通过这个案例，我们可以看到 Python 在自动化办公领域的强大潜力。它不仅能帮助我们节省时间，提高效率，还能减少人为错误，提升工作质量。如果你也是一位教育工作者或对自动化办公感兴趣，不妨学习 Python，开启高效办公的新篇章！</p><p><strong>注：</strong> 文章中提供的 Python 代码和操作步骤需要根据实际情况进行调整和完善。此外，为了保护个人隐私，建议在处理任何个人信息时都要注意数据安全和隐私保护。</p><h2 id="自动校对" tabindex="-1">自动校对 <a class="header-anchor" href="#自动校对" aria-label="Permalink to &quot;自动校对&quot;">​</a></h2><p>无论你的语言能力有多好，当我们撰写长报告、文章或研究论文时，我们都会犯拼写错误。在这个AI时代，有许多伟大的Python包可以帮助解决这些愚蠢的拼写错误，并为你的作品提供精美的校对。</p><p>这个自动化脚本利用lmproof库来进行语法错误、拼写错误、词语混淆错误和其他错误的校对更正。</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>##安装库</span></span>
<span class="line"><span>#使用pip命令安装名为lmproof的库，这是一个用于文本校对的工具库。</span></span>
<span class="line"><span>!pip</span></span>
<span class="line"><span>install lmproof</span></span>
<span class="line"><span>##导入库</span></span>
<span class="line"><span>#导入安装的lmproof库，并重命名为lm，方便后续调用。</span></span>
<span class="line"><span>import</span></span>
<span class="line"><span>lmproof as lm</span></span>
<span class="line"><span>##定义校对函数</span></span>
<span class="line"><span>#定义一个名为Proofread的函数，它接受一个字符串参数text，用于校对文本中的语法错误。</span></span>
<span class="line"><span>def</span></span>
<span class="line"><span>Proofread(text):</span></span>
<span class="line"><span> # 加载英文的语法校对模型。</span></span>
<span class="line"><span> proof = lm.load(&quot;en&quot;)</span></span>
<span class="line"><span> # 使用加载的模型对输入的文本进行校对，并返回校对后无错误的文本。</span></span>
<span class="line"><span> error_free_text = proof.proofread(text)</span></span>
<span class="line"><span> return error_free_text</span></span>
<span class="line"><span>##示例文本</span></span>
<span class="line"><span>#定义一个包含语法错误的英文字符串TEXT。</span></span>
<span class="line"><span>TEXT</span></span>
<span class="line"><span>= &#39;The varialbe was initilized with an invald value, causing the progam to</span></span>
<span class="line"><span>throw a runtime erro.&#39;</span></span>
<span class="line"><span>##调用函数</span></span>
<span class="line"><span>#使用Python的打印功能Print（应为小写的print）来输出调用Proofread函数处理后的文本。</span></span>
<span class="line"><span>print(Proofread(TEXT))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>脚本应用—— • 改善聊天机器人、虚拟助手和客户支持系统的互动和回应。</p><h2 id="伪数据" tabindex="-1">伪数据 <a class="header-anchor" href="#伪数据" aria-label="Permalink to &quot;伪数据&quot;">​</a></h2><p>我不知道谁需要它或为什么需要它，但我发现这个自动化脚本在许多场景中非常有用。无论你是一名数据科学家寻找一些样本数据来测试你的模型，还是某人想要随机信息来填写不必要的表格。</p><p>这个Python自动化脚本将生成逼真但完全人工的数据集，非常适合测试、开发和模拟目的。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入所需的库</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">pandas </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> pd          </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入pandas库，用于数据处理和数据分析，通常简称为pd。</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">faker </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Faker      </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入Faker库，用于生成虚假数据。</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">random                </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入random库，用于生成随机数。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">创建一个Faker对象，用于生成各种虚假数据。</span></span>
<span class="line"><span style="color:#ABB2BF;">fake</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Faker</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义函数以生成虚假数据</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">generate_fake_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">num_entries</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 初始化一个空列表，用来存储每条生成的数据。</span></span>
<span class="line"><span style="color:#ABB2BF;"> data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 循环指定的次数，每次生成一条记录。</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> _ </span><span style="color:#C678DD;">in</span><span style="color:#56B6C2;"> range</span><span style="color:#ABB2BF;">(num_entries):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建一个字典，存储一条虚假数据记录。</span></span>
<span class="line"><span style="color:#ABB2BF;"> entry </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Name&quot;</span><span style="color:#ABB2BF;">: fake.</span><span style="color:#61AFEF;">name</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的全名。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Address&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">address</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的地址。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Email&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">email</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的电子邮箱地址。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Phone Number&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">phone_number</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的电话号码。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Date of Birth&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">date_of_birth</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">minimum_age</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">18</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">maximum_age</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">65</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">), </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的出生日期，年龄范围18至65岁。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Random Number&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">random.</span><span style="color:#61AFEF;">randint</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">),  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">生成一个1至100之间的随机数。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Job Title&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">job</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的职位名称。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Company&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">company</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成虚假的公司名称。</span></span>
<span class="line"><span style="color:#98C379;"> &quot;Lorem Ipsum Text&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">fake.</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">(),  </span><span style="color:#7F848E;font-style:italic;"># 生成一段虚假的文本。</span></span>
<span class="line"><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将生成的数据记录添加到列表中。</span></span>
<span class="line"><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(entry)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将列表转换成DataFrame对象，并返回。</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> pd.</span><span style="color:#61AFEF;">DataFrame</span><span style="color:#ABB2BF;">(data)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">主程序入口</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> num_entries </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 10</span><span style="color:#7F848E;font-style:italic;">  # 设置想要生成的虚假数据记录的数量。</span></span>
<span class="line"><span style="color:#ABB2BF;"> fake_data_df </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">generate_fake_data</span><span style="color:#ABB2BF;">(num_entries)  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">调用函数生成虚假数据。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">##</span></span>
<span class="line"><span style="color:#ABB2BF;">打印生成的DataFrame</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(fake_data_df)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>使用上述脚本生成的虚假数据 脚本应用——</p><p>• 数据库架构测试。</p><p>• 机器学习模型开发</p><p>• API测试</p><h2 id="notifo" tabindex="-1">Notifo <a class="header-anchor" href="#notifo" aria-label="Permalink to &quot;Notifo&quot;">​</a></h2><p>我总是在工作时忘记事情。为了克服健忘并提高我的生产力，我编写了这个Python自动化脚本Notifo。它充当我的数字记忆助手，在自定义时间框架后提醒我做事情，强迫我完成工作。这个脚本提高了我的生产力，帮助我在截止日期之前完成任务。最好的是，它简单、易于复制且非常有用。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入所需的库</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">win10toast </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ToastNotifier  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">从win10toast库导入ToastNotifier，用于显示Windows </span><span style="color:#FFFFFF;">10桌面通知</span><span style="color:#ABB2BF;">。</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">time  </span><span style="color:#7F848E;font-style:italic;"># 导入time库，用于处理时间相关功能。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">创建ToastNotifier对象，用于后续发送通知。</span></span>
<span class="line"><span style="color:#ABB2BF;">toaster</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> ToastNotifier</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义一个设置提醒的函数。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">set_reminder</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 通过input函数获取用户想要记住的事项的标题。</span></span>
<span class="line"><span style="color:#ABB2BF;"> reminder_header </span><span style="color:#56B6C2;">=</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;What would</span></span>
<span class="line"><span style="color:#ABB2BF;">you like me to remember</span><span style="color:#FFFFFF;">?</span><span style="color:#ABB2BF;">\\</span><span style="color:#FFFFFF;">n&quot;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取与提醒相关的详细信息。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> related_message</span><span style="color:#56B6C2;"> =</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Related</span></span>
<span class="line"><span style="color:#ABB2BF;">Message:\\</span><span style="color:#FFFFFF;">n&quot;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取用户希望多少分钟后收到提醒。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> time_minutes</span><span style="color:#56B6C2;"> =</span><span style="color:#56B6C2;"> float</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;In how</span></span>
<span class="line"><span style="color:#ABB2BF;">many minutes</span><span style="color:#FFFFFF;">?</span><span style="color:#ABB2BF;">\\</span><span style="color:#FFFFFF;">n&quot;))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将分钟转换为秒，因为time.sleep函数需要秒为单位。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> time_seconds</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> time_minutes </span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;"> 60</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 显示设置提醒的过程消息。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Setting up reminder...&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 延迟2秒模拟设置提醒过程。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;All set!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 延迟用户指定的时间，此处使用time.sleep阻塞当前线程，直到提醒时间到达。</span></span>
<span class="line"><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(time_seconds)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 发送桌面通知，显示提醒。</span></span>
<span class="line"><span style="color:#ABB2BF;"> toaster.</span><span style="color:#61AFEF;">show_toast</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">title</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">reminder_header</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;"># 提醒的标题。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">related_message</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;"># 提醒的详细信息。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> duration</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">,  </span><span style="color:#7F848E;font-style:italic;"># 通知显示的持续时间（秒）。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> threaded</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#7F848E;font-style:italic;">  # 使用线程来显示通知，这样不会阻塞程序的其他部分。</span></span>
<span class="line"><span style="color:#ABB2BF;"> )</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 循环检查通知是否还在活动状态，如果是，则短暂休眠0.005秒，避免占用太多CPU。</span></span>
<span class="line"><span style="color:#C678DD;"> while</span><span style="color:#ABB2BF;"> toaster.</span><span style="color:#61AFEF;">notification_active</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.005</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果这个脚本是作为主程序运行，而不是被导入到其他脚本中，那么执行set_reminder函数。</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;"> set_reminder</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>Notifo正在执行其职责……</p><p><img src="`+Fn+`" alt="image-20240516212224824"></p><p>这是通知，在35分钟后准时</p><p>你可以使用playsound包在Notifo提醒你某事时播放特定的声音。</p><h2 id="nato-加密" tabindex="-1">NATO 加密 <a class="header-anchor" href="#nato-加密" aria-label="Permalink to &quot;NATO 加密&quot;">​</a></h2><p>这个自动化脚本是我最喜欢的之一，我总是在发送一些私人信息或有时只是为了好玩而在我的电子邮件和消息中使用它。它利用加密和解密技术生成可以使用正确的密钥集解码的编码句子。它以消息为输入并返回编码后的消息作为输出。 我已将此脚本与streamlit集成在一个网络应用中，以获得更好的用户互动。你可以通过复制下面的代码来尝试一下！ 我相信你会喜欢它！</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入Streamlit库，用于快速构建Web应用。</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">streamlit </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> st</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">使用一个字典定义NATO音标字母表的加密规则。</span></span>
<span class="line"><span style="color:#ABB2BF;">nato_encoder</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;"> &#39;A&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Beta&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;B&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Gamma&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;C&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Cypher&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;D&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Epsilon&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;E&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Zeta&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;F&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Eta&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;G&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Theta&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;H&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">&#39;Iota&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;I&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Kappa&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;J&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Lambda&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;K&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Mu&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;L&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Nu&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;M&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Xi&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;N&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Omicron&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;O&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Pi&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;P&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">&#39;Rho&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;Q&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Sigma&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;R&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Tau&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;S&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Upsilon&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&#39;T&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Phi&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;U&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Chi&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;V&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Psi&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;W&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Omega&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;X&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#98C379;">&#39;Alpha&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;Y&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Delta&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Z&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Zen&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39; &#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Space&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义加密函数，输入是普通消息和NATO编码器。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">encrypt_message</span><span style="color:#ABB2BF;">(message, nato_encoder):</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_message </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> char </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> message:</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> char.</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> nato_encoder:  </span><span style="color:#7F848E;font-style:italic;"># 将字符转大写并检查是否在字典中。</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_message </span><span style="color:#56B6C2;">+=</span></span>
<span class="line"><span style="color:#ABB2BF;">nato_encoder[char.</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">()] </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39; &#39;</span><span style="color:#7F848E;font-style:italic;">  #</span></span>
<span class="line"><span style="color:#ABB2BF;">如果在，添加对应的加密词。</span></span>
<span class="line"><span style="color:#C678DD;"> elif</span><span style="color:#ABB2BF;"> char </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &#39; &#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_message </span><span style="color:#56B6C2;">+=</span></span>
<span class="line"><span style="color:#ABB2BF;">nato_encoder[char] </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39; &#39;</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> encrypted_message </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> char </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;</span></span>
<span class="line"><span style="color:#98C379;">&#39;  # 如果不在字典中，保持原样。</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> encrypted_message</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义解密函数，输入是加密消息和NATO编码器。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">decode_message</span><span style="color:#ABB2BF;">(encoded_message, nato_encoder):</span></span>
<span class="line"><span style="color:#ABB2BF;"> decoded_message </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;"> words </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> encoded_message.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 分割加密消息的每一个单词。</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> word </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> words:</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> key, value </span><span style="color:#C678DD;">in</span></span>
<span class="line"><span style="color:#ABB2BF;">nato_encoder.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">():  </span><span style="color:#7F848E;font-style:italic;"># 遍历字典，寻找匹配的加密词。</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> value </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> word:</span></span>
<span class="line"><span style="color:#ABB2BF;"> decoded_message </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> key  </span><span style="color:#7F848E;font-style:italic;"># 找到后，添加对应的字母。</span></span>
<span class="line"><span style="color:#C678DD;"> break</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> decoded_message </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> word  </span><span style="color:#7F848E;font-style:italic;"># 如果没有找到匹配项，保持原样。</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> decoded_message</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义主函数，用于启动Streamlit应用。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">title</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;NATO Phonetic Alphabet</span></span>
<span class="line"><span style="color:#ABB2BF;">Encoder</span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;">Decoder</span><span style="color:#98C379;">&quot;)  # 设置Web页面标题。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 创建两个标签页：编码和解码。</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> tab_choice</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> st.sidebar.</span><span style="color:#61AFEF;">radio</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Select</span></span>
<span class="line"><span style="color:#ABB2BF;">Tab:</span><span style="color:#98C379;">&quot;, [&quot;</span><span style="color:#ABB2BF;">Encode</span><span style="color:#98C379;">&quot;, &quot;</span><span style="color:#ABB2BF;">Decode</span><span style="color:#98C379;">&quot;])</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> tab_choice </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;Encode&quot;</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 编码标签页。</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">header</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Encode Message&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> message_to_encode</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">text_input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Enter the message to encode:&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">button</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Encode&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> encoded_message</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#61AFEF;">encrypt_message</span><span style="color:#ABB2BF;">(message_to_encode, nato_encoder)</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">success</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">encoded_message</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 显示加密后的消息。</span></span>
<span class="line"><span style="color:#C678DD;"> elif</span><span style="color:#ABB2BF;"> tab_choice </span><span style="color:#56B6C2;">==</span><span style="color:#98C379;"> &quot;Decode&quot;</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 解码标签页。</span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">header</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Decode Message&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> message_to_decode</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">text_input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Enter the message to decode:&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">button</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Decode&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> decoded_message</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#61AFEF;">decode_message</span><span style="color:#ABB2BF;">(message_to_decode, nato_encoder)</span></span>
<span class="line"><span style="color:#ABB2BF;">st.</span><span style="color:#61AFEF;">success</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">decoded_message</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 显示解密后的原始消息。</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;"> st.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Creator:: Abhay Parashar</span></span>
<span class="line"><span style="color:#56B6C2;">@</span><span style="color:#ABB2BF;">abhayparashar31 </span><span style="color:#98C379;">&#39;)  # 显示创建者信息。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果这个文件作为主程序运行，执行main函数。</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><p>解码消息 脚本应用——</p><p>• 构建自定义加密/解密算法</p><h2 id="briefit" tabindex="-1">Briefit <a class="header-anchor" href="#briefit" aria-label="Permalink to &quot;Briefit&quot;">​</a></h2><p>我喜欢每天阅读文章、研究论文和不同的新闻出版物。我相信许多找到这个脚本的人有类似的习惯。有时由于时间不足，阅读整篇文章变得困难。 这个自动化脚本使用神经网络生成文章摘要。它利用网络抓取来抓取文章内容，然后将它们输入预训练的模型，该模型输出一个摘要。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入所需库</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">transformers </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> BartForConditionalGeneration, BartTokenizer  </span><span style="color:#7F848E;font-style:italic;"># 导入BART模型和其对应的分词器。</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">requests  </span><span style="color:#7F848E;font-style:italic;"># 导入requests库，用于处理HTTP请求。</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">bs4 </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> BeautifulSoup  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入BeautifulSoup库，用于网页解析。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义一个函数，用于对文章文本进行摘要</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">summarize_article</span><span style="color:#ABB2BF;">(article_text, </span><span style="color:#E06C75;font-style:italic;">max_length</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">150</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;"> model_name </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#98C379;">&quot;facebook/bart-large-cnn&quot;</span><span style="color:#7F848E;font-style:italic;">  #</span></span>
<span class="line"><span style="color:#ABB2BF;">指定模型名，这里使用的是预训练的BART模型。</span></span>
<span class="line"><span style="color:#ABB2BF;"> tokenizer </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">BartTokenizer.</span><span style="color:#61AFEF;">from_pretrained</span><span style="color:#ABB2BF;">(model_name) </span><span style="color:#7F848E;font-style:italic;"># 从预训练模型加载分词器。</span></span>
<span class="line"><span style="color:#ABB2BF;"> model </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">BartForConditionalGeneration.</span><span style="color:#61AFEF;">from_pretrained</span><span style="color:#ABB2BF;">(model_name)  </span><span style="color:#7F848E;font-style:italic;"># 从预训练模型加载BART模型。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用分词器处理输入的文章文本，准备模型输入数据。</span></span>
<span class="line"><span style="color:#ABB2BF;"> inputs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tokenizer.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;summarize:</span></span>
<span class="line"><span style="color:#98C379;">&quot; + article_text, return_tensors=&quot;</span><span style="color:#ABB2BF;">pt</span><span style="color:#98C379;">&quot;, max_length=1024,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">truncation</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用模型生成摘要，设置摘要的最大长度和最小长度等参数。</span></span>
<span class="line"><span style="color:#ABB2BF;"> summary_ids </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> model.</span><span style="color:#61AFEF;">generate</span><span style="color:#ABB2BF;">(inputs,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">max_length</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">max_length, </span><span style="color:#E06C75;font-style:italic;">min_length</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">length_penalty</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2.0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">num_beams</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">early_stopping</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将生成的摘要ID转换为文本。</span></span>
<span class="line"><span style="color:#ABB2BF;"> summary </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tokenizer.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(summary_ids[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">skip_special_tokens</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> summary</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义一个函数，用于从给定的URL抓取网页内容。</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">scrape_webpage</span><span style="color:#ABB2BF;">(url):</span></span>
<span class="line"><span style="color:#C678DD;"> try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(url)  </span><span style="color:#7F848E;font-style:italic;"># 向指定的URL发送GET请求。</span></span>
<span class="line"><span style="color:#ABB2BF;"> response.</span><span style="color:#61AFEF;">raise_for_status</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 检查响应状态，如果不是200，则抛出异常。</span></span>
<span class="line"><span style="color:#ABB2BF;"> soup </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> BeautifulSoup</span><span style="color:#ABB2BF;">(response.text,</span></span>
<span class="line"><span style="color:#98C379;">&#39;html.parser&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">使用BeautifulSoup解析响应的HTML内容。</span></span>
<span class="line"><span style="color:#ABB2BF;"> all_text </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">soup.</span><span style="color:#61AFEF;">get_text</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">separator</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">strip</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;"># 获取网页的所有文本内容，并以换行符分隔。</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> all_text</span></span>
<span class="line"><span style="color:#C678DD;"> except</span><span style="color:#ABB2BF;"> requests.exceptions.RequestException</span></span>
<span class="line"><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:  </span><span style="color:#7F848E;font-style:italic;"># 捕获并处理可能的请求异常。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Error: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果这段代码作为主脚本运行</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;"> webpage_url </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;https://www.scmagazine.com/brief/info-crypto-stealing-python-packages-proliferate&quot;</span><span style="color:#7F848E;font-style:italic;">  # 定义一个用于测试的网页URL。</span></span>
<span class="line"><span style="color:#ABB2BF;"> webpage_text </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">scrape_webpage</span><span style="color:#ABB2BF;">(webpage_url)  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">调用上面定义的函数抓取网页内容。</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> webpage_text:</span></span>
<span class="line"><span style="color:#ABB2BF;"> summary </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">summarize_article</span><span style="color:#ABB2BF;">(webpage_text)  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果成功获取到网页文本，则对其进行摘要。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">Summarized</span></span>
<span class="line"><span style="color:#ABB2BF;">Article:</span><span style="color:#98C379;">&quot;)  # 打印摘要的标题。</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(summary)  </span><span style="color:#7F848E;font-style:italic;"># 打印摘要内容。</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Webpage scraping</span></span>
<span class="line"><span style="color:#ABB2BF;">failed.</span><span style="color:#98C379;">&quot;)  # 如果抓取网页失败，则输出错误消息。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h2 id="_6-image-exif" tabindex="-1">6. Image Exif <a class="header-anchor" href="#_6-image-exif" aria-label="Permalink to &quot;6. Image Exif&quot;">​</a></h2><p>Exif（可交换图像文件格式）是一种标准，规定了数字相机（包括智能手机）、扫描仪和其他处理由数字相机记录的图像和声音文件的系统使用的图像、声音和附属标签的格式。 Exif数据嵌入在图像文件本身中，包含元数据信息，如相机设置、日期和时间、地理位置、方向、软件信息、模型等。 如果你是一个喜欢在不同社交媒体平台上通过图像分享你的回忆的人，这个脚本适合你。 这个自动化脚本获取图像路径，提取图像中的所有Exif详细信息，然后完全删除它们以保护你的隐私。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入Pillow库中的Image模块和JpegImagePlugin（虽然未直接使用JpegImagePlugin）</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#D19A66;">PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入ExifTags模块，用于解释图像文件中的EXIF数据</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#D19A66;">PIL</span><span style="color:#ABB2BF;">.ExifTags </span><span style="color:#C678DD;">import</span><span style="color:#D19A66;"> TAGS</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义函数，用于提取图像的EXIF数据</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">fetch_exif</span><span style="color:#ABB2BF;">(image_path):</span></span>
<span class="line"><span style="color:#C678DD;"> try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 打开图像文件</span></span>
<span class="line"><span style="color:#ABB2BF;"> image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(image_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取图像的EXIF信息</span></span>
<span class="line"><span style="color:#ABB2BF;"> exif_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> image.</span><span style="color:#61AFEF;">_getexif</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> exif_data </span><span style="color:#C678DD;">is</span><span style="color:#C678DD;"> not</span><span style="color:#D19A66;"> None</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 如果EXIF信息存在，将其转换为易读的字典格式</span></span>
<span class="line"><span style="color:#ABB2BF;"> exif_dict </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#D19A66;">TAGS</span><span style="color:#ABB2BF;">[key]:</span></span>
<span class="line"><span style="color:#ABB2BF;">exif_data[key] </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> key </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> exif_data.</span><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> key </span><span style="color:#C678DD;">in</span><span style="color:#D19A66;"> TAGS</span><span style="color:#C678DD;"> and</span></span>
<span class="line"><span style="color:#56B6C2;">isinstance</span><span style="color:#ABB2BF;">(exif_data[key], (</span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">))}</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> exif_dict</span></span>
<span class="line"><span style="color:#C678DD;"> else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;No EXIF data found in</span></span>
<span class="line"><span style="color:#ABB2BF;">the image.</span><span style="color:#98C379;">&quot;)</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#C678DD;"> except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Error fetching EXIF data:</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#D19A66;"> None</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义函数，用于删除图像的EXIF数据</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">remove_exif</span><span style="color:#ABB2BF;">(image_path, output_path):</span></span>
<span class="line"><span style="color:#C678DD;"> try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 打开图像文件</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> image</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(image_path)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 保存图像到指定路径，删除所有EXIF信息</span></span>
<span class="line"><span style="color:#ABB2BF;"> image.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(output_path,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">exif</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;EXIF data removed and</span></span>
<span class="line"><span style="color:#98C379;">saved to </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">output_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;"> except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Error removing EXIF data:</span></span>
<span class="line"><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果这个脚本作为主程序运行</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取用户输入的图像路径</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> image_path</span><span style="color:#56B6C2;"> =</span><span style="color:#56B6C2;"> input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Paste your Image path :</span></span>
<span class="line"><span style="color:#98C379;">&#39;)</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 调用函数提取EXIF数据</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> exif_data</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> fetch_exif</span><span style="color:#ABB2BF;">(image_path)</span></span>
<span class="line"><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> exif_data:</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;EXIF Data:&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 打印出EXIF数据中的每个键值对</span></span>
<span class="line"><span style="color:#C678DD;"> for</span><span style="color:#ABB2BF;"> key, value </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> exif_data.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">key</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">value</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 调用函数删除EXIF数据，并保存新图像</span></span>
<span class="line"><span style="color:#61AFEF;"> remove_exif</span><span style="color:#ABB2BF;">(image_path,</span></span>
<span class="line"><span style="color:#ABB2BF;">image_path</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;_noexif.png&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h2 id="removebg" tabindex="-1">RemoveBG <a class="header-anchor" href="#removebg" aria-label="Permalink to &quot;RemoveBG&quot;">​</a></h2><p>这个自动化脚本是我日常工具包的一部分。作为一名作家，我一直在处理图像，而且大多数时间我需要没有背景的图像。 有许多在线工具和软件可用于去除图片的背景，但我对它们感到不信任，因为我不确定我的图片在提供结果之前在互联网上旅行到了哪里。</p><p>这个自动化脚本使用rembg python包在本地删除图像的背景。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入rembg库的remove函数，用于背景去除</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">rembg </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> remove</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入Pillow库的Image模块，用于图像操作</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#D19A66;">PIL</span><span style="color:#C678DD;"> import</span><span style="color:#ABB2BF;"> Image</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">##</span></span>
<span class="line"><span style="color:#ABB2BF;">定义输入和输出图像的路径</span></span>
<span class="line"><span style="color:#ABB2BF;">input_img</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;monkey.jpg&#39;</span><span style="color:#7F848E;font-style:italic;">  # 输入图像文件的路径</span></span>
<span class="line"><span style="color:#ABB2BF;">output_img</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;monkey_rmbg.png&#39;</span><span style="color:#7F848E;font-style:italic;">  # 输出（处理后）图像文件的路径</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">##</span></span>
<span class="line"><span style="color:#ABB2BF;">加载和移除背景</span></span>
<span class="line"><span style="color:#ABB2BF;">inp</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Image.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(input_img)  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">使用Pillow的Image.open方法打开图像文件</span></span>
<span class="line"><span style="color:#ABB2BF;">output</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> remove</span><span style="color:#ABB2BF;">(inp)  </span><span style="color:#7F848E;font-style:italic;"># 使用rembg的remove函数移除图像的背景</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">##</span></span>
<span class="line"><span style="color:#ABB2BF;">保存去背景后的图像到输入图像相同的位置</span></span>
<span class="line"><span style="color:#ABB2BF;">output.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(output_img)  </span><span style="color:#7F848E;font-style:italic;"># 使用Pillow的save方法保存处理后的图像</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="filtertext" tabindex="-1">FilterText <a class="header-anchor" href="#filtertext" aria-label="Permalink to &quot;FilterText&quot;">​</a></h2><p>Python提供了过滤大量文本数据并从中提取有用信息的最简单方法之一。Python内置的re模块可以帮助你使用Python编写正则表达式，你可以创建不同的模式，并根据这些模式进行匹配，这使得文本过滤变得更加容易。这个自动化脚本是不同文本过滤器的集合，包括电子邮件地址、HTML标签和网页链接。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入正则表达式模块</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">re</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义一个函数来过滤文本</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">filter_text</span><span style="color:#ABB2BF;">(text):</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用正则表达式查找文本中的电子邮件地址</span></span>
<span class="line"><span style="color:#ABB2BF;"> emails </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">re.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;\\b</span><span style="color:#D19A66;">[A-Za-z0-9._%+-]+</span><span style="color:#E06C75;">@</span><span style="color:#D19A66;">[A-Za-z0-9.-]+</span><span style="color:#56B6C2;">\\.</span><span style="color:#D19A66;">[A-Z|a-z]{2,}</span><span style="color:#E06C75;">\\b&#39;</span><span style="color:#ABB2BF;">, text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用正则表达式查找文本中的Twitter提及（如：@username）</span></span>
<span class="line"><span style="color:#ABB2BF;"> mentions </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;@\\w</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">, text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用正则表达式查找文本中的话题标签（如：#hashtag）</span></span>
<span class="line"><span style="color:#ABB2BF;"> hashtags </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;#\\w</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">, text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用正则表达式查找文本中的HTTP或HTTPS链接</span></span>
<span class="line"><span style="color:#ABB2BF;"> links </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">re.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;http</span><span style="color:#D19A66;">[s]?</span><span style="color:#E06C75;">://</span><span style="color:#D19A66;">(?:[a-zA-Z]</span><span style="color:#ABB2BF;">|</span><span style="color:#D19A66;">[0-9]</span><span style="color:#ABB2BF;">|</span><span style="color:#D19A66;">[$-_@.&amp;+]</span><span style="color:#ABB2BF;">|</span><span style="color:#D19A66;">[!*</span><span style="color:#56B6C2;">\\\\</span><span style="color:#D19A66;">(</span><span style="color:#56B6C2;">\\\\</span><span style="color:#D19A66;">),]</span><span style="color:#ABB2BF;">|</span><span style="color:#D19A66;">(?:</span><span style="color:#E06C75;">%</span><span style="color:#D19A66;">[0-9a-fA-F][0-9a-fA-F]))+</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 使用正则表达式查找文本中的HTML标签</span></span>
<span class="line"><span style="color:#ABB2BF;"> html_tags </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> re.</span><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;&lt;</span><span style="color:#D19A66;">[</span><span style="color:#ABB2BF;">^</span><span style="color:#D19A66;">&gt;]+</span><span style="color:#E06C75;">&gt;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 将找到的所有信息打包成一个字典返回</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#98C379;"> &#39;emails&#39;</span><span style="color:#ABB2BF;">: emails,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;mentions&#39;</span><span style="color:#ABB2BF;">: mentions,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;hashtags&#39;</span><span style="color:#ABB2BF;">: hashtags,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;links&#39;</span><span style="color:#ABB2BF;">: links,</span></span>
<span class="line"><span style="color:#98C379;"> &#39;html_tags&#39;</span><span style="color:#ABB2BF;">: html_tags,</span></span>
<span class="line"><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果这个脚本作为主程序运行</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 示例文本，包含HTML标签</span></span>
<span class="line"><span style="color:#ABB2BF;"> example_text </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;"> For more information, contact &lt;a</span></span>
<span class="line"><span style="color:#98C379;">href=&quot;support@example.com&quot;&gt;support@example.com&lt;/a&gt;.</span></span>
<span class="line"><span style="color:#98C379;"> Follow us on Twitter: @example_user. Visit</span></span>
<span class="line"><span style="color:#98C379;">our website: https://www.example.com</span></span>
<span class="line"><span style="color:#98C379;"> Join the conversation with</span></span>
<span class="line"><span style="color:#98C379;">#PythonProgramming.</span></span>
<span class="line"><span style="color:#98C379;"> Connect with John Doe at</span></span>
<span class="line"><span style="color:#98C379;">john.doe@example.com.</span></span>
<span class="line"><span style="color:#98C379;"> I love using Python for &lt;b&gt;natural</span></span>
<span class="line"><span style="color:#98C379;">language processing&lt;/b&gt; and sentiment analysis!</span></span>
<span class="line"><span style="color:#98C379;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 调用filter_text函数，过滤示例文本</span></span>
<span class="line"><span style="color:#ABB2BF;"> filtered_info </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> filter_text</span><span style="color:#ABB2BF;">(example_text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 打印过滤出的各类信息</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Emails:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">filtered_info[</span><span style="color:#98C379;">&#39;emails&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Mentions:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">filtered_info[</span><span style="color:#98C379;">&#39;mentions&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Hashtags:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">filtered_info[</span><span style="color:#98C379;">&#39;hashtags&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Links:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">filtered_info[</span><span style="color:#98C379;">&#39;links&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;HTML Tags:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">filtered_info[</span><span style="color:#98C379;">&#39;html_tags&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p><img src="`+An+`" alt="image-20240516212431669"></p><h2 id="emailheaders" tabindex="-1">EmailHeaders <a class="header-anchor" href="#emailheaders" aria-label="Permalink to &quot;EmailHeaders&quot;">​</a></h2><p>电子邮件头是电子邮件消息的元数据组成部分，提供有关消息起源、传输和内容的关键信息。默认情况下，电子邮件收件人看不到它们，但可以使用电子邮件客户端功能或工具查看。电子邮件头由各种字段组成，每个字段都有特定的用途。 电子邮件头在确保电子邮件系统正常运行、验证消息并提供有关电子邮件起源的透明度方面发挥着关键作用。它们有助于防止垃圾邮件，验证发件人的身份，并协助解决电子邮件传递问题。 如果你还没有看过电子邮件头是什么样的，相信我，它们一点也不可读且不友好。</p><p>这个自动化脚本检测并提取电子邮件头的重要部分，可以用来识别电子邮件是否被篡改、退回或包含恶意内容。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入相关库</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">email</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">quopri</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">email </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> policy</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">email.parser </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> BytesParser  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">使用BytesParser来解析二进制文件。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义函数解析电子邮件</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">parse_email</span><span style="color:#ABB2BF;">(file_path):</span></span>
<span class="line"><span style="color:#C678DD;"> with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#E06C75;"> file</span><span style="color:#ABB2BF;">:  </span><span style="color:#7F848E;font-style:italic;"># 以二进制读取模式打开文件</span></span>
<span class="line"><span style="color:#ABB2BF;"> msg </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#61AFEF;">BytesParser</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">policy</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">policy.default).</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;"># 解析邮件内容</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 打印基本的邮件头部信息</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;From:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;From&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 发送者信息</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;To:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;To&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 接收者信息</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Subject:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Subject&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 邮件主题</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Date:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Date&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 邮件发送日期</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Message ID:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Message-ID&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 邮件唯一标识</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;X-Mailer:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;X-Mailer&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 使用的邮件客户端</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 打印更多的邮件头部信息</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">--- Additional Information</span></span>
<span class="line"><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">\\</span><span style="color:#FFFFFF;">n&quot;)</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;SPF:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Received-SPF&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># SPF验证信息</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;DKIM:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;DKIM-Signature&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># DKIM签名</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;DMARC:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;DMARC-Filter&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># DMARC策略</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;SENDERIP:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;X-Sender-IP&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 发送者IP</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;RETURN PATH:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Return-Path&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 回复路径</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Reply-To:&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Reply-To&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;N/A&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 回复到哪个地址</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Authentication Results:</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Authentication-Results&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;N/A&#39;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;"># 验证结果</span></span>
<span class="line"><span style="color:#56B6C2;"> print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Message ID&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">msg.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Message-Id&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;N/A&#39;</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 邮件ID（重复）</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 如果需要，可以取消注释下面的代码来打印完整的邮件头部信息</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> #print(&#39;\\n\\n\\n\\n&#39;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> #print(&quot;\\n--- Email Headers</span></span>
<span class="line"><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">\\</span><span style="color:#FFFFFF;">n&quot;)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> #print(msg.as_string())  # 打印完整的邮件头部信息</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">主函数</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;"> email_file_path</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">&quot;/content/Congrat!!.eml&quot;</span><span style="color:#7F848E;font-style:italic;">  #</span></span>
<span class="line"><span style="color:#ABB2BF;">指定电子邮件文件的路径</span></span>
<span class="line"><span style="color:#61AFEF;"> parse_email</span><span style="color:#ABB2BF;">(email_file_path)  </span><span style="color:#7F848E;font-style:italic;"># 调用解析函数</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">如果这段脚本作为主程序执行</span></span>
<span class="line"><span style="color:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h2 id="trendystocks" tabindex="-1">TrendyStocks <a class="header-anchor" href="#trendystocks" aria-label="Permalink to &quot;TrendyStocks&quot;">​</a></h2><p>有句话说——“看得见的东西才能卖出去” 在股市中，感知是一种强大的影响力。明智的投资者不仅关注数字，还关注塑造市场格局的叙述、新闻和文章。 人们越多地谈论一只股票，通常会有更多关于它的文章发布，这意味着它出于好的理由或坏的理由而成为热门话题。了解哪些股票正在流行可以帮助做出更好的买卖决策。这个自动化脚本使用Google Trends为指定的股票生成图表。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">导入必要的库</span></span>
<span class="line"><span style="color:#C678DD;">from</span></span>
<span class="line"><span style="color:#ABB2BF;">pytrends.request </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> TrendReq  </span><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">用于请求Google Trends数据</span></span>
<span class="line"><span style="color:#C678DD;">import</span></span>
<span class="line"><span style="color:#ABB2BF;">matplotlib.pyplot </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> plt  </span><span style="color:#7F848E;font-style:italic;"># 用于绘图</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">定义一个函数来获取Google Trends数据</span></span>
<span class="line"><span style="color:#C678DD;">def</span></span>
<span class="line"><span style="color:#61AFEF;">get_google_trends_data</span><span style="color:#ABB2BF;">(keywords, </span><span style="color:#E06C75;font-style:italic;">timeframe</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;today 3-m&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">geo</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;US&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;"> pytrends </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> TrendReq</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">hl</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;en-US&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">tz</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">360</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 创建TrendReq对象，设置语言和时区</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 构建查询的载荷，设置关键词、时间范围和地区等参数</span></span>
<span class="line"><span style="color:#ABB2BF;"> pytrends.</span><span style="color:#61AFEF;">build_payload</span><span style="color:#ABB2BF;">(keywords, </span><span style="color:#E06C75;font-style:italic;">cat</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic;">timeframe</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">timeframe, </span><span style="color:#E06C75;font-style:italic;">geo</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">geo, </span><span style="color:#E06C75;font-style:italic;">gprop</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 获取兴趣随时间的变化数据</span></span>
<span class="line"><span style="color:#ABB2BF;"> interest_over_time_df </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">pytrends.</span><span style="color:#61AFEF;">interest_over_time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;"> return</span><span style="color:#ABB2BF;"> interest_over_time_df  </span><span style="color:#7F848E;font-style:italic;"># 返回得到的数据框(DataFrame)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">示例关键词，这里用了几个大公司的股票代码</span></span>
<span class="line"><span style="color:#D19A66;">STOCKS</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;AMZN&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;MSFT&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;NVDA&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;AAPL&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">&quot;GOOG&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">获取Google Trends数据</span></span>
<span class="line"><span style="color:#ABB2BF;">trends_data</span></span>
<span class="line"><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> get_google_trends_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">STOCKS</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#</span></span>
<span class="line"><span style="color:#ABB2BF;">绘制数据</span></span>
<span class="line"><span style="color:#ABB2BF;">plt.</span><span style="color:#61AFEF;">figure</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">figsize</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">12</span><span style="color:#ABB2BF;">))  </span><span style="color:#7F848E;font-style:italic;"># 设置图形的大小</span></span>
<span class="line"><span style="color:#ABB2BF;">trends_data.</span><span style="color:#61AFEF;">plot</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">title</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;Google</span></span>
<span class="line"><span style="color:#ABB2BF;">Trends </span><span style="color:#C678DD;">for</span><span style="color:#D19A66;"> STOCKS</span><span style="color:#98C379;">&#39;)  # 绘制趋势数据</span></span>
<span class="line"><span style="color:#ABB2BF;">plt.</span><span style="color:#61AFEF;">xlabel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Date&#39;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 设置x轴标签</span></span>
<span class="line"><span style="color:#ABB2BF;">plt.</span><span style="color:#61AFEF;">ylabel</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Interest</span></span>
<span class="line"><span style="color:#ABB2BF;">Over Time</span><span style="color:#98C379;">&#39;)  # 设置y轴标签</span></span>
<span class="line"><span style="color:#ABB2BF;">plt.</span><span style="color:#61AFEF;">show</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 显示图形</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p><img src="`+bn+`" alt="image-20240516212538600"></p><h1 id="python-定时任务-8-种实现方式" tabindex="-1">Python 定时任务 8 种实现方式 <a class="header-anchor" href="#python-定时任务-8-种实现方式" aria-label="Permalink to &quot;Python 定时任务 8 种实现方式&quot;">​</a></h1><h2 id="_1、thread-定时执行-🔄" tabindex="-1">1、Thread 定时执行 🔄 <a class="header-anchor" href="#_1、thread-定时执行-🔄" aria-label="Permalink to &quot;1、Thread 定时执行 🔄&quot;">​</a></h2><p>在 Python 中，利用标准库<code>threading</code>中的<code>Timer</code>类可以轻松创建定时任务，这对于需要在后台独立于主线程运行的任务特别有用。下面详细介绍如何使用<code>threading.Timer</code>来实现定时任务 ，并探讨定时任务的管理与取消策略。</p><h3 id="_1-1-使用-threading-timer-实现" tabindex="-1">1.1 使用 <code>threading.Timer</code> 实现 <a class="header-anchor" href="#_1-1-使用-threading-timer-实现" aria-label="Permalink to &quot;1.1 使用 \`threading.Timer\` 实现&quot;">​</a></h3><p><code>threading.Timer</code>类允许你安排一个函数在指定时间后执行。它通过创建一个新的线程来实现 ，使得定时任务不会阻塞程序的其他部分。下面是一个简单的示例 ，展示如何使用<code>Timer</code>每隔 5 秒打印一条消息：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>import threading</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def hello():</span></span>
<span class="line"><span>    print(&quot;Hello, this is a timed message!&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 创建定时器 ，5秒后执行hello函数</span></span>
<span class="line"><span>t = threading.Timer(5.0, hello)</span></span>
<span class="line"><span>t.start()  # 开始计时</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>输出结果：</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>Hello, this is a timed message!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_1-2-定时任务管理与取消策略" tabindex="-1">1.2 定时任务管理与取消策略 <a class="header-anchor" href="#_1-2-定时任务管理与取消策略" aria-label="Permalink to &quot;1.2 定时任务管理与取消策略&quot;">​</a></h3><p>在实际应用中，可能需要根据条件动态管理定时任务，比如取消尚未执行的任务。<code>threading.Timer</code>对象提供了<code>cancel()</code>方法来取消尚未启动的任务：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># 继续使用上面的hello函数为例</span></span>
<span class="line"><span>t = threading.Timer(10.0, hello)  # 改为10秒后执行</span></span>
<span class="line"><span>t.start()</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 假设在5秒后决定取消这个定时任务</span></span>
<span class="line"><span>import time</span></span>
<span class="line"><span>time.sleep(5)</span></span>
<span class="line"><span>if t.is_alive():  # 检查定时器是否还在运行</span></span>
<span class="line"><span>    t.cancel()</span></span>
<span class="line"><span>    print(&quot;The timer has been cancelled.&quot;)</span></span>
<span class="line"><span>else:</span></span>
<span class="line"><span>    print(&quot;The timer has already executed.&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>输出结果（如果在 5 秒内取消了定时器）：</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>The timer has been cancelled.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>通过这种方式，你可以灵活地控制定时任务的执行，确保程序能够响应外部条件的变化，提高程序的灵活性和效率。在设计复杂的定时任务系统时 ，考虑使用更高级的调度库或框架可能会更加合适，但<code>threading.Timer</code>对于简单需求而言已经足够高效且易于使用。</p><h2 id="_2、schedule-库自动化-🗓️" tabindex="-1">2、Schedule 库自动化 🗓️ <a class="header-anchor" href="#_2、schedule-库自动化-🗓️" aria-label="Permalink to &quot;2、Schedule 库自动化 🗓️&quot;">​</a></h2><h3 id="_2-1-安装与基本用法" tabindex="-1">2.1 安装与基本用法 <a class="header-anchor" href="#_2-1-安装与基本用法" aria-label="Permalink to &quot;2.1 安装与基本用法&quot;">​</a></h3><p><code>schedule</code>库是一个轻量级的 Python 定时任务库，它允许你以简洁的方式安排函数定期执行。首先，你需要通过 pip 安装该库：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install schedule</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装完成后 ，你可以开始编写定时任务。以下是一个简单的例子，展示了如何每 10 秒钟打印一次“Hello, Schedule!”：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>import schedule</span></span>
<span class="line"><span>import time</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def job():</span></span>
<span class="line"><span>    print(&quot;Hello, Schedule!&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 每隔10秒执行一次job函数</span></span>
<span class="line"><span>schedule.every(10).seconds.do(job)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>while True:</span></span>
<span class="line"><span>    schedule.run_pending()</span></span>
<span class="line"><span>    time.sleep(1)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这段代码会持续运行，每 10 秒输出一次指定的信息 ，直到手动中断。</p><h3 id="_2-2-高级功能-重复任务与异常处理" tabindex="-1">2.2 高级功能：重复任务与异常处理 <a class="header-anchor" href="#_2-2-高级功能-重复任务与异常处理" aria-label="Permalink to &quot;2.2 高级功能：重复任务与异常处理&quot;">​</a></h3><p><strong>重复任务</strong></p><p><code>schedule</code>库支持灵活的时间间隔设置，除了基本的秒、分钟、小时等单位外 ，还可以设定特定日期和时间执行任务，或者按周、月重复执行。</p><ul><li><strong>每日特定时间执行：</strong></li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>schedule.every().day.at(&quot;10:30&quot;).do(job)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><strong>每周一早上 9 点执行：</strong></li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>schedule.every().monday.at(&quot;09:00&quot;).do(job)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>异常处理</strong></p><p>在长时间运行的定时任务中 ，异常处理至关重要。可以通过 try-except 结构来捕获并适当处理任务执行过程中可能出现的错误 ，确保定时任务框架的稳定运行。例如：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>import schedule</span></span>
<span class="line"><span>import time</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def safe_job():</span></span>
<span class="line"><span>    try:</span></span>
<span class="line"><span>        # 假设这是可能会抛出异常的代码</span></span>
<span class="line"><span>        ...</span></span>
<span class="line"><span>    except Exception as e:</span></span>
<span class="line"><span>        print(f&quot;An error occurred: {e}&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>schedule.every(5).seconds.do(safe_job)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>while True:</span></span>
<span class="line"><span>    schedule.run_pending()</span></span>
<span class="line"><span>    time.sleep(1)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在这个示例中，即使<code>safe_job</code>内部的代码发生异常 ，程序也不会直接崩溃 ，而是会捕获异常并打印错误信息 ，然后继续等待下一个执行周期。</p><p>通过上述介绍，可以看到<code>schedule</code>库凭借其简洁的 API 设计，成为了处理定时任务的一个强大工具 ，无论是简单的重复任务还是需要复杂时间安排的任务，都能轻松应对。</p><h2 id="_3、apscheduler-框架-🔔" tabindex="-1">3、APScheduler 框架 🔔 <a class="header-anchor" href="#_3、apscheduler-框架-🔔" aria-label="Permalink to &quot;3、APScheduler 框架 🔔&quot;">​</a></h2><h3 id="_3-1-功能强大的定时任务库" tabindex="-1">3.1 功能强大的定时任务库 <a class="header-anchor" href="#_3-1-功能强大的定时任务库" aria-label="Permalink to &quot;3.1 功能强大的定时任务库&quot;">​</a></h3><p><code>APScheduler</code>（Advanced Python Scheduler）是一个功能全面且高度可定制的定时任务库，适用于 Python 3.5 及更高版本。它支持 cron 风格的时间表达式、日期时间以及固定间隔等多种触发方式，同时具备持久化任务、错误处理、任务存储插件等高级特性，非常适合构建复杂且健壮的定时任务系统。</p><p>要开始使用<code>APScheduler</code>，首先需要通过 pip 安装：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install apscheduler</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>接着，可以快速上手一个简单的定时任务示例：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from apscheduler.schedulers.blocking import BlockingScheduler</span></span>
<span class="line"><span>import datetime</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def my_job():</span></span>
<span class="line"><span>    print(&quot;Job executed at &quot; + str(datetime.datetime.now()))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>scheduler = BlockingScheduler()</span></span>
<span class="line"><span>scheduler.add_job(my_job, &#39;interval&#39;, seconds=5)</span></span>
<span class="line"><span>scheduler.start()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这段代码会每隔 5 秒执行一次<code>my_job</code>函数，打印当前时间。</p><h3 id="_3-2-不同类型的触发器介绍" tabindex="-1">3.2 不同类型的触发器介绍 <a class="header-anchor" href="#_3-2-不同类型的触发器介绍" aria-label="Permalink to &quot;3.2 不同类型的触发器介绍&quot;">​</a></h3><p><code>APScheduler</code>提供了多种触发器来适应不同场景的需求：</p><ul><li><strong>IntervalTrigger</strong>：用于在固定时间间隔后重复执行任务。例如，每隔 5 秒执行一次。</li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from apscheduler.schedulers.blocking import BlockingScheduler</span></span>
<span class="line"><span></span></span>
<span class="line"><span>scheduler = BlockingScheduler()</span></span>
<span class="line"><span>scheduler.add_job(my_job, &#39;interval&#39;, seconds=5)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>CronTrigger</strong>：类似于 Linux 的 cron，支持复杂的周期性计划，如每天凌晨 1 点执行。</li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from apscheduler.triggers.cron import CronTrigger</span></span>
<span class="line"><span>from apscheduler.schedulers.blocking import BlockingScheduler</span></span>
<span class="line"><span></span></span>
<span class="line"><span>trigger = CronTrigger(hour=1, minute=0)  # 每天凌晨1点执行</span></span>
<span class="line"><span>scheduler = BlockingScheduler()</span></span>
<span class="line"><span>scheduler.add_job(my_job, trigger)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>DateTrigger</strong>：在特定的日期和时间只执行一次。</li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from apscheduler.triggers.date import DateTrigger</span></span>
<span class="line"><span>from apscheduler.schedulers.blocking import BlockingScheduler</span></span>
<span class="line"><span></span></span>
<span class="line"><span>trigger = DateTrigger(run_date=datetime.datetime(2023, 4, 1))  # 在2023年4月1日执行</span></span>
<span class="line"><span>scheduler = BlockingScheduler()</span></span>
<span class="line"><span>scheduler.add_job(my_job, trigger)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这些触发器使得<code>APScheduler</code>能够灵活适应各种定时任务需求，从简单的定时提醒到复杂的业务逻辑定时处理，都能轻松应对。通过合理选择触发器类型和配置 ，可以构建出既高效又可靠的定时任务解决方案。</p><h2 id="_4、基于-unix-cron-的-python-实现-🕒" tabindex="-1">4、基于 Unix Cron 的 Python 实现 🕒 <a class="header-anchor" href="#_4、基于-unix-cron-的-python-实现-🕒" aria-label="Permalink to &quot;4、基于 Unix Cron 的 Python 实现 🕒&quot;">​</a></h2><h3 id="_4-1-学习-linux-crontab-语法" tabindex="-1">4.1 学习 Linux Crontab 语法 <a class="header-anchor" href="#_4-1-学习-linux-crontab-语法" aria-label="Permalink to &quot;4.1 学习 Linux Crontab 语法&quot;">​</a></h3><p>Cron 是 Unix/Linux 系统中用于定时执行任务的强大工具。Crontab 文件包含了定时任务的列表，每个任务都遵循一个特定的语法来定义何时执行。Cron 语法由六个字段组成，分别代表分钟、小时、一天中的哪一天、月份、一周中的哪一天和命令。字段之间用空格分隔，其格式如下：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>* * * * * command_to_execute</span></span>
<span class="line"><span>- - - - -</span></span>
<span class="line"><span>| | | | |</span></span>
<span class="line"><span>| | | | +--- 星期几 (0 - 6) ，0 和 7 都代表周日</span></span>
<span class="line"><span>| | | +----- 月份 (1 - 12)</span></span>
<span class="line"><span>| | +------- 一个月中的哪一天 (1 - 31)</span></span>
<span class="line"><span>| +--------- 小时 (0 - 23)</span></span>
<span class="line"><span>+----------- 分钟 (0 - 59)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>特殊符号含义：</p><ul><li><code>*</code> 表示任何值都匹配，如<code>*</code>在分钟字段意味着“每分钟”。</li><li><code>,</code> 用于分隔多个值 ，如<code>3,15</code>表示第 3 分钟和第 15 分钟。</li><li><code>-</code> 表示范围，如<code>1-5</code>表示从第 1 到第 5 分钟。</li><li><code>/</code> 表示间隔，如<code>*/2</code>表示每隔 2 分钟。</li></ul><h3 id="_4-2-python-脚本与系统-cron-结合" tabindex="-1">4.2 Python 脚本与系统 Cron 结合 <a class="header-anchor" href="#_4-2-python-脚本与系统-cron-结合" aria-label="Permalink to &quot;4.2 Python 脚本与系统 Cron 结合&quot;">​</a></h3><p>将 Python 脚本与 Cron 结合，可以实现系统的定时任务自动化。首先，你需要准备一个 Python 脚本，假设脚本名为<code>my_script.py</code>，内容如下：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>#!/usr/bin/env python3</span></span>
<span class="line"><span># my_script.py</span></span>
<span class="line"><span>import datetime</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def main():</span></span>
<span class="line"><span>    now = datetime.datetime.now()</span></span>
<span class="line"><span>    print(f&quot;Python script ran at {now}&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if __name__ == &quot;__main__&quot;:</span></span>
<span class="line"><span>    main()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>确保该脚本有执行权限，可通过命令行赋予：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>chmod +x my_script.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>接下来，将此脚本添加到 Cron 计划中。编辑你的 crontab 文件：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>crontab -e</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在打开的文件末尾添加一行来安排任务，例如每天早上 6 点执行：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>0 6 * * * /path/to/your/my_script.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里<code>/path/to/your/my_script.py</code>是脚本的绝对路径。保存退出后，Cron 将自动在指定时间执行该 Python 脚本。记得检查系统日志（如<code>/var/log/syslog</code>）以确认任务是否按预期执行 ，以及是否有任何错误信息。</p><p>通过这种结合方式，你可以充分利用 Cron 的成熟定时机制来调度 Python 脚本执行，无需在 Python 程序内部实现复杂的定时逻辑。</p><h2 id="_5、tornado-异步定时任务-🔄" tabindex="-1">5、Tornado 异步定时任务 🔄 <a class="header-anchor" href="#_5、tornado-异步定时任务-🔄" aria-label="Permalink to &quot;5、Tornado 异步定时任务 🔄&quot;">​</a></h2><h3 id="_5-1-tornado-事件循环基础" tabindex="-1">5.1 Tornado 事件循环基础 <a class="header-anchor" href="#_5-1-tornado-事件循环基础" aria-label="Permalink to &quot;5.1 Tornado 事件循环基础&quot;">​</a></h3><p>Tornado 是一个 Python 网络库，以其异步非阻塞 IO 和高并发能力著称，特别适合构建高性能的 Web 服务和实时应用。其核心在于<code>IOLoop</code> ，这是一个事件循环 ，负责监听和处理 I/O 事件，如网络连接、超时、信号等，以及调度回调函数。</p><p>在 Tornado 中，所有的异步操作都围绕着<code>IOLoop</code>展开。当你启动一个 Tornado 应用时，实际上是在启动一个事件循环。通过将耗时的操作（如网络请求、文件读写）异步化，Tornado 能够高效地处理大量并发连接，而无需为每个连接分配单独的线程或进程。</p><h3 id="_5-2-利用-ioloop-安排定时任务" tabindex="-1">5.2 利用 IOLoop 安排定时任务 <a class="header-anchor" href="#_5-2-利用-ioloop-安排定时任务" aria-label="Permalink to &quot;5.2 利用 IOLoop 安排定时任务&quot;">​</a></h3><p>Tornado 的<code>IOLoop</code>提供了<code>call_later</code>、<code>call_at</code>等方法，可以方便地安排一次性或周期性的定时任务。这些方法不阻塞主事件循环，因此非常适合在异步环境中执行定时操作。</p><p><strong>一次性定时任务示例</strong></p><p>下面的代码展示了如何使用<code>IOLoop.call_later</code>在 5 秒后执行一个函数：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>import tornado.ioloop</span></span>
<span class="line"><span>import time</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def print_time():</span></span>
<span class="line"><span>    print(&quot;Current time:&quot;, time.ctime())</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tornado.ioloop.IOLoop.current().call_later(5, print_time)  # 5秒后执行print_time</span></span>
<span class="line"><span>tornado.ioloop.IOLoop.current().start()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>周期性定时任务示例</strong></p><p>若要实现周期性执行，可以结合<code>call_later</code>和函数自身调用来重新安排下一次执行。下面是一个每两秒打印时间的示例：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>import tornado.ioloop</span></span>
<span class="line"><span>import time</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def periodic_callback():</span></span>
<span class="line"><span>    print(&quot;Current time:&quot;, time.ctime())</span></span>
<span class="line"><span>    tornado.ioloop.IOLoop.current().call_later(2, periodic_callback)  # 每2秒调用一次</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tornado.ioloop.IOLoop.current().call_later(2, periodic_callback)  # 首次调度</span></span>
<span class="line"><span>tornado.ioloop.IOLoop.current().start()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>通过上述示例 ，可以看出 Tornado 的<code>IOLoop</code>为异步定时任务提供了一种高效、灵活的解决方案，尤其适合那些需要在高性能服务器端应用中集成定时处理逻辑的场景。</p><h2 id="_6、celery-分布式任务队列-⏰" tabindex="-1">6、Celery 分布式任务队列 ⏰ <a class="header-anchor" href="#_6、celery-分布式任务队列-⏰" aria-label="Permalink to &quot;6、Celery 分布式任务队列 ⏰&quot;">​</a></h2><h3 id="_6-1-celery-简介与安装部署" tabindex="-1">6.1 Celery 简介与安装部署 <a class="header-anchor" href="#_6-1-celery-简介与安装部署" aria-label="Permalink to &quot;6.1 Celery 简介与安装部署&quot;">​</a></h3><p>Celery 是一款广泛使用的分布式任务队列系统，适用于处理大量消息和后台任务，特别是那些需要异步处理或定时执行的任务。它支持多种消息中间件（如 RabbitMQ、Redis）作为任务代理，确保了任务的可靠传递与高可用性。</p><p><strong>安装</strong></p><p>首先，确保安装了 Python 环境。接着，通过 pip 安装 Celery 及其依赖：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install celery[redis]  # 以Redis为消息中间件安装</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_6-2-定时任务调度与监控" tabindex="-1">6.2 定时任务调度与监控 <a class="header-anchor" href="#_6-2-定时任务调度与监控" aria-label="Permalink to &quot;6.2 定时任务调度与监控&quot;">​</a></h3><p>Celery 提供了丰富的定时任务功能，主要通过<code>beat</code>服务和<code>crontab</code>风格的调度表达式来实现。</p><p><strong>定时任务配置</strong></p><p>在项目目录下创建一个<code>celery.py</code>文件，配置定时任务：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from celery import Celery</span></span>
<span class="line"><span>app = Celery(&#39;tasks&#39;, broker=&#39;redis://localhost:6379/0&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.task</span></span>
<span class="line"><span>def send_email_report():</span></span>
<span class="line"><span>    print(&quot;Sending email report...&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后，在另一个文件中配置定时任务调度（例如在<code>tasks.py</code>中）：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from celery.schedules import crontab</span></span>
<span class="line"><span>from .celery import app</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.conf.beat_schedule = {</span></span>
<span class="line"><span>    &#39;send-email-every-day&#39;: {</span></span>
<span class="line"><span>        &#39;task&#39;: &#39;tasks.send_email_report&#39;,</span></span>
<span class="line"><span>        &#39;schedule&#39;: crontab(hour=0, minute=0),  # 每天凌晨执行</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>运行 Celery 服务</strong></p><p>启动 Celery worker 处理任务：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>celery -A tasks worker --loglevel=info</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>同时，启动<code>beat</code>服务以驱动定时任务：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>celery beat -A tasks --loglevel=info</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>监控</strong></p><p>Celery 提供了实时监控工具 Flower，可以查看任务状态、进度和结果。安装 Flower 并运行：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install flower</span></span>
<span class="line"><span>flower -A tasks --port=5555</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>访问<code>http://localhost:5555</code>即可查看监控界面。</p><p>通过上述步骤，你可以有效地在 Python 应用中集成 Celery 实现分布式定时任务处理 ，不仅提高了任务处理的效率和可靠性，还便于监控和管理。</p><h2 id="_7、使用-asyncio-实现异步定时-🔄" tabindex="-1">7、使用 asyncio 实现异步定时 🔄 <a class="header-anchor" href="#_7、使用-asyncio-实现异步定时-🔄" aria-label="Permalink to &quot;7、使用 asyncio 实现异步定时 🔄&quot;">​</a></h2><h3 id="_7-1-异步编程基础回顾" tabindex="-1">7.1 异步编程基础回顾 <a class="header-anchor" href="#_7-1-异步编程基础回顾" aria-label="Permalink to &quot;7.1 异步编程基础回顾&quot;">​</a></h3><p>在 Python 中，<code>asyncio</code>是一个用于编写并发代码的库，利用协程(coroutine)、事件循环(event loop)和任务(task)等概念 ，实现了异步 IO 操作。协程是一种轻量级的子例程，可以在等待 IO 操作（如网络请求、磁盘读写）期间挂起，从而使其他任务得以执行，提高了程序的效率和响应速度。</p><h3 id="_7-2-asyncio-实现定时执行案例" tabindex="-1">7.2 asyncio 实现定时执行案例 <a class="header-anchor" href="#_7-2-asyncio-实现定时执行案例" aria-label="Permalink to &quot;7.2 asyncio 实现定时执行案例&quot;">​</a></h3><p>要使用<code>asyncio</code>来实现定时任务，通常涉及<code>asyncio.sleep()</code>函数配合事件循环。下面是一个简单的定时打印消息的例子：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>import asyncio</span></span>
<span class="line"><span></span></span>
<span class="line"><span>async def print_every_three_seconds():</span></span>
<span class="line"><span>    while True:</span></span>
<span class="line"><span>        print(&quot;This message is printed every three seconds.&quot;)</span></span>
<span class="line"><span>        await asyncio.sleep(3)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>async def main():</span></span>
<span class="line"><span>    # 创建一个任务并启动</span></span>
<span class="line"><span>    task = asyncio.create_task(print_every_three_seconds())</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # 保持主程序运行，否则事件循环一旦执行完就会结束</span></span>
<span class="line"><span>    await asyncio.sleep(10)  # 示例中让主程序等待10秒后自然结束</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 运行主函数</span></span>
<span class="line"><span>asyncio.run(main())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这段代码定义了一个异步函数<code>print_every_three_seconds</code>，它会无限循环每隔 3 秒打印一次消息。<code>main</code>函数中通过<code>asyncio.create_task</code>创建了这个任务并在事件循环中启动。为了使主程序维持运行一段时间以观察输出效果，我们使用了<code>await asyncio.sleep(10)</code>。实际上，生产环境中可能需要根据具体需求调整或采用更复杂的机制来控制主循环的生命周期。</p><p>请注意，实际应用中可能需要考虑任务的取消、异常处理等高级特性，以确保程序的健壮性。</p><h2 id="_8、基于-django-的-cronjobs-管理后台-💻" tabindex="-1">8、基于 Django 的 CronJobs 管理后台 💻 <a class="header-anchor" href="#_8、基于-django-的-cronjobs-管理后台-💻" aria-label="Permalink to &quot;8、基于 Django 的 CronJobs 管理后台 💻&quot;">​</a></h2><h3 id="_8-1-django-cron-介绍" tabindex="-1">8.1 Django-Cron 介绍 <a class="header-anchor" href="#_8-1-django-cron-介绍" aria-label="Permalink to &quot;8.1 Django-Cron 介绍&quot;">​</a></h3><p>Django-Cron 是专为 Django 框架设计的库，旨在简化定时任务的管理和调度 ，特别是将其集成到 Django 的管理后台。它允许开发者通过 Django 的 Admin 界面来创建、编辑和删除定时任务 ，而无需直接操作服务器的 cron 作业。这样 ，定时任务的管理变得更加直观和便捷，特别适合 Django 项目的维护团队协作。</p><h3 id="_8-2-后台管理系统搭建" tabindex="-1">8.2 后台管理系统搭建 <a class="header-anchor" href="#_8-2-后台管理系统搭建" aria-label="Permalink to &quot;8.2 后台管理系统搭建&quot;">​</a></h3><p><strong>安装 Django-Cron</strong></p><p>首先，通过 pip 安装 Django-cron 库：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pip install django-cron</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>配置 Django 项目</strong></p><ol><li><ol><li><strong>添加到 INSTALLED_APPS</strong>：在你的 Django 项目的<code>settings.py</code>文件中 ，将<code>django_cron</code>加入<code>INSTALLED_APPS</code>列表。</li></ol></li></ol><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>INSTALLED_APPS = [</span></span>
<span class="line"><span>    # ...</span></span>
<span class="line"><span>    &#39;django_cron&#39;,</span></span>
<span class="line"><span>    # ...</span></span>
<span class="line"><span>]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li><ol><li><strong>配置 CRON_CLASSES</strong>：在<code>settings.py</code>中定义你的定时任务类列表。</li></ol></li></ol><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>CRON_CLASSES = [</span></span>
<span class="line"><span>    &#39;myapp.crons.MyCronJob&#39;,  # 假设MyCronJob是你自定义的定时任务类</span></span>
<span class="line"><span>]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>创建定时任务类</strong></p><p>在你的应用目录下创建一个名为<code>cron.py</code>的文件，并定义你的定时任务类。这个类需要继承自<code>Cron.JobBase</code>。</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>from django_cron import CronJobBase, Schedule</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class MyCronJob(CronJobBase):</span></span>
<span class="line"><span>    RUN_EVERY_MINS = 1  # 每分钟运行一次</span></span>
<span class="line"><span>    schedule = Schedule(run_every_mins=RUN_EVERY_MINS)</span></span>
<span class="line"><span>    code = &#39;my_cron.my_cron_job&#39;    # 任务唯一标识</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    def do(self):</span></span>
<span class="line"><span>        print(&quot;Cron Job Running&quot;)</span></span>
<span class="line"><span>        # 在这里执行你的任务逻辑</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>创建管理界面</strong></p><ul><li>运行迁移确保 Django-Cron 的数据库表被创建：</li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>python manage.py migrate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>登录入 Django 管理后台，你应该能看到一个名为&quot;Cron&quot;的新条目。在这里，你可以查看、编辑或删除已定义的定时任务。</li></ul><p><strong>注意事项</strong></p><ul><li>通常 ，Django-Cron 通过管理命令<code>python manage.py runcrons</code>来执行任务。你可能需要将其加入到你的系统 cron 作业或使用像 Supervisor 这样的工具来确保它持续运行。</li><li>确保 Django-Cron 的执行环境与 Django 项目一致 ，特别是在使用环境变量或依赖外部服务时。</li></ul><p>通过 Django-Cron，你可以充分利用 Django 的 Admin 界面管理定时任务，简化运维工作，提高开发效率，确保定时任务的灵活性和可维护性。</p><h2 id="第-9-章-总结与选择建议-🎯" tabindex="-1">第 9 章 总结与选择建议 🎯 <a class="header-anchor" href="#第-9-章-总结与选择建议-🎯" aria-label="Permalink to &quot;第 9 章 总结与选择建议 🎯&quot;">​</a></h2><p>掌握多元定时任务策略，从基础 Thread 定时执行到 APScheduler 的灵活性 ，乃至 Celery 的分布式处理与 asyncio 的异步高效 ，乃至 Quartz 思想在 Python 中的实现，每种方法各有千秋。选择时考虑应用场景、性能需求与资源优化，确保任务调度既高效又适配项目需求。</p><h1 id="python-tika工具包" tabindex="-1">python tika工具包 <a class="header-anchor" href="#python-tika工具包" aria-label="Permalink to &quot;python tika工具包&quot;">​</a></h1><p>提取PDF文档内容</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tika </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> parser</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 解析PDF文件并获取文本内容</span></span>
<span class="line"><span style="color:#ABB2BF;">parsed_pdf </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.pdf&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(parsed_pdf[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>提取Word文档（.docx）的内容</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">parsed_docx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.docx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(parsed_docx[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>提取HTML页面元数据</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">html_metadata </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.html&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">meta</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(html_metadata[</span><span style="color:#98C379;">&#39;metadata&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>提取ZIP压缩包内文件的文本</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">zip_content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;archive.zip&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> file_content </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> zip_content[</span><span style="color:#98C379;">&#39;files&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#56B6C2;">  print</span><span style="color:#ABB2BF;">(file_content[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>检测文件类型</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">file_type </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_buffer</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.jpg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">())[</span><span style="color:#98C379;">&#39;metadata&#39;</span><span style="color:#ABB2BF;">][</span><span style="color:#98C379;">&#39;Content-Type&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(file_type)  </span><span style="color:#7F848E;font-style:italic;"># 输出类似 &quot;image/jpeg&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>读取JSON格式的Tika响应</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">response_json </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">xmlContent</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(response_json[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>提取纯文本文件的元数据与内容</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">txt_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.txt&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(txt_data[</span><span style="color:#98C379;">&#39;metadata&#39;</span><span style="color:#ABB2BF;">])  </span><span style="color:#7F848E;font-style:italic;"># 元数据（如果有）</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(txt_data[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])   </span><span style="color:#7F848E;font-style:italic;"># 文本内容</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>自定义Tika服务器地址</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> tika </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> parser, ServerEndpoint</span></span>
<span class="line"><span style="color:#ABB2BF;">custom_server </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> ServerEndpoint</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;http://localhost:9998/tika&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">parsed_txt </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.txt&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">serverEndpoint</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">custom_server)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(parsed_txt[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>处理嵌套文件结构</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 假设 archive.tar.gz 包含多个层级的文件</span></span>
<span class="line"><span style="color:#ABB2BF;">nested_content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;archive.tar.gz&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> nested_content[</span><span style="color:#98C379;">&#39;files&#39;</span><span style="color:#ABB2BF;">]:</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#98C379;"> &#39;content&#39;</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> item:</span></span>
<span class="line"><span style="color:#56B6C2;">        print</span><span style="color:#ABB2BF;">(item[</span><span style="color:#98C379;">&#39;filename&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, item[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">---</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>提取Excel表格内容</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">parsed_xlsx </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parser.</span><span style="color:#61AFEF;">from_file</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;example.xlsx&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(parsed_xlsx[</span><span style="color:#98C379;">&#39;content&#39;</span><span style="color:#ABB2BF;">])  </span><span style="color:#7F848E;font-style:italic;"># 注意：Excel内容可能以XML形式呈现</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,1590),Cn=[mn];function dn(Dn,En,fn,_n,qn,hn){return a(),n("div",null,Cn)}const vn=s(un,[["render",dn]]);export{xn as __pageData,vn as default};
