import{_ as s,c as n,o as a,a3 as e}from"./chunks/framework.zGi9i9Bf.js";const g=JSON.parse('{"title":"将Docker镜像编译成独立可移植二进制文件","description":"","frontmatter":{},"headers":[],"relativePath":"Document/Docker/Docker应用/将Docker镜像编译成独立可移植二进制文件.md","filePath":"Document/Docker/Docker应用/将Docker镜像编译成独立可移植二进制文件.md","lastUpdated":1717759497000}'),p={name:"Document/Docker/Docker应用/将Docker镜像编译成独立可移植二进制文件.md"},l=e(`<h1 id="将docker镜像编译成独立可移植二进制文件" tabindex="-1">将Docker镜像编译成独立可移植二进制文件 <a class="header-anchor" href="#将docker镜像编译成独立可移植二进制文件" aria-label="Permalink to &quot;将Docker镜像编译成独立可移植二进制文件&quot;">​</a></h1><h3 id="介绍" tabindex="-1"><strong>介绍</strong> <a class="header-anchor" href="#介绍" aria-label="Permalink to &quot;**介绍**&quot;">​</a></h3><p>Dockerc 它是一个容器镜像编译器，可以将Docker容器镜像编译成独立的可移植二进制文件。这意味着用户不再需要使用<code>docker run</code>命令来运行容器，也不需要使用<code>pip install</code>或<code>npm i</code>来安装软件包，而是可以直接运行编译后的可执行文件。</p><p>编译后的二进制文件可以像普通二进制文件一样被调用。此外，网络服务在容器内部运行时，用户可以直接访问，而无需指定<code>-p</code>参数来映射端口。</p><p>这个项目对于希望简化容器部署和管理的用户来说非常有用，尤其是那些希望避免复杂的Docker命令行操作的用户。</p><h3 id="安装webman" tabindex="-1"><strong>安装webman</strong> <a class="header-anchor" href="#安装webman" aria-label="Permalink to &quot;**安装webman**&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>composer create-project workerman/webman tinywan-docker-webman</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="下载php二进制" tabindex="-1"><strong>下载PHP二进制</strong> <a class="header-anchor" href="#下载php二进制" aria-label="Permalink to &quot;**下载PHP二进制**&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>wget https://www.workerman.net/download/php/php-8.2.8-static-bin-x86_64.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>解压即可得到一个PHP可执行文件，可直接使用，无需安装PHP环境。目前只支持Linux系统。通常下载<code>x86_64</code>架构。下载地址 <code>https://www.workerman.net/download</code></p></blockquote><p>解压后会生成一个二进制PHP文件</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>tar -zxvf php-8.2.8-static-bin-x86_64.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看版本</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>./php -v</span></span>
<span class="line"><span>PHP 8.2.8 (cli) (built: Aug 10 2023 13:02:26) (NTS)</span></span>
<span class="line"><span>Copyright (c) The PHP Group</span></span>
<span class="line"><span>Zend Engine v4.2.8, Copyright (c) Zend Technologies</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="构建docker镜像" tabindex="-1"><strong>构建Docker镜像</strong> <a class="header-anchor" href="#构建docker镜像" aria-label="Permalink to &quot;**构建Docker镜像**&quot;">​</a></h3><h4 id="dockerfile-文件" tabindex="-1"><strong>Dockerfile 文件</strong> <a class="header-anchor" href="#dockerfile-文件" aria-label="Permalink to &quot;**Dockerfile 文件**&quot;">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>FROM alpine:latest</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN sed -i &quot;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&quot; /etc/apk/repositories</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN apk update &amp;&amp; \\</span></span>
<span class="line"><span>    apk --no-cache upgrade &amp;&amp; \\</span></span>
<span class="line"><span>    rm -rf /var/cache/apk/* &amp;&amp; \\</span></span>
<span class="line"><span>    mkdir -p /app/opcache</span></span>
<span class="line"><span></span></span>
<span class="line"><span>WORKDIR /app</span></span>
<span class="line"><span></span></span>
<span class="line"><span>COPY ./ /app/</span></span>
<span class="line"><span># 直接使用 PHP 静态二进制文件</span></span>
<span class="line"><span>RUN mv /app/php /usr/local/bin/php &amp;&amp; chmod +x /usr/local/bin/php</span></span>
<span class="line"><span></span></span>
<span class="line"><span>EXPOSE 8787</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CMD [&quot;php&quot;, &quot;-c&quot;, &quot;php.ini&quot;, &quot;start.php&quot;, &quot;start&quot;]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="php-ini-配置文件" tabindex="-1"><strong>php.ini 配置文件</strong> <a class="header-anchor" href="#php-ini-配置文件" aria-label="Permalink to &quot;**php.ini 配置文件**&quot;">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>date.timezone=&quot;UTC&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="构建镜像" tabindex="-1"><strong>构建镜像</strong> <a class="header-anchor" href="#构建镜像" aria-label="Permalink to &quot;**构建镜像**&quot;">​</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>docker build . -t tinywan/webman:8.2.8 --load</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>输出结果</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>[+] Building 3.7s (11/11) FINISHED                                                                                            docker:default</span></span>
<span class="line"><span> =&gt; [internal] load build definition from Dockerfile                                                                                    0.0s</span></span>
<span class="line"><span> =&gt; =&gt; transferring dockerfile: 436B                                                                                                    0.0s</span></span>
<span class="line"><span> =&gt; [internal] load metadata for docker.io/library/alpine:latest                                                                        0.2s</span></span>
<span class="line"><span> =&gt; [internal] load .dockerignore                                                                                                       0.0s</span></span>
<span class="line"><span> =&gt; =&gt; transferring context: 2B                                                                                                         0.0s</span></span>
<span class="line"><span> =&gt; [1/6] FROM docker.io/library/alpine:latest@sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300                  0.0s</span></span>
<span class="line"><span> =&gt; [internal] load build context                                                                                                       0.3s</span></span>
<span class="line"><span> =&gt; =&gt; transferring context: 30.72MB                                                                                                    0.3s</span></span>
<span class="line"><span> =&gt; CACHED [2/6] RUN sed -i &quot;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&quot; /etc/apk/repositories                                       0.0s</span></span>
<span class="line"><span> =&gt; CACHED [3/6] RUN apk update &amp;&amp;     apk --no-cache upgrade &amp;&amp;     rm -rf /var/cache/apk/* &amp;&amp;     mkdir -p /app/opcache               0.0s</span></span>
<span class="line"><span> =&gt; CACHED [4/6] WORKDIR /app                                                                                                           0.0s</span></span>
<span class="line"><span> =&gt; [5/6] COPY ./ /app/                                                                                                                 0.7s</span></span>
<span class="line"><span> =&gt; [6/6] RUN mv /app/php /usr/local/bin/php &amp;&amp; chmod +x /usr/local/bin/php                                                             2.1s</span></span>
<span class="line"><span> =&gt; exporting to image                                                                                                                  0.3s</span></span>
<span class="line"><span> =&gt; =&gt; exporting layers                                                                                                                 0.3s</span></span>
<span class="line"><span> =&gt; =&gt; writing image sha256:45de23415b779b5660070e8035667dca0b5b389d2e229ad4a7092d9e650370c5                                            0.0s</span></span>
<span class="line"><span> =&gt; =&gt; naming to docker.io/tinywan/webman:8.2.8</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>查看镜像</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># docker images</span></span>
<span class="line"><span></span></span>
<span class="line"><span>REPOSITORY                  TAG                IMAGE ID       CREATED              SIZE</span></span>
<span class="line"><span>tinywan/webman              8.2.8              45de23415b77   About a minute ago   71MB</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="下载-dockerc" tabindex="-1"><strong>下载 dockerc</strong> <a class="header-anchor" href="#下载-dockerc" aria-label="Permalink to &quot;**下载 dockerc**&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>wget https://github.com/NilsIrl/dockerc/releases/download/v0.2.1/dockerc</span></span>
<span class="line"><span>chmod u+x dockerc</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="使用-dockerc-将镜像导出为二进制文件" tabindex="-1"><strong>使用 dockerc 将镜像导出为二进制文件</strong> <a class="header-anchor" href="#使用-dockerc-将镜像导出为二进制文件" aria-label="Permalink to &quot;**使用 dockerc 将镜像导出为二进制文件**&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>./dockerc --image docker-daemon:tinywan/webman:8.2.8 --output webman.bin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>输出以下结果表示导出成功</p></blockquote><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>Getting image source signatures</span></span>
<span class="line"><span>Copying blob a31c5b53afbf done   | </span></span>
<span class="line"><span>Copying blob 8d3ac3489996 done   | </span></span>
<span class="line"><span>Copying blob 3a1eb8879fac done   | </span></span>
<span class="line"><span>Copying blob fca36167c75a done   | </span></span>
<span class="line"><span>Copying blob 5f70bf18a086 done   | </span></span>
<span class="line"><span>Copying blob b9b78906a59e done   | </span></span>
<span class="line"><span>Copying config 2678f4ef97 done   | </span></span>
<span class="line"><span>Writing manifest to image destination</span></span>
<span class="line"><span>Parallel mksquashfs: Using 2 processors</span></span>
<span class="line"><span>Creating 4.0 filesystem on webman.bin, block size 131072.</span></span>
<span class="line"><span>[============================================================================================================================|] 671/671 100%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Exportable Squashfs 4.0 filesystem, zstd compressed, data block size 131072</span></span>
<span class="line"><span> compressed data, compressed metadata, compressed fragments,</span></span>
<span class="line"><span> compressed xattrs, compressed ids</span></span>
<span class="line"><span> duplicates are removed</span></span>
<span class="line"><span>Filesystem size 11344.11 Kbytes (11.08 Mbytes)</span></span>
<span class="line"><span> 31.87% of uncompressed filesystem size (35594.23 Kbytes)</span></span>
<span class="line"><span>Inode table size 6844 bytes (6.68 Kbytes)</span></span>
<span class="line"><span> 21.11% of uncompressed inode table size (32419 bytes)</span></span>
<span class="line"><span>Directory table size 9080 bytes (8.87 Kbytes)</span></span>
<span class="line"><span> 46.37% of uncompressed directory table size (19580 bytes)</span></span>
<span class="line"><span>Xattr table size 36 bytes (0.04 Kbytes)</span></span>
<span class="line"><span> 112.50% of uncompressed xattr table size (32 bytes)</span></span>
<span class="line"><span>Number of duplicate files found 10</span></span>
<span class="line"><span>Number of inodes 911</span></span>
<span class="line"><span>Number of files 414</span></span>
<span class="line"><span>Number of fragments 17</span></span>
<span class="line"><span>Number of symbolic links 331</span></span>
<span class="line"><span>Number of device nodes 0</span></span>
<span class="line"><span>Number of fifo nodes 0</span></span>
<span class="line"><span>Number of socket nodes 0</span></span>
<span class="line"><span>Number of directories 166</span></span>
<span class="line"><span>Number of hard-links 0</span></span>
<span class="line"><span>Number of ids (unique uids + gids) 1</span></span>
<span class="line"><span>Number of uids 1</span></span>
<span class="line"><span> root (0)</span></span>
<span class="line"><span>Number of gids 1</span></span>
<span class="line"><span> root (0)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="执行二进制文件" tabindex="-1"><strong>执行二进制文件</strong> <a class="header-anchor" href="#执行二进制文件" aria-label="Permalink to &quot;**执行二进制文件**&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># ./webman.bin </span></span>
<span class="line"><span></span></span>
<span class="line"><span>unknown argument ignored: lazytime</span></span>
<span class="line"><span>Workerman[start.php] start in DEBUG mode</span></span>
<span class="line"><span>------------------------------------------- WORKERMAN -------------------------------------------</span></span>
<span class="line"><span>Workerman version:4.1.15          PHP version:8.2.8           Event-Loop:\\Workerman\\Events\\Event</span></span>
<span class="line"><span>-------------------------------------------- WORKERS --------------------------------------------</span></span>
<span class="line"><span>proto   user            worker          listen                 processes    status           </span></span>
<span class="line"><span>tcp     root            webman          http://0.0.0.0:8282    8             [OK]            </span></span>
<span class="line"><span>tcp     root            monitor         none                   1             [OK]            </span></span>
<span class="line"><span>-------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span>Press Ctrl+C to stop. Start success.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div>`,33),r=[l];function i(c,o,t,b,d,u){return a(),n("div",null,r)}const h=s(p,[["render",i]]);export{g as __pageData,h as default};
